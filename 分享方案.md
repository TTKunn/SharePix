# åº”ç”¨å†…åˆ†äº«åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

### 1.1 åŠŸèƒ½æè¿°

å®ç°ç±»ä¼¼Bç«™çš„åº”ç”¨å†…å¸–å­åˆ†äº«åŠŸèƒ½ï¼Œç”¨æˆ·å¯ä»¥å°†å¸–å­åˆ†äº«ç»™äº’å…³çš„å¥½å‹ï¼Œå¥½å‹å¯ä»¥åœ¨"æ”¶åˆ°çš„åˆ†äº«"åˆ—è¡¨ä¸­æŸ¥çœ‹åˆ†äº«å¡ç‰‡ï¼Œç‚¹å‡»åè·³è½¬åˆ°å¯¹åº”çš„å¸–å­è¯¦æƒ…é¡µé¢ã€‚

### 1.2 æ ¸å¿ƒæµç¨‹

```
ç”¨æˆ·Aç‚¹å‡»åˆ†äº« â†’ é€‰æ‹©äº’å…³ç”¨æˆ·B â†’ åˆ›å»ºåˆ†äº«è®°å½• â†’ ç”¨æˆ·Båœ¨"æ”¶åˆ°çš„åˆ†äº«"åˆ—è¡¨æŸ¥çœ‹ â†’ ç‚¹å‡»å¡ç‰‡è·³è½¬åˆ°å¸–å­è¯¦æƒ…
```

### 1.3 åŠŸèƒ½ç‰¹ç‚¹

- ä»…æ”¯æŒå¸–å­åˆ†äº«ï¼ˆä¸æ”¯æŒç”¨æˆ·åˆ†äº«ï¼‰
- æ— éœ€å¤æ‚çš„ä¼šè¯ç®¡ç†
- å•å‘ä¿¡æ¯ä¼ é€’ï¼ˆåˆ†äº«è€…â†’æ¥æ”¶è€…ï¼‰
- æ”¯æŒæœªè¯»æ ‡è®°
- åˆ†äº«å¡ç‰‡å±•ç¤ºå¸–å­åŸºæœ¬ä¿¡æ¯
- ç‚¹å‡»å¡ç‰‡ç›´æ¥è·³è½¬è¯¦æƒ…é¡µ

---

## äºŒã€åç«¯è®¾è®¡

### 2.1 æ•°æ®åº“è®¾è®¡

#### 2.1.1 åˆ†äº«è¡¨ (shares)

| å­—æ®µå           | ç±»å‹         | è¯´æ˜         | å¤‡æ³¨                   |
| ---------------- | ------------ | ------------ | ---------------------- |
| id               | BIGINT       | ä¸»é”®ID       | è‡ªå¢                   |
| share_id         | VARCHAR(32)  | åˆ†äº«å”¯ä¸€æ ‡è¯† | å¦‚: SHR_2025Q4_xxxxx   |
| post_id          | VARCHAR(32)  | å¸–å­ID       | å…³è”å¸–å­è¡¨             |
| sender_id        | VARCHAR(32)  | åˆ†äº«è€…ID     | å…³è”ç”¨æˆ·è¡¨             |
| receiver_id      | VARCHAR(32)  | æ¥æ”¶è€…ID     | å…³è”ç”¨æˆ·è¡¨             |
| share_message    | TEXT         | åˆ†äº«é™„è¨€     | å¯é€‰                   |
| is_read          | BOOLEAN      | æ˜¯å¦å·²è¯»     | é»˜è®¤false              |
| post_title       | VARCHAR(255) | å¸–å­æ ‡é¢˜     | å†—ä½™å­—æ®µï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ |
| post_cover_image | VARCHAR(512) | å¸–å­å°é¢å›¾   | å†—ä½™å­—æ®µ               |
| post_description | TEXT         | å¸–å­æè¿°     | å†—ä½™å­—æ®µ               |
| sender_name      | VARCHAR(100) | åˆ†äº«è€…æ˜µç§°   | å†—ä½™å­—æ®µ               |
| sender_avatar    | VARCHAR(512) | åˆ†äº«è€…å¤´åƒ   | å†—ä½™å­—æ®µ               |
| create_time      | BIGINT       | åˆ›å»ºæ—¶é—´     | Unixæ—¶é—´æˆ³(ç§’)         |

**ç´¢å¼•è®¾è®¡ï¼š**

```sql
-- ä¸»è¦æŸ¥è¯¢ç´¢å¼•ï¼ˆæ¥æ”¶è€…æŸ¥çœ‹åˆ†äº«åˆ—è¡¨ï¼‰
INDEX idx_receiver_time (receiver_id, create_time DESC)

-- å‘é€è€…æŸ¥è¯¢ç´¢å¼•
INDEX idx_sender (sender_id)

-- å¸–å­æŸ¥è¯¢ç´¢å¼•ï¼ˆç»Ÿè®¡æŸä¸ªå¸–å­è¢«åˆ†äº«æ¬¡æ•°ï¼‰
INDEX idx_post (post_id)

-- æœªè¯»æŸ¥è¯¢ç´¢å¼•
INDEX idx_receiver_unread (receiver_id, is_read, create_time DESC)
```

**å»ºè¡¨SQLï¼š**

```sql
CREATE TABLE shares (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  share_id VARCHAR(32) UNIQUE NOT NULL,
  post_id VARCHAR(32) NOT NULL,
  sender_id VARCHAR(32) NOT NULL,
  receiver_id VARCHAR(32) NOT NULL,
  share_message TEXT,
  is_read BOOLEAN DEFAULT FALSE,
  post_title VARCHAR(255),
  post_cover_image VARCHAR(512),
  post_description TEXT,
  sender_name VARCHAR(100) NOT NULL,
  sender_avatar VARCHAR(512),
  create_time BIGINT NOT NULL,
  
  INDEX idx_receiver_time (receiver_id, create_time DESC),
  INDEX idx_sender (sender_id),
  INDEX idx_post (post_id),
  INDEX idx_receiver_unread (receiver_id, is_read, create_time DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 2.1.2 å…³æ³¨è¡¨æ‰©å±•ï¼ˆå¦‚æœéœ€è¦ï¼‰

ç°æœ‰çš„å…³æ³¨è¡¨å¯èƒ½éœ€è¦æ·»åŠ "äº’å…³"æ ‡è®°æˆ–æŸ¥è¯¢ä¼˜åŒ–ï¼š

```sql
-- å¦‚æœæ²¡æœ‰äº’å…³æ ‡è®°ï¼Œéœ€è¦æ·»åŠ ç´¢å¼•ä¼˜åŒ–äº’å…³æŸ¥è¯¢
INDEX idx_mutual_following (user_id, followed_user_id, is_following)
```

### 2.2 APIæ¥å£è®¾è®¡

#### 2.2.1 åˆ†äº«å¸–å­

**æ¥å£ï¼š** `POST /shares/post`

**è¯·æ±‚å¤´ï¼š**

```
Authorization: Bearer {token}
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**

```json
{
  "post_id": "POST_2025Q4_xxxxx",
  "receiver_id": "USR_2025Q4_xxxxx",
  "share_message": "è¿™ä¸ªå¤ªèµäº†ï¼Œæ¨èç»™ä½ ï¼"
}
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "message": "åˆ†äº«æˆåŠŸ",
  "data": {
    "share_id": "SHR_2025Q4_xxxxx",
    "create_time": 1760888256
  },
  "timestamp": 1760888256
}
```

**ä¸šåŠ¡é€»è¾‘ï¼š**

1. éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
2. éªŒè¯å¸–å­æ˜¯å¦å­˜åœ¨ä¸”å¯è®¿é—®
3. éªŒè¯æ¥æ”¶è€…æ˜¯å¦å­˜åœ¨
4. æ£€æŸ¥å‘é€è€…å’Œæ¥æ”¶è€…æ˜¯å¦äº’å…³ï¼ˆå¯é€‰ï¼‰
5. æŸ¥è¯¢å¸–å­è¯¦æƒ…ï¼Œæå–æ ‡é¢˜ã€å°é¢ã€æè¿°ç­‰ä¿¡æ¯
6. æŸ¥è¯¢å‘é€è€…ä¿¡æ¯ï¼ˆæ˜µç§°ã€å¤´åƒï¼‰
7. åˆ›å»ºåˆ†äº«è®°å½•
8. è¿”å›åˆ†äº«ID

**é”™è¯¯ç ï¼š**

- `40001`: å¸–å­ä¸å­˜åœ¨
- `40002`: æ¥æ”¶è€…ä¸å­˜åœ¨
- `40003`: æœªäº’å…³æ— æ³•åˆ†äº«
- `40004`: ä¸èƒ½åˆ†äº«ç»™è‡ªå·±

---

#### 2.2.2 è·å–æ”¶åˆ°çš„åˆ†äº«åˆ—è¡¨

**æ¥å£ï¼š** `GET /shares/received`

**è¯·æ±‚å‚æ•°ï¼š**

```
page: number         // é¡µç ï¼Œé»˜è®¤1
page_size: number    // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20ï¼Œæœ€å¤§100
unread_only: boolean // åªçœ‹æœªè¯»ï¼Œé»˜è®¤false
```

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```
GET /shares/received?page=1&page_size=20
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "shares": [
      {
        "share_id": "SHR_2025Q4_xxxxx",
        "post_id": "POST_2025Q4_xxxxx",
        "sender": {
          "user_id": "USR_2025Q4_xxxxx",
          "username": "å¼ ä¸‰",
          "avatar_url": "/uploads/avatars/xxx.jpg"
        },
        "share_message": "è¿™ä¸ªå¤ªèµäº†ï¼Œæ¨èç»™ä½ ï¼",
        "post_info": {
          "title": "ç¾é£Ÿæ¢åº—æ”»ç•¥",
          "description": "ä»Šå¤©å»äº†ä¸€å®¶è¶…å¥½åƒçš„å·èœé¦†...",
          "cover_image": "/uploads/posts/xxx.jpg",
          "like_count": 128,
          "favorite_count": 56
        },
        "is_read": false,
        "create_time": 1760888256
      }
    ],
    "total": 15,
    "page": 1,
    "page_size": 20,
    "has_more": false,
    "unread_count": 3
  },
  "timestamp": 1760888256
}
```

**ä¸šåŠ¡é€»è¾‘ï¼š**

1. éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
2. æ ¹æ® receiver_id æŸ¥è¯¢åˆ†äº«åˆ—è¡¨
3. å¦‚æœ unread_only=trueï¼Œåªè¿”å›æœªè¯»åˆ†äº«
4. æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—
5. åˆ†é¡µè¿”å›
6. åŒæ—¶è¿”å›æœªè¯»æ•°é‡

---

#### 2.2.3 æ ‡è®°åˆ†äº«å·²è¯»(ä¸ç”¨å®ç°ç›´æ¥åˆ é™¤ç›¸å…³åŠŸèƒ½å’Œæ•°æ®è¡¨çš„è®¾è®¡)

**æ¥å£ï¼š** `PUT /shares/{share_id}/read`

**è¯·æ±‚ç¤ºä¾‹ï¼š**

```
PUT /shares/SHR_2025Q4_xxxxx/read
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "message": "æ ‡è®°æˆåŠŸ",
  "data": {
    "share_id": "SHR_2025Q4_xxxxx",
    "is_read": true
  },
  "timestamp": 1760888256
}
```

**ä¸šåŠ¡é€»è¾‘ï¼š**

1. éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€
2. éªŒè¯åˆ†äº«æ˜¯å¦å­˜åœ¨
3. éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºæ¥æ”¶è€…
4. æ›´æ–° is_read å­—æ®µä¸º true
5. è¿”å›ç»“æœ

---

#### 2.2.4 è·å–äº’å…³ç”¨æˆ·åˆ—è¡¨

**æ¥å£ï¼š** `GET /users/mutual-following`

**è¯·æ±‚å‚æ•°ï¼š**

```
page: number       // é¡µç ï¼Œé»˜è®¤1
page_size: number  // æ¯é¡µæ•°é‡ï¼Œé»˜è®¤50
search: string     // æœç´¢å…³é”®è¯ï¼ˆå¯é€‰ï¼‰
```

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "users": [
      {
        "user_id": "USR_2025Q4_xxxxx",
        "username": "å¼ ä¸‰",
        "avatar_url": "/uploads/avatars/xxx.jpg",
        "bio": "çƒ­çˆ±ç”Ÿæ´»ï¼Œçƒ­çˆ±ç¾é£Ÿ"
      }
    ],
    "total": 25,
    "page": 1,
    "page_size": 50,
    "has_more": false
  },
  "timestamp": 1760888256
}
```

**ä¸šåŠ¡é€»è¾‘ï¼š**

1. æŸ¥è¯¢å½“å‰ç”¨æˆ·å…³æ³¨çš„ç”¨æˆ·åˆ—è¡¨
2. æŸ¥è¯¢å…³æ³¨å½“å‰ç”¨æˆ·çš„ç”¨æˆ·åˆ—è¡¨
3. å–äº¤é›†å¾—åˆ°äº’å…³ç”¨æˆ·
4. å¦‚æœæœ‰æœç´¢å…³é”®è¯ï¼ŒæŒ‰ç”¨æˆ·åç­›é€‰
5. åˆ†é¡µè¿”å›

**SQLæŸ¥è¯¢ç¤ºä¾‹ï¼š**

```sql
-- æŸ¥è¯¢äº’å…³ç”¨æˆ·
SELECT DISTINCT u.user_id, u.username, u.avatar_url, u.bio
FROM users u
WHERE u.user_id IN (
  -- æˆ‘å…³æ³¨çš„äºº
  SELECT followed_user_id FROM follows WHERE user_id = ? AND is_following = true
)
AND u.user_id IN (
  -- å…³æ³¨æˆ‘çš„äºº
  SELECT user_id FROM follows WHERE followed_user_id = ? AND is_following = true
)
ORDER BY u.username
LIMIT ? OFFSET ?;
```

---

#### 2.2.5 è·å–æœªè¯»åˆ†äº«æ•°é‡

**æ¥å£ï¼š** `GET /shares/unread-count`

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "unread_count": 3
  },
  "timestamp": 1760888256
}
```

**ä¸šåŠ¡é€»è¾‘ï¼š**

1. ç»Ÿè®¡å½“å‰ç”¨æˆ·æœªè¯»åˆ†äº«æ•°é‡
2. è¿”å›æ•°é‡

---

#### 2.2.6 æ‰¹é‡æ ‡è®°å·²è¯»ï¼ˆå¯é€‰ï¼‰

**æ¥å£ï¼š** `PUT /shares/read-all`

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "message": "å·²å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»",
  "data": {
    "read_count": 5
  },
  "timestamp": 1760888256
}
```

---

#### 2.2.7 åˆ é™¤åˆ†äº«è®°å½•ï¼ˆå¯é€‰ï¼‰

**æ¥å£ï¼š** `DELETE /shares/{share_id}`

**æˆåŠŸå“åº”ï¼š**

```json
{
  "success": true,
  "message": "åˆ é™¤æˆåŠŸ",
  "timestamp": 1760888256
}
```

---

### 2.3 æ•°æ®å†—ä½™ç­–ç•¥

ä¸ºäº†æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œé¿å…å¤æ‚çš„JOINæŸ¥è¯¢ï¼Œåˆ†äº«è¡¨ä¸­å­˜å‚¨ä»¥ä¸‹å†—ä½™å­—æ®µï¼š

**å†—ä½™å­—æ®µï¼š**

- `post_title` - å¸–å­æ ‡é¢˜
- `post_cover_image` - å¸–å­å°é¢å›¾
- `post_description` - å¸–å­æè¿°
- `sender_name` - åˆ†äº«è€…æ˜µç§°
- `sender_avatar` - åˆ†äº«è€…å¤´åƒ

**æ›´æ–°ç­–ç•¥ï¼š**

- åˆ›å»ºåˆ†äº«æ—¶ä¸€æ¬¡æ€§å†™å…¥ï¼Œåç»­ä¸æ›´æ–°
- å¦‚æœéœ€è¦å®æ—¶æ•°æ®ï¼Œå‰ç«¯åœ¨è¯¦æƒ…é¡µé‡æ–°è·å–

**ä¼˜ç‚¹ï¼š**

- å‡å°‘æŸ¥è¯¢æ—¶çš„JOINæ“ä½œ
- æé«˜åˆ—è¡¨é¡µåŠ è½½é€Ÿåº¦
- å³ä½¿åŸå¸–å­è¢«åˆ é™¤ï¼Œåˆ†äº«è®°å½•ä»å¯æ˜¾ç¤º

**ç¼ºç‚¹ï¼š**

- æ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ï¼ˆå¯æ¥å—ï¼‰
- å­˜å‚¨ç©ºé—´ç•¥å¢åŠ ï¼ˆå¯æ¥å—ï¼‰

---

## ä¸‰ã€å‰ç«¯è®¾è®¡

### 3.1 æ•°æ®æ¨¡å‹è®¾è®¡

#### 3.1.1 åˆ†äº«å®ä½“ (ShareEntity)

**æ–‡ä»¶è·¯å¾„ï¼š** `entry/src/main/ets/models/entities/ShareEntity.ets`

```typescript
export interface ShareSender {
  user_id: string
  username: string
  avatar_url: string
}

export interface SharePostInfo {
  title: string
  description: string
  cover_image: string
  like_count: number
  favorite_count: number
}

export interface ShareEntity {
  share_id: string
  post_id: string
  sender: ShareSender
  share_message: string
  post_info: SharePostInfo
  is_read: boolean
  create_time: number
}

export interface ShareListResponse {
  shares: ShareEntity[]
  total: number
  page: number
  page_size: number
  has_more: boolean
  unread_count: number
}

export interface MutualFollowUser {
  user_id: string
  username: string
  avatar_url: string
  bio: string
}
```

---

### 3.2 APIæœåŠ¡å±‚è®¾è®¡

#### 3.2.1 ShareApi.ets

**æ–‡ä»¶è·¯å¾„ï¼š** `entry/src/main/ets/services/api/ShareApi.ets`

```typescript
import { httpRequest, ApiResponse } from './HttpRequest'
import { ApiConstants } from './ApiConstants'
import { 
  ShareEntity, 
  ShareListResponse, 
  MutualFollowUser 
} from '../../models/entities/ShareEntity'

export interface CreateShareData {
  share_id: string
  create_time: number
}

export interface UnreadCountData {
  unread_count: number
}

export interface MutualFollowingResponse {
  users: MutualFollowUser[]
  total: number
  page: number
  page_size: number
  has_more: boolean
}

export const sharePost = async (
  postId: string,
  receiverId: string,
  message?: string
): Promise<ApiResponse<CreateShareData>> => {
  const url = ApiConstants.SHARE_ENDPOINTS.SHARE_POST
  const data: Record<string, string> = {
    post_id: postId,
    receiver_id: receiverId
  }
  if (message) {
    data.share_message = message
  }
  return httpRequest.post<CreateShareData>(url, data)
}

export const getReceivedShares = async (
  page: number = 1,
  pageSize: number = 20,
  unreadOnly: boolean = false
): Promise<ApiResponse<ShareListResponse>> => {
  const url = `${ApiConstants.SHARE_ENDPOINTS.GET_RECEIVED_SHARES}?page=${page}&page_size=${pageSize}&unread_only=${unreadOnly}`
  return httpRequest.get<ShareListResponse>(url)
}

export const markShareAsRead = async (
  shareId: string
): Promise<ApiResponse<{ share_id: string, is_read: boolean }>> => {
  const url = ApiConstants.SHARE_ENDPOINTS.MARK_SHARE_READ.replace('{share_id}', shareId)
  return httpRequest.put(url, {})
}

export const getUnreadShareCount = async (): Promise<ApiResponse<UnreadCountData>> => {
  return httpRequest.get<UnreadCountData>(ApiConstants.SHARE_ENDPOINTS.GET_UNREAD_COUNT)
}

export const getMutualFollowingUsers = async (
  page: number = 1,
  pageSize: number = 50,
  search?: string
): Promise<ApiResponse<MutualFollowingResponse>> => {
  let url = `${ApiConstants.SHARE_ENDPOINTS.GET_MUTUAL_FOLLOWING}?page=${page}&page_size=${pageSize}`
  if (search) {
    url += `&search=${encodeURIComponent(search)}`
  }
  return httpRequest.get<MutualFollowingResponse>(url)
}
```

---

#### 3.2.2 ApiConstants æ‰©å±•

**æ–‡ä»¶è·¯å¾„ï¼š** `entry/src/main/ets/services/api/ApiConstants.ets`

```typescript
interface ShareEndpoints {
  SHARE_POST: string
  GET_RECEIVED_SHARES: string
  MARK_SHARE_READ: string
  GET_UNREAD_COUNT: string
  GET_MUTUAL_FOLLOWING: string
  MARK_ALL_READ: string
  DELETE_SHARE: string
}

export class ApiConstants {
  // ... ç°æœ‰ä»£ç  ...
  
  static readonly SHARE_ENDPOINTS: ShareEndpoints = {
    SHARE_POST: '/shares/post',
    GET_RECEIVED_SHARES: '/shares/received',
    MARK_SHARE_READ: '/shares/{share_id}/read',
    GET_UNREAD_COUNT: '/shares/unread-count',
    GET_MUTUAL_FOLLOWING: '/users/mutual-following',
    MARK_ALL_READ: '/shares/read-all',
    DELETE_SHARE: '/shares/{share_id}'
  }
}
```

---

### 3.3 ç»„ä»¶è®¾è®¡

#### 3.3.1 ShareUserSelector - äº’å…³ç”¨æˆ·é€‰æ‹©å™¨

**æ–‡ä»¶è·¯å¾„ï¼š** `entry/src/main/ets/views/components/ShareUserSelector.ets`

**åŠŸèƒ½ï¼š**

- åº•éƒ¨å¼¹å‡ºçš„ç”¨æˆ·é€‰æ‹©å™¨
- å±•ç¤ºäº’å…³ç”¨æˆ·åˆ—è¡¨
- æ”¯æŒæœç´¢
- é€‰ä¸­ç”¨æˆ·åç¡®è®¤åˆ†äº«

**UIç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€‰æ‹©åˆ†äº«å¯¹è±¡                 [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æœç´¢æ¡†]                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â” å¼ ä¸‰                         â”‚
â”‚  â”‚å¤´ â”‚ çƒ­çˆ±ç”Ÿæ´»ï¼Œçƒ­çˆ±ç¾é£Ÿ          â”‚
â”‚  â”‚åƒ â”‚                       [é€‰æ‹©] â”‚
â”‚  â””â”€â”€â”€â”˜                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â” æå››                         â”‚
â”‚  â”‚å¤´ â”‚ æ‘„å½±çˆ±å¥½è€…                   â”‚
â”‚  â”‚åƒ â”‚                       [é€‰æ‹©] â”‚
â”‚  â””â”€â”€â”€â”˜                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Propsï¼š**

```typescript
{
  visible: boolean
  postId: string
  onClose: () => void
  onShareSuccess: () => void
}
```

---

#### 3.3.2 PostShareCard - å¸–å­åˆ†äº«å¡ç‰‡

**æ–‡ä»¶è·¯å¾„ï¼š** `entry/src/main/ets/views/components/PostShareCard.ets`

**åŠŸèƒ½ï¼š**

- å±•ç¤ºåˆ†äº«ä¿¡æ¯
- å±•ç¤ºå¸–å­é¢„è§ˆ
- ç‚¹å‡»è·³è½¬åˆ°è¯¦æƒ…é¡µ

**UIç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â” å¼ ä¸‰ åˆ†äº«äº†ä¸€ä¸ªå¸–å­      [æœªè¯»]â”‚
â”‚ â”‚å¤´ â”‚  "è¿™ä¸ªå¤ªèµäº†ï¼Œæ¨èç»™ä½ ï¼"      â”‚
â”‚ â”‚åƒ â”‚  2å°æ—¶å‰                       â”‚
â”‚ â””â”€â”€â”€â”˜                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ [å¸–å­å°é¢å›¾ - é«˜åº¦çº¦150]        â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚ ç¾é£Ÿæ¢åº—æ”»ç•¥                    â”‚ â”‚
â”‚ â”‚ ä»Šå¤©å»äº†ä¸€å®¶è¶…å¥½åƒçš„å·èœé¦†...   â”‚ â”‚
â”‚ â”‚ ğŸ‘ 128  â­ 56                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Propsï¼š**

```typescript
{
  share: ShareEntity
  onCardClick: (postId: string) => void
}
```

---

#### 3.3.3 ShareListPage - åˆ†äº«åˆ—è¡¨é¡µé¢

**æ–‡ä»¶è·¯å¾„ï¼š** `entry/src/main/ets/views/pages/ShareListPage.ets`

**åŠŸèƒ½ï¼š**

- å±•ç¤ºæ”¶åˆ°çš„åˆ†äº«åˆ—è¡¨
- ä¸‹æ‹‰åˆ·æ–°
- ä¸Šæ‹‰åŠ è½½æ›´å¤š
- æœªè¯»/å·²è¯»ç­›é€‰

**UIç»“æ„ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† æ”¶åˆ°çš„åˆ†äº«        [å…¨éƒ¨] [æœªè¯»]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [PostShareCard 1]                  â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [PostShareCard 2]                  â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  [PostShareCard 3]                  â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è·¯ç”±é…ç½®ï¼š**

```typescript
{
  name: 'ShareListPage',
  pageSourceFile: 'src/main/ets/views/pages/ShareListPage'
}
```

---

### 3.4 é¡µé¢é›†æˆ

#### 3.4.1 PostDetailPage é›†æˆåˆ†äº«æŒ‰é’®

**ä½ç½®ï¼š** åœ¨ ShareDrawer ä¸­æ·»åŠ "åº”ç”¨å†…åˆ†äº«"é€‰é¡¹

**æµç¨‹ï¼š**

1. ç”¨æˆ·ç‚¹å‡»"æ›´å¤š"æŒ‰é’®
2. åœ¨å¼¹å‡ºçš„ ShareDrawer ä¸­æ˜¾ç¤º"åº”ç”¨å†…åˆ†äº«"
3. ç‚¹å‡»åæ˜¾ç¤º ShareUserSelector
4. é€‰æ‹©ç”¨æˆ·å¹¶ç¡®è®¤åˆ†äº«

---

#### 3.4.2 å¯¼èˆªå…¥å£è®¾è®¡

**æ–¹æ¡ˆAï¼šåœ¨"æˆ‘çš„"é¡µé¢æ·»åŠ å…¥å£**

```
æˆ‘çš„é¡µé¢
â”œâ”€ æˆ‘çš„ä½œå“
â”œâ”€ æˆ‘çš„æ”¶è—
â”œâ”€ æ”¶åˆ°çš„åˆ†äº« [çº¢ç‚¹ï¼š3]  â† æ–°å¢
â””â”€ è®¾ç½®
```

**æ–¹æ¡ˆBï¼šåœ¨åº•éƒ¨TabBaræ·»åŠ ï¼ˆå¦‚æœæœ‰ç©ºä½ï¼‰**

```
é¦–é¡µ | å‘ç° | åˆ†äº« | æˆ‘çš„
```

**æ–¹æ¡ˆCï¼šåœ¨é¡¶éƒ¨æ·»åŠ æ¶ˆæ¯å›¾æ ‡ï¼ˆæ¨èï¼‰**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¦–é¡µ               [ğŸ”” 3]  [ğŸ”]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ç‚¹å‡»æ¶ˆæ¯å›¾æ ‡è¿›å…¥åˆ†äº«åˆ—è¡¨

---

### 3.5 çŠ¶æ€ç®¡ç†

#### 3.5.1 æœªè¯»æ•°é‡ç®¡ç†

**æ–¹æ¡ˆï¼š** ä½¿ç”¨ AppStorage å…¨å±€çŠ¶æ€

```typescript
AppStorage.SetOrCreate('unreadShareCount', 0)
```

**æ›´æ–°æ—¶æœºï¼š**

- åº”ç”¨å¯åŠ¨æ—¶è·å–
- è¿›å…¥åˆ†äº«åˆ—è¡¨é¡µæ—¶åˆ·æ–°
- æ ‡è®°å·²è¯»åæ›´æ–°
- æ”¶åˆ°æ–°åˆ†äº«æ—¶æ›´æ–°ï¼ˆå¦‚æœæœ‰æ¨é€ï¼‰

---

### 3.6 ç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 3.6.1 åŠ è½½çŠ¶æ€

- åˆ—è¡¨åŠ è½½æ˜¾ç¤ºéª¨æ¶å±
- åˆ†äº«æ“ä½œæ˜¾ç¤º Loading
- ä¸Šæ‹‰åŠ è½½æ›´å¤šæ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨

#### 3.6.2 ç©ºçŠ¶æ€

- æ²¡æœ‰åˆ†äº«æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€æç¤º
- æç¤ºç”¨æˆ·å¯ä»¥åˆ†äº«å¸–å­ç»™å¥½å‹

#### 3.6.3 é”™è¯¯å¤„ç†

- ç½‘ç»œé”™è¯¯æç¤º
- åˆ†äº«å¤±è´¥æç¤ºåŸå› 
- å¸–å­ä¸å­˜åœ¨æ—¶çš„å‹å¥½æç¤º

#### 3.6.4 äº¤äº’åé¦ˆ

- åˆ†äº«æˆåŠŸ Toast æç¤º
- æ ‡è®°å·²è¯»åå¡ç‰‡æ ·å¼å˜åŒ–
- ä¸‹æ‹‰åˆ·æ–°åŠ¨ç”»

---

## å››ã€å®ç°ä¼˜å…ˆçº§

### P0 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆç¬¬ä¸€æœŸï¼‰

1. åç«¯ï¼šåˆ†äº«è¡¨è®¾è®¡å’Œåˆ›å»º
2. åç«¯ï¼šåˆ†äº«å¸–å­æ¥å£
3. åç«¯ï¼šè·å–åˆ†äº«åˆ—è¡¨æ¥å£
4. å‰ç«¯ï¼šShareApi æœåŠ¡å±‚
5. å‰ç«¯ï¼šShareUserSelector ç»„ä»¶
6. å‰ç«¯ï¼šPostDetailPage é›†æˆåˆ†äº«åŠŸèƒ½
7. å‰ç«¯ï¼šShareListPage é¡µé¢
8. å‰ç«¯ï¼šPostShareCard ç»„ä»¶
9. å‰ç«¯ï¼šæ·»åŠ å¯¼èˆªå…¥å£

### P1 - ä¼˜åŒ–åŠŸèƒ½ï¼ˆç¬¬äºŒæœŸï¼‰

1. åç«¯ï¼šæ ‡è®°å·²è¯»æ¥å£
2. åç«¯ï¼šæœªè¯»æ•°é‡æ¥å£
3. å‰ç«¯ï¼šæœªè¯»çº¢ç‚¹æç¤º
4. å‰ç«¯ï¼šå·²è¯»/æœªè¯»çŠ¶æ€å±•ç¤º
5. å‰ç«¯ï¼šä¸‹æ‹‰åˆ·æ–°
6. å‰ç«¯ï¼šä¸Šæ‹‰åŠ è½½æ›´å¤š

### P2 - å¢å¼ºåŠŸèƒ½ï¼ˆç¬¬ä¸‰æœŸï¼‰

1. åç«¯ï¼šæ‰¹é‡æ ‡è®°å·²è¯»
2. åç«¯ï¼šåˆ é™¤åˆ†äº«è®°å½•
3. å‰ç«¯ï¼šæœç´¢äº’å…³ç”¨æˆ·
4. å‰ç«¯ï¼šåˆ†äº«æ—¶æ·»åŠ ç•™è¨€
5. å‰ç«¯ï¼šåˆ†äº«ç»Ÿè®¡ï¼ˆå¸–å­è¢«åˆ†äº«æ¬¡æ•°ï¼‰
6. åç«¯ï¼šåˆ†äº«æ¨é€é€šçŸ¥ï¼ˆå¯é€‰ï¼‰

---

## äº”ã€æŠ€æœ¯è¦ç‚¹

### 5.1 æ€§èƒ½ä¼˜åŒ–

1. **æ•°æ®å†—ä½™**ï¼šé¿å…é¢‘ç¹JOINæŸ¥è¯¢
2. **ç´¢å¼•ä¼˜åŒ–**ï¼šé’ˆå¯¹å¸¸ç”¨æŸ¥è¯¢æ·»åŠ ç´¢å¼•
3. **åˆ†é¡µåŠ è½½**ï¼šé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®
4. **å›¾ç‰‡æ‡’åŠ è½½**ï¼šåˆ—è¡¨ä¸­çš„å›¾ç‰‡æŒ‰éœ€åŠ è½½

### 5.2 å®‰å…¨è€ƒè™‘

1. **æƒé™éªŒè¯**ï¼šåªèƒ½åˆ†äº«ç»™äº’å…³ç”¨æˆ·
2. **é˜²åˆ·æœºåˆ¶**ï¼šé™åˆ¶åˆ†äº«é¢‘ç‡
3. **æ•æ„Ÿä¿¡æ¯**ï¼šä¸æš´éœ²æ¥æ”¶è€…ä¿¡æ¯
4. **XSSé˜²æŠ¤**ï¼šåˆ†äº«ç•™è¨€éœ€è¦è¿‡æ»¤

### 5.3 æ‰©å±•æ€§

1. **å…¶ä»–åˆ†äº«ç±»å‹**ï¼šå¦‚éœ€æ”¯æŒç”¨æˆ·ã€è¯é¢˜ç­‰ï¼Œå¯æ·»åŠ  share_type å­—æ®µ
2. **æ¶ˆæ¯æ¨¡æ¿**ï¼šå¯æ‰©å±•ä¸ºæ›´å¤æ‚çš„æ¶ˆæ¯ç³»ç»Ÿ
3. **æ¨é€é€šçŸ¥**ï¼šé¢„ç•™æ¨é€æ¥å£
4. **ç»Ÿè®¡åˆ†æ**ï¼šå¯æ·»åŠ åˆ†äº«æ•°æ®ç»Ÿè®¡

---

## å…­ã€æµ‹è¯•ç”¨ä¾‹

### 6.1 åç«¯æ¥å£æµ‹è¯•

#### 6.1.1 åˆ†äº«å¸–å­æ¥å£

- [ ] æˆåŠŸåˆ†äº«å¸–å­
- [ ] å¸–å­ä¸å­˜åœ¨
- [ ] æ¥æ”¶è€…ä¸å­˜åœ¨
- [ ] æœªäº’å…³æ— æ³•åˆ†äº«
- [ ] ä¸èƒ½åˆ†äº«ç»™è‡ªå·±
- [ ] åˆ†äº«é¢‘ç‡é™åˆ¶

#### 6.1.2 è·å–åˆ†äº«åˆ—è¡¨æ¥å£

- [ ] æ­£å¸¸è·å–åˆ—è¡¨
- [ ] åˆ†é¡µåŠŸèƒ½
- [ ] åªçœ‹æœªè¯»
- [ ] ç©ºåˆ—è¡¨
- [ ] æœªè¯»æ•°é‡æ­£ç¡®

#### 6.1.3 æ ‡è®°å·²è¯»æ¥å£

- [ ] æˆåŠŸæ ‡è®°å·²è¯»
- [ ] åˆ†äº«ä¸å­˜åœ¨
- [ ] éæ¥æ”¶è€…æ— æ³•æ ‡è®°

### 6.2 å‰ç«¯åŠŸèƒ½æµ‹è¯•

#### 6.2.1 åˆ†äº«åŠŸèƒ½

- [ ] æ‰“å¼€ç”¨æˆ·é€‰æ‹©å™¨
- [ ] æœç´¢äº’å…³ç”¨æˆ·
- [ ] é€‰æ‹©ç”¨æˆ·å¹¶åˆ†äº«
- [ ] åˆ†äº«æˆåŠŸæç¤º
- [ ] åˆ†äº«å¤±è´¥æç¤º

#### 6.2.2 åˆ†äº«åˆ—è¡¨

- [ ] åˆ—è¡¨æ­£å¸¸æ˜¾ç¤º
- [ ] å¡ç‰‡æ ·å¼æ­£ç¡®
- [ ] ç‚¹å‡»è·³è½¬è¯¦æƒ…
- [ ] ä¸‹æ‹‰åˆ·æ–°
- [ ] ä¸Šæ‹‰åŠ è½½
- [ ] æœªè¯»çº¢ç‚¹æ˜¾ç¤º

---

## ä¸ƒã€ä¸Šçº¿æ£€æŸ¥æ¸…å•

### 7.1 æ•°æ®åº“

- [ ] åˆ›å»ºåˆ†äº«è¡¨
- [ ] æ·»åŠ ç´¢å¼•
- [ ] æ•°æ®å¤‡ä»½æ–¹æ¡ˆ

### 7.2 åç«¯

- [ ] APIæ¥å£å®Œæˆ
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ¥å£æ–‡æ¡£æ›´æ–°
- [ ] æ€§èƒ½æµ‹è¯•

### 7.3 å‰ç«¯

- [ ] ç»„ä»¶å¼€å‘å®Œæˆ
- [ ] é¡µé¢é›†æˆå®Œæˆ
- [ ] UIæµ‹è¯•é€šè¿‡
- [ ] å…¼å®¹æ€§æµ‹è¯•

### 7.4 è”è°ƒ

- [ ] å‰åç«¯è”è°ƒ
- [ ] å¼‚å¸¸åœºæ™¯æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•

---

## å…«ã€FAQ

### Q1: å¦‚æœç”¨æˆ·å–æ¶ˆäº’å…³ï¼Œä¹‹å‰çš„åˆ†äº«è¿˜èƒ½çœ‹åˆ°å—ï¼Ÿ

A: å¯ä»¥çœ‹åˆ°ã€‚åˆ†äº«è®°å½•ä¸€æ—¦åˆ›å»ºå°±ç‹¬ç«‹å­˜åœ¨ï¼Œä¸å—åç»­å…³æ³¨å…³ç³»å˜åŒ–å½±å“ã€‚

### Q2: å¦‚æœå¸–å­è¢«åˆ é™¤ï¼Œåˆ†äº«è¿˜èƒ½çœ‹åˆ°å—ï¼Ÿ

A: åˆ†äº«å¡ç‰‡ä»å¯è§ï¼ˆå› ä¸ºæœ‰å†—ä½™æ•°æ®ï¼‰ï¼Œä½†ç‚¹å‡»åä¼šæç¤º"å¸–å­å·²è¢«åˆ é™¤"ã€‚

### Q3: æ˜¯å¦éœ€è¦å®æ—¶æ¨é€ï¼Ÿ

A: ç¬¬ä¸€æœŸä¸éœ€è¦ï¼Œç”¨æˆ·è¿›å…¥åˆ†äº«åˆ—è¡¨æ—¶åˆ·æ–°å³å¯ã€‚åç»­å¯é€šè¿‡ WebSocket æˆ–æ¨é€å®ç°ã€‚

### Q4: åˆ†äº«æ˜¯å¦æœ‰æ—¶æ•ˆæ€§ï¼Ÿ

A: æš‚ä¸è®¾ç½®æ—¶æ•ˆï¼Œæ‰€æœ‰åˆ†äº«æ°¸ä¹…ä¿å­˜ã€‚å¦‚éœ€æ¸…ç†ï¼Œå¯åç»­æ·»åŠ åˆ é™¤åŠŸèƒ½ã€‚

### Q5: æ˜¯å¦æ”¯æŒåˆ†äº«åˆ°å¤šä¸ªç”¨æˆ·ï¼Ÿ

A: ç¬¬ä¸€æœŸä»…æ”¯æŒå•ä¸ªç”¨æˆ·ã€‚æ‰¹é‡åˆ†äº«å¯åœ¨åç»­ç‰ˆæœ¬æ·»åŠ ã€‚

### Q6: ä¸ºä»€ä¹ˆåªæ”¯æŒå¸–å­åˆ†äº«ï¼Œä¸æ”¯æŒç”¨æˆ·åˆ†äº«ï¼Ÿ

A: æ ¹æ®éœ€æ±‚ç®€åŒ–åŠŸèƒ½èŒƒå›´ï¼Œä¸“æ³¨äºå¸–å­å†…å®¹çš„ä¼ æ’­ã€‚å¦‚éœ€æ‰©å±•ç”¨æˆ·åˆ†äº«ï¼Œå¯åœ¨æ•°æ®è¡¨ä¸­æ·»åŠ  share_type å­—æ®µã€‚

---

## ä¹ã€ç›¸å…³æ–‡æ¡£

- æ•°æ®åº“è®¾è®¡æ–‡æ¡£
- APIæ¥å£æ–‡æ¡£
- UIè®¾è®¡è§„èŒƒ
- æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0  
**åˆ›å»ºæ—¥æœŸï¼š** 2025-01-19  
**æœ€åæ›´æ–°ï¼š** 2025-01-19  
**ç»´æŠ¤äººå‘˜ï¼š** å¼€å‘å›¢é˜Ÿ

