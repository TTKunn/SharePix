# 项目文档说明

**最后更新**: 2025-10-02
**文档版本**: v1.1.0

---

## � 目录

- [📋 文档结构](#文档结构)
  - [第一层：核心文档（000-099）](#第一层核心文档000-099)
  - [第二层：阶段文档（100-199）](#第二层阶段文档100-199)
  - [第三层：技术专题（200-299）](#第三层技术专题200-299)
- [🚀 项目开发方案](#项目开发方案)
  - [项目概述](#项目概述)
  - [项目目标](#项目目标)
  - [技术选型](#技术选型)
  - [架构设计](#架构设计)
  - [开发阶段规划](#开发阶段规划)
    - [阶段A: 基础模块（已完成 ✅）](#阶段a-基础模块已完成-)
    - [阶段B: 用户认证模块（已完成 ✅）](#阶段b-用户认证模块已完成-)
    - [阶段C: 停车位管理模块（已完成 ✅）](#阶段c-停车位管理模块已完成-)
    - [阶段D: 预订管理模块（规划中 ⏳）](#阶段d-预订管理模块规划中-)
    - [阶段E: 支付模块（规划中 ⏳）](#阶段e-支付模块规划中-)
    - [阶段F: 评价模块（规划中 ⏳）](#阶段f-评价模块规划中-)
    - [阶段G: 系统优化（规划中 ⏳）](#阶段g-系统优化规划中-)
  - [技术实现要点](#技术实现要点)
  - [项目里程碑](#项目里程碑)
  - [风险评估](#风险评估)
  - [开发流程](#开发流程)
  - [质量保证](#质量保证)
  - [团队协作](#团队协作)
  - [技术债务管理](#技术债务管理)
- [📖 文档阅读指南](#文档阅读指南)
  - [新人入门路径](#新人入门路径)
  - [按角色阅读](#按角色阅读)
  - [按任务阅读](#按任务阅读)
- [🎯 文档特点](#文档特点)
- [📝 文档更新规范](#文档更新规范)
- [🔄 文档整理历史](#文档整理历史)
- [📞 联系方式](#联系方式)

---

## �📋 文档结构

本目录包含Knot图片分享系统的所有技术文档，按照功能和重要性分为三个层次：

### 第一层：核心文档（000-099）

这些文档是项目的核心参考资料，适合所有团队成员阅读。

| 编号 | 文档名称 | 说明 | 大小 |
|------|----------|------|------|
| [000] | API文档 | 所有API接口的完整说明 | 18KB |
| [001] | 项目架构文档 | 九层架构设计和技术栈说明 | 12KB |
| [002] | 环境安装配置教程 | 开发环境搭建指南 | 7KB |

### 第二层：阶段文档（100-199）

这些文档记录了项目各个开发阶段的完整实现过程。

| 编号 | 文档名称 | 说明 | 大小 |
|------|----------|------|------|
| [100] | 阶段A-基础模块实现 | 基础模块的实现细节 | 45KB |
| [101] | 阶段B-用户认证模块 | 用户认证系统的完整实现 | 16KB |
| [102] | 阶段C-停车位管理模块 | 停车位管理系统的完整实现 | 20KB |

### 第三层：技术专题（200-299）

这些文档深入探讨特定技术主题。

| 编号 | 文档名称 | 说明 | 大小 |
|------|----------|------|------|
| [200] | 数据库设计文档 | 所有表结构和关系设计 | 13KB |
| [201] | 性能优化专题 | 连接池和并发性能优化 | 11KB |

---

## � 项目开发方案

### 项目概述

**项目名称**: Knot图片分享系统（Knot Image Sharing Service）
**项目类型**: 后端服务系统
**开发语言**: C++17
**数据库**: MySQL 8.0.43
**架构模式**: 九层架构

### 项目目标

构建一个高性能、高可用、易扩展的图片分享社交平台后端服务，提供完整的用户管理、图片管理、Feed推荐、社交互动等功能。

### 技术选型

#### 核心技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| C++ | 17 | 开发语言 |
| cpp-httplib | 0.11.0 | HTTP服务器 |
| MySQL | 8.0.43 | 关系型数据库 |
| jwt-cpp | 0.6.0 | JWT令牌管理 |
| JsonCpp | 1.9.5 | JSON解析 |
| OpenSSL | 1.1.1 | 密码学库 |
| spdlog | 1.9.2 | 日志系统 |

#### 技术选型理由

1. **C++17**: 高性能、现代特性、丰富的标准库
2. **cpp-httplib**: 轻量级、易集成、支持高并发
3. **MySQL**: 成熟稳定、事务支持、丰富的生态
4. **jwt-cpp**: 标准JWT实现、易于使用
5. **JsonCpp**: 稳定可靠、API友好
6. **OpenSSL**: 工业标准、安全可靠
7. **spdlog**: 高性能、异步日志、格式灵活

### 架构设计

#### 九层架构

```
第1层：客户端层
  - HTTP客户端
  - 移动端APP
  - Web前端

第2层：HTTP服务器层
  - cpp-httplib服务器
  - 路由管理
  - 请求分发

第3层：API接口层（Handler）
  - AuthHandler: 用户认证接口
  - PostHandler: 帖子管理接口
  - ImageHandler: 图片管理接口
  - TagHandler: 标签管理接口

第4层：业务逻辑层（Service）
  - AuthService: 认证业务逻辑
  - PostService: 帖子业务逻辑
  - ImageService: 图片业务逻辑
  - TagService: 标签业务逻辑

第5层：数据访问层（Repository）
  - UserRepository: 用户数据访问
  - PostRepository: 帖子数据访问
  - ImageRepository: 图片数据访问
  - TagRepository: 标签数据访问

第6层：安全层
  - JWTManager: JWT令牌管理
  - PasswordHasher: 密码哈希
  - AuthMiddleware: 认证中间件（规划中）

第7层：基础设施层
  - DatabaseConnectionPool: 数据库连接池
  - ConnectionGuard: RAII连接管理
  - ConfigManager: 配置管理
  - Logger: 日志系统

第8层：数据模型层（Model）
  - User: 用户模型
  - Post: 帖子模型
  - Image: 图片模型
  - Tag: 标签模型

第9层：数据库层
  - users表: 用户信息
  - posts表: 帖子信息
  - images表: 图片信息
  - tags表: 标签信息
  - post_tags表: 帖子标签关联
```

#### 设计模式

1. **RAII模式**: ConnectionGuard自动管理数据库连接
2. **单例模式**: DatabaseConnectionPool、ConfigManager、Logger
3. **工厂模式**: JSON响应构建
4. **策略模式**: 密码哈希算法
5. **观察者模式**: 日志系统（规划中）

### 开发阶段规划

#### 阶段A: 基础模块（已完成 ✅）

**目标**: 搭建项目骨架和基础设施

**完成内容**:
- ✅ 项目目录结构
- ✅ CMake构建系统
- ✅ 数据库连接池
- ✅ 配置管理系统
- ✅ 日志系统
- ✅ HTTP服务器封装
- ✅ JSON响应工具

**技术要点**:
- 使用CMake管理项目构建
- 实现线程安全的连接池
- 支持JSON配置文件
- 集成spdlog日志库
- 封装cpp-httplib服务器

**文档**: [100]阶段A-基础模块实现.md

#### 阶段B: 用户认证模块（已完成 ✅）

**目标**: 实现完整的用户认证系统

**完成内容**:
- ✅ 用户注册
- ✅ 用户登录
- ✅ JWT令牌管理
- ✅ 密码哈希（PBKDF2-HMAC-SHA256）
- ✅ 令牌验证和刷新
- ✅ 用户信息查询

**技术要点**:
- PBKDF2-HMAC-SHA256密码哈希，100,000次迭代
- JWT访问令牌（1小时）和刷新令牌（24小时）
- SQL预编译语句防止注入
- 详细的错误处理和日志记录

**数据库**:
- users表: 用户信息存储

**API接口**: 6个
- POST /api/v1/auth/register
- POST /api/v1/auth/login
- GET /api/v1/auth/verify
- POST /api/v1/auth/refresh
- POST /api/v1/auth/logout
- GET /api/v1/auth/me

**文档**: [101]阶段B-用户认证模块.md

#### 阶段C: 图片管理模块（已完成 ✅）

**目标**: 实现图片分享功能

**完成内容**:
- ✅ 多图片帖子发布（1-9张图片）
- ✅ 图片压缩与缩略图生成
- ✅ 帖子编辑与删除
- ✅ 图片顺序管理
- ✅ Feed推荐算法
- ✅ 标签系统

**技术要点**:
- STB Image库进行图片处理
- 图片压缩（质量85%）
- 缩略图生成（300x300）
- 基于热度和时间的Feed推荐算法

**数据库**:
- posts表: 帖子信息存储
- images表: 图片信息存储
- tags表: 标签信息存储
- post_tags表: 帖子标签关联

**文档**: [102]阶段C-图片管理模块.md, [105]阶段C-2-多图片帖子系统.md


#### 阶段D: 社交互动模块（规划中 ⏳）

**目标**: 实现社交互动功能

**计划内容**:
- ⏳ 点赞功能
- ⏳ 收藏功能
- ⏳ 关注/粉丝系统
- ⏳ 评论功能

**技术要点**:
- 点赞去重
- 关注关系管理
- 评论嵌套结构
- 敏感词过滤

**数据库**:
- likes表: 点赞信息
- favorites表: 收藏信息
- follows表: 关注关系
- comments表: 评论信息

**预计工作量**: 2-3周

#### 阶段E: 分享系统（规划中 ⏳）

**目标**: 实现分享功能

**计划内容**:
- ⏳ Deep Link生成
- ⏳ 分享统计
- ⏳ 外部平台分享

**技术要点**:
- Deep Link协议设计
- 分享数据统计
- 第三方平台集成

**预计工作量**: 1-2周

#### 阶段F: 系统优化（规划中 ⏳）

**目标**: 提升系统性能和可用性

**计划内容**:
- ⏳ Redis缓存
- ⏳ 读写分离
- ⏳ 负载均衡
- ⏳ 监控告警
- ⏳ 日志分析
- ⏳ 性能测试

**技术要点**:
- Redis缓存热点数据
- MySQL主从复制
- Nginx负载均衡
- Prometheus监控
- ELK日志分析

**预计工作量**: 2-3周

### 技术实现要点

#### 1. 数据库设计原则

- **规范化**: 符合第三范式，减少数据冗余
- **完整性**: 主键、外键、唯一约束保证数据完整性
- **性能**: 合理的索引设计提高查询性能
- **扩展性**: 预留扩展字段，便于未来功能扩展

#### 2. API设计原则

- **RESTful**: 遵循REST架构风格
- **版本控制**: URL中包含版本号（/api/v1/）
- **统一响应**: 统一的JSON响应格式
- **错误处理**: 详细的错误码和错误信息
- **文档完善**: 完整的API文档


#### 3. 安全设计原则

- **密码安全**: PBKDF2-HMAC-SHA256哈希，独立盐值
- **令牌安全**: JWT令牌，访问令牌短期，刷新令牌长期
- **SQL安全**: 预编译语句，参数绑定
- **输入验证**: 严格的参数验证和数据校验
- **日志审计**: 详细的操作日志和安全审计

#### 4. 性能优化原则

- **连接池**: 数据库连接池，减少连接开销
- **RAII管理**: 自动资源管理，防止泄漏
- **并发优化**: 合理的线程池和监听队列
- **索引优化**: 合理的索引设计
- **缓存策略**: Redis缓存热点数据（规划中）

#### 5. 代码规范

- **C++17标准**: 使用现代C++特性
- **九层架构**: 清晰的层次结构，职责分离
- **RAII模式**: 自动资源管理
- **智能指针**: 自动内存管理
- **详细注释**: 中文注释，易于理解

### 项目里程碑

| 阶段 | 目标 | 状态 | 完成时间 |
|------|------|------|----------|
| 阶段A | 基础模块 | ✅ 已完成 | 2025-10-01 |
| 阶段B | 用户认证模块 | ✅ 已完成 | 2025-10-01 |
| 阶段C | 图片管理模块 | ✅ 已完成 | 2025-10-08 |
| 阶段D | 社交互动模块 | ⏳ 规划中 | 预计2-3周 |
| 阶段E | 分享系统 | ⏳ 规划中 | 预计1-2周 |
| 阶段F | 系统优化 | ⏳ 规划中 | 预计2-3周 |

### 风险评估

| 风险 | 等级 | 应对措施 |
|------|------|----------|
| 图片存储空间不足 | 中 | 使用对象存储服务（OSS） |
| 并发性能瓶颈 | 中 | 压力测试，及时优化 |
| 数据库性能问题 | 中 | 索引优化，读写分离 |
| 安全漏洞 | 高 | 代码审查，安全测试 |
| 技术债务积累 | 中 | 定期重构，代码审查 |

### 开发流程

#### 1. 需求分析
- 明确功能需求
- 确定技术方案
- 评估工作量

#### 2. 设计阶段
- 数据库设计
- API设计
- 架构设计
- 编写设计文档

#### 3. 开发阶段
- 按照九层架构开发
- 遵循代码规范
- 编写详细注释
- 单元测试

#### 4. 测试阶段
- 功能测试
- 性能测试
- 安全测试
- 集成测试

#### 5. 部署阶段
- 环境配置
- 数据库迁移
- 服务部署
- 监控配置

#### 6. 维护阶段
- Bug修复
- 性能优化
- 功能迭代
- 文档更新

### 质量保证

#### 代码质量
- 代码审查
- 静态分析
- 单元测试覆盖率 > 80%
- 集成测试

#### 性能质量
- 响应时间 < 100ms
- 并发能力 > 100请求/秒
- 可用性 > 99.9%
- 错误率 < 0.1%

#### 安全质量
- 密码安全存储
- SQL注入防护
- XSS防护
- CSRF防护
- 安全审计日志

### 团队协作

#### 开发规范
- Git分支管理
- 代码提交规范
- 代码审查流程
- 文档更新规范

#### 沟通机制
- 每日站会
- 周例会
- 技术分享
- 问题讨论

### 技术债务管理

#### 识别
- 代码复杂度分析
- 性能瓶颈分析
- 安全漏洞扫描
- 依赖版本检查

#### 偿还
- 定期重构
- 性能优化
- 安全加固
- 依赖升级

---

## �📖 文档阅读指南

### 新人入门路径

如果你是新加入项目的开发者，建议按以下顺序阅读：

1. **[001] 项目架构文档** - 了解整体架构
2. **[002] 环境安装配置教程** - 搭建开发环境
3. **[000] API文档** - 了解所有API接口
4. **[200] 数据库设计文档** - 了解数据库结构
5. **[100] 阶段A-基础模块实现** - 了解基础模块
6. **[101] 阶段B-用户认证模块** - 了解认证系统
7. **[102] 阶段C-停车位管理模块** - 了解停车位管理

### 按角色阅读

#### 前端开发者
- **必读**: [000] API文档
- **推荐**: [001] 项目架构文档

#### 后端开发者
- **必读**: [001] 项目架构文档, [000] API文档, [200] 数据库设计文档
- **推荐**: [101] 阶段B-用户认证模块, [102] 阶段C-停车位管理模块

#### 运维工程师
- **必读**: [002] 环境安装配置教程, [201] 性能优化专题
- **推荐**: [001] 项目架构文档

#### 项目经理
- **必读**: [001] 项目架构文档
- **推荐**: [100] [101] [102] 各阶段文档

### 按任务阅读

#### 开发新功能
1. [001] 项目架构文档 - 了解架构规范
2. [200] 数据库设计文档 - 设计数据表
3. [101] 或 [102] - 参考类似模块的实现

#### 修复Bug
1. [000] API文档 - 确认API规范
2. 相关阶段文档 - 了解模块实现
3. [201] 性能优化专题 - 检查性能问题

#### 性能优化
1. [201] 性能优化专题 - 了解已有优化
2. [200] 数据库设计文档 - 检查索引设计
3. [001] 项目架构文档 - 了解架构瓶颈

---

## 🎯 文档特点

### 完整性
- ✅ 覆盖所有核心功能
- ✅ 包含完整的代码示例
- ✅ 详细的技术说明

### 实用性
- ✅ 清晰的目录结构
- ✅ 丰富的表格和图表
- ✅ 实际的测试结果

### 可维护性
- ✅ 统一的文档格式
- ✅ 清晰的版本号
- ✅ 详细的更新日志

---

## 📝 文档更新规范

### 更新原则

1. **及时更新**: 代码变更后及时更新文档
2. **版本控制**: 重大更新需要更新版本号
3. **向后兼容**: 保持文档的向后兼容性
4. **清晰标注**: 标注更新时间和更新内容

### 版本号规则

采用语义化版本号：`主版本号.次版本号.修订号`

- **主版本号**: 重大架构变更
- **次版本号**: 新增功能模块
- **修订号**: Bug修复和小改进

### 文档模板

每个文档应包含以下部分：

```markdown
# 文档标题

**文档编号**: [XXX]
**创建时间**: YYYY-MM-DD
**版本**: vX.Y.Z
**状态**: 正式版/草稿

---

## 📋 目录

...

---

## 内容

...

---

**文档版本**: vX.Y.Z
**最后更新**: YYYY-MM-DD
**维护者**: Knot Development Team
```