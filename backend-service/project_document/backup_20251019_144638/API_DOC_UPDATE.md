# API文档更新说明

**更新日期**: 2025-10-15  
**版本**: v2.1.1  
**更新人员**: AI Assistant

---

## 📝 更新内容概述

本次更新主要针对**用户信息更新接口** (`PUT /users/profile`) 的文档进行了完善和修正，确保文档与修复后的代码实现完全一致。

---

## 🔄 主要变更

### 1. 参数顺序调整

**变更前**：
```
| real_name | email | avatar_url | phone | bio | gender | location |
```

**变更后**：
```
| real_name | phone | email | avatar_url | bio | gender | location |
```

**原因**：
- 修复了代码中的参数顺序错误
- 确保文档参数顺序与代码实现一致
- `phone` 作为必填字段，调整到 `real_name` 之后更合理

---

### 2. 参数说明增强

#### 新增详细说明：

**phone（手机号）**:
- 明确说明：11位中国手机号，必须以1开头
- 格式验证：`^1[3-9]\d{9}$`

**email（邮箱）**:
- 明确说明：符合标准邮箱格式
- 添加唯一性检查说明

**avatar_url（头像URL）**:
- 明确说明：支持HTTP/HTTPS协议
- 建议使用HTTPS协议的完整URL
- **特别强调**：不会被误判为手机号（已修复BUG）

**gender（性别）**:
- 详细列举四个可选值：
  - `male`（男）
  - `female`（女）
  - `other`（其他）
  - `prefer_not_to_say`（不愿透露）

**bio（个人简介）**:
- 明确字段长度限制：不超过500字符
- **特别强调**：现在可以正常更新（已修复BUG）

**location（所在地）**:
- 明确字段长度限制：不超过100字符
- **特别强调**：现在可以正常更新（已修复BUG）

#### 新增通用说明：

```markdown
**参数说明**:
- `real_name` 和 `phone` 为必填字段
- 其他字段为可选，若不传则保持原值不变
- `phone` 如果修改，会检查是否已被其他用户使用
- `email` 如果修改，会检查是否已被其他用户使用
- `avatar_url` 建议使用HTTPS协议的完整URL
- `gender` 只接受以下四个值：male/female/other/prefer_not_to_say
```

---

### 3. 请求示例优化

#### 完整更新示例：

```json
{
  "real_name": "张三",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "avatar_url": "https://example.com/avatar.jpg",
  "bio": "热爱摄影和旅行",
  "gender": "male",
  "location": "北京市朝阳区"
}
```

#### 新增部分更新示例：

```json
{
  "real_name": "张三",
  "phone": "13800138000",
  "bio": "更新个人简介",
  "gender": "male"
}
```

**说明**：未提供的可选字段（如email、avatar_url、location）将保持原值

---

### 4. 错误码说明完善

#### 新增错误码：

| 错误码 | 说明 | HTTP状态码 |
|--------|------|------------|
| `未提供认证令牌` | 缺少Authorization头 | 401 |
| `用户不存在` | 用户ID不存在于数据库 | 400 |
| `手机号格式无效` | 手机号不符合11位中国手机号格式 | 400 |
| `邮箱格式无效` | 邮箱格式不正确 | 400 |
| `手机号已被使用` | 手机号已被其他用户注册 | 400 |
| `邮箱已被使用` | 邮箱已被其他用户使用 | 400 |
| `个人简介不能超过500个字符` | bio字段长度超限 | 400 |
| `所在地不能超过100个字符` | location字段长度超限 | 400 |
| `更新用户信息失败` | 数据库更新操作失败 | 400 |

#### 新增常见错误场景说明：

```markdown
**常见错误场景**:

1. **头像URL被误判为手机号**: 
   - ❌ 错误：参数顺序不对（已修复）
   - ✅ 正确：确保按照文档顺序传递参数

2. **bio/gender/location无法更新**:
   - ❌ 错误：代码BUG（已修复于v2.1.1）
   - ✅ 正确：现在这些字段可以正常更新

3. **手机号或邮箱已被使用**:
   - 修改时会检查唯一性，如果与其他用户冲突会报错
   - 如果修改为当前用户已有的值，不会报错
```

---

### 5. 版本更新说明

在文档开头新增 **v2.1.1 BUG修复说明**：

```markdown
### ⚠️ v2.1.1 BUG修复（2025-10-15）

**修复内容**：用户信息更新接口BUG修复
- ✅ 修复：上传头像URL会错误返回"手机号格式不对"
- ✅ 修复：bio（个人简介）、gender（性别）、location（位置）字段无法更新
- ✅ 修复：参数传递顺序错误导致的数据错位问题

**影响接口**：
- `PUT /users/profile` - 更新用户信息

**升级建议**：
- 建议所有v2.1.0用户升级到v2.1.1
- 升级后请重新测试用户信息更新功能
- 详细修复报告见：`project_document/[107]用户信息更新接口BUG修复报告.md`
```

---

## 📊 文档对比

### 参数表格对比

| 字段 | 修改前位置 | 修改后位置 | 说明增强 |
|------|-----------|-----------|---------|
| real_name | 第1位 | 第1位 | ✓ 补充长度限制说明 |
| phone | 第4位 ❌ | 第2位 ✅ | ✓ 补充格式说明 |
| email | 第2位 | 第3位 | ✓ 补充格式和唯一性说明 |
| avatar_url | 第3位 | 第4位 | ✓ 补充协议说明和BUG修复提示 |
| bio | 第5位 | 第5位 | ✓ 补充BUG修复提示 |
| gender | 第6位 | 第6位 | ✓ 详细列举可选值 |
| location | 第7位 | 第7位 | ✓ 补充BUG修复提示 |

### 示例对比

**修改前**：
- 只有1个完整示例
- 参数顺序与实际不符
- 缺少部分更新说明

**修改后**：
- 2个示例（完整更新 + 部分更新）
- 参数顺序正确
- 补充部分更新说明

---

## ✅ 验证清单

- [x] 参数顺序与代码实现一致
- [x] 所有参数都有详细说明
- [x] 示例完整且正确
- [x] 错误码说明完善
- [x] BUG修复提示明确
- [x] 版本更新说明已添加
- [x] 常见错误场景已说明

---

## 🔗 相关文档

- **主文档**: `[000]API文档.md`
- **BUG修复报告**: `[107]用户信息更新接口BUG修复报告.md`
- **快速参考**: `BUGFIX_SUMMARY.md`

---

## 📌 注意事项

### 给开发者

1. **严格按照文档参数顺序传递参数**
   - 参数顺序：`real_name` → `phone` → `email` → `avatar_url` → `bio` → `gender` → `location`

2. **必填字段验证**
   - `real_name` 和 `phone` 必须提供
   - 其他字段可选

3. **格式验证**
   - `phone`: 11位数字，1开头
   - `email`: 标准邮箱格式
   - `bio`: 最多500字符
   - `location`: 最多100字符
   - `gender`: 只能是 male/female/other/prefer_not_to_say

### 给测试人员

1. **重点测试场景**
   - 上传头像URL，验证不会报"手机号格式不对"
   - 更新bio、gender、location字段，验证能正常保存
   - 部分更新，验证未提供字段保持原值

2. **边界测试**
   - bio长度：500字符边界
   - location长度：100字符边界
   - phone格式：各种非法格式
   - email格式：各种非法格式

3. **唯一性测试**
   - 修改为已被其他用户使用的phone
   - 修改为已被其他用户使用的email
   - 修改为当前用户原有的值

---

## 📅 更新记录

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| v2.1.1 | 2025-10-15 | 修复用户信息更新接口BUG，完善文档 |
| v2.1.0 | 2025-10-09 | 新增用户信息管理功能 |

---

**文档维护**: AI Assistant  
**最后更新**: 2025-10-15  
**状态**: ✅ 已完成


