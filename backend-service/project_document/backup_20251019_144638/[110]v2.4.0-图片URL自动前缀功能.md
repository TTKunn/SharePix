# v2.4.0 - å›¾ç‰‡URLè‡ªåŠ¨å‰ç¼€åŠŸèƒ½å®æ–½æ–‡æ¡£

**åŠŸèƒ½åç§°**: å›¾ç‰‡URLè‡ªåŠ¨å‰ç¼€  
**ç‰ˆæœ¬å·**: v2.4.0  
**å®æ–½æ—¥æœŸ**: 2025-10-14  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ğŸ“‹ éœ€æ±‚èƒŒæ™¯

åœ¨v2.4.0ä¹‹å‰ï¼ŒAPIè¿”å›çš„å›¾ç‰‡è·¯å¾„ä¸ºç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `/uploads/images/IMG_xxx.jpg`ï¼‰ï¼Œå®¢æˆ·ç«¯éœ€è¦è‡ªè¡Œæ‹¼æ¥æœåŠ¡å™¨åœ°å€æ‰èƒ½è®¿é—®å›¾ç‰‡ã€‚è¿™ç»™å®¢æˆ·ç«¯å¼€å‘å¸¦æ¥ä¸ä¾¿ï¼Œä¸”åœ¨å¤šç¯å¢ƒéƒ¨ç½²æ—¶å®¹æ˜“å‡ºé”™ã€‚

**éœ€æ±‚ç›®æ ‡**:
- APIè‡ªåŠ¨ä¸ºæ‰€æœ‰å›¾ç‰‡è·¯å¾„æ·»åŠ æœåŠ¡å™¨URLå‰ç¼€
- å®¢æˆ·ç«¯å¯ç›´æ¥ä½¿ç”¨è¿”å›çš„å®Œæ•´URLè®¿é—®å›¾ç‰‡
- æ”¯æŒçµæ´»é…ç½®ï¼Œé€‚åº”ä¸åŒéƒ¨ç½²ç¯å¢ƒ

---

## ğŸ¯ å®æ–½æ–¹æ¡ˆ

### æ ¸å¿ƒè®¾è®¡

é‡‡ç”¨**é›†ä¸­ç®¡ç†**æ–¹æ¡ˆï¼Œåœ¨Modelå±‚çš„`toJson()`æ–¹æ³•ä¸­ç»Ÿä¸€å¤„ç†URLå‰ç¼€æ·»åŠ ã€‚

**ä¼˜åŠ¿**:
- âœ… å•ä¸€é…ç½®æºï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å³å¯å…¨å±€ç”Ÿæ•ˆ
- âœ… è‡ªåŠ¨åº”ç”¨åˆ°æ‰€æœ‰APIï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡é€»è¾‘
- âœ… ç¯å¢ƒé€‚é…çµæ´»ï¼ˆå¼€å‘/æµ‹è¯•/ç”Ÿäº§ï¼‰
- âœ… å‘åå…¼å®¹ï¼Œå·²æœ‰å®Œæ•´URLä¸å—å½±å“

### æŠ€æœ¯å®ç°

#### 1. æ–°å¢UrlHelperå·¥å…·ç±»

**æ–‡ä»¶**: `src/utils/url_helper.{h,cpp}`

**æ ¸å¿ƒæ–¹æ³•**:
```cpp
static std::string toFullUrl(const std::string& path);
```

**åŠŸèƒ½**:
- ä»é…ç½®æ–‡ä»¶è¯»å–`server.base_url`
- å¦‚æœæœªé…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼ `http://43.142.157.145:8080`
- è‡ªåŠ¨å¤„ç†è¾¹ç•Œæƒ…å†µï¼ˆç©ºè·¯å¾„ã€å·²æœ‰å®Œæ•´URLç­‰ï¼‰

**é»˜è®¤å€¼å®šä¹‰**:
```cpp
const std::string DEFAULT_BASE_URL = "http://43.142.157.145:8080";
```

#### 2. Modelå±‚ä¿®æ”¹

**Imageæ¨¡å‹** (`src/models/image.cpp`):
```cpp
Json::Value Image::toJson() const {
    // ...
    json["file_url"] = UrlHelper::toFullUrl(fileUrl_);
    json["thumbnail_url"] = UrlHelper::toFullUrl(thumbnailUrl_);
    // ...
}
```

**Postæ¨¡å‹** (`src/models/post.cpp`):
```cpp
std::string Post::getCoverImageUrl() const {
    if (images_.empty()) {
        return "";
    }
    return UrlHelper::toFullUrl(images_[0].getThumbnailUrl());
}
```

**Useræ¨¡å‹** (`src/models/user.cpp`):
```cpp
Json::Value User::toJson(bool includeSecrets) const {
    // ...
    json["avatar_url"] = UrlHelper::toFullUrl(avatarUrl_);
    // ...
}
```

#### 3. APIå±‚å…œåº•å¤„ç†

**PostHandler** (`src/api/post_handler.cpp`):
- ç®€åŒ–`postToJson()`æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨`Post::toJson()`
- `imageToJson()`æ–¹æ³•ä½¿ç”¨`UrlHelper::toFullUrl()`ä½œä¸ºå…œåº•

**AuthHandler** (`src/api/auth_handler.cpp`):
- åœ¨ä¸‰å¤„ç”¨æˆ·ä¿¡æ¯è¿”å›ç‚¹æ·»åŠ `UrlHelper::toFullUrl()`å…œåº•å¤„ç†

#### 4. é…ç½®æ–‡ä»¶æ›´æ–°

**config.example.json**:
```json
{
  "server": {
    "host": "0.0.0.0",
    "port": 8080,
    "base_url": ""
  }
}
```

**config.cloud.json**:
```json
{
  "server": {
    "host": "0.0.0.0",
    "port": 8080,
    "base_url": "http://43.142.157.145:8080"
  }
}
```

---

## ğŸ“Š å½±å“èŒƒå›´

### è‡ªåŠ¨ç”Ÿæ•ˆçš„API

**å¸–å­ç›¸å…³**:
- `POST /api/v1/posts` - åˆ›å»ºå¸–å­
- `GET /api/v1/posts/:id` - è·å–å¸–å­è¯¦æƒ…
- `GET /api/v1/posts` - è·å–å¸–å­åˆ—è¡¨
- `GET /api/v1/users/:user_id/posts` - è·å–ç”¨æˆ·å¸–å­
- `PUT /api/v1/posts/:id` - æ›´æ–°å¸–å­
- `POST /api/v1/posts/:post_id/images` - æ·»åŠ å›¾ç‰‡åˆ°å¸–å­

**ç”¨æˆ·ç›¸å…³**:
- `GET /api/v1/users/profile` - è·å–ç”¨æˆ·ä¿¡æ¯
- `PUT /api/v1/users/profile` - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- `GET /api/v1/users/:user_id` - è·å–ç”¨æˆ·å…¬å¼€ä¿¡æ¯
- `POST /api/v1/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/v1/auth/login` - ç”¨æˆ·ç™»å½•

**å›¾ç‰‡ç›¸å…³**:
- `GET /api/v1/images` - è·å–æœ€æ–°å›¾ç‰‡åˆ—è¡¨
- `GET /api/v1/images/:id` - è·å–å›¾ç‰‡è¯¦æƒ…
- `GET /api/v1/users/:id/images` - è·å–ç”¨æˆ·å›¾ç‰‡åˆ—è¡¨

### å½±å“å­—æ®µ

| å­—æ®µå | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| `file_url` | åŸå›¾URL | `http://43.142.157.145:8080/uploads/images/IMG_2025Q4_xxx.jpg` |
| `thumbnail_url` | ç¼©ç•¥å›¾URL | `http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_xxx_thumb.jpg` |
| `cover_image_url` | å°é¢å›¾URL | `http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_xxx_thumb.jpg` |
| `avatar_url` | ç”¨æˆ·å¤´åƒURL | `http://43.142.157.145:8080/uploads/avatars/user123.jpg` |

---

## âœ… æµ‹è¯•éªŒè¯

### æµ‹è¯•ç¯å¢ƒ
- æœåŠ¡å™¨: `localhost:8080`
- é…ç½®: `config/config.cloud.json`
- URLå‰ç¼€: `http://43.142.157.145:8080`

### æµ‹è¯•åœºæ™¯

#### åœºæ™¯1: åˆ›å»ºå¸–å­ï¼ˆä¸Šä¼ 3å¼ å›¾ç‰‡ï¼‰

**è¯·æ±‚**:
```bash
POST /api/v1/posts
Authorization: Bearer <token>
Content-Type: multipart/form-data

title: "URLå‰ç¼€æµ‹è¯•å¸–å­"
description: "æµ‹è¯•å›¾ç‰‡URLæ˜¯å¦è‡ªåŠ¨æ·»åŠ æœåŠ¡å™¨å‰ç¼€"
imageFiles: [C++.png, mysql.png, socket.png]
```

**å“åº”**:
```json
{
  "success": true,
  "message": "å¸–å­åˆ›å»ºæˆåŠŸ",
  "data": {
    "post": {
      "post_id": "POST_2025Q4_xxx",
      "cover_image_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_xxx_thumb.jpg",
      "images": [
        {
          "image_id": "IMG_2025Q4_xxx",
          "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_xxx.jpg",
          "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_xxx_thumb.jpg"
        }
      ]
    }
  }
}
```

**éªŒè¯ç»“æœ**: âœ… é€šè¿‡
- åŸå›¾URLåŒ…å«å®Œæ•´å‰ç¼€
- ç¼©ç•¥å›¾URLåŒ…å«å®Œæ•´å‰ç¼€
- å°é¢å›¾URLåŒ…å«å®Œæ•´å‰ç¼€

#### åœºæ™¯2: è·å–å¸–å­è¯¦æƒ…

**è¯·æ±‚**:
```bash
GET /api/v1/posts/POST_2025Q4_xxx
```

**éªŒè¯ç»“æœ**: âœ… é€šè¿‡
- æ‰€æœ‰å›¾ç‰‡URLå‡åŒ…å«å®Œæ•´å‰ç¼€

#### åœºæ™¯3: ç”¨æˆ·ä¿¡æ¯

**è¯·æ±‚**:
```bash
GET /api/v1/users/profile
Authorization: Bearer <token>
```

**éªŒè¯ç»“æœ**: âœ… é€šè¿‡
- `avatar_url`å­—æ®µåŒ…å«å®Œæ•´å‰ç¼€ï¼ˆå¦‚æœæœ‰å¤´åƒï¼‰

---

## ğŸ”§ é…ç½®è¯´æ˜

### ä¸‰ç§é…ç½®æ¨¡å¼

#### 1. æœªé…ç½®ï¼ˆé»˜è®¤ç”Ÿäº§æ¨¡å¼ï¼‰

**é…ç½®**:
```json
{
  "server": {
    "host": "0.0.0.0",
    "port": 8080
    // ä¸é…ç½® base_url
  }
}
```

**è¡Œä¸º**: è‡ªåŠ¨ä½¿ç”¨é»˜è®¤å€¼ `http://43.142.157.145:8080`

**é€‚ç”¨åœºæ™¯**: ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

#### 2. æ˜¾å¼é…ç½®ï¼ˆè‡ªå®šä¹‰åŸŸåï¼‰

**é…ç½®**:
```json
{
  "server": {
    "base_url": "https://your-domain.com"
  }
}
```

**è¡Œä¸º**: ä½¿ç”¨é…ç½®çš„URLä½œä¸ºå‰ç¼€

**é€‚ç”¨åœºæ™¯**: ä½¿ç”¨è‡ªå®šä¹‰åŸŸåçš„ç”Ÿäº§ç¯å¢ƒ

#### 3. å¼€å‘æ¨¡å¼ï¼ˆè¿”å›ç›¸å¯¹è·¯å¾„ï¼‰

**é…ç½®**:
```json
{
  "server": {
    "base_url": ""
  }
}
```

**è¡Œä¸º**: è¿”å›ç›¸å¯¹è·¯å¾„ `/uploads/images/xxx.jpg`

**é€‚ç”¨åœºæ™¯**: æœ¬åœ°å¼€å‘è°ƒè¯•

---

## ğŸ“ æ–‡æ¡£æ›´æ–°

### å·²æ›´æ–°æ–‡æ¡£

1. **[000]APIæ–‡æ¡£.md**
   - æ·»åŠ "é‡è¦è¯´æ˜"ç« èŠ‚
   - è¯´æ˜å›¾ç‰‡URLè‡ªåŠ¨å‰ç¼€åŠŸèƒ½
   - åˆ—å‡ºå½±å“å­—æ®µå’Œé…ç½®è¯´æ˜

2. **docs/api/openapi.yaml**
   - æ›´æ–°info.descriptionï¼Œæ·»åŠ åŠŸèƒ½è¯´æ˜
   - æ›´æ–°ç‰ˆæœ¬å·ä¸ºv2.4.0
   - æ›´æ–°æ‰€æœ‰å›¾ç‰‡URLå­—æ®µçš„description
   - æ›´æ–°ç¤ºä¾‹å€¼ä¸ºå®Œæ•´URL

3. **æœ¬æ–‡æ¡£**
   - è®°å½•å®Œæ•´å®æ–½è¿‡ç¨‹
   - æä¾›æŠ€æœ¯ç»†èŠ‚å’Œæµ‹è¯•ç»“æœ

---

## ğŸ‰ åŠŸèƒ½ç‰¹ç‚¹

| ç‰¹ç‚¹ | è¯´æ˜ |
|------|------|
| **é›†ä¸­ç®¡ç†** | åªéœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰APIè‡ªåŠ¨ç”Ÿæ•ˆ |
| **å‘åå…¼å®¹** | å·²æœ‰å®Œæ•´URLä¸å—å½±å“ï¼Œä¸ä¼šé‡å¤æ·»åŠ å‰ç¼€ |
| **ç¯å¢ƒé€‚é…** | æ”¯æŒå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒçµæ´»åˆ‡æ¢ |
| **é›¶ä¾µå…¥** | ä¸šåŠ¡é€»è¾‘æ— éœ€ä¿®æ”¹ï¼Œåœ¨Modelå±‚ç»Ÿä¸€å¤„ç† |
| **å®‰å…¨å¯é ** | ç©ºå€¼ã€è¾¹ç•Œæƒ…å†µå‡æœ‰å¤„ç†ï¼Œä¸ä¼šå‡ºç°å¼‚å¸¸ |
| **æ˜“äºç»´æŠ¤** | URLå¤„ç†é€»è¾‘é›†ä¸­åœ¨UrlHelperå·¥å…·ç±» |

---

## ğŸ”„ åç»­ä¼˜åŒ–å»ºè®®

1. **CDNæ”¯æŒ**: è€ƒè™‘æ”¯æŒé…ç½®CDNåŸŸåï¼Œå°†å›¾ç‰‡æµé‡åˆ†æµåˆ°CDN
2. **å¤šåŸŸåæ”¯æŒ**: æ”¯æŒä¸åŒç±»å‹èµ„æºä½¿ç”¨ä¸åŒåŸŸåï¼ˆå¦‚å›¾ç‰‡ã€å¤´åƒåˆ†ç¦»ï¼‰
3. **HTTPSæ”¯æŒ**: ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®HTTPS
4. **ç¼“å­˜ä¼˜åŒ–**: è€ƒè™‘åœ¨URLä¸­æ·»åŠ ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³ï¼Œä¾¿äºç¼“å­˜ç®¡ç†

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“å­˜å‚¨**: æ•°æ®åº“ä¸­ä»ç„¶å­˜å‚¨ç›¸å¯¹è·¯å¾„ï¼ŒURLå‰ç¼€ä»…åœ¨APIè¿”å›æ—¶æ·»åŠ 
2. **å®¢æˆ·ç«¯é€‚é…**: å®¢æˆ·ç«¯åº”ç›´æ¥ä½¿ç”¨è¿”å›çš„å®Œæ•´URLï¼Œæ— éœ€è‡ªè¡Œæ‹¼æ¥
3. **ç¯å¢ƒåˆ‡æ¢**: åˆ‡æ¢ç¯å¢ƒæ—¶éœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„`base_url`
4. **å‘åå…¼å®¹**: æ—§ç‰ˆæœ¬å®¢æˆ·ç«¯å¦‚æœå·²ç»å®ç°äº†URLæ‹¼æ¥ï¼Œéœ€è¦åˆ¤æ–­è¿”å›çš„URLæ˜¯å¦å·²åŒ…å«å‰ç¼€

---

**å®æ–½äººå‘˜**: Claude AI  
**å®¡æ ¸äººå‘˜**: å¾…å®¡æ ¸  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-14

