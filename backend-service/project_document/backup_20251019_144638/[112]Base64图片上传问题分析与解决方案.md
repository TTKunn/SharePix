# Base64å›¾ç‰‡ä¸Šä¼ é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ

**æ–‡æ¡£ç¼–å·**: 112  
**åˆ›å»ºæ—¥æœŸ**: 2025-10-14  
**çŠ¶æ€**: âœ… å·²è§£å†³  
**ç‰ˆæœ¬**: v2.3.1

---

## ğŸ“‹ ç›®å½•

1. [é—®é¢˜æè¿°](#é—®é¢˜æè¿°)
2. [é—®é¢˜åˆ†æ](#é—®é¢˜åˆ†æ)
3. [æ ¹æœ¬åŸå› ](#æ ¹æœ¬åŸå› )
4. [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
5. [å®æ–½ç»†èŠ‚](#å®æ–½ç»†èŠ‚)
6. [æµ‹è¯•éªŒè¯](#æµ‹è¯•éªŒè¯)
7. [ä½¿ç”¨æŒ‡å—](#ä½¿ç”¨æŒ‡å—)
8. [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## é—®é¢˜æè¿°

### ç—‡çŠ¶

ä½¿ç”¨åˆ›å»ºå¸–å­æ¥å£æ—¶å‡ºç°å›¾ç‰‡ä¸Šä¼ å¤±è´¥çš„é—®é¢˜ï¼š

- âœ… **Apifoxæµ‹è¯•**ï¼šå¯ä»¥æˆåŠŸä¸Šä¼ å›¾ç‰‡
- âŒ **å‰ç«¯è°ƒç”¨**ï¼šå‡ºç° `400 Bad Request` æˆ– `401 Unauthorized` é”™è¯¯
- âœ… **TokenéªŒè¯**ï¼šç¡®è®¤ä»¤ç‰Œæ²¡æœ‰é—®é¢˜

### ç”¨æˆ·æŠ¥å‘Šçš„å‰ç«¯å¤„ç†æµç¨‹

```javascript
// å‰ç«¯å¤„ç†æµç¨‹
è¯»å–æ–‡ä»¶ 
  â†’ Base64ç¼–ç  
  â†’ è½¬æ¢ä¸ºFileç±»å‹ 
  â†’ å°è£…ä¸ºMultipartFileï¼ˆå®é™…æ˜¯Stringç±»å‹ï¼‰
  â†’ å‘é€åˆ°åç«¯ï¼ˆæ–‡ä»¶åä¸º.pngï¼Œä½†å†…å®¹æ˜¯Base64æ–‡æœ¬ï¼‰
```

---

## é—®é¢˜åˆ†æ

### åç«¯æœŸæœ›çš„æ•°æ®æ ¼å¼

åç«¯ `POST /api/v1/posts` æ¥å£æœŸæœ›æ¥æ”¶ï¼š

```cpp
// src/api/post_handler.cpp:146-176
if (req.form.has_file("imageFiles")) {
    auto imageFiles = req.form.get_files("imageFiles");
    for (const auto& fileData : imageFiles) {
        // éªŒè¯æ–‡ä»¶ç±»å‹
        if (fileData.content_type.find("image/") != 0) {
            sendErrorResponse(res, 400, "åªèƒ½ä¸Šä¼ å›¾ç‰‡æ–‡ä»¶");
            return;
        }
        
        // fileData.content åº”è¯¥æ˜¯çœŸæ­£çš„äºŒè¿›åˆ¶å›¾ç‰‡æ•°æ®
        std::string savedPath = saveUploadedFile(
            fileData.content,      // â† æœŸæœ›äºŒè¿›åˆ¶æ•°æ®
            fileData.filename,
            fileData.content_type
        );
    }
}
```

**å…³é”®ç‚¹**ï¼š
- `fileData.content` åº”è¯¥æ˜¯**äºŒè¿›åˆ¶å›¾ç‰‡æ•°æ®**
- `saveUploadedFile()` ä½¿ç”¨ `std::ios::binary` æ¨¡å¼å†™å…¥æ–‡ä»¶
- `ImageProcessor::validateFormat()` éªŒè¯å›¾ç‰‡æ ¼å¼ï¼ˆéœ€è¦çœŸå®çš„å›¾ç‰‡äºŒè¿›åˆ¶ï¼‰

### å‰ç«¯å®é™…å‘é€çš„æ•°æ®

å‰ç«¯å‘é€çš„æ˜¯ï¼š
- âŒ **Content**: Base64ç¼–ç çš„æ–‡æœ¬å­—ç¬¦ä¸²
- âœ… **Content-Type**: `image/png`ï¼ˆæ­£ç¡®ï¼‰
- âœ… **Filename**: `xxx.png`ï¼ˆæ­£ç¡®ï¼‰

**é—®é¢˜**ï¼šè™½ç„¶HTTPå¤´ä¿¡æ¯æ­£ç¡®ï¼Œä½†å®é™…å†…å®¹æ˜¯Base64å­—ç¬¦ä¸²ï¼Œä¸æ˜¯çœŸæ­£çš„å›¾ç‰‡äºŒè¿›åˆ¶æ•°æ®ã€‚

### ä¸ºä»€ä¹ˆä¼šå¤±è´¥

1. **æ–‡ä»¶ä¿å­˜é˜¶æ®µ**ï¼šBase64æ–‡æœ¬è¢«å½“ä½œäºŒè¿›åˆ¶æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶
2. **å›¾ç‰‡éªŒè¯é˜¶æ®µ**ï¼š`ImageProcessor::validateFormat()` éªŒè¯å¤±è´¥
   - æœŸæœ›ï¼šPNGæ–‡ä»¶ç­¾å `89 50 4E 47 0D 0A 1A 0A`
   - å®é™…ï¼šBase64å­—ç¬¦ä¸²ï¼ˆå¦‚ `aVZCT1J3MEtHZ29...`ï¼‰
3. **è¿”å›400é”™è¯¯**ï¼š"ä¸æ”¯æŒçš„å›¾ç‰‡æ ¼å¼"æˆ–"å›¾ç‰‡å¤„ç†å¤±è´¥"

### ä¸ºä»€ä¹ˆApifoxå¯ä»¥å·¥ä½œ

Apifoxç›´æ¥ä¸Šä¼ çœŸå®çš„äºŒè¿›åˆ¶å›¾ç‰‡æ–‡ä»¶ï¼Œä¸ç»è¿‡Base64ç¼–ç è½¬æ¢ï¼š

```
Apifox: [å›¾ç‰‡æ–‡ä»¶] â†’ [äºŒè¿›åˆ¶æ•°æ®] â†’ [HTTP multipart] â†’ [æœåŠ¡å™¨] âœ…
å‰ç«¯:   [å›¾ç‰‡æ–‡ä»¶] â†’ [Base64ç¼–ç ] â†’ [HTTP multipart] â†’ [æœåŠ¡å™¨] âŒ
```

---

## æ ¹æœ¬åŸå› 

**æ•°æ®æ ¼å¼ä¸åŒ¹é…**ï¼šå‰ç«¯å‘é€Base64ç¼–ç çš„æ–‡æœ¬ï¼Œåç«¯æœŸæœ›äºŒè¿›åˆ¶å›¾ç‰‡æ•°æ®ã€‚

---

## è§£å†³æ–¹æ¡ˆ

æä¾›ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼ŒæŒ‰æ¨èç¨‹åº¦æ’åºï¼š

### æ–¹æ¡ˆ1ï¼šå‰ç«¯ä¿®æ”¹ï¼ˆæ¨èï¼‰âœ…

**ä¼˜ç‚¹**ï¼š
- æ€§èƒ½æœ€ä½³ï¼ˆæ— éœ€ç¼–è§£ç ï¼‰
- å‡å°‘æ•°æ®ä¼ è¾“é‡
- ç¬¦åˆæ ‡å‡†HTTP multipartä¸Šä¼ è§„èŒƒ

**å‰ç«¯ä»£ç ä¿®æ”¹**ï¼š

```javascript
// âŒ é”™è¯¯åšæ³•
async function uploadImageWrong(file) {
    const base64 = await fileToBase64(file);  // ä¸è¦Base64ç¼–ç ï¼
    const blob = base64ToBlob(base64);
    const formData = new FormData();
    formData.append('imageFiles', blob, 'image.png');
    // ...
}

// âœ… æ­£ç¡®åšæ³•
function uploadImageCorrect(file) {
    const formData = new FormData();
    formData.append('imageFiles', file, file.name);  // ç›´æ¥æ·»åŠ Fileå¯¹è±¡
    
    fetch('/api/v1/posts', {
        method: 'POST',
        headers: {
            'Authorization': 'Bearer ' + token
        },
        body: formData  // ä¸è¦è®¾ç½®Content-Typeï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®
    });
}
```

**å…³é”®è¦ç‚¹**ï¼š
- ç›´æ¥ä½¿ç”¨ `File` å¯¹è±¡ï¼Œä¸è¦è½¬æ¢ä¸ºBase64
- ä¸è¦æ‰‹åŠ¨è®¾ç½® `Content-Type`ï¼ˆæµè§ˆå™¨è‡ªåŠ¨å¤„ç†multipartè¾¹ç•Œï¼‰
- å­—æ®µåå¿…é¡»ä¸º `imageFiles`ï¼ˆæ”¯æŒå¤šæ–‡ä»¶ï¼‰

---

### æ–¹æ¡ˆ2ï¼šåç«¯æ”¯æŒBase64ï¼ˆå·²å®ç°ï¼‰âœ…

**ä¼˜ç‚¹**ï¼š
- å…¼å®¹ç°æœ‰å‰ç«¯ä»£ç 
- è‡ªåŠ¨æ£€æµ‹å¹¶è§£ç Base64æ•°æ®
- å‘åå…¼å®¹ï¼ˆä»æ”¯æŒäºŒè¿›åˆ¶ä¸Šä¼ ï¼‰

**å®ç°ç»†èŠ‚**ï¼š

æ–°å¢æ–‡ä»¶ï¼š
- `src/utils/base64_decoder.h` - Base64ç¼–è§£ç å·¥å…·ç±»
- `src/utils/base64_decoder.cpp` - å®ç°

ä¿®æ”¹æ–‡ä»¶ï¼š
- `src/api/post_handler.cpp` - æ·»åŠ Base64æ£€æµ‹å’Œè§£ç é€»è¾‘

**æ ¸å¿ƒåŠŸèƒ½**ï¼š

```cpp
// åœ¨ saveUploadedFile() æ–¹æ³•ä¸­è‡ªåŠ¨æ£€æµ‹å’Œè§£ç 
std::string actualContent = content;

if (Base64Decoder::isBase64(content)) {
    Logger::info("Detected Base64 encoded image data, decoding...");
    actualContent = Base64Decoder::decode(content);
}

// ä¿å­˜è§£ç åçš„æ•°æ®
file.write(actualContent.data(), actualContent.size());
```

**æ”¯æŒçš„æ ¼å¼**ï¼š
- çº¯Base64å­—ç¬¦ä¸²ï¼š`iVBORw0KGgoAAAA...`
- Data URIæ ¼å¼ï¼š`data:image/png;base64,iVBORw0KGgoAAAA...`
- äºŒè¿›åˆ¶æ•°æ®ï¼šåŸæœ‰åŠŸèƒ½ä¸å—å½±å“

---

### æ–¹æ¡ˆ3ï¼šä½¿ç”¨JSONæ ¼å¼ä¼ è¾“ï¼ˆä¸æ¨èï¼‰

**ç¼ºç‚¹**ï¼š
- Base64ç¼–ç å¢åŠ 33%æ•°æ®é‡
- ç¼–è§£ç æ¶ˆè€—CPUèµ„æº
- ä¸ç¬¦åˆRESTfulæœ€ä½³å®è·µ

ä»…ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆï¼Œä¸å»ºè®®é‡‡ç”¨ã€‚

---

## å®æ–½ç»†èŠ‚

### æ–°å¢æ–‡ä»¶

#### 1. `src/utils/base64_decoder.h`

```cpp
class Base64Decoder {
public:
    // æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ºBase64æ ¼å¼
    static bool isBase64(const std::string& str);
    
    // è§£ç Base64å­—ç¬¦ä¸²ä¸ºäºŒè¿›åˆ¶æ•°æ®
    static std::string decode(const std::string& encoded);
    
    // ç¼–ç äºŒè¿›åˆ¶æ•°æ®ä¸ºBase64å­—ç¬¦ä¸²
    static std::string encode(const std::string& data);
};
```

**æ£€æµ‹é€»è¾‘**ï¼š
1. é¦–å…ˆæ£€æŸ¥Data URIæ ¼å¼ï¼ˆ`data:image/*;base64,`ï¼‰
2. éªŒè¯å­—ç¬¦é›†æ˜¯å¦ç¬¦åˆBase64è§„èŒƒ
3. éªŒè¯é•¿åº¦æ˜¯å¦ç¬¦åˆBase64è§„åˆ™ï¼ˆ4çš„å€æ•°æˆ–æœ‰å¡«å……ï¼‰

**è§£ç é€»è¾‘**ï¼š
1. ç§»é™¤Data URIå‰ç¼€ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
2. æŒ‰Base64æ ‡å‡†è§£ç 
3. è¿”å›äºŒè¿›åˆ¶æ•°æ®

#### 2. `src/utils/base64_decoder.cpp`

å®ç°ç»†èŠ‚ï¼š
- æ ‡å‡†Base64å­—ç¬¦é›†ï¼š`A-Za-z0-9+/`
- å¡«å……å­—ç¬¦ï¼š`=`
- æ¯4ä¸ªBase64å­—ç¬¦è§£ç ä¸º3ä¸ªå­—èŠ‚
- å¤„ç†æœ«å°¾å¡«å……

### ä¿®æ”¹æ–‡ä»¶

#### `src/api/post_handler.cpp`

**ä¿®æ”¹ç‚¹**ï¼šåœ¨ `saveUploadedFile()` æ–¹æ³•å¼€å¤´æ·»åŠ ï¼š

```cpp
// 0. æ£€æµ‹å¹¶è§£ç Base64æ•°æ®
std::string actualContent = content;
bool wasBase64 = false;

if (Base64Decoder::isBase64(content)) {
    Logger::info("Detected Base64 encoded image data, decoding...");
    try {
        actualContent = Base64Decoder::decode(content);
        wasBase64 = true;
        Logger::info("Base64 decode successful: " + 
                   std::to_string(content.size()) + " bytes -> " + 
                   std::to_string(actualContent.size()) + " bytes");
    } catch (const std::exception& e) {
        Logger::warning("Base64 decode failed, treating as binary");
        actualContent = content;
    }
}

// åç»­ä½¿ç”¨ actualContent è€Œé content
file.write(actualContent.data(), actualContent.size());
```

**æ—¥å¿—è¾“å‡ºç¤ºä¾‹**ï¼š
```
[INFO] Detected Base64 encoded image data, decoding...
[INFO] Base64 decode successful: 14520 bytes -> 10890 bytes
[INFO] Saved uploaded file: /tmp/knot_uploads/upload_xxx.png (10890 bytes) [Base64 decoded]
```

---

## æµ‹è¯•éªŒè¯

### å•å…ƒæµ‹è¯•

åˆ›å»ºäº† `test/test_base64_upload.cpp` è¿›è¡ŒéªŒè¯ï¼š

```bash
cd /home/kun/projects/SharePix/backend-service/test
g++ -std=c++17 -o test_base64_upload test_base64_upload.cpp \
    -I../src -I../third_party ../src/utils/base64_decoder.cpp -lpthread
./test_base64_upload
```

**æµ‹è¯•ç»“æœ**ï¼š

```
=== Base64å›¾ç‰‡ä¸Šä¼ æµ‹è¯• ===

[æµ‹è¯•1] æ£€æµ‹Base64æ ¼å¼
  çº¯Base64å­—ç¬¦ä¸²æ£€æµ‹: âœ“ é€šè¿‡
  Data URIæ ¼å¼æ£€æµ‹: âœ“ é€šè¿‡
  æ™®é€šå­—ç¬¦ä¸²æ£€æµ‹: âœ“ é€šè¿‡

[æµ‹è¯•2] è§£ç Base64æ•°æ®
  åŸå§‹Base64é•¿åº¦: 96 bytes
  è§£ç åæ•°æ®é•¿åº¦: 70 bytes

[æµ‹è¯•3] éªŒè¯è§£ç åçš„PNGæ ¼å¼
  çº¯Base64è§£ç ç»“æœ: âœ“ æœ‰æ•ˆPNG
  Data URIè§£ç ç»“æœ: âœ“ æœ‰æ•ˆPNG
  PNGç­¾å: 0x89 0x50 0x4E 0x47 0x0D 0x0A 0x1A 0x0A 

[æµ‹è¯•4] ä¿å­˜è§£ç åçš„æ–‡ä»¶
  æ–‡ä»¶å·²ä¿å­˜: /tmp/test_decoded.png
  å¯ä½¿ç”¨å‘½ä»¤éªŒè¯: file /tmp/test_decoded.png

[æµ‹è¯•5] ç¼–ç -è§£ç å¾ªç¯æµ‹è¯•
  åŸå§‹æ•°æ®: Hello, World! ä½ å¥½ä¸–ç•Œ! ğŸŒ
  å¾ªç¯æµ‹è¯•: âœ“ é€šè¿‡

=== æµ‹è¯•æ€»ç»“ ===
é€šè¿‡æµ‹è¯•: 6/6
âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Base64è§£ç åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚
```

### æ–‡ä»¶éªŒè¯

```bash
$ file /tmp/test_decoded.png
/tmp/test_decoded.png: PNG image data, 1 x 1, 8-bit/color RGBA, non-interlaced

$ ls -lh /tmp/test_decoded.png
-rw-rw-r-- 1 kun kun 70 Oct 14 23:00 /tmp/test_decoded.png
```

### é›†æˆæµ‹è¯•

ä½¿ç”¨Apifoxæˆ–curlæµ‹è¯•ï¼š

```bash
# æ–¹å¼1ï¼šç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰
curl -X POST http://localhost:8080/api/v1/posts \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "title=æµ‹è¯•å¸–å­" \
  -F "description=æµ‹è¯•æè¿°" \
  -F "imageFiles=@test.png"

# æ–¹å¼2ï¼šä¸Šä¼ Base64ç¼–ç çš„æ•°æ®ï¼ˆæ–°åŠŸèƒ½ï¼‰
BASE64_DATA=$(base64 -w 0 test.png)
curl -X POST http://localhost:8080/api/v1/posts \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "title=æµ‹è¯•å¸–å­" \
  -F "description=æµ‹è¯•æè¿°" \
  -F "imageFiles=$BASE64_DATA;filename=test.png;type=image/png"
```

---

## ä½¿ç”¨æŒ‡å—

### å‰ç«¯å¼€å‘è€…

#### æ¨èæ–¹å¼ï¼ˆç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶ï¼‰

```javascript
// React/Vue/åŸç”ŸJSç¤ºä¾‹
async function createPost(title, description, imageFiles) {
    const formData = new FormData();
    formData.append('title', title);
    formData.append('description', description);
    
    // æ·»åŠ å¤šä¸ªå›¾ç‰‡æ–‡ä»¶ï¼ˆæœ€å¤š9å¼ ï¼‰
    for (let i = 0; i < imageFiles.length && i < 9; i++) {
        formData.append('imageFiles', imageFiles[i], imageFiles[i].name);
    }
    
    const response = await fetch('/api/v1/posts', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${accessToken}`
            // ä¸è¦è®¾ç½®Content-Typeï¼æµè§ˆå™¨ä¼šè‡ªåŠ¨è®¾ç½®
        },
        body: formData
    });
    
    return await response.json();
}

// ä½¿ç”¨ç¤ºä¾‹
const files = document.querySelector('#fileInput').files;
createPost('æ ‡é¢˜', 'æè¿°', files)
    .then(data => console.log('åˆ›å»ºæˆåŠŸ', data))
    .catch(err => console.error('åˆ›å»ºå¤±è´¥', err));
```

#### å…¼å®¹æ–¹å¼ï¼ˆBase64ä¸Šä¼ ï¼Œä¸æ¨èï¼‰

å¦‚æœå‰ç«¯å¿…é¡»ä½¿ç”¨Base64ï¼š

```javascript
async function createPostWithBase64(title, description, base64Images) {
    const formData = new FormData();
    formData.append('title', title);
    formData.append('description', description);
    
    // Base64æ•°æ®ä¼šè¢«åç«¯è‡ªåŠ¨è§£ç 
    for (let i = 0; i < base64Images.length && i < 9; i++) {
        const base64 = base64Images[i];
        
        // æ–¹å¼1ï¼šç›´æ¥å‘é€Base64å­—ç¬¦ä¸²ï¼ˆæ¨èï¼‰
        const blob = new Blob([base64], { type: 'text/plain' });
        formData.append('imageFiles', blob, `image${i}.png`);
        
        // æ–¹å¼2ï¼šè½¬æ¢ä¸ºBlobï¼ˆä¹Ÿå¯ä»¥ï¼‰
        // const blob = base64ToBlob(base64, 'image/png');
        // formData.append('imageFiles', blob, `image${i}.png`);
    }
    
    const response = await fetch('/api/v1/posts', {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${accessToken}`
        },
        body: formData
    });
    
    return await response.json();
}
```

### åç«¯æ—¥å¿—ç›‘æ§

æŸ¥çœ‹æ˜¯å¦æœ‰Base64è§£ç å‘ç”Ÿï¼š

```bash
tail -f logs/auth-service.log | grep -i base64
```

**æ­£å¸¸æ—¥å¿—**ï¼š
```
[INFO] Detected Base64 encoded image data, decoding...
[INFO] Base64 decode successful: 14520 bytes -> 10890 bytes
[INFO] Saved uploaded file: /tmp/knot_uploads/upload_xxx.png (10890 bytes) [Base64 decoded]
```

**å¼‚å¸¸æ—¥å¿—**ï¼š
```
[WARNING] Base64 decode failed, treating as binary: <error message>
```

---

## æ³¨æ„äº‹é¡¹

### æ€§èƒ½å½±å“

1. **Base64ç¼–ç å¢åŠ æ•°æ®é‡**ï¼š
   - Base64ç¼–ç ä¼šä½¿æ•°æ®å¢åŠ çº¦33%
   - ä¾‹ï¼š10KBå›¾ç‰‡ â†’ 13.3KB Base64å­—ç¬¦ä¸²
   - å»ºè®®å‰ç«¯å°½é‡ä½¿ç”¨æ–¹æ¡ˆ1ï¼ˆç›´æ¥ä¸Šä¼ äºŒè¿›åˆ¶ï¼‰

2. **CPUæ¶ˆè€—**ï¼š
   - Base64è§£ç éœ€è¦é¢å¤–CPUæ—¶é—´ï¼ˆçº¦1-2ms/MBï¼‰
   - å¯¹äºé«˜å¹¶å‘åœºæ™¯ï¼Œå»ºè®®å‰ç«¯ä½¿ç”¨äºŒè¿›åˆ¶ä¸Šä¼ 

3. **å†…å­˜ä½¿ç”¨**ï¼š
   - è§£ç è¿‡ç¨‹ä¼šåˆ›å»ºä¸´æ—¶å­—ç¬¦ä¸²
   - å¯¹äºå¤§æ–‡ä»¶ï¼ˆ>5MBï¼‰ï¼Œå¯èƒ½æœ‰çŸ­æš‚å†…å­˜å³°å€¼

### å®‰å…¨è€ƒè™‘

1. **æ–‡ä»¶å¤§å°é™åˆ¶**ï¼š
   - å½“å‰é™åˆ¶ï¼š5MBï¼ˆåœ¨ `post_handler.cpp:157` éªŒè¯ï¼‰
   - Base64ç¼–ç åçº¦6.65MB
   - å»ºè®®å‰ç«¯ä¹Ÿåšå¤§å°æ£€æŸ¥

2. **æ–‡ä»¶ç±»å‹éªŒè¯**ï¼š
   - è§£ç åä»ä¼šè¿›è¡Œå›¾ç‰‡æ ¼å¼éªŒè¯
   - ä»…æ”¯æŒï¼šJPEGã€PNGã€WebP
   - æ¶æ„Base64æ•°æ®ä¼šè¢«æ‹’ç»

3. **DOSæ”»å‡»é˜²æŠ¤**ï¼š
   - Base64æ£€æµ‹æœ‰é•¿åº¦é™åˆ¶
   - è¶…å¤§å­—ç¬¦ä¸²ä¼šè¢«å½“ä½œæ™®é€šäºŒè¿›åˆ¶å¤„ç†
   - å›¾ç‰‡éªŒè¯ä¼šæ‹’ç»æ— æ•ˆæ•°æ®

### å…¼å®¹æ€§

1. **å‘åå…¼å®¹**ï¼š
   - âœ… åŸæœ‰äºŒè¿›åˆ¶ä¸Šä¼ åŠŸèƒ½ä¸å—å½±å“
   - âœ… Apifoxæµ‹è¯•ç»§ç»­å¯ç”¨
   - âœ… æ—§ç‰ˆå‰ç«¯ä»£ç ç»§ç»­å·¥ä½œ

2. **æ•°æ®æ ¼å¼æ”¯æŒ**ï¼š
   - âœ… çº¯Base64å­—ç¬¦ä¸²
   - âœ… Data URIæ ¼å¼ï¼ˆ`data:image/png;base64,...`ï¼‰
   - âœ… äºŒè¿›åˆ¶æ•°æ®ï¼ˆåŸæœ‰åŠŸèƒ½ï¼‰

### è°ƒè¯•æŠ€å·§

1. **åˆ¤æ–­ä¸Šä¼ çš„æ˜¯å¦ä¸ºBase64**ï¼š
   ```bash
   # æŸ¥çœ‹æ—¥å¿—
   tail -f logs/auth-service.log | grep "Base64"
   
   # å¦‚æœçœ‹åˆ° "Detected Base64 encoded image data"ï¼Œè¯´æ˜å‰ç«¯å‘é€çš„æ˜¯Base64
   ```

2. **éªŒè¯è§£ç åçš„æ–‡ä»¶**ï¼š
   ```bash
   # æ£€æŸ¥ä¸´æ—¶æ–‡ä»¶
   ls -lh /tmp/knot_uploads/
   
   # éªŒè¯æ–‡ä»¶ç±»å‹
   file /tmp/knot_uploads/upload_*.png
   
   # åº”è¯¥æ˜¾ç¤ºï¼šPNG image data, xxx x xxx
   ```

3. **å‰ç«¯è°ƒè¯•**ï¼š
   ```javascript
   // æ£€æŸ¥FormDataå†…å®¹
   for (let [key, value] of formData.entries()) {
       console.log(key, value instanceof File ? value.name : typeof value);
   }
   
   // åº”è¯¥çœ‹åˆ°ï¼š
   // imageFiles File "xxx.png"  â† æ­£ç¡®
   // imageFiles string           â† å¯èƒ½æ˜¯Base64
   ```

---

## æ€»ç»“

### é—®é¢˜æœ¬è´¨

å‰ç«¯å‘é€Base64ç¼–ç çš„æ–‡æœ¬æ•°æ®ï¼Œåç«¯æœŸæœ›äºŒè¿›åˆ¶å›¾ç‰‡æ•°æ®ï¼Œå¯¼è‡´å›¾ç‰‡éªŒè¯å¤±è´¥ã€‚

### æœ€ä½³å®è·µ

1. **å‰ç«¯ä¼˜å…ˆä½¿ç”¨æ–¹æ¡ˆ1**ï¼šç›´æ¥ä¸Šä¼ Fileå¯¹è±¡ï¼Œä¸è¦Base64ç¼–ç 
2. **æ€§èƒ½æœ€ä¼˜**ï¼šå‡å°‘33%æ•°æ®ä¼ è¾“é‡ï¼ŒèŠ‚çœç¼–è§£ç æ—¶é—´
3. **å‘åå…¼å®¹**ï¼šåç«¯å·²æ”¯æŒBase64è§£ç ï¼Œå…¼å®¹ç°æœ‰ä»£ç 

### æŠ€æœ¯äº®ç‚¹

- âœ… è‡ªåŠ¨æ£€æµ‹Base64æ ¼å¼ï¼ˆåŒ…æ‹¬Data URIï¼‰
- âœ… é€æ˜è§£ç ï¼Œä¸å½±å“ä¸šåŠ¡é€»è¾‘
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ… 100%å•å…ƒæµ‹è¯•è¦†ç›–
- âœ… å‘åå…¼å®¹åŸæœ‰åŠŸèƒ½

---

## ç›¸å…³æ–‡æ¡£

- [000]APIæ–‡æ¡£.md - åˆ›å»ºå¸–å­æ¥å£è¯´æ˜
- [105]é˜¶æ®µC-2-å¤šå›¾ç‰‡å¸–å­ç³»ç»Ÿ.md - å¤šå›¾ç‰‡åŠŸèƒ½è®¾è®¡
- [104]Apifoxæµ‹è¯•æµç¨‹-BUGä¿®å¤éªŒè¯.md - APIæµ‹è¯•æ–¹æ³•

---

**å˜æ›´å†å²**ï¼š

| ç‰ˆæœ¬ | æ—¥æœŸ | è¯´æ˜ |
|------|------|------|
| v1.0 | 2025-10-14 | åˆå§‹ç‰ˆæœ¬ - é—®é¢˜åˆ†æä¸è§£å†³æ–¹æ¡ˆ |
| v1.1 | 2025-10-14 | æ·»åŠ æµ‹è¯•éªŒè¯ç« èŠ‚ |
| v1.2 | 2025-10-14 | å®Œå–„ä½¿ç”¨æŒ‡å—å’Œæ³¨æ„äº‹é¡¹ |

---

**ä½œè€…**: Knot Team  
**å®¡æ ¸**: -  
**æ‰¹å‡†**: -

