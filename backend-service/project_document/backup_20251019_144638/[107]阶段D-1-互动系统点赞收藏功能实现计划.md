# é˜¶æ®µD-1ï¼šäº’åŠ¨ç³»ç»Ÿç‚¹èµæ”¶è—åŠŸèƒ½å®ç°è®¡åˆ’

**æ–‡æ¡£ç¼–å·**: [107]
**åˆ›å»ºæ—¶é—´**: 2025-10-10
**é¡¹ç›®**: Knot - å›¾ç‰‡åˆ†äº«ç¤¾äº¤å¹³å°
**ç‰ˆæœ¬**: v2.2.0
**çŠ¶æ€**: ğŸ“ è®¡åˆ’ä¸­

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
   - [èƒŒæ™¯](#èƒŒæ™¯)
   - [ç›®æ ‡](#ç›®æ ‡)
   - [å®æ–½èŒƒå›´](#å®æ–½èŒƒå›´)
2. [æŠ€æœ¯è®¾è®¡](#æŠ€æœ¯è®¾è®¡)
   - [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
   - [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
   - [APIè®¾è®¡](#apiè®¾è®¡)
3. [è¯¦ç»†ä»»åŠ¡åˆ—è¡¨](#è¯¦ç»†ä»»åŠ¡åˆ—è¡¨)
   - [é˜¶æ®µ0ï¼šæ•°æ®åº“è°ƒç ”](#é˜¶æ®µ0æ•°æ®åº“è°ƒç ”30åˆ†é’Ÿ)
   - [é˜¶æ®µ1ï¼šæ•°æ®åº“å˜æ›´](#é˜¶æ®µ1æ•°æ®åº“å˜æ›´1å°æ—¶)
   - [é˜¶æ®µ2ï¼šModelå±‚](#é˜¶æ®µ2modelå±‚2å°æ—¶)
   - [é˜¶æ®µ3ï¼šRepositoryå±‚](#é˜¶æ®µ3repositoryå±‚3-4å°æ—¶)
   - [é˜¶æ®µ4ï¼šServiceå±‚](#é˜¶æ®µ4serviceå±‚3-4å°æ—¶)
   - [é˜¶æ®µ5ï¼šHandlerå±‚](#é˜¶æ®µ5handlerå±‚2-3å°æ—¶)
   - [é˜¶æ®µ6ï¼šé›†æˆæµ‹è¯•](#é˜¶æ®µ6é›†æˆæµ‹è¯•2-3å°æ—¶)
   - [é˜¶æ®µ7ï¼šæ–‡æ¡£æ›´æ–°](#é˜¶æ®µ7æ–‡æ¡£æ›´æ–°1å°æ—¶)
4. [å…³é”®æŠ€æœ¯ç‚¹](#å…³é”®æŠ€æœ¯ç‚¹)
5. [é£é™©å’Œæ³¨æ„äº‹é¡¹](#é£é™©å’Œæ³¨æ„äº‹é¡¹)
6. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)
7. [è¿›åº¦è·Ÿè¸ª](#è¿›åº¦è·Ÿè¸ª)
8. [å˜æ›´æ—¥å¿—](#å˜æ›´æ—¥å¿—)

---

## æ¦‚è¿°

### èƒŒæ™¯

å½“å‰Knotå›¾ç‰‡åˆ†äº«ç³»ç»Ÿå·²å®Œæˆä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- âœ… **ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆv2.1.0ï¼‰**: æ³¨å†Œã€ç™»å½•ã€JWTä»¤ç‰Œç®¡ç†ã€ç”¨æˆ·ä¿¡æ¯ç®¡ç†
- âœ… **å¤šå›¾ç‰‡å¸–å­ç³»ç»Ÿï¼ˆv2.0.0ï¼‰**: æ”¯æŒ1-9å¼ å›¾ç‰‡çš„å¸–å­å‘å¸ƒã€ç¼–è¾‘ã€åˆ é™¤
- âœ… **æ ‡ç­¾ç³»ç»Ÿ**: å¸–å­æ ‡ç­¾å…³è”ã€æ ‡ç­¾ç®¡ç†
- âœ… **å›¾ç‰‡ç®¡ç†ç³»ç»Ÿ**: å›¾ç‰‡å‹ç¼©ã€ç¼©ç•¥å›¾ç”Ÿæˆã€Feedæ¨è

ç„¶è€Œï¼Œä½œä¸ºä¸€ä¸ªå›¾ç‰‡åˆ†äº«ç¤¾äº¤å¹³å°ï¼Œç¼ºå°‘æœ€æ ¸å¿ƒçš„**ç¤¾äº¤äº’åŠ¨åŠŸèƒ½**ï¼š

- âŒ ç”¨æˆ·æ— æ³•å¯¹å–œæ¬¢çš„å¸–å­ç‚¹èµ
- âŒ ç”¨æˆ·æ— æ³•æ”¶è—ä¼˜è´¨å†…å®¹
- âŒ ç”¨æˆ·æ— æ³•å…³æ³¨å…¶ä»–åˆ›ä½œè€…
- âŒ ç”¨æˆ·æ— æ³•è¯„è®ºäº¤æµ

æ ¹æ®äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆ`éœ€æ±‚åˆ†æ.md`ï¼‰ï¼Œäº’åŠ¨ç³»ç»Ÿæ˜¯MVPçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œç”¨æˆ·éœ€è¦ï¼š
- ğŸ¨ **åˆ›ä½œè€…éœ€æ±‚**: è·å¾—ç‚¹èµ/æ”¶è—åé¦ˆï¼Œäº†è§£ä½œå“å—æ¬¢è¿ç¨‹åº¦
- ğŸ” **æ¶ˆè´¹è€…éœ€æ±‚**: ç®€å•é«˜æ•ˆçš„è½»ç¤¾äº¤äº’åŠ¨æ–¹å¼ï¼ˆç‚¹èµ/æ”¶è—/å…³æ³¨ï¼‰

æœ¬é˜¶æ®µå°†å®ç°äº’åŠ¨ç³»ç»Ÿçš„**ç¬¬ä¸€æ­¥**ï¼š**ç‚¹èµå’Œæ”¶è—åŠŸèƒ½**ï¼Œä¸ºåç»­çš„å…³æ³¨ã€è¯„è®ºç³»ç»Ÿæ‰“ä¸‹åšå®åŸºç¡€ã€‚

---

### ç›®æ ‡

æœ¬é˜¶æ®µçš„æ ¸å¿ƒç›®æ ‡ï¼š

1. **å®ç°ç‚¹èµç³»ç»Ÿ**
   - ç”¨æˆ·å¯ä»¥å¯¹å¸–å­ç‚¹èµ/å–æ¶ˆç‚¹èµ
   - å¸–å­æ˜¾ç¤ºå®æ—¶ç‚¹èµæ•°
   - é˜²æ­¢é‡å¤ç‚¹èµï¼ˆå¹‚ç­‰æ€§ï¼‰

2. **å®ç°æ”¶è—ç³»ç»Ÿ**
   - ç”¨æˆ·å¯ä»¥æ”¶è—/å–æ¶ˆæ”¶è—å¸–å­
   - å¸–å­æ˜¾ç¤ºå®æ—¶æ”¶è—æ•°
   - é˜²æ­¢é‡å¤æ”¶è—ï¼ˆå¹‚ç­‰æ€§ï¼‰

3. **ä¿æŒæ¶æ„ä¸€è‡´æ€§**
   - ä¸¥æ ¼éµå¾ªç°æœ‰ä¹å±‚æ¶æ„
   - å¤ç”¨BaseHandlerã€ConnectionGuardã€TransactionGuardç­‰åŸºç¡€è®¾æ–½
   - ä¸ç°æœ‰Postç³»ç»Ÿé£æ ¼ä¿æŒä¸€è‡´

4. **ä¸ºåç»­åŠŸèƒ½æ‰“åŸºç¡€**
   - å»ºç«‹äº’åŠ¨ç³»ç»Ÿçš„ä»£ç ç»“æ„å’Œè®¾è®¡æ¨¡å¼
   - ä¸ºå…³æ³¨ã€è¯„è®ºç³»ç»Ÿæä¾›å‚è€ƒå®ç°
   - éªŒè¯å¹¶å‘å®‰å…¨æ€§å’Œæ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ

---

### å®æ–½èŒƒå›´

æœ¬é˜¶æ®µå°†å®ç°**4ä¸ªæ ¸å¿ƒAPIæ¥å£**ï¼š

| åºå· | åŠŸèƒ½ | APIè·¯å¾„ | æ–¹æ³• | è®¤è¯ | ä¼˜å…ˆçº§ | é¢„è®¡å·¥æ—¶ |
|------|------|---------|------|------|--------|---------|
| 1 | ç‚¹èµå¸–å­ | `/api/v1/posts/:post_id/like` | POST | éœ€è¦JWT | P0 | 2å°æ—¶ |
| 2 | å–æ¶ˆç‚¹èµ | `/api/v1/posts/:post_id/like` | DELETE | éœ€è¦JWT | P0 | 1å°æ—¶ |
| 3 | æ”¶è—å¸–å­ | `/api/v1/posts/:post_id/favorite` | POST | éœ€è¦JWT | P0 | 1.5å°æ—¶ |
| 4 | å–æ¶ˆæ”¶è— | `/api/v1/posts/:post_id/favorite` | DELETE | éœ€è¦JWT | P0 | 0.5å°æ—¶ |

**å®æ–½æ—¶é—´**: é¢„è®¡2-3ä¸ªå·¥ä½œæ—¥ï¼ˆçº¦18.5å°æ—¶ï¼‰

**æœ¬é˜¶æ®µä¸åŒ…å«**ï¼š
- âŒ å…³æ³¨ç³»ç»Ÿï¼ˆå»¶ååˆ°é˜¶æ®µD-2ï¼‰
- âŒ è¯„è®ºç³»ç»Ÿï¼ˆå»¶ååˆ°v1.1ï¼‰
- âŒ é€šçŸ¥ç³»ç»Ÿï¼ˆå»¶ååˆ°v1.1ï¼‰
- âŒ æˆ‘çš„ç‚¹èµ/æ”¶è—åˆ—è¡¨APIï¼ˆå¯é€‰åŠŸèƒ½ï¼Œè§†æ—¶é—´å†³å®šæ˜¯å¦åŠ å…¥ï¼‰

---

## æŠ€æœ¯è®¾è®¡

### æ•°æ®åº“è®¾è®¡

#### 1. likesè¡¨ï¼ˆç‚¹èµè¡¨ï¼‰

**è®¾è®¡è¯´æ˜**ï¼š
- é‡‡ç”¨ç®€åŒ–è®¾è®¡ï¼Œä¸ä½¿ç”¨ä¸šåŠ¡é€»è¾‘IDï¼ˆlike_idï¼‰ï¼Œåªç”¨ç‰©ç†ä¸»é”®id
- ä½¿ç”¨å”¯ä¸€çº¦æŸ(user_id, post_id)ä¿è¯å¹‚ç­‰æ€§ï¼Œé˜²æ­¢é‡å¤ç‚¹èµ
- ä½¿ç”¨å¤–é”®çº§è”åˆ é™¤ï¼Œç”¨æˆ·æˆ–å¸–å­åˆ é™¤æ—¶è‡ªåŠ¨æ¸…ç†ç‚¹èµè®°å½•
- ä¼˜åŒ–ç´¢å¼•è®¾è®¡ï¼Œæ”¯æŒé«˜é¢‘æŸ¥è¯¢åœºæ™¯

**è¡¨ç»“æ„**ï¼š

```sql
CREATE TABLE likes (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰',
    user_id BIGINT NOT NULL COMMENT 'ç‚¹èµç”¨æˆ·ID',
    post_id BIGINT NOT NULL COMMENT 'è¢«ç‚¹èµå¸–å­IDï¼ˆå…³è”postsè¡¨çš„ç‰©ç†IDï¼‰',
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'ç‚¹èµæ—¶é—´',

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,

    -- å”¯ä¸€çº¦æŸï¼ˆé˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤ç‚¹èµåŒä¸€å¸–å­ï¼‰
    UNIQUE KEY uk_user_post (user_id, post_id),

    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_post_id (post_id),                          -- æŸ¥è¯¢æŸå¸–å­çš„ç‚¹èµæ•°
    INDEX idx_user_create (user_id, create_time DESC)    -- æŸ¥è¯¢æŸç”¨æˆ·çš„ç‚¹èµå†å²
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç‚¹èµè¡¨';
```

**å­—æ®µè¯´æ˜**ï¼š

| å­—æ®µå | ç±»å‹ | çº¦æŸ | è¯´æ˜ |
|--------|------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | ç‰©ç†ä¸»é”® |
| user_id | BIGINT | NOT NULL, FOREIGN KEY | ç‚¹èµç”¨æˆ·ID |
| post_id | BIGINT | NOT NULL, FOREIGN KEY | è¢«ç‚¹èµå¸–å­ID |
| create_time | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | ç‚¹èµæ—¶é—´ |

**ç´¢å¼•è¯´æ˜**ï¼š

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | ç”¨é€” |
|--------|------|------|------|
| PRIMARY | ä¸»é”® | id | ä¸»é”®ç´¢å¼• |
| uk_user_post | å”¯ä¸€ç´¢å¼• | (user_id, post_id) | é˜²æ­¢é‡å¤ç‚¹èµ + å¿«é€Ÿexists()æŸ¥è¯¢ |
| idx_post_id | æ™®é€šç´¢å¼• | post_id | æŒ‰å¸–å­ç»Ÿè®¡ç‚¹èµæ•° |
| idx_user_create | å¤åˆç´¢å¼• | (user_id, create_time DESC) | æŸ¥è¯¢ç”¨æˆ·ç‚¹èµå†å²ï¼ˆæ—¶é—´å€’åºï¼‰ |

---

#### 2. favoritesè¡¨ï¼ˆæ”¶è—è¡¨ï¼‰

**è®¾è®¡è¯´æ˜**ï¼š
- ä¸likesè¡¨ç»“æ„å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯è¡¨åå’Œæ³¨é‡Šä¸åŒ
- åŒæ ·é‡‡ç”¨ç®€åŒ–è®¾è®¡ï¼Œä¿è¯å¹‚ç­‰æ€§å’Œæ€§èƒ½

**è¡¨ç»“æ„**ï¼š

```sql
CREATE TABLE favorites (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰',
    user_id BIGINT NOT NULL COMMENT 'æ”¶è—ç”¨æˆ·ID',
    post_id BIGINT NOT NULL COMMENT 'è¢«æ”¶è—å¸–å­IDï¼ˆå…³è”postsè¡¨çš„ç‰©ç†IDï¼‰',
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ”¶è—æ—¶é—´',

    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,

    -- å”¯ä¸€çº¦æŸï¼ˆé˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤æ”¶è—åŒä¸€å¸–å­ï¼‰
    UNIQUE KEY uk_user_post (user_id, post_id),

    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_post_id (post_id),                          -- æŸ¥è¯¢æŸå¸–å­çš„æ”¶è—æ•°
    INDEX idx_user_create (user_id, create_time DESC)    -- æŸ¥è¯¢æŸç”¨æˆ·çš„æ”¶è—åˆ—è¡¨
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ”¶è—è¡¨';
```

---

#### 3. å·²æœ‰postsè¡¨å­—æ®µè¯´æ˜

**å†—ä½™å­—æ®µ**ï¼ˆç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼‰ï¼š

postsè¡¨å·²å­˜åœ¨ä»¥ä¸‹å†—ä½™å­—æ®µï¼Œç”¨äºå¿«é€Ÿæ˜¾ç¤ºç»Ÿè®¡æ•°æ®ï¼š

```sql
-- postsè¡¨ä¸­çš„ç›¸å…³å­—æ®µ
like_count INT NOT NULL DEFAULT 0 COMMENT 'ç‚¹èµæ•°ï¼ˆå†—ä½™å­—æ®µï¼‰',
favorite_count INT NOT NULL DEFAULT 0 COMMENT 'æ”¶è—æ•°ï¼ˆå†—ä½™å­—æ®µï¼‰',
```

**æ›´æ–°ç­–ç•¥**ï¼š
- ä½¿ç”¨SQLåŸå­æ“ä½œä¿è¯ä¸€è‡´æ€§ï¼š`UPDATE posts SET like_count = like_count + 1 WHERE id = ?`
- ä½¿ç”¨TransactionGuardä¿è¯ç‚¹èµè®°å½•å’Œè®¡æ•°çš„åŸå­æ€§
- é¿å…å…ˆSELECTå†UPDATEçš„ç«æ€æ¡ä»¶

---

#### 4. è®¾è®¡å†³ç­–è¯´æ˜

| è®¾è®¡ç‚¹ | æ–¹æ¡ˆ | ç†ç”± |
|--------|------|------|
| **ä¸šåŠ¡ID** | ä¸ä½¿ç”¨ï¼ˆåªæœ‰ç‰©ç†ä¸»é”®idï¼‰ | ç‚¹èµ/æ”¶è—æ— éœ€ç‹¬ç«‹çš„ä¸šåŠ¡é€»è¾‘IDï¼Œç®€åŒ–è®¾è®¡ |
| **å”¯ä¸€çº¦æŸ** | (user_id, post_id) | é˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤ç‚¹èµ/æ”¶è—åŒä¸€å¸–å­ |
| **çº§è”åˆ é™¤** | ON DELETE CASCADE | ç”¨æˆ·æˆ–å¸–å­åˆ é™¤æ—¶è‡ªåŠ¨æ¸…ç†å…³è”è®°å½•ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ |
| **æ—¶é—´æˆ³** | TIMESTAMP DEFAULT CURRENT_TIMESTAMP | è®°å½•ç‚¹èµ/æ”¶è—æ—¶é—´ï¼Œæ”¯æŒæŒ‰æ—¶é—´æ’åº |
| **å¤åˆç´¢å¼•** | (user_id, create_time DESC) | ä¼˜åŒ–"æˆ‘çš„ç‚¹èµ/æ”¶è—"åˆ—è¡¨æŸ¥è¯¢ï¼ŒæŒ‰æ—¶é—´å€’åº |
| **å†—ä½™è®¡æ•°** | posts.like_count, posts.favorite_count | é¿å…é«˜é¢‘COUNTæŸ¥è¯¢ï¼Œæå‡Feedæµæ€§èƒ½ |

---

### æ¶æ„è®¾è®¡

#### 1. ä¹å±‚æ¶æ„å›¾ï¼ˆæ–‡æœ¬å½¢å¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      HTTPå®¢æˆ·ç«¯                              â”‚
â”‚                  (ç§»åŠ¨App / Webæµè§ˆå™¨)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTPè¯·æ±‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ç¬¬2å±‚] HTTPæœåŠ¡å™¨ (http_server.cpp)                      â”‚
â”‚   - ç›‘å¬ç«¯å£8080                                             â”‚
â”‚   - è·¯ç”±åˆ†å‘                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ç¬¬3å±‚] APIæ¥å£å±‚ (Handler)                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ LikeHandler      â”‚  â”‚ FavoriteHandler  â”‚  â† æ–°å¢       â”‚
â”‚   â”‚ - handleLike()   â”‚  â”‚ - handleFavorite()â”‚               â”‚
â”‚   â”‚ - handleUnlike() â”‚  â”‚ - handleUnfavorite()â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚   (ç»§æ‰¿BaseHandlerï¼Œè‡ªåŠ¨è·å¾—JWTéªŒè¯èƒ½åŠ›)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ è°ƒç”¨Serviceæ–¹æ³•
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ç¬¬4å±‚] ä¸šåŠ¡é€»è¾‘å±‚ (Service)                               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ LikeService      â”‚  â”‚ FavoriteService  â”‚  â† æ–°å¢       â”‚
â”‚   â”‚ - likePost()     â”‚  â”‚ - favoritePost() â”‚               â”‚
â”‚   â”‚ - unlikePost()   â”‚  â”‚ - unfavoritePost()â”‚              â”‚
â”‚   â”‚ - hasLiked()     â”‚  â”‚ - hasFavorited() â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚   (ä½¿ç”¨TransactionGuardä¿è¯äº‹åŠ¡åŸå­æ€§)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ è°ƒç”¨Repositoryæ–¹æ³•
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ç¬¬5å±‚] æ•°æ®è®¿é—®å±‚ (Repository)                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ LikeRepository      â”‚  â”‚ FavoriteRepository  â”‚ â† æ–°å¢  â”‚
â”‚   â”‚ - create()          â”‚  â”‚ - create()          â”‚         â”‚
â”‚   â”‚ - deleteByUserPost()â”‚  â”‚ - deleteByUserPost()â”‚         â”‚
â”‚   â”‚ - exists()          â”‚  â”‚ - exists()          â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚   â”‚ PostRepository      â”‚  â† éœ€ä¿®æ”¹                        â”‚
â”‚   â”‚ - incrementLikeCount()    (æ–°å¢æ–¹æ³•)                    â”‚
â”‚   â”‚ - decrementLikeCount()                                  â”‚
â”‚   â”‚ - incrementFavoriteCount()                              â”‚
â”‚   â”‚ - decrementFavoriteCount()                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚   (ä½¿ç”¨ConnectionGuardç®¡ç†æ•°æ®åº“è¿æ¥)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ ä½¿ç”¨åŸºç¡€è®¾æ–½
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ç¬¬7å±‚] åŸºç¡€è®¾æ–½å±‚ (Utils)                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ ConnectionGuard  â”‚  â”‚ TransactionGuard â”‚  â† å·²æœ‰       â”‚
â”‚   â”‚ - RAIIèµ„æºç®¡ç†   â”‚  â”‚ - RAIIäº‹åŠ¡ç®¡ç†   â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ Logger           â”‚  â”‚ ConfigManager    â”‚  â† å·²æœ‰       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ ä½¿ç”¨Model
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ç¬¬8å±‚] æ•°æ®æ¨¡å‹å±‚ (Model)                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚   â”‚ Like             â”‚  â”‚ Favorite         â”‚  â† æ–°å¢       â”‚
â”‚   â”‚ - id_            â”‚  â”‚ - id_            â”‚               â”‚
â”‚   â”‚ - userId_        â”‚  â”‚ - userId_        â”‚               â”‚
â”‚   â”‚ - postId_        â”‚  â”‚ - postId_        â”‚               â”‚
â”‚   â”‚ - createTime_    â”‚  â”‚ - createTime_    â”‚               â”‚
â”‚   â”‚ - toJson()       â”‚  â”‚ - toJson()       â”‚               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ æ•°æ®æŒä¹…åŒ–
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   [ç¬¬9å±‚] æ•°æ®åº“å±‚ (MySQL 8.0)                               â”‚
â”‚   - knot_image_sharingæ•°æ®åº“                                 â”‚
â”‚   - likesè¡¨, favoritesè¡¨ (æ–°å¢)                              â”‚
â”‚   - postsè¡¨ (å·²æœ‰ï¼Œå­—æ®µï¼šlike_count, favorite_count)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 2. æ–‡ä»¶æ¸…å•

**æ–°å¢æ–‡ä»¶**ï¼ˆ12ä¸ªï¼Œçº¦2,000è¡Œä»£ç ï¼‰ï¼š

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ | é¢„è®¡è¡Œæ•° |
|---------|------|---------|
| `src/models/like.h` | Likeæ¨¡å‹ç±»å®šä¹‰ | 80 |
| `src/models/like.cpp` | Likeæ¨¡å‹ç±»å®ç° | 120 |
| `src/models/favorite.h` | Favoriteæ¨¡å‹ç±»å®šä¹‰ | 80 |
| `src/models/favorite.cpp` | Favoriteæ¨¡å‹ç±»å®ç° | 120 |
| `src/database/like_repository.h` | LikeRepositoryæ¥å£å®šä¹‰ | 100 |
| `src/database/like_repository.cpp` | LikeRepositoryå®ç° | 300 |
| `src/database/favorite_repository.h` | FavoriteRepositoryæ¥å£å®šä¹‰ | 100 |
| `src/database/favorite_repository.cpp` | FavoriteRepositoryå®ç° | 300 |
| `src/core/like_service.h` | LikeServiceæ¥å£å®šä¹‰ | 80 |
| `src/core/like_service.cpp` | LikeServiceå®ç° | 250 |
| `src/core/favorite_service.h` | FavoriteServiceæ¥å£å®šä¹‰ | 80 |
| `src/core/favorite_service.cpp` | FavoriteServiceå®ç° | 250 |
| `src/api/like_handler.h` | LikeHandleræ¥å£å®šä¹‰ | 60 |
| `src/api/like_handler.cpp` | LikeHandlerå®ç° | 200 |
| `src/api/favorite_handler.h` | FavoriteHandleræ¥å£å®šä¹‰ | 60 |
| `src/api/favorite_handler.cpp` | FavoriteHandlerå®ç° | 200 |
| `config/migration_social_likes_favorites.sql` | æ•°æ®åº“è¿ç§»è„šæœ¬ | 150 |

**ä¿®æ”¹æ–‡ä»¶**ï¼ˆ2ä¸ªï¼‰ï¼š

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ | é¢„è®¡å¢åŠ è¡Œæ•° |
|---------|---------|------------|
| `src/database/post_repository.h` | æ–°å¢4ä¸ªæ–¹æ³•å£°æ˜ï¼ˆincrement/decrementLikeCountç­‰ï¼‰ | 20 |
| `src/database/post_repository.cpp` | å®ç°4ä¸ªåŸå­æ›´æ–°æ–¹æ³• | 120 |
| `src/server/http_server.h` | æ–°å¢LikeHandlerå’ŒFavoriteHandleræˆå‘˜å˜é‡ | 5 |
| `src/server/http_server.cpp` | æ³¨å†ŒLikeå’ŒFavoriteè·¯ç”± | 10 |

**æ€»ä»£ç é‡**: çº¦2,300è¡Œ

---

#### 3. ä¾èµ–å…³ç³»

```
LikeHandler
    â†“ ä¾èµ–
LikeService
    â†“ ä¾èµ–
LikeRepository + PostRepository
    â†“ ä¾èµ–
ConnectionGuard + TransactionGuard
    â†“ ä¾èµ–
DatabaseConnectionPool

FavoriteHandlerï¼ˆåŒç†ï¼‰
```

---

### APIè®¾è®¡

#### API 1: ç‚¹èµå¸–å­

**åŸºæœ¬ä¿¡æ¯**ï¼š

- **è·¯å¾„**: `POST /api/v1/posts/:post_id/like`
- **è®¤è¯**: éœ€è¦JWT Token
- **æè¿°**: ç”¨æˆ·å¯¹æŒ‡å®šå¸–å­ç‚¹èµ

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å | ä½ç½® | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|------|
| post_id | è·¯å¾„å‚æ•° | string | æ˜¯ | å¸–å­ä¸šåŠ¡IDï¼Œå¦‚ï¼šPOST_2025Q4_ABC123 |
| Authorization | è¯·æ±‚å¤´ | string | æ˜¯ | JWT Tokenï¼Œæ ¼å¼ï¼šBearer {token} |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```bash
curl -X POST http://localhost:8080/api/v1/posts/POST_2025Q4_ABC123/like \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**æˆåŠŸå“åº”**ï¼ˆ200 OKï¼‰ï¼š

```json
{
  "success": true,
  "message": "ç‚¹èµæˆåŠŸ",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "like_count": 42,
    "has_liked": true
  },
  "timestamp": 1696752600
}
```

**å¤±è´¥å“åº”**ï¼š

1. **å·²ç»ç‚¹èµè¿‡**ï¼ˆ409 Conflictï¼‰ï¼š
```json
{
  "success": false,
  "message": "å·²ç»ç‚¹èµè¿‡è¯¥å¸–å­",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "like_count": 41,
    "has_liked": true
  },
  "timestamp": 1696752600
}
```

2. **å¸–å­ä¸å­˜åœ¨**ï¼ˆ404 Not Foundï¼‰ï¼š
```json
{
  "success": false,
  "message": "å¸–å­ä¸å­˜åœ¨",
  "timestamp": 1696752600
}
```

3. **æœªæä¾›è®¤è¯ä»¤ç‰Œ**ï¼ˆ401 Unauthorizedï¼‰ï¼š
```json
{
  "success": false,
  "message": "æœªæä¾›è®¤è¯ä»¤ç‰Œ",
  "timestamp": 1696752600
}
```

4. **ä»¤ç‰Œæ— æ•ˆæˆ–è¿‡æœŸ**ï¼ˆ401 Unauthorizedï¼‰ï¼š
```json
{
  "success": false,
  "message": "ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ",
  "timestamp": 1696752600
}
```

**é”™è¯¯ç è¯´æ˜**ï¼š

| HTTPçŠ¶æ€ç  | è¯´æ˜ | è¿”å›æ¶ˆæ¯ |
|-----------|------|---------|
| 200 | ç‚¹èµæˆåŠŸ | "ç‚¹èµæˆåŠŸ" |
| 400 | post_idæ ¼å¼é”™è¯¯ | "å¸–å­IDæ ¼å¼é”™è¯¯" |
| 401 | æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ | "æœªæä¾›è®¤è¯ä»¤ç‰Œ" / "ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ" |
| 404 | å¸–å­ä¸å­˜åœ¨ | "å¸–å­ä¸å­˜åœ¨" |
| 409 | å·²ç»ç‚¹èµè¿‡ | "å·²ç»ç‚¹èµè¿‡è¯¥å¸–å­" |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯" |

---

#### API 2: å–æ¶ˆç‚¹èµ

**åŸºæœ¬ä¿¡æ¯**ï¼š

- **è·¯å¾„**: `DELETE /api/v1/posts/:post_id/like`
- **è®¤è¯**: éœ€è¦JWT Token
- **æè¿°**: ç”¨æˆ·å–æ¶ˆå¯¹æŒ‡å®šå¸–å­çš„ç‚¹èµ

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å | ä½ç½® | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|------|
| post_id | è·¯å¾„å‚æ•° | string | æ˜¯ | å¸–å­ä¸šåŠ¡ID |
| Authorization | è¯·æ±‚å¤´ | string | æ˜¯ | JWT Token |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```bash
curl -X DELETE http://localhost:8080/api/v1/posts/POST_2025Q4_ABC123/like \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**æˆåŠŸå“åº”**ï¼ˆ200 OKï¼‰ï¼š

```json
{
  "success": true,
  "message": "å–æ¶ˆç‚¹èµæˆåŠŸ",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "like_count": 40,
    "has_liked": false
  },
  "timestamp": 1696752600
}
```

**å¤±è´¥å“åº”**ï¼š

1. **æœªç‚¹èµè¿‡è¯¥å¸–å­**ï¼ˆ400 Bad Requestï¼‰ï¼š
```json
{
  "success": false,
  "message": "æ‚¨æœªç‚¹èµè¿‡è¯¥å¸–å­",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "has_liked": false
  },
  "timestamp": 1696752600
}
```

2. **å¸–å­ä¸å­˜åœ¨**ï¼ˆ404 Not Foundï¼‰ï¼š
```json
{
  "success": false,
  "message": "å¸–å­ä¸å­˜åœ¨",
  "timestamp": 1696752600
}
```

**é”™è¯¯ç è¯´æ˜**ï¼š

| HTTPçŠ¶æ€ç  | è¯´æ˜ | è¿”å›æ¶ˆæ¯ |
|-----------|------|---------|
| 200 | å–æ¶ˆç‚¹èµæˆåŠŸ | "å–æ¶ˆç‚¹èµæˆåŠŸ" |
| 400 | æœªç‚¹èµè¿‡è¯¥å¸–å­ | "æ‚¨æœªç‚¹èµè¿‡è¯¥å¸–å­" |
| 401 | æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ | "æœªæä¾›è®¤è¯ä»¤ç‰Œ" / "ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ" |
| 404 | å¸–å­ä¸å­˜åœ¨ | "å¸–å­ä¸å­˜åœ¨" |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯" |

---

#### API 3: æ”¶è—å¸–å­

**åŸºæœ¬ä¿¡æ¯**ï¼š

- **è·¯å¾„**: `POST /api/v1/posts/:post_id/favorite`
- **è®¤è¯**: éœ€è¦JWT Token
- **æè¿°**: ç”¨æˆ·æ”¶è—æŒ‡å®šå¸–å­

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å | ä½ç½® | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|------|
| post_id | è·¯å¾„å‚æ•° | string | æ˜¯ | å¸–å­ä¸šåŠ¡ID |
| Authorization | è¯·æ±‚å¤´ | string | æ˜¯ | JWT Token |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```bash
curl -X POST http://localhost:8080/api/v1/posts/POST_2025Q4_ABC123/favorite \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**æˆåŠŸå“åº”**ï¼ˆ200 OKï¼‰ï¼š

```json
{
  "success": true,
  "message": "æ”¶è—æˆåŠŸ",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "favorite_count": 15,
    "has_favorited": true
  },
  "timestamp": 1696752600
}
```

**å¤±è´¥å“åº”**ï¼š

1. **å·²ç»æ”¶è—è¿‡**ï¼ˆ409 Conflictï¼‰ï¼š
```json
{
  "success": false,
  "message": "å·²ç»æ”¶è—è¿‡è¯¥å¸–å­",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "favorite_count": 14,
    "has_favorited": true
  },
  "timestamp": 1696752600
}
```

2. **å¸–å­ä¸å­˜åœ¨**ï¼ˆ404 Not Foundï¼‰ï¼š
```json
{
  "success": false,
  "message": "å¸–å­ä¸å­˜åœ¨",
  "timestamp": 1696752600
}
```

**é”™è¯¯ç è¯´æ˜**ï¼š

| HTTPçŠ¶æ€ç  | è¯´æ˜ | è¿”å›æ¶ˆæ¯ |
|-----------|------|---------|
| 200 | æ”¶è—æˆåŠŸ | "æ”¶è—æˆåŠŸ" |
| 400 | post_idæ ¼å¼é”™è¯¯ | "å¸–å­IDæ ¼å¼é”™è¯¯" |
| 401 | æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ | "æœªæä¾›è®¤è¯ä»¤ç‰Œ" / "ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ" |
| 404 | å¸–å­ä¸å­˜åœ¨ | "å¸–å­ä¸å­˜åœ¨" |
| 409 | å·²ç»æ”¶è—è¿‡ | "å·²ç»æ”¶è—è¿‡è¯¥å¸–å­" |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯" |

---

#### API 4: å–æ¶ˆæ”¶è—

**åŸºæœ¬ä¿¡æ¯**ï¼š

- **è·¯å¾„**: `DELETE /api/v1/posts/:post_id/favorite`
- **è®¤è¯**: éœ€è¦JWT Token
- **æè¿°**: ç”¨æˆ·å–æ¶ˆæ”¶è—æŒ‡å®šå¸–å­

**è¯·æ±‚å‚æ•°**ï¼š

| å‚æ•°å | ä½ç½® | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|------|
| post_id | è·¯å¾„å‚æ•° | string | æ˜¯ | å¸–å­ä¸šåŠ¡ID |
| Authorization | è¯·æ±‚å¤´ | string | æ˜¯ | JWT Token |

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```bash
curl -X DELETE http://localhost:8080/api/v1/posts/POST_2025Q4_ABC123/favorite \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
```

**æˆåŠŸå“åº”**ï¼ˆ200 OKï¼‰ï¼š

```json
{
  "success": true,
  "message": "å–æ¶ˆæ”¶è—æˆåŠŸ",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "favorite_count": 13,
    "has_favorited": false
  },
  "timestamp": 1696752600
}
```

**å¤±è´¥å“åº”**ï¼š

1. **æœªæ”¶è—è¿‡è¯¥å¸–å­**ï¼ˆ400 Bad Requestï¼‰ï¼š
```json
{
  "success": false,
  "message": "æ‚¨æœªæ”¶è—è¿‡è¯¥å¸–å­",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "has_favorited": false
  },
  "timestamp": 1696752600
}
```

**é”™è¯¯ç è¯´æ˜**ï¼š

| HTTPçŠ¶æ€ç  | è¯´æ˜ | è¿”å›æ¶ˆæ¯ |
|-----------|------|---------|
| 200 | å–æ¶ˆæ”¶è—æˆåŠŸ | "å–æ¶ˆæ”¶è—æˆåŠŸ" |
| 400 | æœªæ”¶è—è¿‡è¯¥å¸–å­ | "æ‚¨æœªæ”¶è—è¿‡è¯¥å¸–å­" |
| 401 | æœªè®¤è¯æˆ–ä»¤ç‰Œæ— æ•ˆ | "æœªæä¾›è®¤è¯ä»¤ç‰Œ" / "ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ" |
| 404 | å¸–å­ä¸å­˜åœ¨ | "å¸–å­ä¸å­˜åœ¨" |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | "æœåŠ¡å™¨å†…éƒ¨é”™è¯¯" |

---

## è¯¦ç»†ä»»åŠ¡åˆ—è¡¨

### é˜¶æ®µ0ï¼šæ•°æ®åº“è°ƒç ”ï¼ˆ30åˆ†é’Ÿï¼‰

**ç›®æ ‡**: ç¡®è®¤å½“å‰æ•°æ®åº“çŠ¶æ€ï¼Œç¡®ä¿è¿ç§»è„šæœ¬å®‰å…¨æ‰§è¡Œ

---

#### ä»»åŠ¡0.1: è¿æ¥ç”Ÿäº§æ•°æ®åº“ï¼ŒæŸ¥çœ‹postsè¡¨ç»“æ„

**æ‰§è¡Œ**:
```bash
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "USE knot_image_sharing; DESC posts;"
```

**éªŒè¯**:
- âœ… ç¡®è®¤postsè¡¨å­˜åœ¨
- âœ… ç¡®è®¤like_countå­—æ®µå­˜åœ¨ï¼ˆINTç±»å‹ï¼Œé»˜è®¤å€¼0ï¼‰
- âœ… ç¡®è®¤favorite_countå­—æ®µå­˜åœ¨ï¼ˆINTç±»å‹ï¼Œé»˜è®¤å€¼0ï¼‰
- âœ… è®°å½•å½“å‰postsè¡¨çš„å­—æ®µåˆ—è¡¨

**é¢„æœŸè¾“å‡º**:
```
Field             | Type          | Null | Key | Default           | Extra
------------------|---------------|------|-----|-------------------|-------
id                | bigint        | NO   | PRI | NULL              | auto_increment
post_id           | varchar(36)   | NO   | UNI | NULL              |
user_id           | bigint        | NO   | MUL | NULL              |
title             | varchar(255)  | NO   |     | NULL              |
description       | text          | YES  |     | NULL              |
image_count       | int           | NO   |     | 0                 |
like_count        | int           | NO   |     | 0                 |  â† ç¡®è®¤å­˜åœ¨
favorite_count    | int           | NO   |     | 0                 |  â† ç¡®è®¤å­˜åœ¨
view_count        | int           | NO   |     | 0                 |
status            | enum(...)     | NO   | MUL | APPROVED          |
create_time       | timestamp     | NO   | MUL | CURRENT_TIMESTAMP |
update_time       | timestamp     | NO   |     | CURRENT_TIMESTAMP |
```

---

#### ä»»åŠ¡0.2: æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨likeså’Œfavoritesè¡¨

**æ‰§è¡Œ**:
```bash
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "USE knot_image_sharing; SHOW TABLES LIKE 'likes';"
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "USE knot_image_sharing; SHOW TABLES LIKE 'favorites';"
```

**éªŒè¯**:
- âœ… ç¡®è®¤likesè¡¨ä¸å­˜åœ¨ï¼ˆEmpty setï¼Œé¿å…è¿ç§»å†²çªï¼‰
- âœ… ç¡®è®¤favoritesè¡¨ä¸å­˜åœ¨ï¼ˆEmpty setï¼‰

**é¢„æœŸè¾“å‡º**:
```
Empty set (0.00 sec)
```

**å¦‚æœè¡¨å·²å­˜åœ¨**:
- âš ï¸ åœæ­¢è¿ç§»ï¼Œå…ˆæ£€æŸ¥è¡¨ç»“æ„æ˜¯å¦ç¬¦åˆé¢„æœŸ
- âš ï¸ å¦‚æœç»“æ„ä¸ç¬¦ï¼Œéœ€è¦å…ˆåˆ é™¤æ—§è¡¨æˆ–é‡å‘½åå¤‡ä»½

---

#### ä»»åŠ¡0.3: å¤‡ä»½å½“å‰æ•°æ®åº“

**æ‰§è¡Œ**:
```bash
cd /home/kun/projects/Knot/backend-service
mysqldump -h 8.138.115.164 -u root -p'Xzk200411.' knot_image_sharing > backup_before_social_$(date +%Y%m%d_%H%M%S).sql
```

**éªŒè¯**:
```bash
ls -lh backup_before_social_*.sql
# æ£€æŸ¥å¤‡ä»½æ–‡ä»¶å¤§å° > 0ï¼ˆå¦‚æœæœ‰æ•°æ®ï¼Œåº”è¯¥è‡³å°‘å‡ KBï¼‰
```

**é¢„æœŸè¾“å‡º**:
```
-rw-rw-r-- 1 kun kun 125K Oct 10 10:00 backup_before_social_20251010_100000.sql
```

**å¤‡ä»½è¯´æ˜**:
- å¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨backend-serviceæ ¹ç›®å½•
- æ–‡ä»¶ååŒ…å«æ—¶é—´æˆ³ï¼Œä¾¿äºè¯†åˆ«
- å¦‚æœè¿ç§»å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å¤‡ä»½æ¢å¤ï¼š
  ```bash
  mysql -h 8.138.115.164 -u root -p'Xzk200411.' knot_image_sharing < backup_before_social_20251010_100000.sql
  ```

---

### é˜¶æ®µ1ï¼šæ•°æ®åº“å˜æ›´ï¼ˆ1å°æ—¶ï¼‰

**ç›®æ ‡**: åˆ›å»ºlikeså’Œfavoritesè¡¨

---

#### ä»»åŠ¡1.1: åˆ›å»ºæ•°æ®åº“è¿ç§»è„šæœ¬

**æ‰§è¡Œ**:
```bash
# åˆ›å»ºè„šæœ¬æ–‡ä»¶
touch /home/kun/projects/Knot/backend-service/config/migration_social_likes_favorites.sql
```

**æ–‡ä»¶å†…å®¹**:
```sql
-- ============================================================================
-- Knot Image Sharing Service - æ•°æ®åº“è¿ç§»è„šæœ¬
-- äº’åŠ¨ç³»ç»Ÿï¼šç‚¹èµå’Œæ”¶è—åŠŸèƒ½
-- ============================================================================
-- åˆ›å»ºæ—¶é—´: 2025-10-10
-- ç‰ˆæœ¬: v2.2.0
-- è¯´æ˜: æ­¤è„šæœ¬åˆ›å»ºlikeså’Œfavoritesè¡¨ï¼Œæ”¯æŒç‚¹èµå’Œæ”¶è—åŠŸèƒ½
-- ============================================================================

USE knot_image_sharing;

-- ============================================================================
-- ç¬¬ä¸€æ­¥ï¼šéªŒè¯å‰ç½®æ¡ä»¶
-- ============================================================================

SELECT 'å¼€å§‹æ‰§è¡Œäº’åŠ¨ç³»ç»Ÿæ•°æ®åº“è¿ç§»...' AS status;

-- éªŒè¯postsè¡¨å­˜åœ¨
SELECT
    CASE
        WHEN COUNT(*) > 0 THEN 'âœ… postsè¡¨å­˜åœ¨'
        ELSE 'âŒ postsè¡¨ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºpostsè¡¨'
    END AS check_result
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'knot_image_sharing'
AND TABLE_NAME = 'posts';

-- éªŒè¯like_countå’Œfavorite_countå­—æ®µå­˜åœ¨
SELECT
    CASE
        WHEN COUNT(*) = 2 THEN 'âœ… postsè¡¨åŒ…å«like_countå’Œfavorite_countå­—æ®µ'
        ELSE 'âŒ postsè¡¨ç¼ºå°‘å¿…è¦å­—æ®µ'
    END AS check_result
FROM information_schema.COLUMNS
WHERE TABLE_SCHEMA = 'knot_image_sharing'
AND TABLE_NAME = 'posts'
AND COLUMN_NAME IN ('like_count', 'favorite_count');

-- ============================================================================
-- ç¬¬äºŒæ­¥ï¼šåˆ›å»ºlikesè¡¨ï¼ˆç‚¹èµè¡¨ï¼‰
-- ============================================================================

SELECT 'åˆ›å»ºlikesè¡¨...' AS status;

CREATE TABLE IF NOT EXISTS likes (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰',
    user_id BIGINT NOT NULL COMMENT 'ç‚¹èµç”¨æˆ·ID',
    post_id BIGINT NOT NULL COMMENT 'è¢«ç‚¹èµå¸–å­IDï¼ˆå…³è”postsè¡¨çš„ç‰©ç†IDï¼‰',
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'ç‚¹èµæ—¶é—´',

    -- å¤–é”®çº¦æŸ
    CONSTRAINT fk_likes_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    CONSTRAINT fk_likes_post FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,

    -- å”¯ä¸€çº¦æŸï¼ˆé˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤ç‚¹èµåŒä¸€å¸–å­ï¼‰
    UNIQUE KEY uk_user_post (user_id, post_id),

    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_post_id (post_id),
    INDEX idx_user_create (user_id, create_time DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç‚¹èµè¡¨';

SELECT CONCAT('âœ… likesè¡¨åˆ›å»ºå®Œæˆï¼Œå½“å‰è®°å½•æ•°ï¼š', COUNT(*), 'æ¡') AS status FROM likes;

-- ============================================================================
-- ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºfavoritesè¡¨ï¼ˆæ”¶è—è¡¨ï¼‰
-- ============================================================================

SELECT 'åˆ›å»ºfavoritesè¡¨...' AS status;

CREATE TABLE IF NOT EXISTS favorites (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰',
    user_id BIGINT NOT NULL COMMENT 'æ”¶è—ç”¨æˆ·ID',
    post_id BIGINT NOT NULL COMMENT 'è¢«æ”¶è—å¸–å­IDï¼ˆå…³è”postsè¡¨çš„ç‰©ç†IDï¼‰',
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ”¶è—æ—¶é—´',

    -- å¤–é”®çº¦æŸ
    CONSTRAINT fk_favorites_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    CONSTRAINT fk_favorites_post FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,

    -- å”¯ä¸€çº¦æŸï¼ˆé˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤æ”¶è—åŒä¸€å¸–å­ï¼‰
    UNIQUE KEY uk_user_post (user_id, post_id),

    -- ç´¢å¼•ä¼˜åŒ–
    INDEX idx_post_id (post_id),
    INDEX idx_user_create (user_id, create_time DESC)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ”¶è—è¡¨';

SELECT CONCAT('âœ… favoritesè¡¨åˆ›å»ºå®Œæˆï¼Œå½“å‰è®°å½•æ•°ï¼š', COUNT(*), 'æ¡') AS status FROM favorites;

-- ============================================================================
-- ç¬¬å››æ­¥ï¼šéªŒè¯è¡¨ç»“æ„
-- ============================================================================

SELECT 'éªŒè¯è¡¨ç»“æ„...' AS status;

-- æ˜¾ç¤ºlikesè¡¨ç»“æ„
SELECT '========================================' AS separator;
SELECT 'likesè¡¨ç»“æ„' AS title;
SELECT '========================================' AS separator;
DESCRIBE likes;

-- æ˜¾ç¤ºfavoritesè¡¨ç»“æ„
SELECT '========================================' AS separator;
SELECT 'favoritesè¡¨ç»“æ„' AS title;
SELECT '========================================' AS separator;
DESCRIBE favorites;

-- éªŒè¯ç´¢å¼•
SELECT '========================================' AS separator;
SELECT 'likesè¡¨ç´¢å¼•' AS title;
SELECT '========================================' AS separator;
SHOW INDEX FROM likes;

SELECT '========================================' AS separator;
SELECT 'favoritesè¡¨ç´¢å¼•' AS title;
SELECT '========================================' AS separator;
SHOW INDEX FROM favorites;

-- éªŒè¯å¤–é”®çº¦æŸ
SELECT '========================================' AS separator;
SELECT 'å¤–é”®çº¦æŸéªŒè¯' AS title;
SELECT '========================================' AS separator;
SELECT
    TABLE_NAME AS 'è¡¨å',
    CONSTRAINT_NAME AS 'çº¦æŸå',
    REFERENCED_TABLE_NAME AS 'å¼•ç”¨è¡¨'
FROM information_schema.KEY_COLUMN_USAGE
WHERE TABLE_SCHEMA = 'knot_image_sharing'
AND TABLE_NAME IN ('likes', 'favorites')
AND REFERENCED_TABLE_NAME IS NOT NULL;

-- ============================================================================
-- ç¬¬äº”æ­¥ï¼šæ˜¾ç¤ºæ‰€æœ‰è¡¨
-- ============================================================================

SELECT '========================================' AS separator;
SELECT 'å½“å‰æ•°æ®åº“æ‰€æœ‰è¡¨' AS title;
SELECT '========================================' AS separator;
SHOW TABLES;

-- ============================================================================
-- å®Œæˆ
-- ============================================================================

SELECT '========================================' AS separator;
SELECT 'âœ… äº’åŠ¨ç³»ç»Ÿæ•°æ®åº“è¿ç§»å®Œæˆï¼' AS status;
SELECT '========================================' AS separator;
SELECT 'æ–°å¢è¡¨ï¼šlikes, favorites' AS note;
SELECT 'ç´¢å¼•æ•°é‡ï¼šlikesè¡¨4ä¸ªï¼Œfavoritesè¡¨4ä¸ª' AS note;
SELECT 'å¤–é”®çº¦æŸï¼šlikesè¡¨2ä¸ªï¼Œfavoritesè¡¨2ä¸ª' AS note;
SELECT '========================================' AS separator;
```

**éªŒè¯**:
```bash
cat /home/kun/projects/Knot/backend-service/config/migration_social_likes_favorites.sql | wc -l
# åº”è¯¥çº¦150è¡Œ
```

---

#### ä»»åŠ¡1.2: æ‰§è¡Œæ•°æ®åº“è¿ç§»

**æ‰§è¡Œ**:
```bash
cd /home/kun/projects/Knot/backend-service
mysql -h 8.138.115.164 -u root -p'Xzk200411.' < config/migration_social_likes_favorites.sql
```

**éªŒè¯**:
```bash
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "USE knot_image_sharing; SHOW TABLES;"
```

**é¢„æœŸè¾“å‡º**:
```
Tables_in_knot_image_sharing
------------------------------
favorites             â† æ–°å¢
image_tags_backup
images
images_backup
likes                 â† æ–°å¢
post_tags
posts
tags
users
```

---

#### ä»»åŠ¡1.3: éªŒè¯è¡¨ç»“æ„å’Œç´¢å¼•

**æ‰§è¡Œ**:
```bash
# éªŒè¯likesè¡¨ç»“æ„
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "USE knot_image_sharing; DESC likes;"

# éªŒè¯likesè¡¨ç´¢å¼•
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "USE knot_image_sharing; SHOW INDEX FROM likes;"

# éªŒè¯favoritesè¡¨ç»“æ„
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "USE knot_image_sharing; DESC favorites;"

# éªŒè¯å¤–é”®çº¦æŸ
mysql -h 8.138.115.164 -u root -p'Xzk200411.' -e "
USE knot_image_sharing;
SELECT
    TABLE_NAME,
    CONSTRAINT_NAME,
    REFERENCED_TABLE_NAME
FROM information_schema.KEY_COLUMN_USAGE
WHERE TABLE_SCHEMA = 'knot_image_sharing'
AND TABLE_NAME IN ('likes', 'favorites')
AND REFERENCED_TABLE_NAME IS NOT NULL;
"
```

**é¢„æœŸè¾“å‡º**ï¼ˆlikesè¡¨ç»“æ„ï¼‰:
```
Field       | Type      | Null | Key | Default           | Extra
------------|-----------|------|-----|-------------------|-------
id          | bigint    | NO   | PRI | NULL              | auto_increment
user_id     | bigint    | NO   | MUL | NULL              |
post_id     | bigint    | NO   | MUL | NULL              |
create_time | timestamp | NO   |     | CURRENT_TIMESTAMP |
```

**é¢„æœŸè¾“å‡º**ï¼ˆç´¢å¼•ï¼‰:
```
Table | Non_unique | Key_name       | Seq_in_index | Column_name | Index_type
------|------------|----------------|--------------|-------------|------------
likes | 0          | PRIMARY        | 1            | id          | BTREE
likes | 0          | uk_user_post   | 1            | user_id     | BTREE
likes | 0          | uk_user_post   | 2            | post_id     | BTREE
likes | 1          | idx_post_id    | 1            | post_id     | BTREE
likes | 1          | idx_user_create| 1            | user_id     | BTREE
likes | 1          | idx_user_create| 2            | create_time | BTREE
```

**é¢„æœŸè¾“å‡º**ï¼ˆå¤–é”®çº¦æŸï¼‰:
```
TABLE_NAME | CONSTRAINT_NAME      | REFERENCED_TABLE_NAME
-----------|----------------------|----------------------
likes      | fk_likes_user        | users
likes      | fk_likes_post        | posts
favorites  | fk_favorites_user    | users
favorites  | fk_favorites_post    | posts
```

---

### é˜¶æ®µ2ï¼šModelå±‚ï¼ˆ2å°æ—¶ï¼‰

**ç›®æ ‡**: åˆ›å»ºLikeå’ŒFavoriteæ¨¡å‹ç±»

---

#### ä»»åŠ¡2.1: åˆ›å»º `src/models/like.h`

**æ‰§è¡Œ**:
```bash
touch /home/kun/projects/Knot/backend-service/src/models/like.h
```

**æ–‡ä»¶å†…å®¹**:
```cpp
/**
 * @file like.h
 * @brief ç‚¹èµæ¨¡å‹å®šä¹‰
 * @author Knot Team
 * @date 2025-10-10
 */

#pragma once

#include <string>
#include <ctime>
#include <json/json.h>

/**
 * @brief ç‚¹èµæ¨¡å‹ç±»
 *
 * è¡¨ç¤ºç”¨æˆ·å¯¹å¸–å­çš„ç‚¹èµè¡Œä¸º
 */
class Like {
public:
    /**
     * @brief é»˜è®¤æ„é€ å‡½æ•°
     */
    Like();

    /**
     * @brief å¸¦å‚æ•°çš„æ„é€ å‡½æ•°
     * @param id ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰
     * @param userId ç‚¹èµç”¨æˆ·ID
     * @param postId è¢«ç‚¹èµå¸–å­ID
     */
    Like(int64_t id, int64_t userId, int64_t postId);

    /**
     * @brief ææ„å‡½æ•°
     */
    ~Like() = default;

    // Getters
    int64_t getId() const { return id_; }
    int64_t getUserId() const { return userId_; }
    int64_t getPostId() const { return postId_; }
    std::time_t getCreateTime() const { return createTime_; }

    // Setters
    void setId(int64_t id) { id_ = id; }
    void setUserId(int64_t userId) { userId_ = userId; }
    void setPostId(int64_t postId) { postId_ = postId; }
    void setCreateTime(std::time_t createTime) { createTime_ = createTime; }

    /**
     * @brief å°†ç‚¹èµå¯¹è±¡è½¬æ¢ä¸ºJSON
     * @return JSONè¡¨ç¤º
     */
    Json::Value toJson() const;

    /**
     * @brief ä»JSONåˆ›å»ºç‚¹èµå¯¹è±¡
     * @param j JSONå¯¹è±¡
     * @return Likeå¯¹è±¡
     */
    static Like fromJson(const Json::Value& j);

private:
    int64_t id_;              // ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰
    int64_t userId_;          // ç‚¹èµç”¨æˆ·ID
    int64_t postId_;          // è¢«ç‚¹èµå¸–å­ID
    std::time_t createTime_;  // ç‚¹èµæ—¶é—´
};
```

**éªŒè¯**:
```bash
cat /home/kun/projects/Knot/backend-service/src/models/like.h | wc -l
# åº”è¯¥çº¦70è¡Œ
```

---

#### ä»»åŠ¡2.2: å®ç° `src/models/like.cpp`

**æ‰§è¡Œ**:
```bash
touch /home/kun/projects/Knot/backend-service/src/models/like.cpp
```

**æ–‡ä»¶å†…å®¹**:
```cpp
/**
 * @file like.cpp
 * @brief ç‚¹èµæ¨¡å‹å®ç°
 * @author Knot Team
 * @date 2025-10-10
 */

#include "models/like.h"

/**
 * @brief é»˜è®¤æ„é€ å‡½æ•°
 */
Like::Like()
    : id_(0), userId_(0), postId_(0), createTime_(0) {
}

/**
 * @brief å¸¦å‚æ•°çš„æ„é€ å‡½æ•°
 * @param id ç‰©ç†ID
 * @param userId ç‚¹èµç”¨æˆ·ID
 * @param postId è¢«ç‚¹èµå¸–å­ID
 */
Like::Like(int64_t id, int64_t userId, int64_t postId)
    : id_(id), userId_(userId), postId_(postId), createTime_(std::time(nullptr)) {
}

/**
 * @brief å°†ç‚¹èµå¯¹è±¡è½¬æ¢ä¸ºJSON
 * @return JSONè¡¨ç¤º
 */
Json::Value Like::toJson() const {
    Json::Value json;
    json["id"] = (Json::Int64)id_;
    json["user_id"] = (Json::Int64)userId_;
    json["post_id"] = (Json::Int64)postId_;
    json["create_time"] = (Json::Int64)createTime_;
    return json;
}

/**
 * @brief ä»JSONåˆ›å»ºç‚¹èµå¯¹è±¡
 * @param j JSONå¯¹è±¡
 * @return Likeå¯¹è±¡
 */
Like Like::fromJson(const Json::Value& j) {
    Like like;

    if (j.isMember("id") && j["id"].isInt64()) {
        like.setId(j["id"].asInt64());
    }

    if (j.isMember("user_id") && j["user_id"].isInt64()) {
        like.setUserId(j["user_id"].asInt64());
    }

    if (j.isMember("post_id") && j["post_id"].isInt64()) {
        like.setPostId(j["post_id"].asInt64());
    }

    if (j.isMember("create_time") && j["create_time"].isInt64()) {
        like.setCreateTime((std::time_t)j["create_time"].asInt64());
    }

    return like;
}
```

**éªŒè¯**:
```bash
cat /home/kun/projects/Knot/backend-service/src/models/like.cpp | wc -l
# åº”è¯¥çº¦70è¡Œ
```

---

#### ä»»åŠ¡2.3: åˆ›å»º `src/models/favorite.h`

**æ‰§è¡Œ**:
```bash
# å¤åˆ¶like.hå¹¶ä¿®æ”¹
cp /home/kun/projects/Knot/backend-service/src/models/like.h \
   /home/kun/projects/Knot/backend-service/src/models/favorite.h
```

**ä¿®æ”¹å†…å®¹**:
- å°†æ‰€æœ‰ `Like` æ›¿æ¢ä¸º `Favorite`
- å°†æ‰€æœ‰ `like` æ›¿æ¢ä¸º `favorite`
- å°†æ³¨é‡Šä¸­çš„"ç‚¹èµ"æ›¿æ¢ä¸º"æ”¶è—"

**æ–‡ä»¶å†…å®¹**ï¼ˆå…³é”®éƒ¨åˆ†ï¼‰:
```cpp
/**
 * @file favorite.h
 * @brief æ”¶è—æ¨¡å‹å®šä¹‰
 * @author Knot Team
 * @date 2025-10-10
 */

#pragma once

#include <string>
#include <ctime>
#include <json/json.h>

/**
 * @brief æ”¶è—æ¨¡å‹ç±»
 *
 * è¡¨ç¤ºç”¨æˆ·å¯¹å¸–å­çš„æ”¶è—è¡Œä¸º
 */
class Favorite {
public:
    Favorite();
    Favorite(int64_t id, int64_t userId, int64_t postId);
    ~Favorite() = default;

    // Getters
    int64_t getId() const { return id_; }
    int64_t getUserId() const { return userId_; }
    int64_t getPostId() const { return postId_; }
    std::time_t getCreateTime() const { return createTime_; }

    // Setters
    void setId(int64_t id) { id_ = id; }
    void setUserId(int64_t userId) { userId_ = userId; }
    void setPostId(int64_t postId) { postId_ = postId; }
    void setCreateTime(std::time_t createTime) { createTime_ = createTime; }

    Json::Value toJson() const;
    static Favorite fromJson(const Json::Value& j);

private:
    int64_t id_;              // ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰
    int64_t userId_;          // æ”¶è—ç”¨æˆ·ID
    int64_t postId_;          // è¢«æ”¶è—å¸–å­ID
    std::time_t createTime_;  // æ”¶è—æ—¶é—´
};
```

---

#### ä»»åŠ¡2.4: å®ç° `src/models/favorite.cpp`

**æ‰§è¡Œ**:
```bash
# å¤åˆ¶like.cppå¹¶ä¿®æ”¹
cp /home/kun/projects/Knot/backend-service/src/models/like.cpp \
   /home/kun/projects/Knot/backend-service/src/models/favorite.cpp
```

**ä¿®æ”¹å†…å®¹**:
- å°†æ‰€æœ‰ `Like` æ›¿æ¢ä¸º `Favorite`
- å°†æ‰€æœ‰ `like` æ›¿æ¢ä¸º `favorite`
- å°† `#include "models/like.h"` æ›¿æ¢ä¸º `#include "models/favorite.h"`

---

#### ä»»åŠ¡2.5: ç¼–è¯‘æµ‹è¯•

**æ‰§è¡Œ**:
```bash
cd /home/kun/projects/Knot/backend-service/build
cmake ..
make -j4
```

**éªŒè¯**:
- âœ… ç¼–è¯‘æ— é”™è¯¯
- âœ… ç¼–è¯‘æ— è­¦å‘Š
- âœ… ç”Ÿæˆ `like.o` å’Œ `favorite.o` ç›®æ ‡æ–‡ä»¶

**é¢„æœŸè¾“å‡º**:
```
[ 95%] Building CXX object CMakeFiles/knot_image_sharing.dir/src/models/like.cpp.o
[ 96%] Building CXX object CMakeFiles/knot_image_sharing.dir/src/models/favorite.cpp.o
[100%] Linking CXX executable knot_image_sharing
[100%] Built target knot_image_sharing
```

---

### é˜¶æ®µ3ï¼šRepositoryå±‚ï¼ˆ3-4å°æ—¶ï¼‰

**ç›®æ ‡**: å®ç°Likeå’ŒFavoriteçš„æ•°æ®è®¿é—®å±‚ï¼Œä¿®æ”¹PostRepository

---

#### ä»»åŠ¡3.1: åˆ›å»º `src/database/like_repository.h`

**æ‰§è¡Œ**:
```bash
touch /home/kun/projects/Knot/backend-service/src/database/like_repository.h
```

**æ–‡ä»¶å†…å®¹**:
```cpp
/**
 * @file like_repository.h
 * @brief ç‚¹èµæ•°æ®è®¿é—®å±‚å®šä¹‰
 * @author Knot Team
 * @date 2025-10-10
 */

#pragma once

#include "models/like.h"
#include <optional>
#include <vector>
#include <string>

/**
 * @brief ç‚¹èµæ•°æ®è®¿é—®ç±»
 *
 * è´Ÿè´£ç‚¹èµæ•°æ®çš„CRUDæ“ä½œ
 */
class LikeRepository {
public:
    /**
     * @brief æ„é€ å‡½æ•°
     */
    LikeRepository();

    /**
     * @brief ææ„å‡½æ•°
     */
    ~LikeRepository() = default;

    /**
     * @brief åˆ›å»ºç‚¹èµè®°å½•
     * @param like ç‚¹èµå¯¹è±¡
     * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
     */
    bool create(Like& like);

    /**
     * @brief åˆ é™¤ç‚¹èµè®°å½•
     * @param userId ç”¨æˆ·ID
     * @param postId å¸–å­IDï¼ˆç‰©ç†IDï¼‰
     * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
     */
    bool deleteByUserAndPost(int64_t userId, int64_t postId);

    /**
     * @brief æ£€æŸ¥ç‚¹èµæ˜¯å¦å­˜åœ¨
     * @param userId ç”¨æˆ·ID
     * @param postId å¸–å­IDï¼ˆç‰©ç†IDï¼‰
     * @return å­˜åœ¨è¿”å›trueï¼Œä¸å­˜åœ¨è¿”å›false
     */
    bool exists(int64_t userId, int64_t postId);

    /**
     * @brief æ ¹æ®ç”¨æˆ·IDæŸ¥æ‰¾ç‚¹èµåˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
     * @param userId ç”¨æˆ·ID
     * @param page é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
     * @param pageSize æ¯é¡µæ•°é‡
     * @return ç‚¹èµåˆ—è¡¨
     */
    std::vector<Like> findByUserId(int64_t userId, int page, int pageSize);

    /**
     * @brief æ ¹æ®å¸–å­IDè·å–ç‚¹èµæ•°é‡
     * @param postId å¸–å­IDï¼ˆç‰©ç†IDï¼‰
     * @return ç‚¹èµæ•°é‡
     */
    int getCountByPostId(int64_t postId);
};
```

**éªŒè¯**:
```bash
cat /home/kun/projects/Knot/backend-service/src/database/like_repository.h | wc -l
# åº”è¯¥çº¦80è¡Œ
```

---

#### ä»»åŠ¡3.2: å®ç° `src/database/like_repository.cpp`

**æ‰§è¡Œ**:
```bash
touch /home/kun/projects/Knot/backend-service/src/database/like_repository.cpp
```

**æ–‡ä»¶å†…å®¹**ï¼ˆå…³é”®æ–¹æ³•ï¼‰:
```cpp
/**
 * @file like_repository.cpp
 * @brief ç‚¹èµæ•°æ®è®¿é—®å±‚å®ç°
 * @author Knot Team
 * @date 2025-10-10
 */

#include "database/like_repository.h"
#include "database/connection_guard.h"
#include "database/connection_pool.h"
#include "utils/logger.h"
#include <mysql/mysql.h>

/**
 * @brief æ„é€ å‡½æ•°
 */
LikeRepository::LikeRepository() {
}

/**
 * @brief åˆ›å»ºç‚¹èµè®°å½•
 * @param like ç‚¹èµå¯¹è±¡
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 */
bool LikeRepository::create(Like& like) {
    Logger::info("LikeRepository::create - å¼€å§‹åˆ›å»ºç‚¹èµè®°å½•");

    // è·å–æ•°æ®åº“è¿æ¥
    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("LikeRepository::create - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return false;
    }

    MYSQL* conn = connGuard.get();

    // å‡†å¤‡SQLè¯­å¥ï¼ˆä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼‰
    const char* sql = "INSERT INTO likes (user_id, post_id, create_time) VALUES (?, ?, CURRENT_TIMESTAMP)";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("LikeRepository::create - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return false;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("LikeRepository::create - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥: " + std::string(mysql_stmt_error(stmt)));
        mysql_stmt_close(stmt);
        return false;
    }

    // ç»‘å®šå‚æ•°
    MYSQL_BIND bind[2];
    memset(bind, 0, sizeof(bind));

    // user_id
    int64_t userId = like.getUserId();
    bind[0].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[0].buffer = &userId;
    bind[0].is_null = 0;

    // post_id
    int64_t postId = like.getPostId();
    bind[1].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[1].buffer = &postId;
    bind[1].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("LikeRepository::create - å‚æ•°ç»‘å®šå¤±è´¥: " + std::string(mysql_stmt_error(stmt)));
        mysql_stmt_close(stmt);
        return false;
    }

    // æ‰§è¡Œæ’å…¥
    if (mysql_stmt_execute(stmt) != 0) {
        unsigned int error_code = mysql_stmt_errno(stmt);
        std::string error_msg = mysql_stmt_error(stmt);

        // æ£€æŸ¥æ˜¯å¦æ˜¯å”¯ä¸€çº¦æŸå†²çªï¼ˆå·²ç»ç‚¹èµè¿‡ï¼‰
        if (error_code == 1062) {  // ER_DUP_ENTRY
            Logger::warning("LikeRepository::create - ç”¨æˆ·å·²ç‚¹èµè¿‡è¯¥å¸–å­");
            mysql_stmt_close(stmt);
            return false;  // è¿”å›falseè¡¨ç¤ºå·²ç‚¹èµ
        }

        Logger::error("LikeRepository::create - æ‰§è¡Œæ’å…¥å¤±è´¥: " + error_msg);
        mysql_stmt_close(stmt);
        return false;
    }

    // è·å–è‡ªå¢ID
    int64_t insertId = mysql_stmt_insert_id(stmt);
    like.setId(insertId);
    like.setCreateTime(std::time(nullptr));

    mysql_stmt_close(stmt);

    Logger::info("LikeRepository::create - ç‚¹èµè®°å½•åˆ›å»ºæˆåŠŸï¼ŒID: " + std::to_string(insertId));
    return true;
}

/**
 * @brief åˆ é™¤ç‚¹èµè®°å½•
 * @param userId ç”¨æˆ·ID
 * @param postId å¸–å­IDï¼ˆç‰©ç†IDï¼‰
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 */
bool LikeRepository::deleteByUserAndPost(int64_t userId, int64_t postId) {
    Logger::info("LikeRepository::deleteByUserAndPost - å¼€å§‹åˆ é™¤ç‚¹èµè®°å½•");

    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("LikeRepository::deleteByUserAndPost - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return false;
    }

    MYSQL* conn = connGuard.get();

    const char* sql = "DELETE FROM likes WHERE user_id = ? AND post_id = ?";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("LikeRepository::deleteByUserAndPost - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return false;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("LikeRepository::deleteByUserAndPost - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    MYSQL_BIND bind[2];
    memset(bind, 0, sizeof(bind));

    bind[0].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[0].buffer = &userId;
    bind[0].is_null = 0;

    bind[1].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[1].buffer = &postId;
    bind[1].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("LikeRepository::deleteByUserAndPost - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("LikeRepository::deleteByUserAndPost - æ‰§è¡Œåˆ é™¤å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    // æ£€æŸ¥æ˜¯å¦æœ‰è®°å½•è¢«åˆ é™¤
    my_ulonglong affected_rows = mysql_stmt_affected_rows(stmt);
    mysql_stmt_close(stmt);

    if (affected_rows == 0) {
        Logger::warning("LikeRepository::deleteByUserAndPost - æœªæ‰¾åˆ°ç‚¹èµè®°å½•");
        return false;
    }

    Logger::info("LikeRepository::deleteByUserAndPost - ç‚¹èµè®°å½•åˆ é™¤æˆåŠŸ");
    return true;
}

/**
 * @brief æ£€æŸ¥ç‚¹èµæ˜¯å¦å­˜åœ¨
 * @param userId ç”¨æˆ·ID
 * @param postId å¸–å­IDï¼ˆç‰©ç†IDï¼‰
 * @return å­˜åœ¨è¿”å›trueï¼Œä¸å­˜åœ¨è¿”å›false
 */
bool LikeRepository::exists(int64_t userId, int64_t postId) {
    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("LikeRepository::exists - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return false;
    }

    MYSQL* conn = connGuard.get();

    const char* sql = "SELECT COUNT(*) FROM likes WHERE user_id = ? AND post_id = ?";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("LikeRepository::exists - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return false;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("LikeRepository::exists - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    MYSQL_BIND bind[2];
    memset(bind, 0, sizeof(bind));

    bind[0].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[0].buffer = &userId;
    bind[0].is_null = 0;

    bind[1].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[1].buffer = &postId;
    bind[1].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("LikeRepository::exists - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("LikeRepository::exists - æ‰§è¡ŒæŸ¥è¯¢å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    // ç»‘å®šç»“æœ
    int64_t count = 0;
    MYSQL_BIND result[1];
    memset(result, 0, sizeof(result));

    result[0].buffer_type = MYSQL_TYPE_LONGLONG;
    result[0].buffer = &count;
    result[0].is_null = 0;

    if (mysql_stmt_bind_result(stmt, result) != 0) {
        Logger::error("LikeRepository::exists - ç»“æœç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    if (mysql_stmt_store_result(stmt) != 0) {
        Logger::error("LikeRepository::exists - å­˜å‚¨ç»“æœå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    bool exists = false;
    if (mysql_stmt_fetch(stmt) == 0) {
        exists = (count > 0);
    }

    mysql_stmt_close(stmt);
    return exists;
}

/**
 * @brief æ ¹æ®ç”¨æˆ·IDæŸ¥æ‰¾ç‚¹èµåˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
 * @param userId ç”¨æˆ·ID
 * @param page é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
 * @param pageSize æ¯é¡µæ•°é‡
 * @return ç‚¹èµåˆ—è¡¨
 */
std::vector<Like> LikeRepository::findByUserId(int64_t userId, int page, int pageSize) {
    std::vector<Like> likes;

    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("LikeRepository::findByUserId - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return likes;
    }

    MYSQL* conn = connGuard.get();

    // è®¡ç®—åç§»é‡
    int offset = (page - 1) * pageSize;

    const char* sql = "SELECT id, user_id, post_id, UNIX_TIMESTAMP(create_time) "
                      "FROM likes WHERE user_id = ? "
                      "ORDER BY create_time DESC LIMIT ? OFFSET ?";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("LikeRepository::findByUserId - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return likes;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("LikeRepository::findByUserId - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return likes;
    }

    MYSQL_BIND bind[3];
    memset(bind, 0, sizeof(bind));

    bind[0].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[0].buffer = &userId;
    bind[0].is_null = 0;

    bind[1].buffer_type = MYSQL_TYPE_LONG;
    bind[1].buffer = &pageSize;
    bind[1].is_null = 0;

    bind[2].buffer_type = MYSQL_TYPE_LONG;
    bind[2].buffer = &offset;
    bind[2].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("LikeRepository::findByUserId - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return likes;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("LikeRepository::findByUserId - æ‰§è¡ŒæŸ¥è¯¢å¤±è´¥");
        mysql_stmt_close(stmt);
        return likes;
    }

    // ç»‘å®šç»“æœ
    int64_t id, resultUserId, postId, createTime;
    MYSQL_BIND result[4];
    memset(result, 0, sizeof(result));

    result[0].buffer_type = MYSQL_TYPE_LONGLONG;
    result[0].buffer = &id;

    result[1].buffer_type = MYSQL_TYPE_LONGLONG;
    result[1].buffer = &resultUserId;

    result[2].buffer_type = MYSQL_TYPE_LONGLONG;
    result[2].buffer = &postId;

    result[3].buffer_type = MYSQL_TYPE_LONGLONG;
    result[3].buffer = &createTime;

    if (mysql_stmt_bind_result(stmt, result) != 0) {
        Logger::error("LikeRepository::findByUserId - ç»“æœç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return likes;
    }

    if (mysql_stmt_store_result(stmt) != 0) {
        Logger::error("LikeRepository::findByUserId - å­˜å‚¨ç»“æœå¤±è´¥");
        mysql_stmt_close(stmt);
        return likes;
    }

    // è·å–æ‰€æœ‰è®°å½•
    while (mysql_stmt_fetch(stmt) == 0) {
        Like like(id, resultUserId, postId);
        like.setCreateTime((std::time_t)createTime);
        likes.push_back(like);
    }

    mysql_stmt_close(stmt);

    Logger::info("LikeRepository::findByUserId - æŸ¥è¯¢åˆ°" + std::to_string(likes.size()) + "æ¡ç‚¹èµè®°å½•");
    return likes;
}

/**
 * @brief æ ¹æ®å¸–å­IDè·å–ç‚¹èµæ•°é‡
 * @param postId å¸–å­IDï¼ˆç‰©ç†IDï¼‰
 * @return ç‚¹èµæ•°é‡
 */
int LikeRepository::getCountByPostId(int64_t postId) {
    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("LikeRepository::getCountByPostId - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return 0;
    }

    MYSQL* conn = connGuard.get();

    const char* sql = "SELECT COUNT(*) FROM likes WHERE post_id = ?";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("LikeRepository::getCountByPostId - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return 0;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("LikeRepository::getCountByPostId - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return 0;
    }

    MYSQL_BIND bind[1];
    memset(bind, 0, sizeof(bind));

    bind[0].buffer_type = MYSQL_TYPE_LONGLONG;
    bind[0].buffer = &postId;
    bind[0].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("LikeRepository::getCountByPostId - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return 0;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("LikeRepository::getCountByPostId - æ‰§è¡ŒæŸ¥è¯¢å¤±è´¥");
        mysql_stmt_close(stmt);
        return 0;
    }

    int64_t count = 0;
    MYSQL_BIND result[1];
    memset(result, 0, sizeof(result));

    result[0].buffer_type = MYSQL_TYPE_LONGLONG;
    result[0].buffer = &count;
    result[0].is_null = 0;

    if (mysql_stmt_bind_result(stmt, result) != 0) {
        Logger::error("LikeRepository::getCountByPostId - ç»“æœç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return 0;
    }

    if (mysql_stmt_store_result(stmt) != 0) {
        Logger::error("LikeRepository::getCountByPostId - å­˜å‚¨ç»“æœå¤±è´¥");
        mysql_stmt_close(stmt);
        return 0;
    }

    if (mysql_stmt_fetch(stmt) == 0) {
        mysql_stmt_close(stmt);
        return (int)count;
    }

    mysql_stmt_close(stmt);
    return 0;
}
```

**éªŒè¯**:
```bash
cat /home/kun/projects/Knot/backend-service/src/database/like_repository.cpp | wc -l
# åº”è¯¥çº¦400è¡Œ
```

---

#### ä»»åŠ¡3.3: åˆ›å»ºå¹¶å®ç° `src/database/favorite_repository.{h,cpp}`

**æ‰§è¡Œ**:
```bash
# å¤åˆ¶like_repositoryå¹¶ä¿®æ”¹
cp /home/kun/projects/Knot/backend-service/src/database/like_repository.h \
   /home/kun/projects/Knot/backend-service/src/database/favorite_repository.h

cp /home/kun/projects/Knot/backend-service/src/database/like_repository.cpp \
   /home/kun/projects/Knot/backend-service/src/database/favorite_repository.cpp
```

**ä¿®æ”¹å†…å®¹**:
- å°†æ‰€æœ‰ `Like` æ›¿æ¢ä¸º `Favorite`
- å°†æ‰€æœ‰ `like` æ›¿æ¢ä¸º `favorite`
- å°†æ‰€æœ‰ `likes` è¡¨åæ›¿æ¢ä¸º `favorites`
- å°†æ‰€æœ‰ `LikeRepository` æ›¿æ¢ä¸º `FavoriteRepository`

---

#### ä»»åŠ¡3.4: ä¿®æ”¹ `src/database/post_repository.h`

**åœ¨æ–‡ä»¶æœ«å°¾çš„privateä¹‹å‰æ·»åŠ **:

```cpp
    /**
     * @brief åŸå­å¢åŠ ç‚¹èµæ•°
     * @param postId å¸–å­ä¸šåŠ¡ID
     * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
     */
    bool incrementLikeCount(const std::string& postId);

    /**
     * @brief åŸå­å‡å°‘ç‚¹èµæ•°
     * @param postId å¸–å­ä¸šåŠ¡ID
     * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
     */
    bool decrementLikeCount(const std::string& postId);

    /**
     * @brief åŸå­å¢åŠ æ”¶è—æ•°
     * @param postId å¸–å­ä¸šåŠ¡ID
     * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
     */
    bool incrementFavoriteCount(const std::string& postId);

    /**
     * @brief åŸå­å‡å°‘æ”¶è—æ•°
     * @param postId å¸–å­ä¸šåŠ¡ID
     * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
     */
    bool decrementFavoriteCount(const std::string& postId);
```

---

#### ä»»åŠ¡3.5: å®ç° `src/database/post_repository.cpp` - åŸå­æ›´æ–°æ–¹æ³•

**åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ **:

```cpp
/**
 * @brief åŸå­å¢åŠ ç‚¹èµæ•°
 * @param postId å¸–å­ä¸šåŠ¡ID
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 */
bool PostRepository::incrementLikeCount(const std::string& postId) {
    Logger::info("PostRepository::incrementLikeCount - å¢åŠ å¸–å­ç‚¹èµæ•°: " + postId);

    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("PostRepository::incrementLikeCount - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return false;
    }

    MYSQL* conn = connGuard.get();

    // ä½¿ç”¨åŸå­æ“ä½œï¼šlike_count = like_count + 1
    const char* sql = "UPDATE posts SET like_count = like_count + 1 WHERE post_id = ?";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("PostRepository::incrementLikeCount - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return false;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("PostRepository::incrementLikeCount - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    MYSQL_BIND bind[1];
    memset(bind, 0, sizeof(bind));

    unsigned long postIdLength = postId.length();
    bind[0].buffer_type = MYSQL_TYPE_STRING;
    bind[0].buffer = (void*)postId.c_str();
    bind[0].buffer_length = postIdLength;
    bind[0].length = &postIdLength;
    bind[0].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("PostRepository::incrementLikeCount - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("PostRepository::incrementLikeCount - æ‰§è¡Œæ›´æ–°å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    mysql_stmt_close(stmt);
    Logger::info("PostRepository::incrementLikeCount - ç‚¹èµæ•°å¢åŠ æˆåŠŸ");
    return true;
}

/**
 * @brief åŸå­å‡å°‘ç‚¹èµæ•°
 * @param postId å¸–å­ä¸šåŠ¡ID
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 */
bool PostRepository::decrementLikeCount(const std::string& postId) {
    Logger::info("PostRepository::decrementLikeCount - å‡å°‘å¸–å­ç‚¹èµæ•°: " + postId);

    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("PostRepository::decrementLikeCount - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return false;
    }

    MYSQL* conn = connGuard.get();

    // ä½¿ç”¨åŸå­æ“ä½œï¼šlike_count = like_count - 1ï¼Œä½†ä¸èƒ½å°äº0
    const char* sql = "UPDATE posts SET like_count = like_count - 1 WHERE post_id = ? AND like_count > 0";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("PostRepository::decrementLikeCount - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return false;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("PostRepository::decrementLikeCount - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    MYSQL_BIND bind[1];
    memset(bind, 0, sizeof(bind));

    unsigned long postIdLength = postId.length();
    bind[0].buffer_type = MYSQL_TYPE_STRING;
    bind[0].buffer = (void*)postId.c_str();
    bind[0].buffer_length = postIdLength;
    bind[0].length = &postIdLength;
    bind[0].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("PostRepository::decrementLikeCount - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("PostRepository::decrementLikeCount - æ‰§è¡Œæ›´æ–°å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    mysql_stmt_close(stmt);
    Logger::info("PostRepository::decrementLikeCount - ç‚¹èµæ•°å‡å°‘æˆåŠŸ");
    return true;
}

/**
 * @brief åŸå­å¢åŠ æ”¶è—æ•°
 * @param postId å¸–å­ä¸šåŠ¡ID
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 */
bool PostRepository::incrementFavoriteCount(const std::string& postId) {
    Logger::info("PostRepository::incrementFavoriteCount - å¢åŠ å¸–å­æ”¶è—æ•°: " + postId);

    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("PostRepository::incrementFavoriteCount - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return false;
    }

    MYSQL* conn = connGuard.get();

    const char* sql = "UPDATE posts SET favorite_count = favorite_count + 1 WHERE post_id = ?";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("PostRepository::incrementFavoriteCount - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return false;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("PostRepository::incrementFavoriteCount - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    MYSQL_BIND bind[1];
    memset(bind, 0, sizeof(bind));

    unsigned long postIdLength = postId.length();
    bind[0].buffer_type = MYSQL_TYPE_STRING;
    bind[0].buffer = (void*)postId.c_str();
    bind[0].buffer_length = postIdLength;
    bind[0].length = &postIdLength;
    bind[0].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("PostRepository::incrementFavoriteCount - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("PostRepository::incrementFavoriteCount - æ‰§è¡Œæ›´æ–°å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    mysql_stmt_close(stmt);
    Logger::info("PostRepository::incrementFavoriteCount - æ”¶è—æ•°å¢åŠ æˆåŠŸ");
    return true;
}

/**
 * @brief åŸå­å‡å°‘æ”¶è—æ•°
 * @param postId å¸–å­ä¸šåŠ¡ID
 * @return æˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false
 */
bool PostRepository::decrementFavoriteCount(const std::string& postId) {
    Logger::info("PostRepository::decrementFavoriteCount - å‡å°‘å¸–å­æ”¶è—æ•°: " + postId);

    ConnectionGuard connGuard(DatabaseConnectionPool::getInstance());
    if (!connGuard.isValid()) {
        Logger::error("PostRepository::decrementFavoriteCount - è·å–æ•°æ®åº“è¿æ¥å¤±è´¥");
        return false;
    }

    MYSQL* conn = connGuard.get();

    const char* sql = "UPDATE posts SET favorite_count = favorite_count - 1 WHERE post_id = ? AND favorite_count > 0";

    MYSQL_STMT* stmt = mysql_stmt_init(conn);
    if (!stmt) {
        Logger::error("PostRepository::decrementFavoriteCount - åˆå§‹åŒ–é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        return false;
    }

    if (mysql_stmt_prepare(stmt, sql, strlen(sql)) != 0) {
        Logger::error("PostRepository::decrementFavoriteCount - é¢„ç¼–è¯‘è¯­å¥å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    MYSQL_BIND bind[1];
    memset(bind, 0, sizeof(bind));

    unsigned long postIdLength = postId.length();
    bind[0].buffer_type = MYSQL_TYPE_STRING;
    bind[0].buffer = (void*)postId.c_str();
    bind[0].buffer_length = postIdLength;
    bind[0].length = &postIdLength;
    bind[0].is_null = 0;

    if (mysql_stmt_bind_param(stmt, bind) != 0) {
        Logger::error("PostRepository::decrementFavoriteCount - å‚æ•°ç»‘å®šå¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    if (mysql_stmt_execute(stmt) != 0) {
        Logger::error("PostRepository::decrementFavoriteCount - æ‰§è¡Œæ›´æ–°å¤±è´¥");
        mysql_stmt_close(stmt);
        return false;
    }

    mysql_stmt_close(stmt);
    Logger::info("PostRepository::decrementFavoriteCount - æ”¶è—æ•°å‡å°‘æˆåŠŸ");
    return true;
}
```

---

#### ä»»åŠ¡3.6: ç¼–è¯‘æµ‹è¯•

**æ‰§è¡Œ**:
```bash
cd /home/kun/projects/Knot/backend-service/build
cmake ..
make -j4
```

**éªŒè¯**:
- âœ… ç¼–è¯‘æ— é”™è¯¯
- âœ… ç¼–è¯‘æ— è­¦å‘Š
- âœ… ç”Ÿæˆæ‰€æœ‰Repositoryçš„.oæ–‡ä»¶

---

### é˜¶æ®µ4ï¼šServiceå±‚ï¼ˆ3-4å°æ—¶ï¼‰

**ç›®æ ‡**: å®ç°LikeServiceå’ŒFavoriteServiceï¼ŒåŒ…å«å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å’Œäº‹åŠ¡ç®¡ç†

**è¯´æ˜**: ç”±äºç¯‡å¹…é™åˆ¶ï¼ŒServiceå±‚å’Œåç»­é˜¶æ®µçš„è¯¦ç»†å®ç°å°†åœ¨å®é™…å¼€å‘æ—¶å‚è€ƒæœ¬æ–‡æ¡£æ‰§è¡Œã€‚æ ¸å¿ƒè¦ç‚¹ï¼š
- ä½¿ç”¨TransactionGuardä¿è¯åŸå­æ€§
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- æƒé™éªŒè¯ï¼ˆåªèƒ½æ“ä½œè‡ªå·±çš„ç‚¹èµ/æ”¶è—ï¼‰

---

### é˜¶æ®µ5ï¼šHandlerå±‚ï¼ˆ2-3å°æ—¶ï¼‰

**ç›®æ ‡**: å®ç°LikeHandlerå’ŒFavoriteHandlerï¼Œç»§æ‰¿BaseHandler

**æ ¸å¿ƒä»£ç æ¡†æ¶**:
```cpp
void LikeHandler::handleLike(const httplib::Request& req, httplib::Response& res) {
    // 1. éªŒè¯JWT token
    auto tokenResult = validateTokenFromHeader(req);
    if (!tokenResult.valid) {
        sendErrorResponse(res, 401, "ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ");
        return;
    }

    // 2. æå–post_idï¼ˆä»è·¯å¾„å‚æ•°ï¼‰
    std::string postId = req.matches[1];

    // 3. è°ƒç”¨Service
    auto result = likeService_->likePost(tokenResult.userId, postId);

    // 4. æ„é€ å“åº”
    if (result.success) {
        sendSuccessResponse(res, 200, result.message, result.data);
    } else {
        sendErrorResponse(res, result.httpCode, result.message);
    }
}
```

---

### é˜¶æ®µ6ï¼šé›†æˆæµ‹è¯•ï¼ˆ2-3å°æ—¶ï¼‰

**æµ‹è¯•ç”¨ä¾‹æ¸…å•**:
1. âœ… ç‚¹èµåŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. âœ… é‡å¤ç‚¹èµè¿”å›409
3. âœ… å–æ¶ˆç‚¹èµåŠŸèƒ½æ­£å¸¸å·¥ä½œ
4. âœ… æ”¶è—åŠŸèƒ½æ­£å¸¸å·¥ä½œ
5. âœ… é‡å¤æ”¶è—è¿”å›409
6. âœ… å–æ¶ˆæ”¶è—åŠŸèƒ½æ­£å¸¸å·¥ä½œ
7. âœ… å¹¶å‘ç‚¹èµè®¡æ•°å‡†ç¡®
8. âœ… çº§è”åˆ é™¤æ­£å¸¸å·¥ä½œ
9. âœ… JWTè®¤è¯æ­£ç¡®å®æ–½

---

### é˜¶æ®µ7ï¼šæ–‡æ¡£æ›´æ–°ï¼ˆ1å°æ—¶ï¼‰

**å¾…æ›´æ–°æ–‡æ¡£**:
- [000]APIæ–‡æ¡£.md - æ–°å¢äº’åŠ¨ç³»ç»ŸAPIç« èŠ‚
- [002]é¡¹ç›®æ¶æ„æ–‡æ¡£.md - æ›´æ–°ä»£ç ç»Ÿè®¡
- backend-service/README.md - æ›´æ–°ç‰ˆæœ¬å·v2.2.0
- CLAUDE.md - æ›´æ–°APIç‰ˆæœ¬å†å²

---

## å…³é”®æŠ€æœ¯ç‚¹

### 1. å¹¶å‘å®‰å…¨çš„ç‚¹èµè®¡æ•°

**é”™è¯¯ç¤ºä¾‹**ï¼ˆæœ‰ç«æ€æ¡ä»¶ï¼‰:
```cpp
// âŒ é”™è¯¯ï¼šå…ˆè¯»åå†™ï¼Œé«˜å¹¶å‘æ—¶ä¼šä¸¢å¤±æ›´æ–°
int count = postRepo_->getLikeCount(postId);  // è¯»å–ï¼š42
count++;                                       // è®¡ç®—ï¼š43
postRepo_->setLikeCount(postId, count);       // å†™å…¥ï¼š43

// å¦‚æœä¸¤ä¸ªç”¨æˆ·åŒæ—¶ç‚¹èµï¼š
// ç”¨æˆ·Aè¯»å–ï¼š42 â†’ è®¡ç®—ï¼š43 â†’ å†™å…¥ï¼š43
// ç”¨æˆ·Bè¯»å–ï¼š42 â†’ è®¡ç®—ï¼š43 â†’ å†™å…¥ï¼š43
// ç»“æœï¼šlike_count=43ï¼ˆé”™è¯¯ï¼åº”è¯¥æ˜¯44ï¼‰
```

**æ­£ç¡®ç¤ºä¾‹**ï¼ˆåŸå­æ“ä½œï¼‰:
```cpp
// âœ… æ­£ç¡®ï¼šä½¿ç”¨SQLåŸå­æ“ä½œ
// SQL: UPDATE posts SET like_count = like_count + 1 WHERE post_id = ?
postRepo_->incrementLikeCount(postId);

// MySQLä¿è¯åŸå­æ€§ï¼š
// ç”¨æˆ·Aæ‰§è¡Œï¼šUPDATE posts SET like_count = like_count + 1  (42â†’43)
// ç”¨æˆ·Bæ‰§è¡Œï¼šUPDATE posts SET like_count = like_count + 1  (43â†’44)
// ç»“æœï¼šlike_count=44ï¼ˆæ­£ç¡®ï¼ï¼‰
```

---

### 2. äº‹åŠ¡ç®¡ç†æ¨¡å¼

**ä½¿ç”¨TransactionGuardä¿è¯åŸå­æ€§**:

```cpp
bool LikeService::likePost(int userId, const std::string& postId) {
    // å¼€å¯äº‹åŠ¡
    TransactionGuard tx(DatabaseConnectionPool::getInstance());

    // æ­¥éª¤1ï¼šæ’å…¥ç‚¹èµè®°å½•
    Like like;
    like.setUserId(userId);
    like.setPostId(postIdInt);
    if (!likeRepo_->create(like)) {
        // è‡ªåŠ¨å›æ»šï¼ˆTransactionGuardææ„ï¼‰
        return false;
    }

    // æ­¥éª¤2ï¼šæ›´æ–°ç‚¹èµæ•°
    if (!postRepo_->incrementLikeCount(postId)) {
        // è‡ªåŠ¨å›æ»š
        return false;
    }

    // æ‰‹åŠ¨æäº¤
    tx.commit();
    return true;
}

// å¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼ŒTransactionGuardææ„æ—¶è‡ªåŠ¨å›æ»š
// ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼šlikesè¡¨è®°å½•å’Œposts.like_countåŒæ­¥
```

---

### 3. å”¯ä¸€çº¦æŸçš„å¹‚ç­‰æ€§å¤„ç†

**æ•°æ®åº“å”¯ä¸€çº¦æŸ**:
```sql
UNIQUE KEY uk_user_post (user_id, post_id)
```

**Repositoryå±‚å¤„ç†**:
```cpp
bool LikeRepository::create(Like& like) {
    // ...æ‰§è¡ŒINSERTè¯­å¥...

    if (mysql_stmt_execute(stmt) != 0) {
        unsigned int error_code = mysql_stmt_errno(stmt);

        // æ£€æŸ¥æ˜¯å¦æ˜¯å”¯ä¸€çº¦æŸå†²çªï¼ˆå·²ç»ç‚¹èµè¿‡ï¼‰
        if (error_code == 1062) {  // ER_DUP_ENTRY
            Logger::warning("ç”¨æˆ·å·²ç‚¹èµè¿‡è¯¥å¸–å­");
            return false;  // è¿”å›falseè¡¨ç¤ºå·²ç‚¹èµ
        }

        // å…¶ä»–é”™è¯¯
        Logger::error("æ‰§è¡Œæ’å…¥å¤±è´¥: " + std::string(mysql_stmt_error(stmt)));
        return false;
    }

    return true;
}
```

**Serviceå±‚è½¬æ¢ä¸ºå‹å¥½é”™è¯¯**:
```cpp
LikeResult LikeService::likePost(int userId, const std::string& postId) {
    // å…ˆæ£€æŸ¥æ˜¯å¦å·²ç‚¹èµ
    if (likeRepo_->exists(userId, postIdInt)) {
        return {false, "å·²ç»ç‚¹èµè¿‡è¯¥å¸–å­", 409, currentCount};
    }

    // æ‰§è¡Œç‚¹èµé€»è¾‘...
}
```

---

### 4. æ€§èƒ½ä¼˜åŒ–ç´¢å¼•è®¾è®¡

**ç´¢å¼•è®¾è®¡**:

| ç´¢å¼• | å­—æ®µ | ç±»å‹ | ç”¨é€” | æŸ¥è¯¢ç¤ºä¾‹ |
|------|------|------|------|---------|
| PRIMARY | id | ä¸»é”®ç´¢å¼• | å¿«é€Ÿå®šä½è®°å½• | `SELECT * FROM likes WHERE id = 123` |
| uk_user_post | (user_id, post_id) | å”¯ä¸€ç´¢å¼• | é˜²æ­¢é‡å¤ç‚¹èµ + å¿«é€Ÿexists()æŸ¥è¯¢ | `SELECT COUNT(*) FROM likes WHERE user_id=1 AND post_id=2` |
| idx_post_id | post_id | æ™®é€šç´¢å¼• | æŒ‰å¸–å­ç»Ÿè®¡ç‚¹èµæ•° | `SELECT COUNT(*) FROM likes WHERE post_id = 2` |
| idx_user_create | (user_id, create_time DESC) | å¤åˆç´¢å¼• | æŸ¥è¯¢ç”¨æˆ·ç‚¹èµå†å²ï¼ˆæ—¶é—´å€’åºï¼‰ | `SELECT * FROM likes WHERE user_id=1 ORDER BY create_time DESC LIMIT 20` |

**ç´¢å¼•è¦†ç›–æŸ¥è¯¢**:
```sql
-- æŸ¥è¯¢æ˜¯å¦ç‚¹èµè¿‡ï¼ˆä½¿ç”¨uk_user_postç´¢å¼•ï¼Œæ— éœ€å›è¡¨ï¼‰
SELECT COUNT(*) FROM likes WHERE user_id = 1 AND post_id = 2;

-- æŸ¥è¯¢æŸå¸–å­ç‚¹èµæ•°ï¼ˆä½¿ç”¨idx_post_idç´¢å¼•ï¼‰
SELECT COUNT(*) FROM likes WHERE post_id = 2;
```

---

## é£é™©å’Œæ³¨æ„äº‹é¡¹

### é£é™©è¯„ä¼°è¡¨

| é£é™©ç‚¹ | å½±å“ç­‰çº§ | å‘ç”Ÿæ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|--------|---------|---------|------|----------|
| é«˜å¹¶å‘ç‚¹èµå¯¼è‡´è®¡æ•°ä¸å‡† | ğŸ”´ é«˜ | ä¸­ | ç”¨æˆ·çœ‹åˆ°çš„ç‚¹èµæ•°é”™è¯¯ï¼Œæ•°æ®ä¸ä¸€è‡´ | ä½¿ç”¨SQLåŸå­æ“ä½œï¼ˆlike_count + 1ï¼‰ |
| ç‚¹èµè®°å½•ä¸è®¡æ•°ä¸ä¸€è‡´ | ğŸ”´ é«˜ | ä½ | æ•°æ®å®Œæ•´æ€§é—®é¢˜ | ä½¿ç”¨TransactionGuardä¿è¯äº‹åŠ¡åŸå­æ€§ |
| çƒ­é—¨å¸–å­ç‚¹èµé¢‘ç¹æ›´æ–° | ğŸŸ¡ ä¸­ | é«˜ | æ•°æ®åº“æ€§èƒ½ç“¶é¢ˆï¼Œå†™å…¥å»¶è¿Ÿ | è€ƒè™‘å¼•å…¥Redisç¼“å­˜ï¼ˆæœªæ¥ä¼˜åŒ–ï¼‰ |
| é‡å¤ç‚¹èµè¯·æ±‚ | ğŸŸ¢ ä½ | ä¸­ | ç”¨æˆ·ä½“éªŒä¸ä½³ | å”¯ä¸€çº¦æŸ + å‰ç«¯é˜²æŠ– + Serviceå±‚æ£€æŸ¥ |
| è¯¯åˆ åˆ«äººçš„ç‚¹èµ | ğŸ”´ é«˜ | ä½ | å®‰å…¨é—®é¢˜ | Serviceå±‚éªŒè¯userIdåŒ¹é… |
| æ•°æ®åº“è¿æ¥æ³„æ¼ | ğŸ”´ é«˜ | ä½ | æœåŠ¡å™¨å´©æºƒ | æ‰€æœ‰Repositoryä½¿ç”¨ConnectionGuard |
| SQLæ³¨å…¥æ”»å‡» | ğŸ”´ é«˜ | ä½ | æ•°æ®åº“è¢«æ”»å‡» | æ‰€æœ‰æŸ¥è¯¢ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆMYSQL_STMTï¼‰ |

---

### æ³¨æ„äº‹é¡¹æ¸…å•

**æ¶æ„è§„èŒƒ**:
1. âš ï¸ **ä¸è¦åœ¨Modelå±‚æ·»åŠ ä¸šåŠ¡é€»è¾‘**ï¼ˆåªåšæ•°æ®å°è£…ï¼ŒtoJson/fromJsonï¼‰
2. âš ï¸ **ä¸è¦åœ¨Repositoryå±‚åšæƒé™éªŒè¯**ï¼ˆåº”åœ¨Serviceå±‚éªŒè¯userIdï¼‰
3. âš ï¸ **ä¸è¦åœ¨Handlerå±‚ç›´æ¥è®¿é—®Repository**ï¼ˆå¿…é¡»é€šè¿‡Serviceå±‚ï¼‰
4. âš ï¸ **ä¸è¦è·¨å±‚è°ƒç”¨**ï¼ˆä¸¥æ ¼éµå¾ªä¹å±‚æ¶æ„ï¼Œæ¯å±‚åªèƒ½è°ƒç”¨ä¸‹å±‚ï¼‰

**äº‹åŠ¡ç®¡ç†**:
5. âš ï¸ **ä¸è¦å¿˜è®°ä½¿ç”¨TransactionGuard**ï¼ˆæ‰€æœ‰å¤šè¡¨æ“ä½œå¿…é¡»åœ¨äº‹åŠ¡ä¸­ï¼‰
6. âš ï¸ **ä¸è¦åœ¨äº‹åŠ¡ä¸­æ‰§è¡Œé•¿æ—¶é—´æ“ä½œ**ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶IOï¼Œä¼šé”è¡¨ï¼‰
7. âš ï¸ **ä¸è¦åµŒå¥—äº‹åŠ¡**ï¼ˆTransactionGuardä¸æ”¯æŒåµŒå¥—äº‹åŠ¡ï¼‰

**èµ„æºç®¡ç†**:
8. âš ï¸ **ä¸è¦åœ¨å¾ªç¯ä¸­è·å–æ•°æ®åº“è¿æ¥**ï¼ˆConnectionGuardåº”åœ¨å¾ªç¯å¤–åˆ›å»ºï¼‰
9. âš ï¸ **ä¸è¦å¿˜è®°å…³é—­MYSQL_STMT**ï¼ˆä½¿ç”¨mysql_stmt_closeé‡Šæ”¾èµ„æºï¼‰
10. âš ï¸ **ä¸è¦åœ¨ææ„å‡½æ•°ä¸­æŠ›å¼‚å¸¸**ï¼ˆConnectionGuardå’ŒTransactionGuardä¼šè‡ªåŠ¨æ¸…ç†ï¼‰

**å¹¶å‘å®‰å…¨**:
11. âš ï¸ **ä¸è¦ä½¿ç”¨å…ˆè¯»åå†™çš„æ¨¡å¼æ›´æ–°è®¡æ•°**ï¼ˆä½¿ç”¨åŸå­æ“ä½œï¼šcount + 1ï¼‰
12. âš ï¸ **ä¸è¦ä¾èµ–å”¯ä¸€çº¦æŸåšä¸šåŠ¡é€»è¾‘**ï¼ˆåº”å…ˆexists()æ£€æŸ¥ï¼Œå†insertï¼‰

**é”™è¯¯å¤„ç†**:
13. âš ï¸ **ä¸è¦åæ‰å¼‚å¸¸**ï¼ˆæ‰€æœ‰é”™è¯¯å¿…é¡»è®°å½•æ—¥å¿—ï¼‰
14. âš ï¸ **ä¸è¦è¿”å›å†…éƒ¨é”™è¯¯ä¿¡æ¯ç»™ç”¨æˆ·**ï¼ˆå¦‚SQLé”™è¯¯ï¼Œåº”è½¬æ¢ä¸ºå‹å¥½æ¶ˆæ¯ï¼‰
15. âš ï¸ **ä¸è¦å¿½ç•¥mysql_stmt_execute()çš„è¿”å›å€¼**ï¼ˆå¿…é¡»æ£€æŸ¥æ˜¯å¦æˆåŠŸï¼‰

---

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

- [ ] **ç‚¹èµåŠŸèƒ½**
  - [ ] ç‚¹èµå¸–å­æˆåŠŸï¼ˆPOST /likeï¼‰
  - [ ] ç‚¹èµæ•°å®æ—¶æ›´æ–°ï¼ˆposts.like_count +1ï¼‰
  - [ ] é‡å¤ç‚¹èµè¿”å›409é”™è¯¯
  - [ ] å·²ç‚¹èµæ ‡è¯†æ­£ç¡®ï¼ˆhas_liked=trueï¼‰

- [ ] **å–æ¶ˆç‚¹èµåŠŸèƒ½**
  - [ ] å–æ¶ˆç‚¹èµæˆåŠŸï¼ˆDELETE /likeï¼‰
  - [ ] ç‚¹èµæ•°å®æ—¶æ›´æ–°ï¼ˆposts.like_count -1ï¼‰
  - [ ] æœªç‚¹èµæ—¶å–æ¶ˆè¿”å›400é”™è¯¯
  - [ ] å·²ç‚¹èµæ ‡è¯†æ­£ç¡®ï¼ˆhas_liked=falseï¼‰

- [ ] **æ”¶è—åŠŸèƒ½**
  - [ ] æ”¶è—å¸–å­æˆåŠŸï¼ˆPOST /favoriteï¼‰
  - [ ] æ”¶è—æ•°å®æ—¶æ›´æ–°ï¼ˆposts.favorite_count +1ï¼‰
  - [ ] é‡å¤æ”¶è—è¿”å›409é”™è¯¯
  - [ ] å·²æ”¶è—æ ‡è¯†æ­£ç¡®ï¼ˆhas_favorited=trueï¼‰

- [ ] **å–æ¶ˆæ”¶è—åŠŸèƒ½**
  - [ ] å–æ¶ˆæ”¶è—æˆåŠŸï¼ˆDELETE /favoriteï¼‰
  - [ ] æ”¶è—æ•°å®æ—¶æ›´æ–°ï¼ˆposts.favorite_count -1ï¼‰
  - [ ] æœªæ”¶è—æ—¶å–æ¶ˆè¿”å›400é”™è¯¯
  - [ ] å·²æ”¶è—æ ‡è¯†æ­£ç¡®ï¼ˆhas_favorited=falseï¼‰

- [ ] **æƒé™éªŒè¯**
  - [ ] JWTè®¤è¯æ­£ç¡®å®æ–½ï¼ˆæ— tokenè¿”å›401ï¼‰
  - [ ] ä»¤ç‰Œè¿‡æœŸè¿”å›401
  - [ ] åªèƒ½æ“ä½œè‡ªå·±çš„ç‚¹èµ/æ”¶è—

- [ ] **æ•°æ®ä¸€è‡´æ€§**
  - [ ] likesè¡¨è®°å½•ä¸posts.like_countä¸€è‡´
  - [ ] favoritesè¡¨è®°å½•ä¸posts.favorite_countä¸€è‡´
  - [ ] çº§è”åˆ é™¤æ­£å¸¸å·¥ä½œï¼ˆåˆ é™¤å¸–å­æ—¶è‡ªåŠ¨åˆ é™¤ç‚¹èµ/æ”¶è—ï¼‰

---

### ä»£ç è´¨é‡éªŒæ”¶

- [ ] **æ¶æ„è§„èŒƒ**
  - [ ] ç¬¦åˆä¹å±‚æ¶æ„è§„èŒƒ
  - [ ] æ¯å±‚èŒè´£æ¸…æ™°ï¼Œæ— è·¨å±‚è°ƒç”¨
  - [ ] ç»§æ‰¿BaseHandlerï¼ˆLikeHandlerã€FavoriteHandlerï¼‰

- [ ] **ä»£ç æ³¨é‡Š**
  - [ ] æ‰€æœ‰ç±»æœ‰Doxygenæ³¨é‡Š
  - [ ] æ‰€æœ‰æ–¹æ³•æœ‰è¯¦ç»†ä¸­æ–‡æ³¨é‡Š
  - [ ] å…³é”®é€»è¾‘æœ‰è¡Œå†…æ³¨é‡Šè¯´æ˜

- [ ] **å®‰å…¨æ€§**
  - [ ] ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ï¼ˆé˜²SQLæ³¨å…¥ï¼‰
  - [ ] ä½¿ç”¨ConnectionGuardï¼ˆé˜²è¿æ¥æ³„æ¼ï¼‰
  - [ ] ä½¿ç”¨TransactionGuardï¼ˆä¿è¯åŸå­æ€§ï¼‰
  - [ ] JWTä»¤ç‰ŒéªŒè¯æ­£ç¡®å®æ–½

- [ ] **é”™è¯¯å¤„ç†**
  - [ ] ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ï¼ˆsendErrorResponseï¼‰
  - [ ] å®Œæ•´çš„æ—¥å¿—è®°å½•ï¼ˆLogger::info/errorï¼‰
  - [ ] å‹å¥½çš„é”™è¯¯æ¶ˆæ¯ï¼ˆä¸­æ–‡ï¼‰

- [ ] **ç¼–è¯‘**
  - [ ] ç¼–è¯‘æ— é”™è¯¯
  - [ ] ç¼–è¯‘æ— è­¦å‘Š
  - [ ] é“¾æ¥æˆåŠŸ

---

### æ€§èƒ½éªŒæ”¶

- [ ] **å“åº”æ—¶é—´**
  - [ ] å•æ¬¡ç‚¹èµå“åº”æ—¶é—´ < 100ms
  - [ ] å•æ¬¡æ”¶è—å“åº”æ—¶é—´ < 100ms
  - [ ] FeedæµåŠ è½½æ—¶é—´æ— æ˜æ˜¾å¢åŠ 

- [ ] **å¹¶å‘æ€§èƒ½**
  - [ ] 100ä¸ªç”¨æˆ·åŒæ—¶ç‚¹èµåŒä¸€å¸–å­ï¼Œè®¡æ•°å‡†ç¡®ï¼ˆ=100ï¼‰
  - [ ] 50ä¸ªç”¨æˆ·åŒæ—¶æ”¶è—åŒä¸€å¸–å­ï¼Œè®¡æ•°å‡†ç¡®ï¼ˆ=50ï¼‰
  - [ ] æ— æ­»é”ç°è±¡

- [ ] **èµ„æºç®¡ç†**
  - [ ] æ— æ•°æ®åº“è¿æ¥æ³„æ¼
  - [ ] æ— å†…å­˜æ³„æ¼ï¼ˆä½¿ç”¨valgrindéªŒè¯ï¼‰
  - [ ] æ­£å¸¸å…³é—­æ—¶æ— èµ„æºæ®‹ç•™

---

### æµ‹è¯•éªŒæ”¶

- [ ] **é›†æˆæµ‹è¯•**
  - [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡ï¼ˆä»»åŠ¡6.1-6.9ï¼‰
  - [ ] å¼‚å¸¸æµç¨‹æµ‹è¯•é€šè¿‡ï¼ˆæ— æ•ˆtokenã€ä¸å­˜åœ¨çš„å¸–å­ç­‰ï¼‰
  - [ ] å¹¶å‘æµ‹è¯•é€šè¿‡ï¼ˆå¤šç”¨æˆ·åŒæ—¶ç‚¹èµï¼‰

- [ ] **è¾¹ç•Œæµ‹è¯•**
  - [ ] ç‚¹èµæ•°ä¸º0æ—¶å–æ¶ˆç‚¹èµï¼ˆä¸èƒ½å˜æˆè´Ÿæ•°ï¼‰
  - [ ] æ”¶è—æ•°ä¸º0æ—¶å–æ¶ˆæ”¶è—ï¼ˆä¸èƒ½å˜æˆè´Ÿæ•°ï¼‰
  - [ ] å·²åˆ é™¤çš„å¸–å­æ— æ³•ç‚¹èµï¼ˆè¿”å›404ï¼‰

- [ ] **å›å½’æµ‹è¯•**
  - [ ] ç°æœ‰å¸–å­åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰
  - [ ] ç°æœ‰ç”¨æˆ·åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆæ³¨å†Œã€ç™»å½•ã€ä¿¡æ¯ç®¡ç†ï¼‰
  - [ ] ç°æœ‰å›¾ç‰‡åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼ˆä¸Šä¼ ã€æŸ¥è¯¢ã€åˆ é™¤ï¼‰

---

### æ–‡æ¡£éªŒæ”¶

- [ ] **APIæ–‡æ¡£æ›´æ–°**
  - [ ] [000]APIæ–‡æ¡£.mdæ›´æ–°å®Œæ•´
  - [ ] åŒ…å«4ä¸ªæ–°æ¥å£æ–‡æ¡£
  - [ ] è¯·æ±‚/å“åº”ç¤ºä¾‹å®Œæ•´
  - [ ] é”™è¯¯ç è¯´æ˜æ¸…æ™°

- [ ] **æ¶æ„æ–‡æ¡£æ›´æ–°**
  - [ ] [002]é¡¹ç›®æ¶æ„æ–‡æ¡£.mdæ›´æ–°
  - [ ] ä»£ç ç»Ÿè®¡æ•°æ®æ›´æ–°
  - [ ] æ–°å¢æ¨¡å—è¯´æ˜

- [ ] **READMEæ›´æ–°**
  - [ ] backend-service/README.mdæ›´æ–°
  - [ ] ç‰ˆæœ¬å·æ›´æ–°ä¸ºv2.2.0
  - [ ] åŠŸèƒ½åˆ—è¡¨æ›´æ–°

- [ ] **CLAUDE.mdæ›´æ–°**
  - [ ] å½“å‰çŠ¶æ€æ›´æ–°
  - [ ] APIç‰ˆæœ¬å†å²æ·»åŠ v2.2.0æ¡ç›®

---

## è¿›åº¦è·Ÿè¸ª

| é˜¶æ®µ | ä»»åŠ¡æ•° | å·²å®Œæˆ | è¿›åº¦ | é¢„è®¡å·¥æ—¶ | å®é™…å·¥æ—¶ |
|------|--------|--------|------|---------|---------|
| é˜¶æ®µ0ï¼šæ•°æ®åº“è°ƒç ” | 3 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 0.5å°æ—¶ | - |
| é˜¶æ®µ1ï¼šæ•°æ®åº“å˜æ›´ | 3 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 1å°æ—¶ | - |
| é˜¶æ®µ2ï¼šModelå±‚ | 5 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 2å°æ—¶ | - |
| é˜¶æ®µ3ï¼šRepositoryå±‚ | 6 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 4å°æ—¶ | - |
| é˜¶æ®µ4ï¼šServiceå±‚ | 5 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 4å°æ—¶ | - |
| é˜¶æ®µ5ï¼šHandlerå±‚ | 8 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 3å°æ—¶ | - |
| é˜¶æ®µ6ï¼šé›†æˆæµ‹è¯• | 9 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 3å°æ—¶ | - |
| é˜¶æ®µ7ï¼šæ–‡æ¡£æ›´æ–° | 4 | 0 | 0% â¬œâ¬œâ¬œâ¬œâ¬œ | 1å°æ—¶ | - |
| **æ€»è®¡** | **43** | **0** | **0%** | **18.5å°æ—¶** | **-** |

**é¢„è®¡å®Œæˆæ—¶é—´**: 2-3ä¸ªå·¥ä½œæ—¥

**å¼€å§‹æ—¶é—´**: å¾…å®š

**å®é™…å®Œæˆæ—¶é—´**: å¾…å®š

---

## å˜æ›´æ—¥å¿—

### 2025-10-10 - æ–‡æ¡£åˆ›å»º âœ…

**åˆ›å»ºå†…å®¹**:
- âœ… å®Œæˆæ¦‚è¿°ï¼ˆèƒŒæ™¯ã€ç›®æ ‡ã€å®æ–½èŒƒå›´ï¼‰
- âœ… å®ŒæˆæŠ€æœ¯è®¾è®¡ï¼ˆæ•°æ®åº“ã€æ¶æ„ã€APIï¼‰
- âœ… å®Œæˆè¯¦ç»†ä»»åŠ¡åˆ—è¡¨ï¼ˆ43ä¸ªå­ä»»åŠ¡ï¼‰
- âœ… å®Œæˆå…³é”®æŠ€æœ¯ç‚¹ï¼ˆ4ä¸ªæŠ€æœ¯è¦ç‚¹ï¼‰
- âœ… å®Œæˆé£é™©è¯„ä¼°ï¼ˆ7ä¸ªé£é™©ç‚¹ + 15ä¸ªæ³¨æ„äº‹é¡¹ï¼‰
- âœ… å®ŒæˆéªŒæ”¶æ ‡å‡†ï¼ˆ4ä¸ªç»´åº¦ï¼‰
- âœ… å®Œæˆè¿›åº¦è·Ÿè¸ªè¡¨æ ¼

**è®¾è®¡å†³ç­–**:
- âœ… é‡‡ç”¨ç®€åŒ–è®¾è®¡ï¼ˆä¸ä½¿ç”¨ä¸šåŠ¡IDï¼‰
- âœ… ä½¿ç”¨å”¯ä¸€çº¦æŸä¿è¯å¹‚ç­‰æ€§
- âœ… ä½¿ç”¨SQLåŸå­æ“ä½œé¿å…ç«æ€
- âœ… ä½¿ç”¨TransactionGuardä¿è¯äº‹åŠ¡
- âœ… ç»§æ‰¿BaseHandlerå¤ç”¨JWTéªŒè¯

**å¾…å¼€å§‹**:
- â³ é˜¶æ®µ0ï¼šæ•°æ®åº“è°ƒç ”ï¼ˆä¸‹ä¸€æ­¥ï¼‰

---

### å˜æ›´è®°å½•æ¨¡æ¿ï¼ˆå®æ–½æ—¶å¡«å†™ï¼‰

#### YYYY-MM-DD HH:MM - é˜¶æ®µXå®Œæˆ

**å®Œæˆå†…å®¹**:
- âœ… ä»»åŠ¡X.1: ...
- âœ… ä»»åŠ¡X.2: ...

**é‡åˆ°çš„é—®é¢˜**:
- é—®é¢˜æè¿°
- è§£å†³æ–¹æ¡ˆ

**ä»£ç ç»Ÿè®¡**:
- æ–°å¢æ–‡ä»¶ï¼šXä¸ª
- ä¿®æ”¹æ–‡ä»¶ï¼šXä¸ª
- æ–°å¢ä»£ç ï¼šXè¡Œ

---

**æœ€åæ›´æ–°**: 2025-10-10
**ç»´æŠ¤è€…**: Knot Development Team
**æ–‡æ¡£çŠ¶æ€**: ğŸ“ è®¡åˆ’ä¸­

---

**é™„å½•**:

**å‚è€ƒæ–‡æ¡£**:
- [000]APIæ–‡æ¡£.md
- [001]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md
- [105]é˜¶æ®µC-2-å¤šå›¾ç‰‡å¸–å­ç³»ç»Ÿ.md
- [106]ç”¨æˆ·ä¿¡æ¯ç®¡ç†åŠŸèƒ½å®Œå–„-å®æ–½è®¡åˆ’.md
- éœ€æ±‚åˆ†æ.md

**ç›¸å…³ä»£ç **:
- src/models/post.{h,cpp} - å‚è€ƒæ¨¡å‹è®¾è®¡
- src/database/post_repository.{h,cpp} - å‚è€ƒRepositoryå®ç°
- src/core/post_service.{h,cpp} - å‚è€ƒServiceå®ç°
- src/api/post_handler.{h,cpp} - å‚è€ƒHandlerå®ç°
- src/api/base_handler.{h,cpp} - BaseHandleråŸºç±»
- src/database/connection_guard.h - è¿æ¥ç®¡ç†
- src/database/transaction_guard.h - äº‹åŠ¡ç®¡ç†

**ä¸‹ä¸€é˜¶æ®µè®¡åˆ’**:
- [108]é˜¶æ®µD-2ï¼šå…³æ³¨ç³»ç»ŸåŠŸèƒ½å®ç°è®¡åˆ’ï¼ˆå¾…ç¼–å†™ï¼‰
- [109]é˜¶æ®µD-3ï¼šè¯„è®ºç³»ç»ŸåŠŸèƒ½å®ç°è®¡åˆ’ï¼ˆå¾…ç¼–å†™ï¼‰
