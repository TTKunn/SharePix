# é˜¶æ®µD-3ï¼šåˆ†äº«ç³»ç»Ÿå®ç°è®¡åˆ’

**æ–‡æ¡£ç¼–å·**: [109]
**åˆ›å»ºæ—¶é—´**: 2025-10-11
**é¡¹ç›®**: Knot - å›¾ç‰‡åˆ†äº«ç¤¾äº¤å¹³å°
**ç‰ˆæœ¬**: v2.3.0
**çŠ¶æ€**: ğŸ“ è®¡åˆ’ä¸­
**ä¾èµ–**: [108]é˜¶æ®µD-2-äº’åŠ¨ç³»ç»Ÿå…³æ³¨åŠŸèƒ½å®ç°è®¡åˆ’ï¼ˆv2.2.0ï¼‰

---

## ğŸ“‹ ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
   - [èƒŒæ™¯](#èƒŒæ™¯)
   - [ç›®æ ‡](#ç›®æ ‡)
   - [å®æ–½èŒƒå›´](#å®æ–½èŒƒå›´)

2. [æŠ€æœ¯è®¾è®¡](#æŠ€æœ¯è®¾è®¡)
   - [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
   - [çŸ­é“¾æ¥ç®—æ³•è®¾è®¡](#çŸ­é“¾æ¥ç®—æ³•è®¾è®¡)
   - [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
   - [APIè®¾è®¡](#apiè®¾è®¡)

3. [Deep Linké…ç½®](#deep-linké…ç½®)
   - [iOS Universal Linksé…ç½®](#ios-universal-linksé…ç½®)
   - [Android App Linksé…ç½®](#android-app-linksé…ç½®)
   - [HarmonyOS Deep Linkingé…ç½®](#harmonyos-deep-linkingé…ç½®)
   - [HarmonyOS App Linkingé…ç½®](#harmonyos-app-linkingé…ç½®)
   - [ä¸‰ç«¯é…ç½®å¯¹æ¯”](#ä¸‰ç«¯é…ç½®å¯¹æ¯”)

4. [è¯¦ç»†ä»»åŠ¡åˆ—è¡¨](#è¯¦ç»†ä»»åŠ¡åˆ—è¡¨)

5. [å…³é”®æŠ€æœ¯ç‚¹](#å…³é”®æŠ€æœ¯ç‚¹)

6. [H5å‰ç«¯é›†æˆæŒ‡å¼•](#h5å‰ç«¯é›†æˆæŒ‡å¼•)

7. [é£é™©å’Œæ³¨æ„äº‹é¡¹](#é£é™©å’Œæ³¨æ„äº‹é¡¹)

8. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)

9. [åç»­ä¼˜åŒ–æ–¹å‘](#åç»­ä¼˜åŒ–æ–¹å‘)

10. [å˜æ›´æ—¥å¿—](#å˜æ›´æ—¥å¿—)

---

## æ¦‚è¿°

### èƒŒæ™¯

**å·²å®Œæˆçš„åŠŸèƒ½ï¼ˆv2.2.0ï¼‰**ï¼š
- âœ… **ç‚¹èµç³»ç»Ÿ**: ç”¨æˆ·å¯å¯¹å¸–å­ç‚¹èµ/å–æ¶ˆç‚¹èµ
- âœ… **æ”¶è—ç³»ç»Ÿ**: ç”¨æˆ·å¯æ”¶è—/å–æ¶ˆæ”¶è—å¸–å­
- âœ… **å…³æ³¨ç³»ç»Ÿ**: ç”¨æˆ·å¯å…³æ³¨/å–æ¶ˆå…³æ³¨å…¶ä»–ç”¨æˆ·
- âœ… **å¤šå›¾ç‰‡å¸–å­ç³»ç»Ÿï¼ˆv2.0.0ï¼‰**: æ”¯æŒ1-9å¼ å›¾ç‰‡çš„å¸–å­
- âœ… **ç”¨æˆ·è®¤è¯ç³»ç»Ÿï¼ˆv2.1.0ï¼‰**: æ³¨å†Œã€ç™»å½•ã€JWTä»¤ç‰Œç®¡ç†

**å½“å‰ç¼ºå¤±çš„æ ¸å¿ƒåŠŸèƒ½**ï¼š
- âŒ **åˆ†äº«ç³»ç»Ÿ**: ç”¨æˆ·æ— æ³•å°†å–œæ¬¢çš„å¸–å­åˆ†äº«åˆ°å…¶ä»–å¹³å°
- âŒ **Deep Linkæ”¯æŒ**: æ— æ³•é€šè¿‡é“¾æ¥ç›´æ¥å”¤èµ·APP
- âŒ **çŸ­é“¾æ¥ç”Ÿæˆ**: ç¼ºå°‘ç®€æ´çš„åˆ†äº«é“¾æ¥
- âŒ **ä¸‰ç«¯ç»Ÿä¸€**: ç¼ºå°‘iOS/Android/HarmonyOSçš„ç»Ÿä¸€åˆ†äº«æ–¹æ¡ˆ

æ ¹æ®äº§å“éœ€æ±‚æ–‡æ¡£ï¼ˆ`éœ€æ±‚åˆ†æ.md`ï¼‰å’Œè¡Œä¸šæœ€ä½³å®è·µï¼š
- ğŸ¯ **å†…å®¹ä¼ æ’­**: åˆ†äº«æ˜¯UGCå¹³å°æœ€é‡è¦çš„å¢é•¿å¼•æ“
- ğŸ¯ **ç”¨æˆ·æ‹‰æ–°**: é€šè¿‡Deep Linké™ä½æ–°ç”¨æˆ·å®‰è£…é—¨æ§›
- ğŸ¯ **åˆ›ä½œè€…æ¿€åŠ±**: å¸®åŠ©åˆ›ä½œè€…æ‰©å¤§å†…å®¹å½±å“åŠ›
- ğŸ¯ **ä¸‰ç«¯æ”¯æŒ**: æ”¯æŒiOSã€Androidã€HarmonyOSä¸‰å¤§ä¸»æµå¹³å°

æœ¬é˜¶æ®µå°†å®ç°**åˆ†äº«ç³»ç»Ÿ**çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸ºå†…å®¹ä¼ æ’­å’Œç”¨æˆ·å¢é•¿æä¾›åŸºç¡€è®¾æ–½ã€‚

---

### ç›®æ ‡

æœ¬é˜¶æ®µçš„æ ¸å¿ƒç›®æ ‡ï¼š

1. **å®ç°çŸ­é“¾æ¥ç”Ÿæˆ**
   - åŸºäºé›ªèŠ±IDç®—æ³•ç”Ÿæˆå…¨å±€å”¯ä¸€ID
   - ä½¿ç”¨Base62ç¼–ç ç”Ÿæˆ8ä½çŸ­ç 
   - ä¿è¯çŸ­ç å”¯ä¸€æ€§ï¼ˆæ•°æ®åº“å”¯ä¸€ç´¢å¼•ï¼‰
   - æ”¯æŒçŸ­é“¾æ¥è¿‡æœŸæœºåˆ¶

2. **å®ç°åˆ†äº«é“¾æ¥ç®¡ç†**
   - ä¸ºå¸–å­åˆ›å»ºåˆ†äº«é“¾æ¥
   - é€šè¿‡çŸ­ç è§£æè·å–å¸–å­ä¿¡æ¯
   - è®°å½•åˆ†äº«é“¾æ¥åˆ›å»ºè€…
   - è”è¡¨æŸ¥è¯¢ä¼˜åŒ–æ€§èƒ½

3. **é…ç½®ä¸‰ç«¯Deep Link**
   - iOS Universal Linksé…ç½®
   - Android App Linksé…ç½®
   - **HarmonyOS Deep Linkingé…ç½®**ï¼ˆé‡ç‚¹ï¼‰
   - **HarmonyOS App Linkingé…ç½®**ï¼ˆå®‰å…¨å‡çº§æ–¹æ¡ˆï¼‰
   - æä¾›å®Œæ•´çš„é…ç½®æ–‡ä»¶å’Œä»£ç ç¤ºä¾‹

4. **ä¿æŒæ¶æ„ä¸€è‡´æ€§**
   - ä¸¥æ ¼éµå¾ªä¹å±‚æ¶æ„
   - å¤ç”¨ç°æœ‰Repository/Serviceæ¨¡å¼
   - ä¸Like/Favorite/Followç³»ç»Ÿé£æ ¼ä¿æŒä¸€è‡´

5. **ä¸ºåç»­åŠŸèƒ½æ‰“åŸºç¡€**
   - é¢„ç•™ç»Ÿè®¡åŠŸèƒ½æ‰©å±•ç‚¹ï¼ˆvisit_count, install_countç­‰ï¼‰
   - æ”¯æŒåˆ†äº«å¤šç§å¯¹è±¡ç±»å‹ï¼ˆPOST/USER/TAGï¼‰
   - ä¸ºåˆ†äº«æµ·æŠ¥ç”Ÿæˆã€äºŒç»´ç ç”Ÿæˆé¢„ç•™æ¥å£

**é‡è¦è¯´æ˜**ï¼š
- âš ï¸ æœ¬é˜¶æ®µ**ä¸å®ç°ç»Ÿè®¡åŠŸèƒ½**ï¼ˆvisit_count, install_count, share_platformç­‰ï¼‰
- âš ï¸ æœ¬é˜¶æ®µ**ä»…æ”¯æŒåˆ†äº«å¸–å­**ï¼ˆPOSTç±»å‹ï¼‰ï¼Œä¸æ”¯æŒåˆ†äº«ç”¨æˆ·ä¸»é¡µæˆ–æ ‡ç­¾é¡µ
- âš ï¸ æ•°æ®åº“è®¾è®¡å’Œä»£ç æ¶æ„å·²é¢„ç•™æ‰©å±•ç‚¹ï¼Œåç»­è¿­ä»£å¯å¿«é€Ÿæ·»åŠ 

---

### å®æ–½èŒƒå›´

æœ¬é˜¶æ®µå°†å®ç°**2ä¸ªæ ¸å¿ƒAPIæ¥å£**ï¼š

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è®¤è¯ | è¯´æ˜ |
|------|------|------|------|------|
| åˆ›å»ºåˆ†äº«é“¾æ¥ | POST | `/api/v1/posts/:post_id/share` | âœ… éœ€è¦ | ä¸ºæŒ‡å®šå¸–å­åˆ›å»ºåˆ†äº«é“¾æ¥ |
| è§£æåˆ†äº«é“¾æ¥ | GET | `/api/v1/share/:code` | âŒ å…¬å¼€ | é€šè¿‡çŸ­ç è·å–å¸–å­ä¿¡æ¯å’ŒDeep Link |

**æ•°æ®åº“å˜æ›´**ï¼š
- æ–°å¢è¡¨ï¼š`share_links`ï¼ˆ7ä¸ªå­—æ®µï¼Œ4ä¸ªç´¢å¼•ï¼‰

**é…ç½®æ–‡ä»¶**ï¼š
- iOS: `.well-known/apple-app-site-association`
- Android: `.well-known/assetlinks.json`
- HarmonyOS: `.well-known/applinking.json`ï¼ˆApp Linkingæ–¹æ¡ˆï¼‰

**ä»£ç æ¨¡å—**ï¼š
- Modelå±‚: `ShareLink` ç±»
- Repositoryå±‚: `ShareLinkRepository` ç±»
- Serviceå±‚: `ShareService` ç±»
- Handlerå±‚: `ShareHandler` ç±»
- Utilså±‚: `Base62Encoder` ç±»ã€æ‰©å±• `IdGenerator` ç±»

**æ–‡æ¡£æ›´æ–°**ï¼š
- `[000]APIæ–‡æ¡£.md`: æ–°å¢åˆ†äº«ç³»ç»ŸAPIç« èŠ‚
- `[001]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md`: æ–°å¢share_linksè¡¨è¯´æ˜
- `README.md`: æ›´æ–°åŠŸèƒ½åˆ—è¡¨
- `CLAUDE.md`: æ›´æ–°APIç‰ˆæœ¬å†å²

---

## æŠ€æœ¯è®¾è®¡

### æ•°æ®åº“è®¾è®¡

#### share_linksè¡¨ç»“æ„

```sql
CREATE TABLE share_links (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰',
    short_code VARCHAR(10) NOT NULL UNIQUE COMMENT 'çŸ­é“¾æ¥ç (Base62ç¼–ç ,8ä½)',
    target_type ENUM('POST') NOT NULL DEFAULT 'POST' COMMENT 'åˆ†äº«ç›®æ ‡ç±»å‹(å½“å‰ä»…æ”¯æŒå¸–å­)',
    target_id BIGINT NOT NULL COMMENT 'ç›®æ ‡å¸–å­çš„ç‰©ç†ID(å¯¹åº”posts.id)',
    creator_id BIGINT NULL COMMENT 'åˆ›å»ºè€…ç”¨æˆ·ID(å¯é€‰,æœªç™»å½•ç”¨æˆ·å¯ä¸ºç©º)',
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    expire_time TIMESTAMP NULL COMMENT 'è¿‡æœŸæ—¶é—´(å¯é€‰,ç”¨äºä¸´æ—¶åˆ†äº«é“¾æ¥)',

    -- å¤–é”®çº¦æŸ
    CONSTRAINT fk_share_creator FOREIGN KEY (creator_id) REFERENCES users(id) ON DELETE SET NULL,
    CONSTRAINT fk_share_target FOREIGN KEY (target_id) REFERENCES posts(id) ON DELETE CASCADE,

    -- ç´¢å¼•ä¼˜åŒ–
    UNIQUE INDEX idx_short_code (short_code),
    INDEX idx_target (target_type, target_id),
    INDEX idx_creator (creator_id),
    INDEX idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åˆ†äº«é“¾æ¥è¡¨';
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | BIGINT | ç‰©ç†ä¸»é”®ï¼Œè‡ªå¢ |
| short_code | VARCHAR(10) | çŸ­é“¾æ¥ç ï¼Œ8ä½Base62ç¼–ç ï¼Œå¦‚"ABC12345" |
| target_type | ENUM | åˆ†äº«ç›®æ ‡ç±»å‹ï¼Œå½“å‰ä»…æ”¯æŒ'POST'ï¼ˆå¸–å­ï¼‰ |
| target_id | BIGINT | ç›®æ ‡å¸–å­çš„ç‰©ç†IDï¼Œå…³è”posts.id |
| creator_id | BIGINT | åˆ›å»ºè€…ç”¨æˆ·IDï¼Œå…³è”users.idï¼Œå¯ä¸ºNULL |
| create_time | TIMESTAMP | åˆ›å»ºæ—¶é—´ï¼Œè‡ªåŠ¨è®°å½• |
| expire_time | TIMESTAMP | è¿‡æœŸæ—¶é—´ï¼ŒNULLè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ |

#### ç´¢å¼•è®¾è®¡

| ç´¢å¼•å | ç±»å‹ | å­—æ®µ | è¯´æ˜ |
|--------|------|------|------|
| PRIMARY | ä¸»é”® | id | ç‰©ç†ä¸»é”® |
| idx_short_code | å”¯ä¸€ | short_code | çŸ­ç æŸ¥è¯¢ï¼Œæ ¸å¿ƒç´¢å¼• |
| idx_target | æ™®é€š | (target_type, target_id) | æŸ¥è¯¢æŸä¸ªå¸–å­æ˜¯å¦å·²æœ‰åˆ†äº«é“¾æ¥ |
| idx_creator | æ™®é€š | creator_id | æŸ¥è¯¢æŸç”¨æˆ·åˆ›å»ºçš„åˆ†äº«é“¾æ¥ |
| idx_create_time | æ™®é€š | create_time | æŒ‰æ—¶é—´æ’åºæŸ¥è¯¢ |

#### å¤–é”®çº¦æŸ

| çº¦æŸå | å­è¡¨å­—æ®µ | çˆ¶è¡¨ | çº§è”æ“ä½œ | è¯´æ˜ |
|--------|----------|------|----------|------|
| fk_share_creator | creator_id | users.id | ON DELETE SET NULL | åˆ é™¤ç”¨æˆ·æ—¶ï¼Œå°†creator_idè®¾ä¸ºNULL |
| fk_share_target | target_id | posts.id | ON DELETE CASCADE | åˆ é™¤å¸–å­æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å…¶åˆ†äº«é“¾æ¥ |

#### è®¾è®¡è¯´æ˜

1. **target_typeæšä¸¾æ‰©å±•æ€§**
   - å½“å‰ä»…æ”¯æŒ'POST'
   - æœªæ¥å¯æ‰©å±•ä¸º('POST', 'USER', 'TAG')
   - æ•°æ®åº“ALTER TABLEå³å¯æ·»åŠ 

2. **creator_idå¯ä¸ºNULL**
   - æ”¯æŒæœªç™»å½•ç”¨æˆ·åˆ›å»ºåˆ†äº«é“¾æ¥ï¼ˆå¦‚é€šè¿‡H5é¡µé¢åˆ†äº«ï¼‰
   - å·²ç™»å½•ç”¨æˆ·åˆ›å»ºçš„åˆ†äº«é“¾æ¥å¯è¿½è¸ªåˆ›å»ºè€…

3. **expire_timeè¿‡æœŸæœºåˆ¶**
   - NULLè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆ
   - æ”¯æŒä¸´æ—¶åˆ†äº«é“¾æ¥ï¼ˆå¦‚æ´»åŠ¨ä¸“å±é“¾æ¥ï¼‰
   - å¯é€šè¿‡å®šæ—¶ä»»åŠ¡æ¸…ç†è¿‡æœŸé“¾æ¥ï¼š`DELETE FROM share_links WHERE expire_time < NOW()`

4. **æ— ç»Ÿè®¡å­—æ®µ**
   - æœ¬ç‰ˆæœ¬ä¸åŒ…å«visit_countã€install_countã€share_platformç­‰å­—æ®µ
   - åç»­å¦‚éœ€æ·»åŠ ç»Ÿè®¡åŠŸèƒ½ï¼Œæ‰§è¡Œï¼š
     ```sql
     ALTER TABLE share_links
     ADD COLUMN visit_count INT NOT NULL DEFAULT 0 COMMENT 'è®¿é—®æ¬¡æ•°',
     ADD COLUMN install_count INT NOT NULL DEFAULT 0 COMMENT 'å®‰è£…æ¬¡æ•°',
     ADD COLUMN share_platform VARCHAR(20) NULL COMMENT 'åˆ†äº«å¹³å°';
     ```

---

### çŸ­é“¾æ¥ç®—æ³•è®¾è®¡

#### æ–¹æ¡ˆå¯¹æ¯”

| ç»´åº¦ | æ–¹æ¡ˆä¸€ï¼šé›ªèŠ±ID + Base62 | æ–¹æ¡ˆäºŒï¼šè‡ªå¢ID + Base62 |
|------|------------------------|------------------------|
| **å”¯ä¸€æ€§** | âœ… å…¨å±€å”¯ä¸€ï¼ˆé›ªèŠ±ç®—æ³•ä¿è¯ï¼‰ | âš ï¸ ä¾èµ–æ•°æ®åº“è‡ªå¢ |
| **å®‰å…¨æ€§** | âœ… ä¸å¯é¢„æµ‹ | âŒ è¿ç»­å¯é¢„æµ‹ï¼Œæ˜“è¢«éå† |
| **æ€§èƒ½** | âœ… æ— éœ€æŸ¥è¯¢æ•°æ®åº“å³å¯ç”Ÿæˆ | âš ï¸ éœ€è¦INSERTåè·å–è‡ªå¢ID |
| **çŸ­ç é•¿åº¦** | âš ï¸ å›ºå®š8ä½ | âœ… åˆæœŸæ›´çŸ­ï¼ˆ6ä½ï¼‰ |
| **æ‰©å±•æ€§** | âœ… æ”¯æŒåˆ†å¸ƒå¼ç³»ç»Ÿ | âŒ åˆ†åº“åˆ†è¡¨å›°éš¾ |
| **ç¢°æ’æ¦‚ç‡** | âœ… æä½ï¼ˆ2^64ç©ºé—´ï¼‰ | âœ… æ— ç¢°æ’ï¼ˆæ•°æ®åº“ä¿è¯ï¼‰ |
| **å®ç°å¤æ‚åº¦** | âš ï¸ éœ€å®ç°é›ªèŠ±ç®—æ³• | âœ… ç®€å• |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­ |

**ç»“è®º**: é‡‡ç”¨**æ–¹æ¡ˆä¸€ï¼šé›ªèŠ±ID + Base62ç¼–ç **

#### é›ªèŠ±IDç®—æ³•

**ç®—æ³•åŸç†**ï¼ˆ64ä½ï¼‰ï¼š
```
0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000
|   |                                                  |       |       |
ç¬¦å·ä½ |                                                  æœºå™¨ID  |       åºåˆ—å·
     æ—¶é—´æˆ³(41ä½,ç²¾ç¡®åˆ°æ¯«ç§’)                                    æ•°æ®ä¸­å¿ƒID
```

**å„éƒ¨åˆ†è¯´æ˜**ï¼š
- **1ä½ç¬¦å·ä½**: å§‹ç»ˆä¸º0ï¼ˆæ­£æ•°ï¼‰
- **41ä½æ—¶é—´æˆ³**: ç²¾ç¡®åˆ°æ¯«ç§’ï¼Œå¯ç”¨69å¹´ï¼ˆ2^41 / (1000 * 60 * 60 * 24 * 365) â‰ˆ 69ï¼‰
- **10ä½æœºå™¨ID**: 5ä½æ•°æ®ä¸­å¿ƒID + 5ä½æœºå™¨IDï¼Œæœ€å¤šæ”¯æŒ1024å°æœºå™¨
- **12ä½åºåˆ—å·**: æ¯«ç§’å†…çš„åºåˆ—å·ï¼Œæœ€å¤šæ”¯æŒ4096ä¸ªID/æ¯«ç§’

**ç®€åŒ–å®ç°**ï¼ˆå•æœºç‰ˆï¼‰ï¼š
```cpp
class SnowflakeIdGenerator {
private:
    static const int64_t EPOCH = 1609459200000LL; // 2021-01-01 00:00:00 UTC
    static const int64_t MACHINE_ID_BITS = 10;
    static const int64_t SEQUENCE_BITS = 12;
    static const int64_t MAX_SEQUENCE = (1 << SEQUENCE_BITS) - 1;

    int64_t machineId_;
    int64_t sequence_;
    int64_t lastTimestamp_;

public:
    SnowflakeIdGenerator(int64_t machineId = 0)
        : machineId_(machineId & ((1 << MACHINE_ID_BITS) - 1))
        , sequence_(0)
        , lastTimestamp_(-1) {}

    int64_t nextId() {
        int64_t timestamp = currentTimeMillis();

        // æ—¶é’Ÿå›æ‹¨æ£€æµ‹
        if (timestamp < lastTimestamp_) {
            throw std::runtime_error("Clock moved backwards");
        }

        // åŒä¸€æ¯«ç§’å†…ï¼Œåºåˆ—å·è‡ªå¢
        if (timestamp == lastTimestamp_) {
            sequence_ = (sequence_ + 1) & MAX_SEQUENCE;
            if (sequence_ == 0) {
                // åºåˆ—å·æº¢å‡ºï¼Œç­‰å¾…ä¸‹ä¸€æ¯«ç§’
                timestamp = waitNextMillis(lastTimestamp_);
            }
        } else {
            sequence_ = 0;
        }

        lastTimestamp_ = timestamp;

        // ç»„è£…ID
        return ((timestamp - EPOCH) << (MACHINE_ID_BITS + SEQUENCE_BITS))
             | (machineId_ << SEQUENCE_BITS)
             | sequence_;
    }

private:
    int64_t currentTimeMillis() {
        return std::chrono::duration_cast<std::chrono::milliseconds>(
            std::chrono::system_clock::now().time_since_epoch()
        ).count();
    }

    int64_t waitNextMillis(int64_t lastTimestamp) {
        int64_t timestamp = currentTimeMillis();
        while (timestamp <= lastTimestamp) {
            timestamp = currentTimeMillis();
        }
        return timestamp;
    }
};
```

#### Base62ç¼–ç 

**å­—ç¬¦é›†**: `0-9A-Za-z` (62ä¸ªå­—ç¬¦)

**ç¼–ç åŸç†**: å°†10è¿›åˆ¶æ•°å­—è½¬æ¢ä¸º62è¿›åˆ¶

**ä¸ºä»€ä¹ˆé€‰æ‹©Base62**:
- Base64åŒ…å«`+`ã€`/`ã€`=`ç­‰URLä¸å‹å¥½å­—ç¬¦
- Base62ä»…ä½¿ç”¨å­—æ¯å’Œæ•°å­—ï¼ŒURLå®‰å…¨
- ç›¸æ¯”Base36(0-9A-Z)ï¼ŒBase62æ›´çŸ­

**ç¼–ç ç®—æ³•**:
```cpp
class Base62Encoder {
private:
    static const char BASE62_CHARS[];
    static const int BASE = 62;

public:
    // ç¼–ç ï¼šint64 â†’ Base62å­—ç¬¦ä¸²
    static std::string encode(int64_t num, int minLength = 8) {
        if (num == 0) {
            return std::string(minLength, '0');
        }

        std::string result;
        while (num > 0) {
            result = BASE62_CHARS[num % BASE] + result;
            num /= BASE;
        }

        // å¡«å……åˆ°æœ€å°é•¿åº¦
        while (result.length() < minLength) {
            result = '0' + result;
        }

        return result;
    }

    // è§£ç ï¼šBase62å­—ç¬¦ä¸² â†’ int64
    static int64_t decode(const std::string& str) {
        int64_t result = 0;
        for (char c : str) {
            int value;
            if (c >= '0' && c <= '9') {
                value = c - '0';
            } else if (c >= 'A' && c <= 'Z') {
                value = c - 'A' + 10;
            } else if (c >= 'a' && c <= 'z') {
                value = c - 'a' + 36;
            } else {
                throw std::invalid_argument("Invalid Base62 character");
            }
            result = result * BASE + value;
        }
        return result;
    }
};

const char Base62Encoder::BASE62_CHARS[] =
    "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
```

**ç¤ºä¾‹**:
```cpp
// é›ªèŠ±ID: 1234567890123456789
// Base62ç¼–ç : "1LY7VK1WO8N" (11ä½)
// å¡«å……åˆ°8ä½: "1LY7VK1W" (æˆªå–å‰8ä½)

// å®é™…ä½¿ç”¨ï¼š
int64_t snowflakeId = SnowflakeIdGenerator().nextId();
std::string shortCode = Base62Encoder::encode(snowflakeId, 8);
// ç»“æœ: "ABC12345" (8ä½)
```

**çŸ­ç å®¹é‡**:
- 8ä½Base62: 62^8 = 218,340,105,584,896 â‰ˆ 218ä¸‡äº¿
- å³ä½¿æ¯ç§’ç”Ÿæˆ100ä¸‡ä¸ªçŸ­ç ï¼Œå¯ç”¨6,919å¹´

---

### æ¶æ„è®¾è®¡

éµå¾ªä¹å±‚æ¶æ„ï¼Œä»ä¸‹åˆ°ä¸Šä¾æ¬¡å®ç°ï¼š

#### ç¬¬8å±‚ï¼šæ•°æ®æ¨¡å‹å±‚

**src/models/share_link.h**

```cpp
#pragma once

#include <string>
#include <ctime>
#include <json/json.h>
#include <optional>

/**
 * @brief åˆ†äº«é“¾æ¥æ¨¡å‹ç±»
 */
class ShareLink {
public:
    /**
     * @brief ç›®æ ‡ç±»å‹æšä¸¾
     */
    enum class TargetType {
        POST,   // å¸–å­
        USER,   // ç”¨æˆ·ï¼ˆé¢„ç•™ï¼‰
        TAG     // æ ‡ç­¾ï¼ˆé¢„ç•™ï¼‰
    };

    // æ„é€ å‡½æ•°
    ShareLink() = default;

    // Getters
    int getId() const { return id_; }
    std::string getShortCode() const { return shortCode_; }
    TargetType getTargetType() const { return targetType_; }
    int64_t getTargetId() const { return targetId_; }
    std::optional<int64_t> getCreatorId() const { return creatorId_; }
    time_t getCreateTime() const { return createTime_; }
    std::optional<time_t> getExpireTime() const { return expireTime_; }

    // Setters
    void setId(int id) { id_ = id; }
    void setShortCode(const std::string& code) { shortCode_ = code; }
    void setTargetType(TargetType type) { targetType_ = type; }
    void setTargetId(int64_t id) { targetId_ = id; }
    void setCreatorId(int64_t id) { creatorId_ = id; }
    void setCreateTime(time_t time) { createTime_ = time; }
    void setExpireTime(time_t time) { expireTime_ = time; }

    // å·¥å…·æ–¹æ³•
    bool isExpired() const;
    std::string getFullUrl() const;
    static std::string targetTypeToString(TargetType type);
    static TargetType stringToTargetType(const std::string& str);

    // JSONåºåˆ—åŒ–
    Json::Value toJson() const;
    static ShareLink fromJson(const Json::Value& json);

private:
    int id_ = 0;
    std::string shortCode_;
    TargetType targetType_ = TargetType::POST;
    int64_t targetId_ = 0;
    std::optional<int64_t> creatorId_;
    time_t createTime_ = 0;
    std::optional<time_t> expireTime_;
};
```

#### ç¬¬7å±‚ï¼šåŸºç¡€è®¾æ–½å±‚

**src/utils/base62_encoder.h** (æ–°å¢)

```cpp
#pragma once

#include <string>
#include <stdexcept>

/**
 * @brief Base62ç¼–ç å·¥å…·ç±»
 */
class Base62Encoder {
public:
    /**
     * @brief å°†int64ç¼–ç ä¸ºBase62å­—ç¬¦ä¸²
     * @param num åŸå§‹æ•°å­—
     * @param minLength æœ€å°é•¿åº¦ï¼ˆä¸è¶³è¡¥0ï¼‰ï¼Œé»˜è®¤8ä½
     * @return Base62ç¼–ç å­—ç¬¦ä¸²
     */
    static std::string encode(int64_t num, int minLength = 8);

    /**
     * @brief å°†Base62å­—ç¬¦ä¸²è§£ç ä¸ºint64
     * @param str Base62å­—ç¬¦ä¸²
     * @return è§£ç åçš„æ•°å­—
     */
    static int64_t decode(const std::string& str);

private:
    static const char BASE62_CHARS[];
    static const int BASE = 62;
};
```

**src/utils/id_generator.h** (æ‰©å±•)

```cpp
class IdGenerator {
public:
    // ç°æœ‰æ–¹æ³•
    static std::string generateImageId();
    static std::string generateFileName(const std::string& extension);

    // æ–°å¢æ–¹æ³•
    /**
     * @brief ç”Ÿæˆåˆ†äº«é“¾æ¥çŸ­ç 
     * ä½¿ç”¨é›ªèŠ±ç®—æ³•ç”Ÿæˆå”¯ä¸€IDï¼Œç„¶åBase62ç¼–ç 
     * @return 8ä½çŸ­ç 
     */
    static std::string generateShareCode();

private:
    static std::string generateRandomString(int length);
    static std::string generateUUID();

    // æ–°å¢æ–¹æ³•
    /**
     * @brief ç”Ÿæˆé›ªèŠ±IDï¼ˆç®€åŒ–ç‰ˆå•æœºï¼‰
     * @return 64ä½å”¯ä¸€ID
     */
    static int64_t generateSnowflakeId();
};
```

#### ç¬¬5å±‚ï¼šæ•°æ®è®¿é—®å±‚

**src/database/share_link_repository.h**

```cpp
#pragma once

#include "../models/share_link.h"
#include "connection_pool.h"
#include <optional>
#include <vector>

/**
 * @brief åˆ†äº«é“¾æ¥æ•°æ®è®¿é—®å±‚
 */
class ShareLinkRepository {
public:
    /**
     * @brief åˆ›å»ºåˆ†äº«é“¾æ¥
     * @param shareLink åˆ†äº«é“¾æ¥å¯¹è±¡ï¼ˆä¼šæ›´æ–°idå­—æ®µï¼‰
     * @return æ“ä½œæ˜¯å¦æˆåŠŸ
     */
    bool create(ShareLink& shareLink);

    /**
     * @brief æ ¹æ®çŸ­ç æŸ¥è¯¢åˆ†äº«é“¾æ¥
     * @param shortCode çŸ­é“¾æ¥ç 
     * @return åˆ†äº«é“¾æ¥å¯¹è±¡ï¼ˆå¯é€‰ï¼‰
     */
    std::optional<ShareLink> findByShortCode(const std::string& shortCode);

    /**
     * @brief æ£€æŸ¥çŸ­ç æ˜¯å¦å­˜åœ¨
     * @param shortCode çŸ­é“¾æ¥ç 
     * @return æ˜¯å¦å­˜åœ¨
     */
    bool existsByShortCode(const std::string& shortCode);

    /**
     * @brief æ ¹æ®ç›®æ ‡æŸ¥è¯¢åˆ†äº«é“¾æ¥ï¼ˆç”¨äºå»é‡ï¼‰
     * @param targetType ç›®æ ‡ç±»å‹
     * @param targetId ç›®æ ‡ID
     * @return åˆ†äº«é“¾æ¥å¯¹è±¡ï¼ˆå¯é€‰ï¼‰
     */
    std::optional<ShareLink> findByTarget(
        ShareLink::TargetType targetType,
        int64_t targetId
    );

    /**
     * @brief åˆ é™¤è¿‡æœŸé“¾æ¥ï¼ˆå®šæ—¶ä»»åŠ¡ç”¨ï¼‰
     * @return åˆ é™¤çš„è®°å½•æ•°
     */
    int deleteExpired();
};
```

#### ç¬¬4å±‚ï¼šä¸šåŠ¡é€»è¾‘å±‚

**src/core/share_service.h**

```cpp
#pragma once

#include "../models/share_link.h"
#include "../database/share_link_repository.h"
#include "../database/post_repository.h"
#include <json/json.h>
#include <memory>

/**
 * @brief åˆ†äº«æœåŠ¡ä¸šåŠ¡é€»è¾‘å±‚
 */
class ShareService {
public:
    ShareService(
        ShareLinkRepository* shareLinkRepo,
        PostRepository* postRepo
    );

    /**
     * @brief åˆ›å»ºåˆ†äº«é“¾æ¥ç»“æœ
     */
    struct CreateShareLinkResult {
        bool success;
        std::string message;
        std::string short_code;      // çŸ­ç : ABC12345
        std::string short_link;      // å®Œæ•´URL: https://knot.app/s/ABC12345
    };

    /**
     * @brief åˆ›å»ºåˆ†äº«é“¾æ¥
     * @param postId å¸–å­ç‰©ç†ID
     * @param creatorId åˆ›å»ºè€…IDï¼ˆå¯é€‰ï¼Œ0è¡¨ç¤ºæœªç™»å½•ï¼‰
     * @return åˆ›å»ºç»“æœ
     */
    CreateShareLinkResult createShareLink(
        int64_t postId,
        int64_t creatorId = 0
    );

    /**
     * @brief è§£æåˆ†äº«é“¾æ¥ç»“æœ
     */
    struct ResolveShareLinkResult {
        bool success;
        std::string message;
        Json::Value post_data;      // å¸–å­å®Œæ•´ä¿¡æ¯
        Json::Value deep_links;     // Deep Link URLs
    };

    /**
     * @brief è§£æåˆ†äº«é“¾æ¥
     * @param shortCode çŸ­é“¾æ¥ç 
     * @return è§£æç»“æœ
     */
    ResolveShareLinkResult resolveShareLink(
        const std::string& shortCode
    );

private:
    ShareLinkRepository* shareLinkRepo_;
    PostRepository* postRepo_;

    /**
     * @brief ç”ŸæˆDeep Link URLs
     * @param postId å¸–å­ç‰©ç†ID
     * @return Deep Link JSONå¯¹è±¡
     */
    Json::Value generateDeepLinks(int64_t postId);
};
```

#### ç¬¬3å±‚ï¼šAPIæ¥å£å±‚

**src/api/share_handler.h**

```cpp
#pragma once

#include "../core/share_service.h"
#include "../third_party/httplib.h"
#include <memory>

/**
 * @brief åˆ†äº«APIå¤„ç†å™¨
 */
class ShareHandler {
public:
    ShareHandler(ShareService* shareService);

    /**
     * @brief æ³¨å†Œåˆ†äº«ç›¸å…³è·¯ç”±
     */
    void registerRoutes(httplib::Server& server);

private:
    /**
     * @brief POST /api/v1/posts/:post_id/share
     * åˆ›å»ºå¸–å­åˆ†äº«é“¾æ¥ï¼ˆéœ€è¦è®¤è¯ï¼‰
     */
    void handleCreatePostShare(
        const httplib::Request& req,
        httplib::Response& res
    );

    /**
     * @brief GET /api/v1/share/:code
     * è§£æåˆ†äº«é“¾æ¥ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€è®¤è¯ï¼‰
     */
    void handleResolveShare(
        const httplib::Request& req,
        httplib::Response& res
    );

    ShareService* shareService_;
};
```

---

### APIè®¾è®¡

#### API 1: åˆ›å»ºåˆ†äº«é“¾æ¥

**ç«¯ç‚¹**: `POST /api/v1/posts/:post_id/share`

**è®¤è¯**: éœ€è¦JWT Token

**è¯·æ±‚å¤´**:
```
Authorization: Bearer <access_token>
Content-Type: application/json
```

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| post_id | string | æ˜¯ | å¸–å­ä¸šåŠ¡IDï¼ˆå¦‚POST_2025Q4_ABC123ï¼‰ |

**è¯·æ±‚ä½“**: æ— 

**å“åº”å‚æ•°**:

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| success | boolean | æ˜¯å¦æˆåŠŸ |
| message | string | è¿”å›æ¶ˆæ¯ |
| data | object | åˆ†äº«é“¾æ¥æ•°æ® |
| data.short_code | string | çŸ­é“¾æ¥ç ï¼ˆ8ä½ï¼‰ |
| data.short_link | string | å®Œæ•´çŸ­é“¾æ¥URL |
| data.expire_time | string/null | è¿‡æœŸæ—¶é—´ï¼ˆnullè¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆï¼‰ |
| timestamp | integer | å“åº”æ—¶é—´æˆ³ |

**æˆåŠŸå“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "åˆ†äº«é“¾æ¥åˆ›å»ºæˆåŠŸ",
  "data": {
    "short_code": "ABC12345",
    "short_link": "https://knot.app/s/ABC12345",
    "expire_time": null
  },
  "timestamp": 1760020100
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹**:
```json
{
  "success": false,
  "message": "å¸–å­ä¸å­˜åœ¨",
  "data": null,
  "timestamp": 1760020100
}
```

**é”™è¯¯ç è¯´æ˜**:

| HTTPçŠ¶æ€ç  | message | è¯´æ˜ |
|-----------|---------|------|
| 200 | åˆ†äº«é“¾æ¥åˆ›å»ºæˆåŠŸ | åˆ›å»ºæˆåŠŸ |
| 200 | åˆ†äº«é“¾æ¥å·²å­˜åœ¨ | è¯¥å¸–å­å·²æœ‰åˆ†äº«é“¾æ¥ï¼Œè¿”å›ç°æœ‰é“¾æ¥ |
| 401 | æœªæä¾›è®¤è¯ä»¤ç‰Œ | ç¼ºå°‘Authorizationå¤´ |
| 401 | ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ | TokenéªŒè¯å¤±è´¥ |
| 404 | å¸–å­ä¸å­˜åœ¨ | post_idå¯¹åº”çš„å¸–å­ä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ•°æ®åº“é”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ |

**ä¸šåŠ¡é€»è¾‘**:
1. éªŒè¯JWT Tokenï¼Œè·å–ç”¨æˆ·ID
2. éªŒè¯å¸–å­æ˜¯å¦å­˜åœ¨ï¼ˆé€šè¿‡post_idæŸ¥è¯¢postsè¡¨ï¼‰
3. æ£€æŸ¥è¯¥å¸–å­æ˜¯å¦å·²æœ‰åˆ†äº«é“¾æ¥ï¼ˆå»é‡é€»è¾‘ï¼‰
   - å¦‚æœå·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›ç°æœ‰é“¾æ¥
   - å¦‚æœä¸å­˜åœ¨ï¼Œç”Ÿæˆæ–°é“¾æ¥
4. ç”Ÿæˆ8ä½çŸ­ç ï¼ˆé›ªèŠ±ID + Base62ç¼–ç ï¼‰
5. ä¿å­˜åˆ°share_linksè¡¨
6. è¿”å›çŸ­ç å’Œå®Œæ•´URL

**ç¤ºä¾‹ä»£ç **:
```cpp
void ShareHandler::handleCreatePostShare(
    const httplib::Request& req,
    httplib::Response& res
) {
    // 1. éªŒè¯JWT Token
    std::string authHeader = req.get_header_value("Authorization");
    if (authHeader.empty() || authHeader.substr(0, 7) != "Bearer ") {
        res.status = 401;
        res.set_content(R"({"success":false,"message":"æœªæä¾›è®¤è¯ä»¤ç‰Œ"})", "application/json");
        return;
    }

    std::string token = authHeader.substr(7);
    auto jwtManager = std::make_unique<JWTManager>();
    auto validation = jwtManager->validateAccessToken(token);

    if (!validation.valid) {
        res.status = 401;
        res.set_content(R"({"success":false,"message":"ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ"})", "application/json");
        return;
    }

    int64_t userId = validation.userId;

    // 2. è·å–post_idå‚æ•°
    std::string postIdStr = req.path_params.at("post_id");

    // 3. è°ƒç”¨Serviceå±‚åˆ›å»ºåˆ†äº«é“¾æ¥
    auto result = shareService_->createShareLink(postIdStr, userId);

    // 4. æ„é€ å“åº”
    Json::Value response;
    response["success"] = result.success;
    response["message"] = result.message;
    response["timestamp"] = static_cast<int>(std::time(nullptr));

    if (result.success) {
        Json::Value data;
        data["short_code"] = result.short_code;
        data["short_link"] = result.short_link;
        data["expire_time"] = Json::Value::null;
        response["data"] = data;
    } else {
        response["data"] = Json::Value::null;
    }

    res.status = result.success ? 200 : 404;
    res.set_content(response.toStyledString(), "application/json");
}
```

---

#### API 2: è§£æåˆ†äº«é“¾æ¥

**ç«¯ç‚¹**: `GET /api/v1/share/:code`

**è®¤è¯**: æ— éœ€è®¤è¯ï¼ˆå…¬å¼€æ¥å£ï¼‰

**è·¯å¾„å‚æ•°**:

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| code | string | æ˜¯ | çŸ­é“¾æ¥ç ï¼ˆ8ä½ï¼Œå¦‚ABC12345ï¼‰ |

**å“åº”å‚æ•°**:

| å‚æ•°å | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| success | boolean | æ˜¯å¦æˆåŠŸ |
| message | string | è¿”å›æ¶ˆæ¯ |
| data | object | è§£æç»“æœæ•°æ® |
| data.target_type | string | ç›®æ ‡ç±»å‹ï¼ˆPOST/USER/TAGï¼‰ |
| data.target_id | integer | ç›®æ ‡ç‰©ç†ID |
| data.post | object | å¸–å­å®Œæ•´ä¿¡æ¯ï¼ˆå½“target_type=POSTæ—¶ï¼‰ |
| data.deep_link | object | Deep Link URLs |
| data.deep_link.ios | string | iOS Deep Link |
| data.deep_link.android | string | Android Deep Link |
| data.deep_link.harmonyos | string | HarmonyOS Deep Link |
| data.deep_link.universal_link | string | Universal Linkï¼ˆhttpsï¼‰ |
| timestamp | integer | å“åº”æ—¶é—´æˆ³ |

**æˆåŠŸå“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "target_type": "POST",
    "target_id": 12345,
    "post": {
      "post_id": "POST_2025Q4_ABC123",
      "title": "ç¾å¥½çš„ä¸€å¤©",
      "description": "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæ‹äº†å‡ å¼ ç…§ç‰‡åˆ†äº«ç»™å¤§å®¶",
      "image_count": 3,
      "like_count": 42,
      "favorite_count": 15,
      "view_count": 100,
      "status": "APPROVED",
      "create_time": "2025-10-08 10:30:00",
      "images": [
        {
          "image_id": "IMG_2025Q4_XYZ001",
          "display_order": 1,
          "file_url": "/uploads/images/abc123.jpg",
          "thumbnail_url": "/uploads/thumbnails/abc123_thumb.jpg",
          "width": 1920,
          "height": 1080
        },
        {
          "image_id": "IMG_2025Q4_XYZ002",
          "display_order": 2,
          "file_url": "/uploads/images/def456.jpg",
          "thumbnail_url": "/uploads/thumbnails/def456_thumb.jpg",
          "width": 1920,
          "height": 1080
        },
        {
          "image_id": "IMG_2025Q4_XYZ003",
          "display_order": 3,
          "file_url": "/uploads/images/ghi789.jpg",
          "thumbnail_url": "/uploads/thumbnails/ghi789_thumb.jpg",
          "width": 1920,
          "height": 1080
        }
      ],
      "user": {
        "user_id": "USR_2025Q4_USER01",
        "username": "john_doe",
        "real_name": "å¼ ä¸‰",
        "avatar_url": "/uploads/avatars/john.jpg"
      }
    },
    "deep_link": {
      "ios": "knot://post/12345",
      "android": "knot://post/12345",
      "harmonyos": "knot://post/12345",
      "universal_link": "https://knot.app/post/12345"
    }
  },
  "timestamp": 1760020100
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹**:
```json
{
  "success": false,
  "message": "åˆ†äº«é“¾æ¥ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ",
  "data": null,
  "timestamp": 1760020100
}
```

**é”™è¯¯ç è¯´æ˜**:

| HTTPçŠ¶æ€ç  | message | è¯´æ˜ |
|-----------|---------|------|
| 200 | æŸ¥è¯¢æˆåŠŸ | æˆåŠŸè§£æåˆ†äº«é“¾æ¥ |
| 404 | åˆ†äº«é“¾æ¥ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ | çŸ­ç ä¸å­˜åœ¨æˆ–é“¾æ¥å·²è¿‡æœŸ |
| 404 | ç›®æ ‡å¸–å­ä¸å­˜åœ¨ | å…³è”çš„å¸–å­å·²è¢«åˆ é™¤ |
| 500 | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ | æ•°æ®åº“é”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸ |

**ä¸šåŠ¡é€»è¾‘**:
1. æ ¹æ®çŸ­ç æŸ¥è¯¢share_linksè¡¨
2. æ£€æŸ¥é“¾æ¥æ˜¯å¦è¿‡æœŸï¼ˆexpire_timeï¼‰
3. æ ¹æ®target_typeå’Œtarget_idè”è¡¨æŸ¥è¯¢ç›®æ ‡å¯¹è±¡
   - å¦‚æœtarget_type=POSTï¼Œè”è¡¨æŸ¥è¯¢postsã€imagesã€usersè¡¨
4. ç”Ÿæˆä¸‰ç«¯Deep Link URL
5. è¿”å›å®Œæ•´æ•°æ®

**SQLæŸ¥è¯¢ä¼˜åŒ–**:
```sql
-- è”è¡¨æŸ¥è¯¢å¸–å­å®Œæ•´ä¿¡æ¯
SELECT
    p.*,
    u.user_id, u.username, u.real_name, u.avatar_url,
    GROUP_CONCAT(
        CONCAT_WS('|', i.image_id, i.display_order, i.file_url, i.thumbnail_url, i.width, i.height)
        ORDER BY i.display_order
        SEPARATOR ';;'
    ) AS images_data
FROM share_links sl
INNER JOIN posts p ON sl.target_id = p.id
INNER JOIN users u ON p.user_id = u.id
LEFT JOIN images i ON p.id = i.post_id
WHERE sl.short_code = ?
  AND (sl.expire_time IS NULL OR sl.expire_time > NOW())
GROUP BY p.id;
```

---

## Deep Linké…ç½®

### æ¦‚è¿°

Deep Linkï¼ˆæ·±åº¦é“¾æ¥ï¼‰æ˜¯ä¸€ç§å…è®¸åº”ç”¨ç¨‹åºé€šè¿‡URLç›´æ¥æ‰“å¼€ç‰¹å®šé¡µé¢çš„æŠ€æœ¯ã€‚å¯¹äºKnotå›¾ç‰‡åˆ†äº«åº”ç”¨ï¼ŒDeep Linkæœ‰ä¸¤ä¸ªæ ¸å¿ƒä½œç”¨ï¼š

1. **åº”ç”¨å”¤èµ·**: ç”¨æˆ·ç‚¹å‡»åˆ†äº«é“¾æ¥æ—¶ï¼Œè‡ªåŠ¨æ‰“å¼€Knotåº”ç”¨å¹¶è·³è½¬åˆ°å¯¹åº”å¸–å­
2. **ç”¨æˆ·ä½“éªŒ**: é¿å…ç”¨æˆ·æ‰‹åŠ¨æœç´¢å†…å®¹ï¼Œæä¾›æ— ç¼çš„åˆ†äº«-æŸ¥çœ‹ä½“éªŒ

**ä¸‰ç«¯å®ç°æ–¹æ¡ˆ**:
- **iOS**: Universal Linksï¼ˆiOS 9+ï¼‰
- **Android**: App Linksï¼ˆAndroid 6+ï¼‰
- **HarmonyOS**: Deep Linking / App Linkingï¼ˆHarmonyOS 5.0+ï¼‰

---

### iOS Universal Linksé…ç½®

#### ä»€ä¹ˆæ˜¯Universal Links

Universal Linksæ˜¯è‹¹æœä»iOS 9å¼€å§‹æ¨å‡ºçš„æ·±åº¦é“¾æ¥æŠ€æœ¯ï¼Œä½¿ç”¨HTTPSé“¾æ¥ä»£æ›¿è‡ªå®šä¹‰URL Schemeã€‚

**ä¼˜åŠ¿**:
- âœ… æ— éœ€ç”¨æˆ·ç¡®è®¤ï¼Œç›´æ¥å”¤èµ·APP
- âœ… å¦‚æœæœªå®‰è£…APPï¼Œåœ¨Safariä¸­æ‰“å¼€ç½‘é¡µ
- âœ… æ”¯æŒè·¨åŸŸåå…±äº«
- âœ… å®‰å…¨æ€§é«˜ï¼ˆéœ€è¦åŸŸåéªŒè¯ï¼‰

**åŸç†**:
```
ç”¨æˆ·ç‚¹å‡»é“¾æ¥ https://knot.app/s/ABC12345
    â†“
iOSç³»ç»Ÿæ£€æŸ¥æ˜¯å¦å®‰è£…Knotåº”ç”¨
    â†“
å·²å®‰è£… â†’ ç›´æ¥å”¤èµ·åº”ç”¨ï¼Œä¼ é€’URLå‚æ•°
æœªå®‰è£… â†’ åœ¨Safariä¸­æ‰“å¼€H5é¡µé¢
```

#### æœåŠ¡å™¨ç«¯é…ç½®

**æ­¥éª¤1: åˆ›å»ºapple-app-site-associationæ–‡ä»¶**

åœ¨æœåŠ¡å™¨åˆ›å»ºæ–‡ä»¶: `https://knot.app/.well-known/apple-app-site-association`

**æ³¨æ„**:
- æ–‡ä»¶åæ— æ‰©å±•å
- å¿…é¡»é€šè¿‡HTTPSè®¿é—®
- Content-Typeå¿…é¡»æ˜¯`application/json`

```json
{
  "applinks": {
    "apps": [],
    "details": [
      {
        "appID": "TEAMID.com.knot.app",
        "paths": [
          "/s/*",
          "/post/*"
        ]
      }
    ]
  }
}
```

**å­—æ®µè¯´æ˜**:
- `appID`: æ ¼å¼ä¸º`TEAMID.BUNDLEID`
  - `TEAMID`: åœ¨Apple Developerç½‘ç«™æŸ¥çœ‹ï¼ˆå¦‚: A1B2C3D4E5ï¼‰
  - `BUNDLEID`: åº”ç”¨çš„Bundle Identifierï¼ˆå¦‚: com.knot.appï¼‰
- `paths`: æ”¯æŒçš„URLè·¯å¾„æ¨¡å¼
  - `/s/*`: åŒ¹é…æ‰€æœ‰çŸ­é“¾æ¥ï¼ˆå¦‚ https://knot.app/s/ABC12345ï¼‰
  - `/post/*`: åŒ¹é…æ‰€æœ‰å¸–å­è¯¦æƒ…ï¼ˆå¦‚ https://knot.app/post/12345ï¼‰
  - `*`æ˜¯é€šé…ç¬¦ï¼ŒåŒ¹é…ä»»æ„å­—ç¬¦

**æ­¥éª¤2: é…ç½®Nginx**

```nginx
server {
    listen 443 ssl http2;
    server_name knot.app;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # Universal Linksé…ç½®
    location /.well-known/apple-app-site-association {
        alias /usr/share/nginx/html/.well-known/apple-app-site-association;
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
        add_header Content-Type "application/json; charset=utf-8";
    }

    # å…¶ä»–é…ç½®...
}
```

**æ­¥éª¤3: éªŒè¯é…ç½®**

åœ¨æµè§ˆå™¨è®¿é—®: `https://knot.app/.well-known/apple-app-site-association`

åº”è¯¥çœ‹åˆ°JSONå†…å®¹ï¼Œä¸”Content-Typeä¸º`application/json`ã€‚

#### iOSåº”ç”¨ç«¯é…ç½®

**æ­¥éª¤1: æ·»åŠ Associated Domainsæƒé™**

åœ¨Xcodeä¸­:
1. é€‰æ‹©é¡¹ç›®Target
2. ç‚¹å‡»"Signing & Capabilities"
3. ç‚¹å‡»"+ Capability"
4. æ·»åŠ "Associated Domains"
5. æ·»åŠ åŸŸå: `applinks:knot.app`

æˆ–ç›´æ¥ç¼–è¾‘`é¡¹ç›®å.entitlements`æ–‡ä»¶:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>com.apple.developer.associated-domains</key>
    <array>
        <string>applinks:knot.app</string>
    </array>
</dict>
</plist>
```

**æ­¥éª¤2: åœ¨AppDelegateä¸­å¤„ç†Universal Links**

```swift
import UIKit

@main
class AppDelegate: UIResponder, UIApplicationDelegate {

    func application(_ application: UIApplication,
                     continue userActivity: NSUserActivity,
                     restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {

        // æ£€æŸ¥æ˜¯å¦æ˜¯Universal Link
        guard userActivity.activityType == NSUserActivityTypeBrowsingWeb,
              let url = userActivity.webpageURL else {
            return false
        }

        // å¤„ç†URL
        return handleUniversalLink(url: url)
    }

    private func handleUniversalLink(url: URL) -> Bool {
        print("Received Universal Link: \(url.absoluteString)")

        // è§£æURLè·¯å¾„
        let path = url.path

        if path.hasPrefix("/s/") {
            // çŸ­é“¾æ¥: /s/ABC12345
            let shortCode = String(path.dropFirst(3)) // å»æ‰"/s/"
            handleShortLink(shortCode: shortCode)
            return true

        } else if path.hasPrefix("/post/") {
            // å¸–å­è¯¦æƒ…: /post/12345
            let postId = String(path.dropFirst(6)) // å»æ‰"/post/"
            handlePostDetail(postId: postId)
            return true
        }

        return false
    }

    private func handleShortLink(shortCode: String) {
        // 1. è°ƒç”¨åç«¯APIè§£æçŸ­ç 
        // GET /api/v1/share/:code

        // 2. è·å–å¸–å­ID

        // 3. è·³è½¬åˆ°å¸–å­è¯¦æƒ…é¡µ
        // navigationController.pushViewController(PostDetailViewController(postId: postId), animated: true)
    }

    private func handlePostDetail(postId: String) {
        // ç›´æ¥è·³è½¬åˆ°å¸–å­è¯¦æƒ…é¡µ
        // navigationController.pushViewController(PostDetailViewController(postId: postId), animated: true)
    }
}
```

**æ­¥éª¤3: æµ‹è¯•Universal Links**

åœ¨çœŸæœºä¸Šæµ‹è¯•ï¼ˆæ¨¡æ‹Ÿå™¨ä¸æ”¯æŒï¼‰:

1. é€šè¿‡å¤‡å¿˜å½•ã€ä¿¡æ¯ç­‰åº”ç”¨å‘é€é“¾æ¥: `https://knot.app/s/ABC12345`
2. é•¿æŒ‰é“¾æ¥ï¼Œåº”è¯¥çœ‹åˆ°"åœ¨'Knot'ä¸­æ‰“å¼€"é€‰é¡¹
3. ç‚¹å‡»é“¾æ¥ï¼Œåº”è¯¥ç›´æ¥å”¤èµ·Knotåº”ç”¨

**è°ƒè¯•æŠ€å·§**:
- å¦‚æœæ²¡æœ‰å”¤èµ·åº”ç”¨ï¼Œæ£€æŸ¥åŸŸåæ˜¯å¦æ­£ç¡®é…ç½®
- ä½¿ç”¨`swcd`å‘½ä»¤è¡Œå·¥å…·éªŒè¯: `swcutil getApps -domain knot.app`
- æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—: `Console.app` â†’ æœç´¢"swcd"

---

### Android App Linksé…ç½®

#### ä»€ä¹ˆæ˜¯App Links

App Linksæ˜¯Googleä»Android 6.0ï¼ˆAPI 23ï¼‰å¼€å§‹æ¨å‡ºçš„æ·±åº¦é“¾æ¥æŠ€æœ¯ï¼Œç±»ä¼¼iOSçš„Universal Linksã€‚

**ä¼˜åŠ¿**:
- âœ… è‡ªåŠ¨éªŒè¯ï¼Œæ— éœ€ç”¨æˆ·é€‰æ‹©
- âœ… ä½¿ç”¨HTTPSé“¾æ¥ï¼Œå®‰å…¨å¯é 
- âœ… å¦‚æœæœªå®‰è£…APPï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
- âœ… æ”¯æŒIntentè¿‡æ»¤

**åŸç†**:
```
ç”¨æˆ·ç‚¹å‡»é“¾æ¥ https://knot.app/s/ABC12345
    â†“
Androidç³»ç»Ÿæ£€æŸ¥æ˜¯å¦æœ‰åº”ç”¨å£°æ˜è¯¥åŸŸå
    â†“
æ‰¾åˆ°Knotåº”ç”¨ â†’ ç›´æ¥å”¤èµ·åº”ç”¨
æœªæ‰¾åˆ° â†’ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€
```

#### æœåŠ¡å™¨ç«¯é…ç½®

**æ­¥éª¤1: åˆ›å»ºassetlinks.jsonæ–‡ä»¶**

åœ¨æœåŠ¡å™¨åˆ›å»ºæ–‡ä»¶: `https://knot.app/.well-known/assetlinks.json`

```json
[
  {
    "relation": ["delegate_permission/common.handle_all_urls"],
    "target": {
      "namespace": "android_app",
      "package_name": "com.knot.app",
      "sha256_cert_fingerprints": [
        "AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99"
      ]
    }
  }
]
```

**å­—æ®µè¯´æ˜**:
- `package_name`: åº”ç”¨åŒ…åï¼ˆå¦‚: com.knot.appï¼‰
- `sha256_cert_fingerprints`: åº”ç”¨ç­¾åè¯ä¹¦çš„SHA256æŒ‡çº¹

**è·å–SHA256æŒ‡çº¹**:

```bash
# Debugç‰ˆæœ¬ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
keytool -list -v -keystore ~/.android/debug.keystore -alias androiddebugkey -storepass android -keypass android

# Releaseç‰ˆæœ¬ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
keytool -list -v -keystore /path/to/release.keystore -alias your_alias

# è¾“å‡ºç¤ºä¾‹ï¼š
# SHA256: AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99
```

**æ­¥éª¤2: é…ç½®Nginx**

```nginx
server {
    listen 443 ssl http2;
    server_name knot.app;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # App Linksé…ç½®
    location /.well-known/assetlinks.json {
        alias /usr/share/nginx/html/.well-known/assetlinks.json;
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
        add_header Content-Type "application/json; charset=utf-8";
    }

    # å…¶ä»–é…ç½®...
}
```

**æ­¥éª¤3: éªŒè¯é…ç½®**

åœ¨æµè§ˆå™¨è®¿é—®: `https://knot.app/.well-known/assetlinks.json`

åº”è¯¥çœ‹åˆ°JSONæ•°ç»„å†…å®¹ã€‚

#### Androidåº”ç”¨ç«¯é…ç½®

**æ­¥éª¤1: åœ¨AndroidManifest.xmlä¸­é…ç½®Intent Filter**

```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.knot.app">

    <application>
        <activity
            android:name=".MainActivity"
            android:exported="true">

            <!-- å¯åŠ¨å™¨Intentï¼ˆä¿ç•™åŸæœ‰ï¼‰ -->
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />
                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>

            <!-- App Links Intent Filter -->
            <intent-filter android:autoVerify="true">
                <action android:name="android.intent.action.VIEW" />
                <category android:name="android.intent.category.DEFAULT" />
                <category android:name="android.intent.category.BROWSABLE" />

                <!-- åŒ¹é… https://knot.app/s/* -->
                <data
                    android:scheme="https"
                    android:host="knot.app"
                    android:pathPrefix="/s/" />

                <!-- åŒ¹é… https://knot.app/post/* -->
                <data
                    android:scheme="https"
                    android:host="knot.app"
                    android:pathPrefix="/post/" />
            </intent-filter>

        </activity>
    </application>
</manifest>
```

**å…³é”®å±æ€§è¯´æ˜**:
- `android:autoVerify="true"`: å¯ç”¨è‡ªåŠ¨éªŒè¯ï¼Œç³»ç»Ÿä¼šæ£€æŸ¥assetlinks.json
- `android:scheme="https"`: å¿…é¡»ä½¿ç”¨httpsï¼ˆhttpä¸æ”¯æŒApp Linksï¼‰
- `android:host="knot.app"`: åŸŸå
- `android:pathPrefix="/s/"`: è·¯å¾„å‰ç¼€

**æ­¥éª¤2: åœ¨Activityä¸­å¤„ç†App Links**

```kotlin
import android.content.Intent
import android.net.Uri
import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity

class MainActivity : AppCompatActivity() {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)

        // å¤„ç†Intent
        handleIntent(intent)
    }

    override fun onNewIntent(intent: Intent?) {
        super.onNewIntent(intent)
        intent?.let { handleIntent(it) }
    }

    private fun handleIntent(intent: Intent) {
        val action = intent.action
        val data: Uri? = intent.data

        if (action == Intent.ACTION_VIEW && data != null) {
            // å¤„ç†App Link
            handleAppLink(data)
        }
    }

    private fun handleAppLink(uri: Uri) {
        Log.d("AppLink", "Received: ${uri.toString()}")

        val path = uri.path ?: return

        when {
            path.startsWith("/s/") -> {
                // çŸ­é“¾æ¥: /s/ABC12345
                val shortCode = path.removePrefix("/s/")
                handleShortLink(shortCode)
            }
            path.startsWith("/post/") -> {
                // å¸–å­è¯¦æƒ…: /post/12345
                val postId = path.removePrefix("/post/")
                handlePostDetail(postId)
            }
        }
    }

    private fun handleShortLink(shortCode: String) {
        // 1. è°ƒç”¨åç«¯APIè§£æçŸ­ç 
        // GET /api/v1/share/:code

        // 2. è·å–å¸–å­ID

        // 3. è·³è½¬åˆ°å¸–å­è¯¦æƒ…é¡µ
        // val intent = Intent(this, PostDetailActivity::class.java)
        // intent.putExtra("postId", postId)
        // startActivity(intent)
    }

    private fun handlePostDetail(postId: String) {
        // ç›´æ¥è·³è½¬åˆ°å¸–å­è¯¦æƒ…é¡µ
        // val intent = Intent(this, PostDetailActivity::class.java)
        // intent.putExtra("postId", postId)
        // startActivity(intent)
    }
}
```

**æ­¥éª¤3: æµ‹è¯•App Links**

1. **é€šè¿‡adbå‘½ä»¤æµ‹è¯•**:
```bash
# æµ‹è¯•çŸ­é“¾æ¥
adb shell am start -a android.intent.action.VIEW -d "https://knot.app/s/ABC12345"

# æµ‹è¯•å¸–å­è¯¦æƒ…
adb shell am start -a android.intent.action.VIEW -d "https://knot.app/post/12345"
```

2. **çœŸæœºæµ‹è¯•**:
- é€šè¿‡çŸ­ä¿¡ã€é‚®ä»¶ç­‰å‘é€é“¾æ¥
- ç‚¹å‡»é“¾æ¥ï¼Œåº”è¯¥ç›´æ¥å”¤èµ·Knotåº”ç”¨

3. **éªŒè¯åŸŸåéªŒè¯çŠ¶æ€**:
```bash
# æŸ¥çœ‹App LinkséªŒè¯çŠ¶æ€
adb shell pm get-app-links com.knot.app

# è¾“å‡ºç¤ºä¾‹ï¼š
# com.knot.app:
#   ID: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
#   Signatures: [AA:BB:CC:...]
#   Domain verification state:
#     knot.app: verified
```

**è°ƒè¯•æŠ€å·§**:
- å¦‚æœéªŒè¯å¤±è´¥ï¼Œæ£€æŸ¥SHA256æŒ‡çº¹æ˜¯å¦æ­£ç¡®
- ç¡®ä¿assetlinks.jsonå¯ä»¥é€šè¿‡HTTPSè®¿é—®
- æŸ¥çœ‹Logcatæ—¥å¿—: `adb logcat | grep -i "IntentFilter"`

---

### HarmonyOS Deep Linkingé…ç½®

#### ä»€ä¹ˆæ˜¯HarmonyOS Deep Linking

HarmonyOSæ”¯æŒä¸¤ç§æ·±åº¦é“¾æ¥æ–¹æ¡ˆï¼š
1. **Deep Linkingï¼ˆè‡ªå®šä¹‰Schemeï¼‰**: ä½¿ç”¨è‡ªå®šä¹‰åè®®ï¼ˆå¦‚`knot://`ï¼‰ï¼Œæ— éœ€åŸŸåéªŒè¯
2. **App Linkingï¼ˆåŸŸåéªŒè¯ï¼‰**: ä½¿ç”¨HTTPSé“¾æ¥ï¼Œéœ€è¦åŸŸåéªŒè¯ï¼ˆç±»ä¼¼iOS Universal Linksï¼‰

æœ¬èŠ‚å…ˆä»‹ç»**æ–¹æ¡ˆä¸€ï¼šDeep Linkingï¼ˆè‡ªå®šä¹‰Schemeï¼‰**ï¼Œè¿™æ˜¯æœ€ç®€å•ã€æœ€å¿«é€Ÿçš„å®ç°æ–¹å¼ã€‚

**ä¼˜åŠ¿**:
- âœ… å®ç°ç®€å•ï¼Œæ— éœ€æœåŠ¡å™¨é…ç½®
- âœ… é€‚åˆMVPå¿«é€ŸéªŒè¯
- âœ… æ”¯æŒè‡ªå®šä¹‰åè®®ï¼ˆknot://ï¼‰

**åŠ£åŠ¿**:
- âš ï¸ éœ€è¦ç”¨æˆ·ç¡®è®¤æ‰“å¼€åº”ç”¨
- âš ï¸ å¦‚æœæœªå®‰è£…åº”ç”¨ï¼Œä¼šæ˜¾ç¤ºé”™è¯¯æç¤º
- âš ï¸ å®‰å…¨æ€§è¾ƒä½ï¼ˆæ— åŸŸåéªŒè¯ï¼‰

**åŸç†**:
```
ç”¨æˆ·ç‚¹å‡»é“¾æ¥ knot://post/12345
    â†“
HarmonyOSç³»ç»Ÿæ£€æŸ¥æ˜¯å¦æœ‰åº”ç”¨æ³¨å†Œè¯¥Scheme
    â†“
æ‰¾åˆ°Knotåº”ç”¨ â†’ å¼¹å‡ºç¡®è®¤æ¡† â†’ å”¤èµ·åº”ç”¨
æœªæ‰¾åˆ° â†’ æ˜¾ç¤º"æ— æ³•æ‰“å¼€é“¾æ¥"é”™è¯¯
```

#### HarmonyOSåº”ç”¨ç«¯é…ç½®ï¼ˆæ–¹æ¡ˆä¸€ï¼‰

**æ­¥éª¤1: åœ¨module.json5ä¸­é…ç½®Scheme**

æ‰“å¼€é¡¹ç›®çš„`entry/src/main/module.json5`æ–‡ä»¶ï¼Œæ·»åŠ skillsé…ç½®:

```json5
{
  "module": {
    "name": "entry",
    "type": "entry",
    "description": "Knotå›¾ç‰‡åˆ†äº«åº”ç”¨",
    "mainElement": "EntryAbility",
    "deviceTypes": [
      "phone",
      "tablet"
    ],
    "abilities": [
      {
        "name": "EntryAbility",
        "srcEntry": "./ets/entryability/EntryAbility.ets",
        "description": "åº”ç”¨ä¸»å…¥å£",
        "icon": "$media:icon",
        "label": "$string:EntryAbility_label",
        "startWindowIcon": "$media:icon",
        "startWindowBackground": "$color:start_window_background",
        "exported": true,
        "skills": [
          {
            "entities": [
              "entity.system.home"
            ],
            "actions": [
              "action.system.home"
            ]
          },
          {
            // Deep Linké…ç½®
            "entities": [
              "entity.system.browsable"  // å…è®¸ä»æµè§ˆå™¨ç­‰å…¶ä»–åº”ç”¨å”¤èµ·
            ],
            "actions": [
              "ohos.want.action.viewData"
            ],
            "uris": [
              {
                "scheme": "knot",  // è‡ªå®šä¹‰Scheme
                "host": "post",    // å¸–å­è¯¦æƒ…é¡µ
                "pathStartWith": "/"  // è·¯å¾„ä»¥/å¼€å¤´
              },
              {
                "scheme": "knot",
                "host": "share",   // åˆ†äº«è§£æé¡µ
                "pathStartWith": "/"
              }
            ]
          }
        ]
      }
    ]
  }
}
```

**é…ç½®è¯´æ˜**:
- `scheme: "knot"`: è‡ªå®šä¹‰åè®®ï¼Œå¯ä»¥æ”¹ä¸ºä½ çš„åº”ç”¨å
- `host: "post"`: ç”¨äºåŒ¹é…`knot://post/12345`
- `host: "share"`: ç”¨äºåŒ¹é…`knot://share/ABC12345`ï¼ˆå¯é€‰ï¼‰
- `pathStartWith: "/"`: è·¯å¾„åŒ¹é…è§„åˆ™

**æ”¯æŒçš„URLæ ¼å¼**:
- `knot://post/12345` - ç›´æ¥è·³è½¬å¸–å­è¯¦æƒ…
- `knot://post?id=12345` - å¸¦queryå‚æ•°çš„æ–¹å¼
- `knot://share/ABC12345` - çŸ­é“¾æ¥è§£æï¼ˆå¯é€‰ï¼‰

**æ­¥éª¤2: åœ¨EntryAbilityä¸­å¤„ç†Deep Link**

æ‰“å¼€`entry/src/main/ets/entryability/EntryAbility.ets`æ–‡ä»¶:

```typescript
import UIAbility from '@ohos.app.ability.UIAbility';
import AbilityConstant from '@ohos.app.ability.AbilityConstant';
import Want from '@ohos.app.ability.Want';
import window from '@ohos.window';
import hilog from '@ohos.hilog';

const TAG: string = 'EntryAbility';
const DOMAIN: number = 0xFF00;

export default class EntryAbility extends UIAbility {
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(DOMAIN, TAG, 'Ability onCreate');

    // å¤„ç†Deep Link
    this.handleDeepLink(want);
  }

  onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(DOMAIN, TAG, 'Ability onNewWant');

    // å½“åº”ç”¨å·²åœ¨åå°æ—¶ï¼Œé€šè¿‡Deep Linkå†æ¬¡å”¤èµ·
    this.handleDeepLink(want);
  }

  /**
   * å¤„ç†Deep Link
   * @param want Wantå¯¹è±¡ï¼ŒåŒ…å«URIä¿¡æ¯
   */
  private handleDeepLink(want: Want): void {
    // è·å–URI
    const uri = want.uri;
    if (!uri) {
      hilog.info(DOMAIN, TAG, 'No URI found');
      return;
    }

    hilog.info(DOMAIN, TAG, `Received Deep Link: ${uri}`);

    try {
      // è§£æURI: knot://post/12345
      const url = new URL(uri);
      const scheme = url.protocol.replace(':', ''); // knot
      const host = url.hostname; // post
      const path = url.pathname; // /12345

      if (scheme === 'knot') {
        if (host === 'post') {
          // å¸–å­è¯¦æƒ…: knot://post/12345
          const postId = path.substring(1); // å»æ‰å¼€å¤´çš„"/"
          this.navigateToPostDetail(postId);
        } else if (host === 'share') {
          // çŸ­é“¾æ¥: knot://share/ABC12345
          const shortCode = path.substring(1);
          this.handleShortLink(shortCode);
        }
      }
    } catch (error) {
      hilog.error(DOMAIN, TAG, `Failed to parse URI: ${error.message}`);
    }
  }

  /**
   * è·³è½¬åˆ°å¸–å­è¯¦æƒ…é¡µ
   * @param postId å¸–å­ID
   */
  private navigateToPostDetail(postId: string): void {
    hilog.info(DOMAIN, TAG, `Navigating to post: ${postId}`);

    // æ–¹å¼1: ä½¿ç”¨AppStorageå­˜å‚¨å‚æ•°
    AppStorage.SetOrCreate('deeplink_post_id', postId);

    // æ–¹å¼2: ä½¿ç”¨Routerä¼ å‚ï¼ˆéœ€è¦åœ¨é¡µé¢ä¸­å¤„ç†ï¼‰
    // import router from '@ohos.router';
    // router.pushUrl({
    //   url: 'pages/PostDetail',
    //   params: {
    //     postId: postId
    //   }
    // });
  }

  /**
   * å¤„ç†çŸ­é“¾æ¥
   * @param shortCode çŸ­ç 
   */
  private async handleShortLink(shortCode: string): Promise<void> {
    hilog.info(DOMAIN, TAG, `Resolving short link: ${shortCode}`);

    try {
      // 1. è°ƒç”¨åç«¯APIè§£æçŸ­ç 
      // GET https://knot.app/api/v1/share/:code
      const response = await fetch(`https://knot.app/api/v1/share/${shortCode}`);
      const data = await response.json();

      if (data.success && data.data.target_type === 'POST') {
        const postId = data.data.target_id;
        this.navigateToPostDetail(postId.toString());
      } else {
        hilog.error(DOMAIN, TAG, `Failed to resolve short link: ${data.message}`);
      }
    } catch (error) {
      hilog.error(DOMAIN, TAG, `Error resolving short link: ${error.message}`);
    }
  }

  onDestroy(): void {
    hilog.info(DOMAIN, TAG, 'Ability onDestroy');
  }

  onWindowStageCreate(windowStage: window.WindowStage): void {
    hilog.info(DOMAIN, TAG, 'Ability onWindowStageCreate');

    windowStage.loadContent('pages/Index', (err, data) => {
      if (err.code) {
        hilog.error(DOMAIN, TAG, 'Failed to load the content. Cause: %{public}s', JSON.stringify(err) ?? '');
        return;
      }
      hilog.info(DOMAIN, TAG, 'Succeeded in loading the content. Data: %{public}s', JSON.stringify(data) ?? '');
    });
  }

  onWindowStageDestroy(): void {
    hilog.info(DOMAIN, TAG, 'Ability onWindowStageDestroy');
  }

  onForeground(): void {
    hilog.info(DOMAIN, TAG, 'Ability onForeground');
  }

  onBackground(): void {
    hilog.info(DOMAIN, TAG, 'Ability onBackground');
  }
}
```

**æ­¥éª¤3: åœ¨é¡µé¢ä¸­è·å–Deep Linkå‚æ•°**

åœ¨é¦–é¡µï¼ˆ`pages/Index.ets`ï¼‰æˆ–å¸–å­è¯¦æƒ…é¡µä¸­ï¼Œè·å–Deep Linkä¼ é€’çš„å‚æ•°:

```typescript
import router from '@ohos.router';

@Entry
@Component
struct Index {
  @State postId: string = '';

  aboutToAppear() {
    // è·å–Deep Linkå‚æ•°
    const params = router.getParams() as Record<string, string>;
    if (params && params.postId) {
      this.postId = params.postId;
      this.loadPostDetail(this.postId);
    }

    // æˆ–è€…ä»AppStorageè·å–
    const deepLinkPostId = AppStorage.Get<string>('deeplink_post_id');
    if (deepLinkPostId) {
      this.postId = deepLinkPostId;
      this.loadPostDetail(this.postId);
      // æ¸…é™¤æ ‡è®°
      AppStorage.Delete('deeplink_post_id');
    }
  }

  loadPostDetail(postId: string) {
    // åŠ è½½å¸–å­è¯¦æƒ…
    console.log(`Loading post: ${postId}`);
    // TODO: è°ƒç”¨APIè·å–å¸–å­æ•°æ®
  }

  build() {
    // UIä»£ç ...
  }
}
```

**æ­¥éª¤4: æµ‹è¯•Deep Link**

1. **é€šè¿‡hdcå‘½ä»¤æµ‹è¯•**ï¼ˆHarmonyOS Development Kitçš„å‘½ä»¤è¡Œå·¥å…·ï¼‰:

```bash
# æµ‹è¯•å¸–å­è¯¦æƒ…
hdc shell aa start -U "knot://post/12345" -b com.knot.app -a EntryAbility

# æµ‹è¯•çŸ­é“¾æ¥
hdc shell aa start -U "knot://share/ABC12345" -b com.knot.app -a EntryAbility
```

**å‚æ•°è¯´æ˜**:
- `-U`: URIå‚æ•°
- `-b`: åº”ç”¨åŒ…åï¼ˆBundle Nameï¼‰
- `-a`: Abilityåç§°

2. **çœŸæœºæµ‹è¯•**:
- é€šè¿‡çŸ­ä¿¡ã€å¤‡å¿˜å½•ç­‰åº”ç”¨å‘é€é“¾æ¥: `knot://post/12345`
- ç‚¹å‡»é“¾æ¥ï¼Œåº”è¯¥å¼¹å‡ºç¡®è®¤æ¡†ï¼š"æ˜¯å¦æ‰“å¼€Knotåº”ç”¨?"
- ç‚¹å‡»ç¡®è®¤ï¼Œåº”ç”¨æ‰“å¼€å¹¶è·³è½¬åˆ°å¸–å­è¯¦æƒ…é¡µ

3. **H5é¡µé¢æµ‹è¯•**:

åœ¨H5é¡µé¢ä¸­æ·»åŠ æŒ‰é’®ï¼Œç‚¹å‡»å”¤èµ·åº”ç”¨:

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ‰“å¼€Knotåº”ç”¨</title>
</head>
<body>
    <h1>å¸–å­åˆ†äº«</h1>
    <button onclick="openApp()">åœ¨Knotåº”ç”¨ä¸­æŸ¥çœ‹</button>

    <script>
        function openApp() {
            // å°è¯•å”¤èµ·åº”ç”¨
            window.location.href = 'knot://post/12345';

            // å¦‚æœ3ç§’åè¿˜åœ¨é¡µé¢ï¼Œè¯´æ˜åº”ç”¨æœªå®‰è£…ï¼Œè·³è½¬åˆ°ä¸‹è½½é¡µ
            setTimeout(function() {
                if (document.hidden === false) {
                    alert('è¯·å…ˆå®‰è£…Knotåº”ç”¨');
                    // window.location.href = 'https://knot.app/download';
                }
            }, 3000);
        }
    </script>
</body>
</html>
```

**è°ƒè¯•æŠ€å·§**:
- ä½¿ç”¨`hilog`å‘½ä»¤æŸ¥çœ‹æ—¥å¿—: `hdc shell hilog | grep EntryAbility`
- æ£€æŸ¥module.json5ä¸­çš„schemeé…ç½®æ˜¯å¦æ­£ç¡®
- ç¡®ä¿`exported: true`å’Œ`entity.system.browsable`éƒ½å·²é…ç½®

---

### HarmonyOS App Linkingé…ç½®

#### ä»€ä¹ˆæ˜¯HarmonyOS App Linking

App Linkingæ˜¯HarmonyOS 5.0+å¼•å…¥çš„åŸŸåéªŒè¯æ·±åº¦é“¾æ¥æ–¹æ¡ˆï¼Œç±»ä¼¼iOS Universal Linkså’ŒAndroid App Linksã€‚

**ä¼˜åŠ¿**:
- âœ… ä½¿ç”¨HTTPSé“¾æ¥ï¼ŒURLå‹å¥½
- âœ… åŸŸåéªŒè¯ï¼Œå®‰å…¨æ€§é«˜
- âœ… å¦‚æœæœªå®‰è£…åº”ç”¨ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€H5é¡µé¢
- âœ… æ— éœ€ç”¨æˆ·ç¡®è®¤ï¼Œè‡ªåŠ¨å”¤èµ·åº”ç”¨

**åŠ£åŠ¿**:
- âš ï¸ éœ€è¦åŸŸåå’ŒHTTPSè¯ä¹¦
- âš ï¸ éœ€è¦åœ¨AGCï¼ˆAppGallery Connectï¼‰æ§åˆ¶å°é…ç½®
- âš ï¸ é…ç½®ç›¸å¯¹å¤æ‚

**åŸç†**:
```
ç”¨æˆ·ç‚¹å‡»é“¾æ¥ https://knot.app/s/ABC12345
    â†“
HarmonyOSç³»ç»Ÿä¸‹è½½å¹¶éªŒè¯ applinking.json
    â†“
éªŒè¯é€šè¿‡ â†’ ç›´æ¥å”¤èµ·Knotåº”ç”¨
éªŒè¯å¤±è´¥æˆ–æœªå®‰è£… â†’ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€H5é¡µé¢
```

#### æœåŠ¡å™¨ç«¯é…ç½®ï¼ˆæ–¹æ¡ˆäºŒï¼‰

**æ­¥éª¤1: åˆ›å»ºapplinking.jsonæ–‡ä»¶**

åœ¨æœåŠ¡å™¨åˆ›å»ºæ–‡ä»¶: `https://knot.app/.well-known/applinking.json`

```json
{
  "relation": ["delegate_permission/common.handle_all_urls"],
  "target": {
    "namespace": "harmony_app",
    "bundle_name": "com.knot.app",
    "sha256_cert_fingerprints": [
      "AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99"
    ]
  }
}
```

**å­—æ®µè¯´æ˜**:
- `bundle_name`: åº”ç”¨çš„Bundle Nameï¼ˆå¦‚: com.knot.appï¼‰
- `sha256_cert_fingerprints`: åº”ç”¨ç­¾åè¯ä¹¦çš„SHA256æŒ‡çº¹æ•°ç»„ï¼ˆæ”¯æŒå¤šä¸ªè¯ä¹¦ï¼‰

**è·å–SHA256æŒ‡çº¹**:

åœ¨DevEco Studioä¸­:
1. æ‰“å¼€`File` â†’ `Project Structure` â†’ `Signing Configs`
2. é€‰æ‹©ä½ çš„ç­¾åé…ç½®ï¼ˆå¦‚: defaultï¼‰
3. å¤åˆ¶`SHA256`å€¼

æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ:

```bash
# ä½¿ç”¨keytoolæŸ¥çœ‹.p12è¯ä¹¦æ–‡ä»¶
keytool -list -v -keystore /path/to/your.p12 -storetype PKCS12

# è¾“å‡ºç¤ºä¾‹ï¼š
# è¯ä¹¦æŒ‡çº¹:
#   SHA256: AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99
```

**æ³¨æ„äº‹é¡¹**:
- Debugç‰ˆæœ¬å’ŒReleaseç‰ˆæœ¬çš„è¯ä¹¦æŒ‡çº¹ä¸åŒï¼Œéœ€è¦åˆ†åˆ«é…ç½®
- å»ºè®®åœ¨`sha256_cert_fingerprints`æ•°ç»„ä¸­åŒæ—¶æ·»åŠ Debugå’ŒReleaseè¯ä¹¦
- è¯ä¹¦æŒ‡çº¹æ ¼å¼å¿…é¡»æ˜¯å¤§å†™å­—æ¯ï¼Œç”¨å†’å·åˆ†éš”

**æ­¥éª¤2: é…ç½®Nginx**

```nginx
server {
    listen 443 ssl http2;
    server_name knot.app;

    # SSLè¯ä¹¦é…ç½®
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # HarmonyOS App Linkingé…ç½®
    location /.well-known/applinking.json {
        alias /usr/share/nginx/html/.well-known/applinking.json;
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
        add_header Content-Type "application/json; charset=utf-8";
    }

    # å…¶ä»–é…ç½®...
}
```

**æ­¥éª¤3: éªŒè¯é…ç½®**

åœ¨æµè§ˆå™¨è®¿é—®: `https://knot.app/.well-known/applinking.json`

åº”è¯¥çœ‹åˆ°JSONå†…å®¹ï¼Œä¸”Content-Typeä¸º`application/json`ã€‚

**æ­¥éª¤4: åœ¨AGCæ§åˆ¶å°é…ç½®ï¼ˆé‡è¦ï¼‰**

1. ç™»å½•[AppGallery Connect](https://developer.huawei.com/consumer/cn/service/josp/agc/index.html)
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. è¿›å…¥`æˆ‘çš„åº”ç”¨` â†’ é€‰æ‹©ä½ çš„åº”ç”¨
4. ç‚¹å‡»`æœåŠ¡` â†’ `App Linking`
5. ç‚¹å‡»`æ·»åŠ åŸŸå`
6. è¾“å…¥åŸŸå: `knot.app`
7. ç‚¹å‡»`ä¿å­˜`

**éªŒè¯æ–¹æ³•**:
AGCä¼šè‡ªåŠ¨ä¸‹è½½å¹¶éªŒè¯ä½ çš„`applinking.json`æ–‡ä»¶ï¼Œç¡®ä¿:
- æ–‡ä»¶å¯é€šè¿‡HTTPSè®¿é—®
- `bundle_name`ä¸åº”ç”¨åŒ…åä¸€è‡´
- `sha256_cert_fingerprints`åŒ…å«åº”ç”¨ç­¾åè¯ä¹¦

#### HarmonyOSåº”ç”¨ç«¯é…ç½®ï¼ˆæ–¹æ¡ˆäºŒï¼‰

**æ­¥éª¤1: åœ¨module.json5ä¸­é…ç½®App Linking**

æ‰“å¼€é¡¹ç›®çš„`entry/src/main/module.json5`æ–‡ä»¶:

```json5
{
  "module": {
    "name": "entry",
    "type": "entry",
    "description": "Knotå›¾ç‰‡åˆ†äº«åº”ç”¨",
    "mainElement": "EntryAbility",
    "deviceTypes": [
      "phone",
      "tablet"
    ],
    "abilities": [
      {
        "name": "EntryAbility",
        "srcEntry": "./ets/entryability/EntryAbility.ets",
        "description": "åº”ç”¨ä¸»å…¥å£",
        "icon": "$media:icon",
        "label": "$string:EntryAbility_label",
        "startWindowIcon": "$media:icon",
        "startWindowBackground": "$color:start_window_background",
        "exported": true,
        "skills": [
          {
            "entities": [
              "entity.system.home"
            ],
            "actions": [
              "action.system.home"
            ]
          },
          {
            // App Linkingé…ç½®
            "entities": [
              "entity.system.browsable"
            ],
            "actions": [
              "ohos.want.action.viewData"
            ],
            "uris": [
              {
                "scheme": "https",     // å¿…é¡»æ˜¯https
                "host": "knot.app",    // ä½ çš„åŸŸå
                "pathStartWith": "/s/",   // åŒ¹é… /s/* è·¯å¾„
                "domainVerify": true   // å¯ç”¨åŸŸåéªŒè¯
              },
              {
                "scheme": "https",
                "host": "knot.app",
                "pathStartWith": "/post/",  // åŒ¹é… /post/* è·¯å¾„
                "domainVerify": true
              }
            ]
          }
        ]
      }
    ]
  }
}
```

**å…³é”®é…ç½®è¯´æ˜**:
- `scheme: "https"`: å¿…é¡»ä½¿ç”¨httpsï¼ˆä¸æ”¯æŒhttpï¼‰
- `host: "knot.app"`: ä½ çš„åŸŸå
- `pathStartWith: "/s/"`: è·¯å¾„å‰ç¼€ï¼ŒåŒ¹é…`https://knot.app/s/ABC12345`
- `domainVerify: true`: **å¯ç”¨åŸŸåéªŒè¯**ï¼ˆè¿™æ˜¯App Linkingçš„æ ¸å¿ƒï¼‰

**æ­¥éª¤2: åœ¨EntryAbilityä¸­å¤„ç†App Linking**

å¤„ç†ä»£ç ä¸Deep Linkingç±»ä¼¼ï¼Œåªéœ€è¦è§£æHTTPS URL:

```typescript
import UIAbility from '@ohos.app.ability.UIAbility';
import AbilityConstant from '@ohos.app.ability.AbilityConstant';
import Want from '@ohos.app.ability.Want';
import window from '@ohos.window';
import hilog from '@ohos.hilog';

const TAG: string = 'EntryAbility';
const DOMAIN: number = 0xFF00;

export default class EntryAbility extends UIAbility {
  onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(DOMAIN, TAG, 'Ability onCreate');
    this.handleAppLinking(want);
  }

  onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam): void {
    hilog.info(DOMAIN, TAG, 'Ability onNewWant');
    this.handleAppLinking(want);
  }

  /**
   * å¤„ç†App Linking
   * @param want Wantå¯¹è±¡ï¼ŒåŒ…å«URIä¿¡æ¯
   */
  private handleAppLinking(want: Want): void {
    const uri = want.uri;
    if (!uri) {
      hilog.info(DOMAIN, TAG, 'No URI found');
      return;
    }

    hilog.info(DOMAIN, TAG, `Received App Linking: ${uri}`);

    try {
      // è§£æURI: https://knot.app/s/ABC12345
      const url = new URL(uri);
      const host = url.hostname; // knot.app
      const path = url.pathname; // /s/ABC12345

      if (host === 'knot.app') {
        if (path.startsWith('/s/')) {
          // çŸ­é“¾æ¥: /s/ABC12345
          const shortCode = path.substring(3); // å»æ‰"/s/"
          this.handleShortLink(shortCode);
        } else if (path.startsWith('/post/')) {
          // å¸–å­è¯¦æƒ…: /post/12345
          const postId = path.substring(6); // å»æ‰"/post/"
          this.navigateToPostDetail(postId);
        }
      }
    } catch (error) {
      hilog.error(DOMAIN, TAG, `Failed to parse URI: ${error.message}`);
    }
  }

  private navigateToPostDetail(postId: string): void {
    hilog.info(DOMAIN, TAG, `Navigating to post: ${postId}`);
    AppStorage.SetOrCreate('deeplink_post_id', postId);
  }

  private async handleShortLink(shortCode: string): Promise<void> {
    hilog.info(DOMAIN, TAG, `Resolving short link: ${shortCode}`);

    try {
      // è°ƒç”¨åç«¯APIè§£æçŸ­ç 
      const response = await fetch(`https://knot.app/api/v1/share/${shortCode}`);
      const data = await response.json();

      if (data.success && data.data.target_type === 'POST') {
        const postId = data.data.target_id;
        this.navigateToPostDetail(postId.toString());
      } else {
        hilog.error(DOMAIN, TAG, `Failed to resolve short link: ${data.message}`);
      }
    } catch (error) {
      hilog.error(DOMAIN, TAG, `Error resolving short link: ${error.message}`);
    }
  }

  // ... å…¶ä»–ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¿æŒä¸å˜
}
```

**æ­¥éª¤3: æµ‹è¯•App Linking**

1. **çœŸæœºæµ‹è¯•**ï¼ˆæ¨èï¼‰:
   - é€šè¿‡çŸ­ä¿¡ã€å¤‡å¿˜å½•ç­‰åº”ç”¨å‘é€é“¾æ¥: `https://knot.app/s/ABC12345`
   - ç‚¹å‡»é“¾æ¥ï¼Œåº”è¯¥**ç›´æ¥å”¤èµ·åº”ç”¨**ï¼ˆæ— éœ€ç¡®è®¤ï¼‰
   - å¦‚æœæœªå®‰è£…åº”ç”¨ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€H5é¡µé¢

2. **hdcå‘½ä»¤æµ‹è¯•**:
```bash
# æµ‹è¯•App Linking
hdc shell aa start -U "https://knot.app/s/ABC12345" -b com.knot.app -a EntryAbility
```

3. **éªŒè¯åŸŸåéªŒè¯çŠ¶æ€**:

åœ¨DevEco Studioçš„ç»ˆç«¯ä¸­è¿è¡Œ:

```bash
# æ£€æŸ¥App LinkingéªŒè¯çŠ¶æ€
hdc shell bm dump -n com.knot.app

# è¾“å‡ºä¸­æŸ¥æ‰¾:
# domainVerify: verified (è¡¨ç¤ºéªŒè¯æˆåŠŸ)
```

**å¸¸è§é—®é¢˜æ’æŸ¥**:

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ³• |
|------|------|----------|
| ç‚¹å‡»é“¾æ¥æ‰“å¼€æµè§ˆå™¨è€Œéåº”ç”¨ | åŸŸåéªŒè¯å¤±è´¥ | æ£€æŸ¥applinking.jsonæ˜¯å¦å¯è®¿é—®ï¼ŒSHA256æŒ‡çº¹æ˜¯å¦æ­£ç¡® |
| æç¤º"æ— æ³•æ‰“å¼€é“¾æ¥" | schemeé…ç½®é”™è¯¯ | ç¡®ä¿ä½¿ç”¨httpsï¼Œä¸æ˜¯http |
| AGCæ§åˆ¶å°æ˜¾ç¤ºéªŒè¯å¤±è´¥ | è¯ä¹¦æŒ‡çº¹ä¸åŒ¹é… | é‡æ–°è·å–è¯ä¹¦æŒ‡çº¹ï¼Œæ›´æ–°applinking.json |
| åº”ç”¨æœªå“åº”Deep Link | domainVerifyæœªå¯ç”¨ | åœ¨module.json5ä¸­è®¾ç½®`domainVerify: true` |

---

### ä¸‰ç«¯é…ç½®å¯¹æ¯”

ä»¥ä¸‹æ˜¯iOSã€Androidã€HarmonyOSä¸‰ç«¯Deep Linké…ç½®çš„å¯¹æ¯”æ€»ç»“:

| ç»´åº¦ | iOS Universal Links | Android App Links | HarmonyOS Deep Linking | HarmonyOS App Linking |
|------|---------------------|-------------------|------------------------|------------------------|
| **URLæ ¼å¼** | https://knot.app/s/ABC12345 | https://knot.app/s/ABC12345 | knot://post/12345 | https://knot.app/s/ABC12345 |
| **åŸŸåéªŒè¯** | âœ… éœ€è¦ | âœ… éœ€è¦ | âŒ ä¸éœ€è¦ | âœ… éœ€è¦ |
| **æœåŠ¡å™¨é…ç½®æ–‡ä»¶** | apple-app-site-association | assetlinks.json | æ—  | applinking.json |
| **æ–‡ä»¶è·¯å¾„** | /.well-known/ | /.well-known/ | æ—  | /.well-known/ |
| **è¯ä¹¦æŒ‡çº¹** | Team ID | SHA256 | æ—  | SHA256 |
| **ç”¨æˆ·ä½“éªŒ** | ç›´æ¥å”¤èµ· | ç›´æ¥å”¤èµ· | éœ€è¦ç¡®è®¤ | ç›´æ¥å”¤èµ· |
| **æœªå®‰è£…æ—¶** | æ‰“å¼€H5é¡µé¢ | æ‰“å¼€æµè§ˆå™¨ | æ˜¾ç¤ºé”™è¯¯ | æ‰“å¼€H5é¡µé¢ |
| **å®‰å…¨æ€§** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| **å®ç°å¤æ‚åº¦** | â­â­â­â­ | â­â­â­â­ | â­â­ | â­â­â­â­â­ |
| **æ¨èåº¦** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­ | â­â­â­â­â­ |

**é…ç½®æ–‡ä»¶å†…å®¹å¯¹æ¯”**:

```json
// iOS: apple-app-site-association
{
  "applinks": {
    "apps": [],
    "details": [{
      "appID": "TEAMID.com.knot.app",
      "paths": ["/s/*", "/post/*"]
    }]
  }
}

// Android: assetlinks.json
[{
  "relation": ["delegate_permission/common.handle_all_urls"],
  "target": {
    "namespace": "android_app",
    "package_name": "com.knot.app",
    "sha256_cert_fingerprints": ["AA:BB:CC:..."]
  }
}]

// HarmonyOS: applinking.json
{
  "relation": ["delegate_permission/common.handle_all_urls"],
  "target": {
    "namespace": "harmony_app",
    "bundle_name": "com.knot.app",
    "sha256_cert_fingerprints": ["AA:BB:CC:..."]
  }
}
```

**å¼€å‘å»ºè®®**:

1. **MVPé˜¶æ®µ**ï¼ˆå¿«é€ŸéªŒè¯ï¼‰:
   - iOS: Universal Linksï¼ˆå¿…é¡»ï¼‰
   - Android: App Linksï¼ˆå¿…é¡»ï¼‰
   - HarmonyOS: **Deep Linkingï¼ˆè‡ªå®šä¹‰Schemeï¼‰** â† å¿«é€Ÿå®ç°

2. **ç”Ÿäº§ç¯å¢ƒ**ï¼ˆæ­£å¼å‘å¸ƒï¼‰:
   - iOS: Universal Links
   - Android: App Links
   - HarmonyOS: **App Linkingï¼ˆåŸŸåéªŒè¯ï¼‰** â† æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

3. **H5é™çº§æ–¹æ¡ˆ**:
   - å¯¹äºæœªå®‰è£…åº”ç”¨çš„ç”¨æˆ·ï¼Œæä¾›H5é¡µé¢å±•ç¤ºå†…å®¹
   - H5é¡µé¢ä¸­æ·»åŠ "ä¸‹è½½åº”ç”¨"æŒ‰é’®
   - ä½¿ç”¨JavaScriptæ£€æµ‹åº”ç”¨æ˜¯å¦å®‰è£…å¹¶è‡ªåŠ¨å”¤èµ·

**H5é¡µé¢Deep Linkå”¤èµ·ç¤ºä¾‹**:

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Knot - å¸–å­è¯¦æƒ…</title>
    <script>
        // é¡µé¢åŠ è½½æ—¶å°è¯•å”¤èµ·åº”ç”¨
        window.onload = function() {
            const userAgent = navigator.userAgent.toLowerCase();
            const shortCode = 'ABC12345'; // ä»URLè·å–

            if (userAgent.indexOf('harmonyos') !== -1) {
                // HarmonyOS: ä¼˜å…ˆä½¿ç”¨App Linking
                window.location.href = `https://knot.app/s/${shortCode}`;

                // é™çº§åˆ°Deep Linking
                setTimeout(function() {
                    window.location.href = `knot://share/${shortCode}`;
                }, 500);
            } else if (userAgent.indexOf('iphone') !== -1 || userAgent.indexOf('ipad') !== -1) {
                // iOS: Universal Links
                window.location.href = `https://knot.app/s/${shortCode}`;
            } else if (userAgent.indexOf('android') !== -1) {
                // Android: App Links
                window.location.href = `https://knot.app/s/${shortCode}`;

                // é™çº§åˆ°Intent
                setTimeout(function() {
                    window.location.href = `intent://post/${shortCode}#Intent;scheme=knot;package=com.knot.app;end`;
                }, 500);
            }

            // 2ç§’åå¦‚æœè¿˜åœ¨é¡µé¢ï¼Œæ˜¾ç¤ºä¸‹è½½æç¤º
            setTimeout(function() {
                if (!document.hidden) {
                    document.getElementById('download-tip').style.display = 'block';
                }
            }, 2000);
        };
    </script>
</head>
<body>
    <h1>æ­£åœ¨æ‰“å¼€Knotåº”ç”¨...</h1>

    <div id="download-tip" style="display:none;">
        <p>æœªæ£€æµ‹åˆ°Knotåº”ç”¨ï¼Œè¯·å…ˆå®‰è£…</p>
        <a href="https://knot.app/download">ä¸‹è½½Knotåº”ç”¨</a>
    </div>

    <!-- å¸–å­å†…å®¹é¢„è§ˆï¼ˆH5ç‰ˆæœ¬ï¼‰ -->
    <div id="post-preview">
        <!-- TODO: æ˜¾ç¤ºå¸–å­å›¾ç‰‡å’Œä¿¡æ¯ -->
    </div>
</body>
</html>
```

---

## è¯¦ç»†ä»»åŠ¡åˆ—è¡¨

### é˜¶æ®µåˆ’åˆ†

æœ¬é¡¹ç›®åˆ†ä¸º8ä¸ªé˜¶æ®µä¾æ¬¡å®ç°ï¼Œéµå¾ªä¹å±‚æ¶æ„è‡ªä¸‹è€Œä¸Šçš„å¼€å‘æ–¹å¼ã€‚

---

### é˜¶æ®µ1: æ•°æ®åº“è®¾è®¡ä¸è¿ç§» â±ï¸ é¢„è®¡1å°æ—¶

**ç›®æ ‡**: åˆ›å»ºshare_linksè¡¨å’Œç›¸å…³ç´¢å¼•

**ä»»åŠ¡æ¸…å•**:
- [ ] ç¼–å†™æ•°æ®åº“è¿ç§»SQLè„šæœ¬
  - [ ] åœ¨`config/database.sql`ä¸­æ·»åŠ share_linksè¡¨å®šä¹‰
  - [ ] æ·»åŠ 4ä¸ªç´¢å¼•ï¼ˆä¸»é”®ã€å”¯ä¸€ç´¢å¼•ã€2ä¸ªæ™®é€šç´¢å¼•ï¼‰
  - [ ] æ·»åŠ 2ä¸ªå¤–é”®çº¦æŸ
  - [ ] æ·»åŠ è¡¨æ³¨é‡Šå’Œå­—æ®µæ³¨é‡Š
- [ ] æ‰§è¡Œæ•°æ®åº“è¿ç§»
  - [ ] è¿æ¥åˆ°MySQLæœåŠ¡å™¨
  - [ ] æ‰§è¡ŒCREATE TABLEè¯­å¥
  - [ ] éªŒè¯è¡¨åˆ›å»ºæˆåŠŸï¼š`SHOW CREATE TABLE share_links;`
  - [ ] éªŒè¯ç´¢å¼•åˆ›å»ºæˆåŠŸï¼š`SHOW INDEX FROM share_links;`
- [ ] æ›´æ–°æ•°æ®åº“è®¾è®¡æ–‡æ¡£
  - [ ] åœ¨`[001]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md`ä¸­æ·»åŠ share_linksè¡¨è¯´æ˜
  - [ ] æ›´æ–°ERå›¾ï¼ˆå¦‚æœæœ‰ï¼‰
  - [ ] æ›´æ–°`[200]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md`

**éªŒæ”¶æ ‡å‡†**:
- share_linksè¡¨åˆ›å»ºæˆåŠŸï¼ŒåŒ…å«7ä¸ªå­—æ®µ
- 4ä¸ªç´¢å¼•å…¨éƒ¨åˆ›å»ºæˆåŠŸ
- å¤–é”®çº¦æŸç”Ÿæ•ˆï¼ˆæµ‹è¯•çº§è”åˆ é™¤ï¼‰
- æ•°æ®åº“æ–‡æ¡£å·²æ›´æ–°

---

### é˜¶æ®µ2: åŸºç¡€è®¾æ–½å±‚å®ç° â±ï¸ é¢„è®¡2å°æ—¶

**ç›®æ ‡**: å®ç°Base62ç¼–ç å’Œé›ªèŠ±IDç”Ÿæˆå™¨

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°Base62Encoderå·¥å…·ç±»
  - [ ] åˆ›å»º`src/utils/base62_encoder.h`
  - [ ] åˆ›å»º`src/utils/base62_encoder.cpp`
  - [ ] å®ç°`encode(int64_t num, int minLength = 8)`æ–¹æ³•
  - [ ] å®ç°`decode(const std::string& str)`æ–¹æ³•
  - [ ] ç¼–å†™å•å…ƒæµ‹è¯•éªŒè¯ç¼–ç /è§£ç æ­£ç¡®æ€§
- [ ] æ‰©å±•IdGeneratorç±»
  - [ ] æ‰“å¼€`src/utils/id_generator.h`
  - [ ] æ·»åŠ `generateSnowflakeId()`ç§æœ‰æ–¹æ³•
  - [ ] æ·»åŠ `generateShareCode()`å…¬æœ‰æ–¹æ³•
  - [ ] åœ¨`src/utils/id_generator.cpp`ä¸­å®ç°é›ªèŠ±IDç®—æ³•
  - [ ] å®ç°çŸ­ç ç”Ÿæˆé€»è¾‘ï¼ˆé›ªèŠ±ID â†’ Base62ç¼–ç ï¼‰
  - [ ] ç¼–å†™æµ‹è¯•éªŒè¯çŸ­ç å”¯ä¸€æ€§å’Œé•¿åº¦
- [ ] æ›´æ–°CMakeLists.txt
  - [ ] æ·»åŠ base62_encoder.cppåˆ°æºæ–‡ä»¶åˆ—è¡¨
  - [ ] ç¡®ä¿ç¼–è¯‘é€šè¿‡

**éªŒæ”¶æ ‡å‡†**:
- Base62ç¼–ç /è§£ç åŠŸèƒ½æ­£ç¡®
- é›ªèŠ±IDç”Ÿæˆå™¨æ— æ—¶é’Ÿå›æ‹¨é—®é¢˜
- çŸ­ç é•¿åº¦å›ºå®šä¸º8ä½
- çŸ­ç ä»…åŒ…å«0-9A-Za-zå­—ç¬¦
- å•å…ƒæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

### é˜¶æ®µ3: æ•°æ®æ¨¡å‹å±‚å®ç° â±ï¸ é¢„è®¡1.5å°æ—¶

**ç›®æ ‡**: å®ç°ShareLinkæ¨¡å‹ç±»

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºShareLinkæ¨¡å‹ç±»
  - [ ] åˆ›å»º`src/models/share_link.h`
  - [ ] å®šä¹‰TargetTypeæšä¸¾ï¼ˆPOST/USER/TAGï¼‰
  - [ ] å®šä¹‰ç§æœ‰æˆå‘˜å˜é‡ï¼ˆ7ä¸ªå­—æ®µï¼‰
  - [ ] å®ç°Getterå’ŒSetteræ–¹æ³•
  - [ ] åˆ›å»º`src/models/share_link.cpp`
- [ ] å®ç°å·¥å…·æ–¹æ³•
  - [ ] å®ç°`isExpired()`æ–¹æ³•ï¼šæ£€æŸ¥é“¾æ¥æ˜¯å¦è¿‡æœŸ
  - [ ] å®ç°`getFullUrl()`æ–¹æ³•ï¼šè¿”å›å®Œæ•´URLï¼ˆhttps://knot.app/s/ABC12345ï¼‰
  - [ ] å®ç°`targetTypeToString()`é™æ€æ–¹æ³•
  - [ ] å®ç°`stringToTargetType()`é™æ€æ–¹æ³•
- [ ] å®ç°JSONåºåˆ—åŒ–
  - [ ] å®ç°`toJson()`æ–¹æ³•
  - [ ] å®ç°`fromJson()`é™æ€æ–¹æ³•
  - [ ] å¤„ç†optionalå­—æ®µï¼ˆcreator_id, expire_timeï¼‰
- [ ] æ›´æ–°CMakeLists.txt
  - [ ] æ·»åŠ share_link.cppåˆ°æºæ–‡ä»¶åˆ—è¡¨

**éªŒæ”¶æ ‡å‡†**:
- ShareLinkç±»ç¼–è¯‘é€šè¿‡
- JSONåºåˆ—åŒ–/ååºåˆ—åŒ–æ­£ç¡®
- isExpired()é€»è¾‘æ­£ç¡®
- getFullUrl()è¿”å›æ­£ç¡®æ ¼å¼

---

### é˜¶æ®µ4: æ•°æ®è®¿é—®å±‚å®ç° â±ï¸ é¢„è®¡3å°æ—¶

**ç›®æ ‡**: å®ç°ShareLinkRepositoryç±»

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºShareLinkRepositoryç±»
  - [ ] åˆ›å»º`src/database/share_link_repository.h`
  - [ ] å£°æ˜5ä¸ªå…¬æœ‰æ–¹æ³•ï¼ˆcreate, findByShortCode, existsByShortCode, findByTarget, deleteExpiredï¼‰
  - [ ] åˆ›å»º`src/database/share_link_repository.cpp`
- [ ] å®ç°createæ–¹æ³•
  - [ ] ä½¿ç”¨ConnectionGuardè·å–è¿æ¥
  - [ ] ç¼–å†™é¢„ç¼–è¯‘SQLè¯­å¥ï¼ˆINSERTï¼‰
  - [ ] ç»‘å®šå‚æ•°ï¼ˆ7ä¸ªå­—æ®µï¼‰
  - [ ] æ‰§è¡Œæ’å…¥ï¼Œè·å–è‡ªå¢ID
  - [ ] æ›´æ–°shareLinkå¯¹è±¡çš„idå­—æ®µ
  - [ ] è¿”å›æ“ä½œç»“æœ
- [ ] å®ç°findByShortCodeæ–¹æ³•
  - [ ] ç¼–å†™é¢„ç¼–è¯‘SQLè¯­å¥ï¼ˆSELECT WHERE short_code = ?ï¼‰
  - [ ] è§£ææŸ¥è¯¢ç»“æœï¼Œæ„é€ ShareLinkå¯¹è±¡
  - [ ] è¿”å›std::optional<ShareLink>
- [ ] å®ç°existsByShortCodeæ–¹æ³•
  - [ ] ç¼–å†™é¢„ç¼–è¯‘SQLè¯­å¥ï¼ˆSELECT COUNT(*) WHERE short_code = ?ï¼‰
  - [ ] è¿”å›å¸ƒå°”å€¼
- [ ] å®ç°findByTargetæ–¹æ³•
  - [ ] ç¼–å†™é¢„ç¼–è¯‘SQLè¯­å¥ï¼ˆSELECT WHERE target_type = ? AND target_id = ?ï¼‰
  - [ ] è¿”å›std::optional<ShareLink>
- [ ] å®ç°deleteExpiredæ–¹æ³•
  - [ ] ç¼–å†™SQLè¯­å¥ï¼ˆDELETE WHERE expire_time < NOW()ï¼‰
  - [ ] è¿”å›åˆ é™¤çš„è®°å½•æ•°
- [ ] æ›´æ–°CMakeLists.txt
  - [ ] æ·»åŠ share_link_repository.cppåˆ°æºæ–‡ä»¶åˆ—è¡¨

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰æ–¹æ³•ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥
- ConnectionGuardæ­£ç¡®ç®¡ç†è¿æ¥
- æŸ¥è¯¢ç»“æœæ­£ç¡®æ˜ å°„åˆ°ShareLinkå¯¹è±¡
- å¤–é”®çº¦æŸçº§è”æ“ä½œç”Ÿæ•ˆ

---

### é˜¶æ®µ5: ä¸šåŠ¡é€»è¾‘å±‚å®ç° â±ï¸ é¢„è®¡3å°æ—¶

**ç›®æ ‡**: å®ç°ShareServiceç±»

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºShareServiceç±»
  - [ ] åˆ›å»º`src/core/share_service.h`
  - [ ] å®šä¹‰CreateShareLinkResultç»“æ„ä½“
  - [ ] å®šä¹‰ResolveShareLinkResultç»“æ„ä½“
  - [ ] å£°æ˜3ä¸ªå…¬æœ‰æ–¹æ³•å’Œ1ä¸ªç§æœ‰æ–¹æ³•
  - [ ] åˆ›å»º`src/core/share_service.cpp`
- [ ] å®ç°createShareLinkæ–¹æ³•
  - [ ] éªŒè¯å¸–å­æ˜¯å¦å­˜åœ¨ï¼ˆè°ƒç”¨PostRepositoryï¼‰
  - [ ] æ£€æŸ¥å¸–å­æ˜¯å¦å·²æœ‰åˆ†äº«é“¾æ¥ï¼ˆè°ƒç”¨findByTargetï¼‰
  - [ ] å¦‚æœå·²å­˜åœ¨ï¼Œç›´æ¥è¿”å›ç°æœ‰é“¾æ¥
  - [ ] å¦‚æœä¸å­˜åœ¨ï¼Œç”Ÿæˆæ–°çŸ­ç ï¼ˆè°ƒç”¨IdGenerator::generateShareCode()ï¼‰
  - [ ] åˆ›å»ºShareLinkå¯¹è±¡å¹¶ä¿å­˜ï¼ˆè°ƒç”¨Repository::createï¼‰
  - [ ] æ„é€ å®Œæ•´URLï¼š`https://knot.app/s/` + short_code
  - [ ] è¿”å›CreateShareLinkResult
- [ ] å®ç°resolveShareLinkæ–¹æ³•
  - [ ] æ ¹æ®çŸ­ç æŸ¥è¯¢åˆ†äº«é“¾æ¥ï¼ˆè°ƒç”¨findByShortCodeï¼‰
  - [ ] æ£€æŸ¥é“¾æ¥æ˜¯å¦è¿‡æœŸï¼ˆè°ƒç”¨isExpired()ï¼‰
  - [ ] æ ¹æ®target_typeå’Œtarget_idæŸ¥è¯¢ç›®æ ‡å¯¹è±¡
  - [ ] å¦‚æœæ˜¯POSTç±»å‹ï¼Œè°ƒç”¨PostRepositoryè”è¡¨æŸ¥è¯¢å¸–å­ã€å›¾ç‰‡ã€ç”¨æˆ·ä¿¡æ¯
  - [ ] ç”ŸæˆDeep Link URLsï¼ˆè°ƒç”¨generateDeepLinksï¼‰
  - [ ] è¿”å›ResolveShareLinkResult
- [ ] å®ç°generateDeepLinksç§æœ‰æ–¹æ³•
  - [ ] æ„é€ iOS Deep Linkï¼š`knot://post/{postId}`
  - [ ] æ„é€ Android Deep Linkï¼š`knot://post/{postId}`
  - [ ] æ„é€ HarmonyOS Deep Linkï¼š`knot://post/{postId}`
  - [ ] æ„é€ Universal Linkï¼š`https://knot.app/post/{postId}`
  - [ ] è¿”å›Json::Valueå¯¹è±¡
- [ ] æ›´æ–°CMakeLists.txt
  - [ ] æ·»åŠ share_service.cppåˆ°æºæ–‡ä»¶åˆ—è¡¨

**éªŒæ”¶æ ‡å‡†**:
- å»é‡é€»è¾‘æ­£ç¡®ï¼ˆåŒä¸€å¸–å­ä¸é‡å¤åˆ›å»ºåˆ†äº«é“¾æ¥ï¼‰
- çŸ­ç å”¯ä¸€æ€§ä¿è¯
- è¿‡æœŸé“¾æ¥æ­£ç¡®å¤„ç†
- Deep Link URLsæ ¼å¼æ­£ç¡®

---

### é˜¶æ®µ6: APIæ¥å£å±‚å®ç° â±ï¸ é¢„è®¡2.5å°æ—¶

**ç›®æ ‡**: å®ç°ShareHandlerç±»

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºShareHandlerç±»
  - [ ] åˆ›å»º`src/api/share_handler.h`
  - [ ] å£°æ˜æ„é€ å‡½æ•°å’ŒregisterRoutesæ–¹æ³•
  - [ ] å£°æ˜2ä¸ªç§æœ‰Handleræ–¹æ³•
  - [ ] åˆ›å»º`src/api/share_handler.cpp`
- [ ] å®ç°handleCreatePostShareæ–¹æ³•
  - [ ] æå–Authorizationå¤´
  - [ ] éªŒè¯JWT Tokenï¼ˆè°ƒç”¨JWTManager::validateAccessTokenï¼‰
  - [ ] å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å›401é”™è¯¯
  - [ ] æå–post_idè·¯å¾„å‚æ•°
  - [ ] è°ƒç”¨ShareService::createShareLink
  - [ ] æ„é€ JSONå“åº”ï¼ˆsuccess, message, data, timestampï¼‰
  - [ ] è®¾ç½®HTTPçŠ¶æ€ç ï¼ˆ200æˆ–404ï¼‰
  - [ ] è¿”å›å“åº”
- [ ] å®ç°handleResolveShareæ–¹æ³•ï¼ˆå…¬å¼€æ¥å£ï¼Œæ— éœ€è®¤è¯ï¼‰
  - [ ] æå–codeè·¯å¾„å‚æ•°
  - [ ] è°ƒç”¨ShareService::resolveShareLink
  - [ ] æ„é€ JSONå“åº”ï¼ˆåŒ…å«å¸–å­å®Œæ•´ä¿¡æ¯å’ŒDeep Link URLsï¼‰
  - [ ] è®¾ç½®HTTPçŠ¶æ€ç ï¼ˆ200æˆ–404ï¼‰
  - [ ] è¿”å›å“åº”
- [ ] å®ç°registerRoutesæ–¹æ³•
  - [ ] æ³¨å†ŒPOST /api/v1/posts/:post_id/shareè·¯ç”±
  - [ ] æ³¨å†ŒGET /api/v1/share/:codeè·¯ç”±
- [ ] æ›´æ–°CMakeLists.txt
  - [ ] æ·»åŠ share_handler.cppåˆ°æºæ–‡ä»¶åˆ—è¡¨

**éªŒæ”¶æ ‡å‡†**:
- JWTè®¤è¯é€»è¾‘æ­£ç¡®
- å…¬å¼€æ¥å£æ— éœ€è®¤è¯
- JSONå“åº”æ ¼å¼ç»Ÿä¸€
- é”™è¯¯å¤„ç†å®Œå–„ï¼ˆ401, 404, 500ï¼‰

---

### é˜¶æ®µ7: æœåŠ¡å™¨é›†æˆä¸æµ‹è¯• â±ï¸ é¢„è®¡2å°æ—¶

**ç›®æ ‡**: é›†æˆShareHandleråˆ°HTTPæœåŠ¡å™¨å¹¶æµ‹è¯•

**ä»»åŠ¡æ¸…å•**:
- [ ] ä¿®æ”¹src/server/http_server.cpp
  - [ ] åœ¨HttpServeræ„é€ å‡½æ•°ä¸­åˆ›å»ºShareHandlerå®ä¾‹
  - [ ] åœ¨registerRoutes()ä¸­è°ƒç”¨shareHandler_->registerRoutes(*server_)
  - [ ] ç¡®ä¿ä¾èµ–æ³¨å…¥æ­£ç¡®ï¼ˆShareService, PostRepositoryç­‰ï¼‰
- [ ] ä¿®æ”¹src/main.cppï¼ˆå¦‚æœéœ€è¦ï¼‰
  - [ ] ç¡®ä¿ShareHandlerä¾èµ–çš„Serviceå’ŒRepositoryæ­£ç¡®åˆå§‹åŒ–
- [ ] ç¼–è¯‘é¡¹ç›®
  - [ ] æ‰§è¡Œ`rm -rf build && mkdir build && cd build && cmake .. && make -j4`
  - [ ] è§£å†³ç¼–è¯‘é”™è¯¯ï¼ˆå¦‚æœæœ‰ï¼‰
- [ ] å¯åŠ¨æœåŠ¡å™¨
  - [ ] æ‰§è¡Œ`./build/knot_image_sharing`
  - [ ] ç¡®è®¤æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼ˆç›‘å¬8080ç«¯å£ï¼‰
- [ ] ä½¿ç”¨curlæµ‹è¯•API
  - [ ] æµ‹è¯•åˆ›å»ºåˆ†äº«é“¾æ¥ï¼ˆPOST /api/v1/posts/:post_id/shareï¼‰
    ```bash
    curl -X POST http://localhost:8080/api/v1/posts/POST_2025Q4_ABC123/share \
      -H "Authorization: Bearer <token>" \
      -H "Content-Type: application/json"
    ```
  - [ ] æµ‹è¯•è§£æåˆ†äº«é“¾æ¥ï¼ˆGET /api/v1/share/:codeï¼‰
    ```bash
    curl http://localhost:8080/api/v1/share/ABC12345
    ```
  - [ ] æµ‹è¯•å„ç§é”™è¯¯åœºæ™¯ï¼ˆæ— tokenã€å¸–å­ä¸å­˜åœ¨ã€çŸ­ç ä¸å­˜åœ¨ç­‰ï¼‰
- [ ] æŸ¥çœ‹æ—¥å¿—
  - [ ] æ£€æŸ¥`logs/auth-service.log`ç¡®è®¤æ— é”™è¯¯

**éªŒæ”¶æ ‡å‡†**:
- ç¼–è¯‘æ— é”™è¯¯å’Œè­¦å‘Š
- æœåŠ¡å™¨æ­£å¸¸å¯åŠ¨
- APIè¿”å›æ­£ç¡®çš„JSONæ ¼å¼
- JWTè®¤è¯ç”Ÿæ•ˆ
- é”™è¯¯å¤„ç†æ­£ç¡®

---

### é˜¶æ®µ8: Deep Linké…ç½®ä¸æ–‡æ¡£æ›´æ–° â±ï¸ é¢„è®¡2å°æ—¶

**ç›®æ ‡**: é…ç½®ä¸‰ç«¯Deep Linkå¹¶æ›´æ–°é¡¹ç›®æ–‡æ¡£

**ä»»åŠ¡æ¸…å•**:
- [ ] é…ç½®æœåŠ¡å™¨ç«¯Deep Linkæ–‡ä»¶
  - [ ] åˆ›å»º`.well-known`ç›®å½•
  - [ ] åˆ›å»º`apple-app-site-association`æ–‡ä»¶ï¼ˆiOSï¼‰
  - [ ] åˆ›å»º`assetlinks.json`æ–‡ä»¶ï¼ˆAndroidï¼‰
  - [ ] åˆ›å»º`applinking.json`æ–‡ä»¶ï¼ˆHarmonyOSï¼‰
  - [ ] é…ç½®Nginx locationè§„åˆ™
  - [ ] é‡å¯Nginx: `sudo systemctl reload nginx`
  - [ ] éªŒè¯æ–‡ä»¶å¯è®¿é—®ï¼šcurlæµ‹è¯•ä¸‰ä¸ªURL
- [ ] æ›´æ–°APIæ–‡æ¡£
  - [ ] æ‰“å¼€`[000]APIæ–‡æ¡£.md`
  - [ ] æ·»åŠ "åˆ†äº«ç³»ç»ŸAPI"ç« èŠ‚
  - [ ] æ–‡æ¡£2ä¸ªAPIç«¯ç‚¹ï¼ˆè¯·æ±‚/å“åº”ç¤ºä¾‹ï¼‰
  - [ ] æ·»åŠ Deep Link URLsè¯´æ˜
- [ ] æ›´æ–°README.md
  - [ ] åœ¨"å½“å‰ç‰ˆæœ¬"ä¸­æ›´æ–°ä¸ºv2.3.0
  - [ ] åœ¨"åŠŸèƒ½æ¨¡å—ç»Ÿè®¡"ä¸­æ·»åŠ åˆ†äº«ç³»ç»Ÿè¡Œ
  - [ ] æ›´æ–°APIæ•°é‡ç»Ÿè®¡
- [ ] æ›´æ–°CLAUDE.md
  - [ ] åœ¨"APIç‰ˆæœ¬å†å²"ä¸­æ·»åŠ v2.3.0æ¡ç›®
  - [ ] åˆ—å‡º2ä¸ªæ–°å¢API
  - [ ] è¯´æ˜æ•°æ®åº“å˜æ›´ï¼ˆæ–°å¢share_linksè¡¨ï¼‰
  - [ ] æ·»åŠ Deep Linké…ç½®è¯´æ˜
- [ ] æ›´æ–°æ•°æ®åº“è®¾è®¡æ–‡æ¡£
  - [ ] åœ¨`[001]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md`ä¸­æ·»åŠ share_linksè¡¨å®Œæ•´è¯´æ˜
  - [ ] åœ¨`[200]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md`ä¸­è¡¥å……share_linksè¡¨è®¾è®¡ç†å¿µ

**éªŒæ”¶æ ‡å‡†**:
- ä¸‰ç«¯Deep Linké…ç½®æ–‡ä»¶å¯é€šè¿‡HTTPSè®¿é—®
- APIæ–‡æ¡£å®Œæ•´ï¼ˆåŒ…å«è¯·æ±‚/å“åº”ç¤ºä¾‹ï¼‰
- æ‰€æœ‰é¡¹ç›®æ–‡æ¡£åŒæ­¥æ›´æ–°
- æ–‡æ¡£æ ¼å¼ç»Ÿä¸€è§„èŒƒ

---

### æ€»ç»“

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡è€—æ—¶ | è¾“å‡ºäº§ç‰© |
|------|------|---------|---------|
| é˜¶æ®µ1 | æ•°æ®åº“è®¾è®¡ä¸è¿ç§» | 1å°æ—¶ | share_linksè¡¨ã€ç´¢å¼•ã€å¤–é”®ã€æ–‡æ¡£ |
| é˜¶æ®µ2 | åŸºç¡€è®¾æ–½å±‚ | 2å°æ—¶ | Base62Encoderã€IdGeneratoræ‰©å±• |
| é˜¶æ®µ3 | æ•°æ®æ¨¡å‹å±‚ | 1.5å°æ—¶ | ShareLinkç±» |
| é˜¶æ®µ4 | æ•°æ®è®¿é—®å±‚ | 3å°æ—¶ | ShareLinkRepositoryç±» |
| é˜¶æ®µ5 | ä¸šåŠ¡é€»è¾‘å±‚ | 3å°æ—¶ | ShareServiceç±» |
| é˜¶æ®µ6 | APIæ¥å£å±‚ | 2.5å°æ—¶ | ShareHandlerç±» |
| é˜¶æ®µ7 | æœåŠ¡å™¨é›†æˆä¸æµ‹è¯• | 2å°æ—¶ | é›†æˆä»£ç ã€æµ‹è¯•è„šæœ¬ |
| é˜¶æ®µ8 | Deep Linké…ç½®ä¸æ–‡æ¡£ | 2å°æ—¶ | é…ç½®æ–‡ä»¶ã€APIæ–‡æ¡£ã€README |
| **æ€»è®¡** | **8ä¸ªé˜¶æ®µ** | **17å°æ—¶** | **å®Œæ•´åˆ†äº«ç³»ç»Ÿv2.3.0** |

---

## å…³é”®æŠ€æœ¯ç‚¹

### 1. é›ªèŠ±IDç®—æ³•å®ç°è¦ç‚¹

**æ—¶é’Ÿå›æ‹¨é—®é¢˜**:
```cpp
if (timestamp < lastTimestamp_) {
    // æ–¹æ¡ˆ1: æŠ›å‡ºå¼‚å¸¸ï¼ˆæ¨èï¼‰
    throw std::runtime_error("Clock moved backwards, refusing to generate id");

    // æ–¹æ¡ˆ2: ç­‰å¾…åˆ°ä¸Šæ¬¡æ—¶é—´æˆ³
    // timestamp = waitUntilTimestamp(lastTimestamp_);
}
```

**æ¯«ç§’å†…åºåˆ—å·è€—å°½**:
```cpp
if (timestamp == lastTimestamp_) {
    sequence_ = (sequence_ + 1) & MAX_SEQUENCE;
    if (sequence_ == 0) {
        // åºåˆ—å·æº¢å‡ºï¼Œç­‰å¾…ä¸‹ä¸€æ¯«ç§’
        timestamp = waitNextMillis(lastTimestamp_);
    }
}
```

**æœºå™¨IDé…ç½®**:
- å•æœºéƒ¨ç½²ï¼šmachineId = 0
- åˆ†å¸ƒå¼éƒ¨ç½²ï¼šä»é…ç½®æ–‡ä»¶è¯»å–æˆ–ä»ç¯å¢ƒå˜é‡è·å–
- å»ºè®®èŒƒå›´ï¼š0-1023ï¼ˆ10ä½ï¼‰

---

### 2. Base62ç¼–ç ä¼˜åŒ–

**å‰å¯¼é›¶å¡«å……**:
```cpp
// ç¡®ä¿çŸ­ç é•¿åº¦å›ºå®šä¸º8ä½
while (result.length() < minLength) {
    result = '0' + result;
}
```

**å­—ç¬¦é›†é¡ºåº**:
```cpp
// 0-9: æ•°å­—ä¼˜å…ˆï¼ˆå€¼0-9ï¼‰
// A-Z: å¤§å†™å­—æ¯ï¼ˆå€¼10-35ï¼‰
// a-z: å°å†™å­—æ¯ï¼ˆå€¼36-61ï¼‰
const char BASE62_CHARS[] = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";
```

**è§£ç å®‰å…¨æ€§**:
```cpp
// æ£€æµ‹éæ³•å­—ç¬¦
if (c < '0' || (c > '9' && c < 'A') || (c > 'Z' && c < 'a') || c > 'z') {
    throw std::invalid_argument("Invalid Base62 character: " + std::string(1, c));
}
```

---

### 3. æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

**è”è¡¨æŸ¥è¯¢ä¼˜åŒ–**:
```sql
-- ä½¿ç”¨GROUP_CONCATåˆå¹¶å›¾ç‰‡æ•°æ®ï¼Œé¿å…N+1æŸ¥è¯¢
SELECT
    p.*,
    u.user_id, u.username, u.real_name, u.avatar_url,
    GROUP_CONCAT(
        CONCAT_WS('|', i.image_id, i.display_order, i.file_url, i.thumbnail_url, i.width, i.height)
        ORDER BY i.display_order
        SEPARATOR ';;'
    ) AS images_data
FROM share_links sl
INNER JOIN posts p ON sl.target_id = p.id
INNER JOIN users u ON p.user_id = u.id
LEFT JOIN images i ON p.id = i.post_id
WHERE sl.short_code = ?
GROUP BY p.id;
```

**ç´¢å¼•ä½¿ç”¨å»ºè®®**:
- `idx_short_code`ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ï¼šç”¨äºçŸ­ç æŸ¥è¯¢ï¼ˆæœ€é«˜é¢‘ï¼‰
- `idx_target`ï¼ˆå¤åˆç´¢å¼•ï¼‰ï¼šç”¨äºå»é‡æŸ¥è¯¢ï¼ˆæ£€æŸ¥å¸–å­æ˜¯å¦å·²æœ‰åˆ†äº«é“¾æ¥ï¼‰
- `idx_creator`ï¼ˆæ™®é€šç´¢å¼•ï¼‰ï¼šç”¨äºæŸ¥è¯¢ç”¨æˆ·åˆ›å»ºçš„åˆ†äº«é“¾æ¥ï¼ˆä½é¢‘ï¼‰
- `idx_create_time`ï¼ˆæ™®é€šç´¢å¼•ï¼‰ï¼šç”¨äºåˆ†é¡µæŸ¥è¯¢å’Œç»Ÿè®¡ï¼ˆä½é¢‘ï¼‰

**è¿‡æœŸé“¾æ¥æ¸…ç†**:
```sql
-- å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œï¼‰
DELETE FROM share_links
WHERE expire_time IS NOT NULL
  AND expire_time < NOW()
LIMIT 1000;
```

---

### 4. JWTè®¤è¯é›†æˆ

**Handlerå±‚éªŒè¯æ¨¡å¼**:
```cpp
// 1. æå–Token
std::string authHeader = req.get_header_value("Authorization");
if (authHeader.empty() || authHeader.substr(0, 7) != "Bearer ") {
    // è¿”å›401é”™è¯¯
}

// 2. éªŒè¯Token
auto jwtManager = std::make_unique<JWTManager>();
auto validation = jwtManager->validateAccessToken(token);
if (!validation.valid) {
    // è¿”å›401é”™è¯¯
}

// 3. ä½¿ç”¨ç”¨æˆ·ID
int64_t userId = validation.userId;
```

**å…¬å¼€æ¥å£å¤„ç†**:
```cpp
// GET /api/v1/share/:code ä¸éœ€è¦è®¤è¯
void ShareHandler::handleResolveShare(const httplib::Request& req, httplib::Response& res) {
    // ç›´æ¥æå–å‚æ•°ï¼Œæ— éœ€éªŒè¯Token
    std::string shortCode = req.path_params.at("code");
    // ...
}
```

---

### 5. å»é‡é€»è¾‘è®¾è®¡

**æ–¹æ¡ˆå¯¹æ¯”**:

| æ–¹æ¡ˆ | ä¼˜åŠ¿ | åŠ£åŠ¿ | æ¨èåº¦ |
|------|------|------|--------|
| æ¯æ¬¡éƒ½åˆ›å»ºæ–°é“¾æ¥ | ç®€å• | æ•°æ®å†—ä½™ï¼ŒçŸ­ç æµªè´¹ | â­ |
| æ£€æŸ¥æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿”å› | èŠ‚çœçŸ­ç ï¼Œé¿å…å†—ä½™ | éœ€è¦é¢å¤–æŸ¥è¯¢ | â­â­â­â­â­ |
| æ¯ä¸ªå¸–å­å›ºå®šä¸€ä¸ªçŸ­ç  | çŸ­ç å¯é¢„æµ‹ | å®‰å…¨æ€§ä½ | â­â­ |

**æ¨èå®ç°**ï¼ˆæ–¹æ¡ˆ2ï¼‰:
```cpp
// åœ¨ShareService::createShareLinkä¸­
auto existingLink = shareLinkRepo_->findByTarget(ShareLink::TargetType::POST, postId);
if (existingLink.has_value()) {
    // å·²å­˜åœ¨ï¼Œè¿”å›ç°æœ‰é“¾æ¥
    return CreateShareLinkResult{
        .success = true,
        .message = "åˆ†äº«é“¾æ¥å·²å­˜åœ¨",
        .short_code = existingLink->getShortCode(),
        .short_link = existingLink->getFullUrl()
    };
}

// ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°é“¾æ¥
std::string shortCode = IdGenerator::generateShareCode();
// ...
```

---

### 6. Deep Link URLç”Ÿæˆè§„åˆ™

**URLæ ¼å¼ç»Ÿä¸€**:
```cpp
Json::Value ShareService::generateDeepLinks(int64_t postId) {
    Json::Value deepLinks;

    // è‡ªå®šä¹‰Schemeï¼ˆå…¼å®¹æ—§ç‰ˆiOS/Android/HarmonyOSï¼‰
    deepLinks["ios"] = "knot://post/" + std::to_string(postId);
    deepLinks["android"] = "knot://post/" + std::to_string(postId);
    deepLinks["harmonyos"] = "knot://post/" + std::to_string(postId);

    // Universal Linkï¼ˆæ¨èï¼‰
    deepLinks["universal_link"] = "https://knot.app/post/" + std::to_string(postId);

    return deepLinks;
}
```

**å®¢æˆ·ç«¯é€‰æ‹©é€»è¾‘**:
- iOS: ä¼˜å…ˆä½¿ç”¨`universal_link`ï¼Œé™çº§åˆ°`ios`
- Android: ä¼˜å…ˆä½¿ç”¨`universal_link`ï¼Œé™çº§åˆ°`android`
- HarmonyOS: ä¼˜å…ˆä½¿ç”¨`universal_link`ï¼Œé™çº§åˆ°`harmonyos`

---

### 7. é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

**HTTPçŠ¶æ€ç è§„èŒƒ**:
```cpp
// 200 OK: æˆåŠŸ
res.status = 200;

// 401 Unauthorized: æœªè®¤è¯æˆ–Tokenæ— æ•ˆ
res.status = 401;

// 404 Not Found: èµ„æºä¸å­˜åœ¨ï¼ˆå¸–å­ä¸å­˜åœ¨ã€çŸ­ç ä¸å­˜åœ¨ï¼‰
res.status = 404;

// 500 Internal Server Error: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼ˆæ•°æ®åº“é”™è¯¯ç­‰ï¼‰
res.status = 500;
```

**ç»Ÿä¸€å“åº”æ ¼å¼**:
```json
{
  "success": true/false,
  "message": "å¯è¯»çš„é”™è¯¯æˆ–æˆåŠŸæ¶ˆæ¯",
  "data": {...} / null,
  "timestamp": 1760020100
}
```

---

### 8. æ€§èƒ½ç›‘æ§è¦ç‚¹

**å…³é”®æŒ‡æ ‡**:
- **çŸ­ç ç”Ÿæˆè€—æ—¶**: åº”å°äº1ms
- **åˆ›å»ºåˆ†äº«é“¾æ¥è€—æ—¶**: åº”å°äº50msï¼ˆåŒ…å«æ•°æ®åº“æ’å…¥ï¼‰
- **è§£æåˆ†äº«é“¾æ¥è€—æ—¶**: åº”å°äº100msï¼ˆåŒ…å«è”è¡¨æŸ¥è¯¢ï¼‰
- **çŸ­ç å”¯ä¸€æ€§ç¢°æ’ç‡**: åº”ä¸º0ï¼ˆé›ªèŠ±IDä¿è¯ï¼‰

**æ—¥å¿—è®°å½•**:
```cpp
Logger::info("Creating share link for post: " + postIdStr);
auto startTime = std::chrono::high_resolution_clock::now();

// æ‰§è¡Œä¸šåŠ¡é€»è¾‘...

auto endTime = std::chrono::high_resolution_clock::now();
auto duration = std::chrono::duration_cast<std::chrono::milliseconds>(endTime - startTime).count();
Logger::info("Share link created in " + std::to_string(duration) + "ms");
```

---

## H5å‰ç«¯é›†æˆæŒ‡å¼•

### æ¦‚è¿°

æœ¬èŠ‚æä¾›å‰ç«¯å¼€å‘è€…æ¥å…¥åˆ†äº«ç³»ç»Ÿçš„å®Œæ•´æŒ‡å¼•ï¼ŒåŒ…æ‹¬APIè°ƒç”¨ã€Deep Linkå”¤èµ·ã€H5é™çº§æ–¹æ¡ˆç­‰ã€‚

---

### 1. åˆ›å»ºåˆ†äº«é“¾æ¥

**åœºæ™¯**: ç”¨æˆ·åœ¨å¸–å­è¯¦æƒ…é¡µç‚¹å‡»"åˆ†äº«"æŒ‰é’®

**APIè°ƒç”¨**:
```javascript
async function createShareLink(postId) {
    const token = localStorage.getItem('access_token');

    const response = await fetch(`https://knot.app/api/v1/posts/${postId}/share`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        }
    });

    const data = await response.json();

    if (data.success) {
        console.log('çŸ­é“¾æ¥:', data.data.short_link);
        // https://knot.app/s/ABC12345

        // æ‰“å¼€åˆ†äº«é¢æ¿
        showSharePanel(data.data.short_link);
    } else {
        console.error('åˆ›å»ºåˆ†äº«é“¾æ¥å¤±è´¥:', data.message);
    }
}
```

**é”™è¯¯å¤„ç†**:
```javascript
if (response.status === 401) {
    // Tokenè¿‡æœŸï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
    window.location.href = '/login';
} else if (response.status === 404) {
    // å¸–å­ä¸å­˜åœ¨
    alert('è¯¥å¸–å­ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤');
} else if (!data.success) {
    // å…¶ä»–é”™è¯¯
    alert('åˆ†äº«å¤±è´¥: ' + data.message);
}
```

---

### 2. åˆ†äº«é¢æ¿å®ç°

**HTMLç»“æ„**:
```html
<div id="share-panel" class="share-panel">
    <div class="share-header">
        <h3>åˆ†äº«åˆ°</h3>
        <button class="close-btn" onclick="closeSharePanel()">Ã—</button>
    </div>

    <div class="share-platforms">
        <button class="platform-btn" onclick="shareToWechat()">
            <img src="/icons/wechat.png" alt="å¾®ä¿¡">
            <span>å¾®ä¿¡</span>
        </button>

        <button class="platform-btn" onclick="shareToWeibo()">
            <img src="/icons/weibo.png" alt="å¾®åš">
            <span>å¾®åš</span>
        </button>

        <button class="platform-btn" onclick="shareToQQ()">
            <img src="/icons/qq.png" alt="QQ">
            <span>QQ</span>
        </button>

        <button class="platform-btn" onclick="copyLink()">
            <img src="/icons/link.png" alt="å¤åˆ¶é“¾æ¥">
            <span>å¤åˆ¶é“¾æ¥</span>
        </button>
    </div>

    <div class="share-link">
        <input type="text" id="share-link-input" readonly value="https://knot.app/s/ABC12345">
        <button onclick="copyLink()">å¤åˆ¶</button>
    </div>
</div>
```

**JavaScripté€»è¾‘**:
```javascript
function showSharePanel(shortLink) {
    document.getElementById('share-link-input').value = shortLink;
    document.getElementById('share-panel').style.display = 'block';
}

function closeSharePanel() {
    document.getElementById('share-panel').style.display = 'none';
}

function copyLink() {
    const input = document.getElementById('share-link-input');
    input.select();
    document.execCommand('copy');
    alert('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
}
```

---

### 3. ç¬¬ä¸‰æ–¹å¹³å°åˆ†äº«

**å¾®ä¿¡åˆ†äº«**ï¼ˆéœ€è¦å¾®ä¿¡JS-SDKï¼‰:
```javascript
function shareToWechat() {
    const shortLink = document.getElementById('share-link-input').value;

    wx.ready(function() {
        wx.updateAppMessageShareData({
            title: 'åˆ†äº«æ ‡é¢˜',
            desc: 'åˆ†äº«æè¿°',
            link: shortLink,
            imgUrl: 'https://knot.app/share-cover.jpg',
            success: function() {
                console.log('åˆ†äº«æˆåŠŸ');
            }
        });
    });
}
```

**å¾®åšåˆ†äº«**ï¼ˆä½¿ç”¨å¾®åšåˆ†äº«æŒ‰é’®ï¼‰:
```javascript
function shareToWeibo() {
    const shortLink = document.getElementById('share-link-input').value;
    const title = encodeURIComponent('åˆ†äº«æ ‡é¢˜');
    const weiboUrl = `https://service.weibo.com/share/share.php?url=${encodeURIComponent(shortLink)}&title=${title}`;
    window.open(weiboUrl, '_blank');
}
```

**QQåˆ†äº«**ï¼ˆä½¿ç”¨QQåˆ†äº«APIï¼‰:
```javascript
function shareToQQ() {
    const shortLink = document.getElementById('share-link-input').value;
    const title = encodeURIComponent('åˆ†äº«æ ‡é¢˜');
    const qqUrl = `https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(shortLink)}&title=${title}`;
    window.open(qqUrl, '_blank');
}
```

---

### 4. çŸ­é“¾æ¥è§£æé¡µï¼ˆH5ï¼‰

**é¡µé¢URL**: `https://knot.app/s/:code`

**å®Œæ•´å®ç°**:
```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knot - å¸–å­åˆ†äº«</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .loading {
            text-align: center;
            padding: 50px 0;
        }

        .post-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            max-width: 600px;
            margin: 0 auto;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .post-images {
            width: 100%;
            position: relative;
        }

        .post-images img {
            width: 100%;
            display: block;
        }

        .post-content {
            padding: 20px;
        }

        .post-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .post-description {
            color: #666;
            line-height: 1.6;
        }

        .post-user {
            display: flex;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .user-name {
            font-weight: bold;
        }

        .download-tip {
            background: #007AFF;
            color: white;
            text-align: center;
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
        }

        .download-btn {
            background: white;
            color: #007AFF;
            border: none;
            padding: 10px 30px;
            border-radius: 20px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <p>æ­£åœ¨åŠ è½½...</p>
    </div>

    <div id="post-container" style="display:none;"></div>

    <div id="download-tip" class="download-tip" style="display:none;">
        <p>åœ¨Knotåº”ç”¨ä¸­æŸ¥çœ‹å®Œæ•´å†…å®¹</p>
        <button class="download-btn" onclick="downloadApp()">ä¸‹è½½åº”ç”¨</button>
    </div>

    <script>
        // ä»URLè·å–çŸ­ç 
        const pathParts = window.location.pathname.split('/');
        const shortCode = pathParts[pathParts.length - 1];

        // å°è¯•å”¤èµ·åº”ç”¨
        tryOpenApp(shortCode);

        // åŠ è½½å¸–å­æ•°æ®
        loadPostData(shortCode);

        function tryOpenApp(shortCode) {
            const userAgent = navigator.userAgent.toLowerCase();
            const universalLink = `https://knot.app/s/${shortCode}`;

            if (userAgent.indexOf('harmonyos') !== -1) {
                // HarmonyOS: ä¼˜å…ˆApp Linking
                setTimeout(() => {
                    window.location.href = `knot://share/${shortCode}`;
                }, 500);
            } else if (userAgent.indexOf('iphone') !== -1 || userAgent.indexOf('ipad') !== -1) {
                // iOS: Universal Linksè‡ªåŠ¨å¤„ç†
            } else if (userAgent.indexOf('android') !== -1) {
                // Android: App Linksè‡ªåŠ¨å¤„ç†ï¼Œé™çº§Intent
                setTimeout(() => {
                    window.location.href = `intent://share/${shortCode}#Intent;scheme=knot;package=com.knot.app;end`;
                }, 500);
            }

            // 2ç§’åæ˜¾ç¤ºä¸‹è½½æç¤º
            setTimeout(() => {
                if (!document.hidden) {
                    document.getElementById('download-tip').style.display = 'block';
                }
            }, 2000);
        }

        async function loadPostData(shortCode) {
            try {
                const response = await fetch(`https://knot.app/api/v1/share/${shortCode}`);
                const data = await response.json();

                document.getElementById('loading').style.display = 'none';

                if (data.success) {
                    renderPost(data.data.post);
                    document.getElementById('post-container').style.display = 'block';
                } else {
                    document.getElementById('post-container').innerHTML =
                        '<p style="text-align:center;color:#999;">è¯¥åˆ†äº«é“¾æ¥ä¸å­˜åœ¨æˆ–å·²è¿‡æœŸ</p>';
                    document.getElementById('post-container').style.display = 'block';
                }
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                document.getElementById('loading').innerHTML = '<p style="color:red;">åŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</p>';
            }
        }

        function renderPost(post) {
            const container = document.getElementById('post-container');

            // æ¸²æŸ“ç¬¬ä¸€å¼ å›¾ç‰‡
            const firstImage = post.images[0];

            const html = `
                <div class="post-card">
                    <div class="post-images">
                        <img src="https://knot.app${firstImage.file_url}" alt="${post.title}">
                    </div>
                    <div class="post-content">
                        <div class="post-title">${post.title || 'æ— æ ‡é¢˜'}</div>
                        <div class="post-description">${post.description}</div>
                        <div class="post-user">
                            <img class="user-avatar" src="https://knot.app${post.user.avatar_url}" alt="${post.user.username}">
                            <div>
                                <div class="user-name">${post.user.real_name || post.user.username}</div>
                                <div style="color:#999;font-size:12px;">${formatTime(post.create_time)}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = html;
        }

        function formatTime(timeStr) {
            // ç®€å•çš„æ—¶é—´æ ¼å¼åŒ–
            return timeStr.split(' ')[0];
        }

        function downloadApp() {
            // è·³è½¬åˆ°åº”ç”¨ä¸‹è½½é¡µ
            window.location.href = 'https://knot.app/download';
        }
    </script>
</body>
</html>
```

---

### 5. ç§»åŠ¨ç«¯é€‚é…

**å“åº”å¼CSS**:
```css
@media (max-width: 768px) {
    .post-card {
        border-radius: 0;
        margin: -20px;
    }

    .share-panel {
        bottom: 0;
        left: 0;
        right: 0;
        border-radius: 20px 20px 0 0;
    }
}
```

**è§¦æ‘¸ä¼˜åŒ–**:
```css
.platform-btn, .download-btn {
    -webkit-tap-highlight-color: rgba(0,0,0,0.1);
    user-select: none;
}

.platform-btn:active {
    transform: scale(0.95);
}
```

---

### 6. SEOä¼˜åŒ–

**Metaæ ‡ç­¾**ï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰:
```html
<head>
    <title>{{ post.title }} - Knot</title>
    <meta name="description" content="{{ post.description }}">

    <!-- Open Graph (Facebook/å¾®ä¿¡) -->
    <meta property="og:title" content="{{ post.title }}">
    <meta property="og:description" content="{{ post.description }}">
    <meta property="og:image" content="https://knot.app{{ post.images[0].file_url }}">
    <meta property="og:url" content="https://knot.app/s/{{ shortCode }}">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ post.title }}">
    <meta name="twitter:description" content="{{ post.description }}">
    <meta name="twitter:image" content="https://knot.app{{ post.images[0].file_url }}">
</head>
```

---

## é£é™©å’Œæ³¨æ„äº‹é¡¹

### 1. å®‰å…¨é£é™©

#### é£é™©1.1: çŸ­ç è¢«éå†æ”»å‡»

**æè¿°**: æ”»å‡»è€…å¯èƒ½å°è¯•éå†æ‰€æœ‰å¯èƒ½çš„çŸ­ç ï¼ˆå¦‚ä»00000000åˆ°zzzzzzzzï¼‰æ¥çˆ¬å–å¸–å­æ•°æ®ã€‚

**å½±å“**:
- ç”¨æˆ·éšç§æ³„éœ²
- æœåŠ¡å™¨èµ„æºæ¶ˆè€—

**ç¼“è§£æªæ–½**:
- âœ… **å·²é‡‡å–**: ä½¿ç”¨é›ªèŠ±ID + Base62ç¼–ç ï¼ŒçŸ­ç ä¸å¯é¢„æµ‹
- âœ… **å·²é‡‡å–**: 8ä½Base62ç¼–ç æä¾›62^8 â‰ˆ 218ä¸‡äº¿ç§å¯èƒ½ï¼Œéå†æˆæœ¬æé«˜
- ğŸ”§ **å»ºè®®**: æ·»åŠ APIè®¿é—®é¢‘ç‡é™åˆ¶ï¼ˆRate Limitingï¼‰
  ```cpp
  // ç¤ºä¾‹ï¼šé™åˆ¶å•IPæ¯åˆ†é’Ÿæœ€å¤šè¯·æ±‚100æ¬¡
  if (getRequestCount(clientIP) > 100) {
      res.status = 429; // Too Many Requests
      return;
  }
  ```

---

#### é£é™©1.2: JWT Tokenæ³„éœ²

**æè¿°**: å¦‚æœç”¨æˆ·çš„JWT Tokenè¢«çªƒå–ï¼Œæ”»å‡»è€…å¯ä»¥å†’å……ç”¨æˆ·åˆ›å»ºåˆ†äº«é“¾æ¥ã€‚

**å½±å“**:
- å†’å……ç”¨æˆ·è¡Œä¸º
- æ•°æ®æ³„éœ²

**ç¼“è§£æªæ–½**:
- âœ… **å·²é‡‡å–**: ä½¿ç”¨HTTPSä¼ è¾“ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»
- âœ… **å·²é‡‡å–**: Access Tokenæœ‰æ•ˆæœŸè®¾ç½®ä¸º1å°æ—¶
- ğŸ”§ **å»ºè®®**: æ·»åŠ è®¾å¤‡æŒ‡çº¹éªŒè¯
- ğŸ”§ **å»ºè®®**: è®°å½•åˆ›å»ºè€…IPåœ°å€ï¼Œç”¨äºå¼‚å¸¸æ£€æµ‹

---

### 2. æ€§èƒ½é£é™©

#### é£é™©2.1: è”è¡¨æŸ¥è¯¢æ€§èƒ½ç“¶é¢ˆ

**æè¿°**: è§£æåˆ†äº«é“¾æ¥æ—¶éœ€è¦è”è¡¨æŸ¥è¯¢postsã€imagesã€usersä¸‰å¼ è¡¨ï¼Œå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚

**å½±å“**:
- APIå“åº”æ—¶é—´å¢åŠ 
- æ•°æ®åº“è´Ÿè½½å‡é«˜

**ç¼“è§£æªæ–½**:
- âœ… **å·²é‡‡å–**: ä½¿ç”¨GROUP_CONCATåˆå¹¶å›¾ç‰‡æ•°æ®ï¼Œå‡å°‘æŸ¥è¯¢æ¬¡æ•°
- âœ… **å·²é‡‡å–**: åœ¨short_codeå­—æ®µä¸Šæ·»åŠ å”¯ä¸€ç´¢å¼•
- ğŸ”§ **å»ºè®®**: æ·»åŠ Redisç¼“å­˜å±‚
  ```cpp
  // ä¼ªä»£ç 
  std::string cacheKey = "share_link:" + shortCode;
  auto cached = redis->get(cacheKey);
  if (cached.has_value()) {
      return cached.value();
  }

  // æŸ¥è¯¢æ•°æ®åº“
  auto result = queryDatabase(shortCode);

  // ç¼“å­˜ç»“æœï¼ˆTTL: 10åˆ†é’Ÿï¼‰
  redis->setex(cacheKey, 600, result);
  ```

---

#### é£é™©2.2: é›ªèŠ±IDç”Ÿæˆå™¨å¹¶å‘é—®é¢˜

**æè¿°**: é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œé›ªèŠ±IDç”Ÿæˆå™¨çš„é”ç«äº‰å¯èƒ½å¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚

**å½±å“**:
- çŸ­ç ç”Ÿæˆè€—æ—¶å¢åŠ 
- æœåŠ¡å™¨CPUä½¿ç”¨ç‡ä¸Šå‡

**ç¼“è§£æªæ–½**:
- âœ… **å·²é‡‡å–**: ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œé¿å…é‡å¤åˆå§‹åŒ–
- ğŸ”§ **å»ºè®®**: å®ç°æ— é”é›ªèŠ±IDç”Ÿæˆå™¨ï¼ˆä½¿ç”¨åŸå­æ“ä½œï¼‰
- ğŸ”§ **å»ºè®®**: é¢„ç”ŸæˆçŸ­ç æ± ï¼ˆæ‰¹é‡ç”Ÿæˆå¹¶ç¼“å­˜ï¼‰

---

### 3. ä¸šåŠ¡é£é™©

#### é£é™©3.1: åˆ é™¤å¸–å­ååˆ†äº«é“¾æ¥å¤±æ•ˆ

**æè¿°**: å¸–å­è¢«åˆ é™¤åï¼Œç›¸å…³çš„åˆ†äº«é“¾æ¥ä¼šå¤±æ•ˆï¼Œç”¨æˆ·ç‚¹å‡»é“¾æ¥åçœ‹åˆ°404é”™è¯¯ã€‚

**å½±å“**:
- ç”¨æˆ·ä½“éªŒå·®
- å·²åˆ†äº«é“¾æ¥æ— æ³•è®¿é—®

**ç¼“è§£æªæ–½**:
- âœ… **å·²é‡‡å–**: å¤–é”®çº§è”åˆ é™¤ï¼ˆON DELETE CASCADEï¼‰ï¼Œè‡ªåŠ¨åˆ é™¤åˆ†äº«é“¾æ¥
- ğŸ”§ **å»ºè®®**: åœ¨H5é¡µé¢æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼š"è¯¥å¸–å­å·²è¢«åˆ é™¤"
- ğŸ”§ **å»ºè®®**: æä¾›"æ¨èå…¶ä»–å†…å®¹"åŠŸèƒ½

---

#### é£é™©3.2: è¿‡æœŸé“¾æ¥å¤„ç†ä¸åŠæ—¶

**æè¿°**: è¿‡æœŸé“¾æ¥æœªåŠæ—¶æ¸…ç†ï¼Œå ç”¨æ•°æ®åº“ç©ºé—´ã€‚

**å½±å“**:
- æ•°æ®åº“ç©ºé—´æµªè´¹
- æŸ¥è¯¢æ€§èƒ½ä¸‹é™

**ç¼“è§£æªæ–½**:
- âœ… **å·²å®ç°**: deleteExpired()æ–¹æ³•
- ğŸ”§ **å»ºè®®**: é…ç½®å®šæ—¶ä»»åŠ¡ï¼ˆcronï¼‰æ¯å¤©å‡Œæ™¨æ‰§è¡Œæ¸…ç†
  ```bash
  # /etc/crontab
  0 3 * * * /usr/bin/mysql -u root -p'password' -e "DELETE FROM share_links WHERE expire_time < NOW() LIMIT 1000"
  ```

---

### 4. å…¼å®¹æ€§é£é™©

#### é£é™©4.1: Deep Linkåœ¨ä½ç‰ˆæœ¬ç³»ç»Ÿå¤±æ•ˆ

**æè¿°**: iOS 9ä»¥ä¸‹ã€Android 6ä»¥ä¸‹ã€HarmonyOS 5.0ä»¥ä¸‹ä¸æ”¯æŒUniversal Links/App Linksã€‚

**å½±å“**:
- æ—§ç‰ˆæœ¬ç”¨æˆ·æ— æ³•å”¤èµ·åº”ç”¨
- ç”¨æˆ·ä½“éªŒå‰²è£‚

**ç¼“è§£æªæ–½**:
- âœ… **å·²é‡‡å–**: æä¾›è‡ªå®šä¹‰Schemeé™çº§æ–¹æ¡ˆï¼ˆknot://ï¼‰
- âœ… **å·²é‡‡å–**: H5é¡µé¢æ£€æµ‹ç³»ç»Ÿç‰ˆæœ¬å¹¶æç¤ºå‡çº§
- ğŸ”§ **å»ºè®®**: ç»Ÿè®¡å„å¹³å°ç‰ˆæœ¬åˆ†å¸ƒï¼Œå†³å®šæ˜¯å¦æ”¾å¼ƒä½ç‰ˆæœ¬æ”¯æŒ

---

#### é£é™©4.2: åŸŸåé…ç½®æ–‡ä»¶ç¼“å­˜é—®é¢˜

**æè¿°**: iOSå’ŒAndroidç³»ç»Ÿä¼šç¼“å­˜apple-app-site-associationå’Œassetlinks.jsonæ–‡ä»¶ï¼Œæ›´æ–°åä¸ç”Ÿæ•ˆã€‚

**å½±å“**:
- Deep Linké…ç½®æ›´æ–°å»¶è¿Ÿ
- ç”¨æˆ·æ— æ³•å”¤èµ·æ–°ç‰ˆæœ¬åº”ç”¨

**ç¼“è§£æªæ–½**:
- ğŸ”§ **å»ºè®®**: é…ç½®CDNç¼“å­˜ç­–ç•¥ï¼ˆCache-Control: max-age=3600ï¼‰
- ğŸ”§ **å»ºè®®**: æ›´æ–°é…ç½®æ–‡ä»¶åï¼Œé€šçŸ¥ç”¨æˆ·é‡å¯åº”ç”¨æˆ–é‡æ–°å®‰è£…

---

### 5. è¿ç»´é£é™©

#### é£é™©5.1: Nginxé…ç½®é”™è¯¯å¯¼è‡´Deep Linkå¤±æ•ˆ

**æè¿°**: .well-knownç›®å½•é…ç½®é”™è¯¯ï¼Œå¯¼è‡´åŸŸåéªŒè¯å¤±è´¥ã€‚

**å½±å“**:
- Deep Linkæ— æ³•æ­£å¸¸å·¥ä½œ
- ç”¨æˆ·ç‚¹å‡»é“¾æ¥åæ‰“å¼€æµè§ˆå™¨è€Œéåº”ç”¨

**ç¼“è§£æªæ–½**:
- âœ… **æ–‡æ¡£å·²æä¾›**: å®Œæ•´çš„Nginxé…ç½®ç¤ºä¾‹
- ğŸ”§ **å»ºè®®**: é…ç½®ç›‘æ§å‘Šè­¦ï¼Œå®šæœŸæ£€æŸ¥é…ç½®æ–‡ä»¶å¯è®¿é—®æ€§
  ```bash
  # ç›‘æ§è„šæœ¬
  curl -I https://knot.app/.well-known/apple-app-site-association | grep "200 OK"
  ```

---

#### é£é™©5.2: æ•°æ®åº“è¿ç§»å¤±è´¥

**æè¿°**: æ‰§è¡ŒALTER TABLEæˆ–DROP TABLEæ—¶å¯èƒ½å› ä¸ºå¤–é”®çº¦æŸå¤±è´¥ã€‚

**å½±å“**:
- æ•°æ®åº“è¿ç§»ä¸­æ–­
- ç”Ÿäº§ç¯å¢ƒæ•…éšœ

**ç¼“è§£æªæ–½**:
- ğŸ”§ **å»ºè®®**: è¿ç§»å‰å¤‡ä»½æ•°æ®åº“
  ```bash
  mysqldump -u root -p knot_image_sharing > backup_$(date +%Y%m%d_%H%M%S).sql
  ```
- ğŸ”§ **å»ºè®®**: åœ¨æµ‹è¯•ç¯å¢ƒå…ˆæ‰§è¡Œè¿ç§»ï¼Œç¡®è®¤æ— è¯¯åå†ä¸Šç”Ÿäº§

---

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶

| åºå· | åŠŸèƒ½ç‚¹ | éªŒæ”¶æ ‡å‡† | æµ‹è¯•æ–¹æ³• |
|------|--------|---------|---------|
| 1 | åˆ›å»ºåˆ†äº«é“¾æ¥ | æˆåŠŸåˆ›å»ºçŸ­é“¾æ¥ï¼Œè¿”å›8ä½çŸ­ç  | Apifoxæµ‹è¯•POST /api/v1/posts/:post_id/share |
| 2 | çŸ­ç å”¯ä¸€æ€§ | æ¯æ¬¡ç”Ÿæˆçš„çŸ­ç ä¸é‡å¤ | å¹¶å‘åˆ›å»º100ä¸ªé“¾æ¥ï¼Œæ£€æŸ¥çŸ­ç æ˜¯å¦å”¯ä¸€ |
| 3 | å»é‡é€»è¾‘ | åŒä¸€å¸–å­å¤šæ¬¡åˆ›å»ºè¿”å›ç›¸åŒçŸ­é“¾æ¥ | å¯¹åŒä¸€å¸–å­è°ƒç”¨2æ¬¡APIï¼ŒéªŒè¯short_codeç›¸åŒ |
| 4 | è§£æåˆ†äº«é“¾æ¥ | é€šè¿‡çŸ­ç æ­£ç¡®è·å–å¸–å­å®Œæ•´ä¿¡æ¯ | Apifoxæµ‹è¯•GET /api/v1/share/:code |
| 5 | è”è¡¨æŸ¥è¯¢ | è¿”å›çš„å¸–å­æ•°æ®åŒ…å«å›¾ç‰‡å’Œç”¨æˆ·ä¿¡æ¯ | æ£€æŸ¥å“åº”JSONä¸­æ˜¯å¦åŒ…å«imageså’Œuserå­—æ®µ |
| 6 | JWTè®¤è¯ | åˆ›å»ºé“¾æ¥éœ€è¦æœ‰æ•ˆToken | ä½¿ç”¨æ— æ•ˆTokenè°ƒç”¨APIï¼ŒéªŒè¯è¿”å›401 |
| 7 | å…¬å¼€æ¥å£ | è§£æé“¾æ¥æ— éœ€Token | ä¸å¸¦Authorizationå¤´è°ƒç”¨GET /api/v1/share/:code |
| 8 | è¿‡æœŸé“¾æ¥ | expire_timeå°äºå½“å‰æ—¶é—´çš„é“¾æ¥æ— æ³•è®¿é—® | æ‰‹åŠ¨ä¿®æ”¹æ•°æ®åº“è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ŒéªŒè¯è¿”å›404 |
| 9 | å¸–å­åˆ é™¤çº§è” | åˆ é™¤å¸–å­åï¼Œç›¸å…³åˆ†äº«é“¾æ¥è‡ªåŠ¨åˆ é™¤ | åˆ é™¤å¸–å­ï¼ŒæŸ¥è¯¢share_linksè¡¨éªŒè¯è®°å½•å·²åˆ é™¤ |
| 10 | Deep Link URLs | è¿”å›ios/android/harmonyos/universal_linkå››ç§URL | æ£€æŸ¥å“åº”JSONçš„deep_linkå­—æ®µ |

---

### æ€§èƒ½éªŒæ”¶

| åºå· | æ€§èƒ½æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|------|---------|--------|---------|
| 1 | çŸ­ç ç”Ÿæˆè€—æ—¶ | <1ms | å•å…ƒæµ‹è¯•ï¼Œè®°å½•generateShareCode()æ‰§è¡Œæ—¶é—´ |
| 2 | åˆ›å»ºåˆ†äº«é“¾æ¥å“åº”æ—¶é—´ | <50ms | Apifoxå‹æµ‹ï¼ŒP95å“åº”æ—¶é—´ |
| 3 | è§£æåˆ†äº«é“¾æ¥å“åº”æ—¶é—´ | <100ms | Apifoxå‹æµ‹ï¼ŒP95å“åº”æ—¶é—´ |
| 4 | å¹¶å‘å¤„ç†èƒ½åŠ› | 100 TPS | ä½¿ç”¨test_concurrent.shæµ‹è¯• |
| 5 | æ•°æ®åº“è¿æ¥æ± åˆ©ç”¨ç‡ | <80% | ç›‘æ§è¿æ¥æ± çŠ¶æ€ |
| 6 | çŸ­ç ç¢°æ’ç‡ | 0% | ç”Ÿæˆ100ä¸‡ä¸ªçŸ­ç ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é‡å¤ |

---

### å®‰å…¨éªŒæ”¶

| åºå· | å®‰å…¨é¡¹ | éªŒæ”¶æ ‡å‡† | æµ‹è¯•æ–¹æ³• |
|------|--------|---------|---------|
| 1 | SQLæ³¨å…¥é˜²æŠ¤ | æ‰€æœ‰æŸ¥è¯¢ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥ | ä»£ç å®¡æŸ¥ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å­—ç¬¦ä¸²æ‹¼æ¥SQL |
| 2 | JWTéªŒè¯ | æ— æ•ˆTokenæ— æ³•åˆ›å»ºåˆ†äº«é“¾æ¥ | ä½¿ç”¨ä¼ªé€ Tokenè°ƒç”¨APIï¼ŒéªŒè¯è¿”å›401 |
| 3 | çŸ­ç ä¸å¯é¢„æµ‹ | çŸ­ç æ— è§„å¾‹ï¼Œæ— æ³•é€šè¿‡ç®—æ³•æ¨æµ‹ | ç”Ÿæˆ100ä¸ªçŸ­ç ï¼Œåˆ†ææ˜¯å¦æœ‰è§„å¾‹ |
| 4 | HTTPSä¼ è¾“ | Deep Linké…ç½®æ–‡ä»¶å¿…é¡»é€šè¿‡HTTPSè®¿é—® | ä½¿ç”¨http://è®¿é—®é…ç½®æ–‡ä»¶ï¼ŒéªŒè¯è¢«é‡å®šå‘åˆ°https:// |
| 5 | å¤–é”®çº¦æŸ | æ— æ³•æ’å…¥ä¸å­˜åœ¨çš„target_id | å°è¯•æ’å…¥ä¸å­˜åœ¨çš„å¸–å­IDï¼ŒéªŒè¯æŠ¥é”™ |

---

### æ–‡æ¡£éªŒæ”¶

| åºå· | æ–‡æ¡£ | éªŒæ”¶æ ‡å‡† | æ£€æŸ¥æ–¹æ³• |
|------|------|---------|---------|
| 1 | APIæ–‡æ¡£ | [000]APIæ–‡æ¡£.mdåŒ…å«2ä¸ªæ–°å¢API | æ‰“å¼€æ–‡æ¡£ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰"åˆ†äº«ç³»ç»ŸAPI"ç« èŠ‚ |
| 2 | æ•°æ®åº“æ–‡æ¡£ | [001]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.mdåŒ…å«share_linksè¡¨è¯´æ˜ | æ£€æŸ¥è¡¨ç»“æ„ã€å­—æ®µè¯´æ˜ã€ç´¢å¼•è¯´æ˜ |
| 3 | READMEæ›´æ–° | v2.3.0åŠŸèƒ½åˆ—è¡¨å·²æ›´æ–° | æ£€æŸ¥"å½“å‰çŠ¶æ€"å’Œ"APIç‰ˆæœ¬å†å²" |
| 4 | CLAUDE.mdæ›´æ–° | åŒ…å«v2.3.0ç‰ˆæœ¬æ¡ç›® | æ£€æŸ¥"APIç‰ˆæœ¬å†å²"ç« èŠ‚ |
| 5 | å®æ–½è®¡åˆ’ | [109]æ–‡æ¡£å†…å®¹å®Œæ•´ | æœ¬æ–‡æ¡£ |

---

### Deep Linké…ç½®éªŒæ”¶

| åºå· | å¹³å° | éªŒæ”¶æ ‡å‡† | æµ‹è¯•æ–¹æ³• |
|------|------|---------|---------|
| 1 | iOS | apple-app-site-associationå¯è®¿é—® | curl https://knot.app/.well-known/apple-app-site-association |
| 2 | Android | assetlinks.jsonå¯è®¿é—® | curl https://knot.app/.well-known/assetlinks.json |
| 3 | HarmonyOS | applinking.jsonå¯è®¿é—® | curl https://knot.app/.well-known/applinking.json |
| 4 | Content-Type | ä¸‰ä¸ªæ–‡ä»¶Content-Typeå‡ä¸ºapplication/json | æ£€æŸ¥HTTPå“åº”å¤´ |
| 5 | Nginxé…ç½® | locationè§„åˆ™ç”Ÿæ•ˆ | è®¿é—®æ–‡ä»¶åæ£€æŸ¥Nginxæ—¥å¿— |

---

### é›†æˆæµ‹è¯•éªŒæ”¶

**æµ‹è¯•åœºæ™¯1: å®Œæ•´åˆ†äº«æµç¨‹**
1. ç”¨æˆ·ç™»å½•è·å–Token
2. åˆ›å»ºå¸–å­
3. åˆ›å»ºåˆ†äº«é“¾æ¥
4. é€šè¿‡çŸ­é“¾æ¥è®¿é—®H5é¡µé¢
5. H5é¡µé¢æ­£ç¡®æ˜¾ç¤ºå¸–å­ä¿¡æ¯
6. ç‚¹å‡»"åœ¨åº”ç”¨ä¸­æ‰“å¼€"ï¼Œå°è¯•å”¤èµ·åº”ç”¨

**é¢„æœŸç»“æœ**: æµç¨‹é¡ºç•…ï¼Œæ— é”™è¯¯

---

**æµ‹è¯•åœºæ™¯2: å¹¶å‘åˆ›å»ºåˆ†äº«é“¾æ¥**
1. ä½¿ç”¨test_concurrent.shåŒæ—¶åˆ›å»º100ä¸ªåˆ†äº«é“¾æ¥
2. æ£€æŸ¥æ‰€æœ‰çŸ­ç æ˜¯å¦å”¯ä¸€
3. æ£€æŸ¥æ•°æ®åº“share_linksè¡¨è®°å½•æ•°

**é¢„æœŸç»“æœ**: 100ä¸ªè¯·æ±‚å…¨éƒ¨æˆåŠŸï¼ŒçŸ­ç æ— é‡å¤

---

**æµ‹è¯•åœºæ™¯3: è¾¹ç•Œæ¡ä»¶æµ‹è¯•**
1. åˆ›å»ºåˆ†äº«é“¾æ¥åç«‹å³åˆ é™¤å¸–å­
2. å°è¯•è®¿é—®åˆšæ‰çš„çŸ­é“¾æ¥
3. åˆ›å»ºè¿‡æœŸæ—¶é—´ä¸º1ç§’åçš„ä¸´æ—¶é“¾æ¥
4. ç­‰å¾…2ç§’åè®¿é—®è¯¥é“¾æ¥

**é¢„æœŸç»“æœ**:
- åœºæ™¯1è¿”å›404"ç›®æ ‡å¸–å­ä¸å­˜åœ¨"
- åœºæ™¯3è¿”å›404"åˆ†äº«é“¾æ¥å·²è¿‡æœŸ"

---

## åç»­ä¼˜åŒ–æ–¹å‘

### 1. ç»Ÿè®¡åŠŸèƒ½ï¼ˆv2.4.0ï¼‰

**ç›®æ ‡**: æ·»åŠ åˆ†äº«é“¾æ¥è®¿é—®ç»Ÿè®¡

**æ–°å¢å­—æ®µ**:
```sql
ALTER TABLE share_links
ADD COLUMN visit_count INT NOT NULL DEFAULT 0 COMMENT 'è®¿é—®æ¬¡æ•°',
ADD COLUMN install_count INT NOT NULL DEFAULT 0 COMMENT 'å®‰è£…æ¬¡æ•°',
ADD COLUMN share_platform VARCHAR(20) NULL COMMENT 'åˆ†äº«å¹³å°(wechat/weibo/qq)',
ADD COLUMN last_visit_time TIMESTAMP NULL COMMENT 'æœ€åè®¿é—®æ—¶é—´';
```

**æ–°å¢API**:
- POST /api/v1/share/:code/visit - è®°å½•è®¿é—®äº‹ä»¶
- GET /api/v1/share/:code/stats - è·å–ç»Ÿè®¡æ•°æ®

**åº”ç”¨åœºæ™¯**:
- å†…å®¹çƒ­åº¦åˆ†æ
- åˆ›ä½œè€…æ•°æ®çœ‹æ¿
- è¥é”€æ•ˆæœè¯„ä¼°

---

### 2. åˆ†äº«å¤šç§å¯¹è±¡ç±»å‹ï¼ˆv2.5.0ï¼‰

**ç›®æ ‡**: æ”¯æŒåˆ†äº«ç”¨æˆ·ä¸»é¡µå’Œæ ‡ç­¾é¡µ

**æ•°æ®åº“å˜æ›´**:
```sql
ALTER TABLE share_links
MODIFY COLUMN target_type ENUM('POST', 'USER', 'TAG') NOT NULL DEFAULT 'POST';
```

**æ–°å¢API**:
- POST /api/v1/users/:user_id/share - åˆ›å»ºç”¨æˆ·ä¸»é¡µåˆ†äº«é“¾æ¥
- POST /api/v1/tags/:tag_name/share - åˆ›å»ºæ ‡ç­¾é¡µåˆ†äº«é“¾æ¥
- GET /api/v1/share/:code - æ‰©å±•æ”¯æŒè§£æUSER/TAGç±»å‹

**Deep Linkæ ¼å¼**:
- ç”¨æˆ·ä¸»é¡µï¼š`https://knot.app/user/12345` â†’ `knot://user/12345`
- æ ‡ç­¾é¡µï¼š`https://knot.app/tag/ç¾é£Ÿ` â†’ `knot://tag/ç¾é£Ÿ`

---

### 3. äºŒç»´ç ç”Ÿæˆï¼ˆv2.6.0ï¼‰

**ç›®æ ‡**: ä¸ºåˆ†äº«é“¾æ¥ç”ŸæˆäºŒç»´ç 

**æŠ€æœ¯æ–¹æ¡ˆ**:
- ä½¿ç”¨qrencodeåº“ç”ŸæˆäºŒç»´ç å›¾ç‰‡
- ç¼“å­˜ç”Ÿæˆçš„äºŒç»´ç ï¼ˆRedis/æœ¬åœ°æ–‡ä»¶ï¼‰
- æä¾›SVGå’ŒPNGä¸¤ç§æ ¼å¼

**æ–°å¢API**:
- GET /api/v1/share/:code/qrcode - è·å–äºŒç»´ç å›¾ç‰‡
- GET /api/v1/share/:code/qrcode.svg - è·å–SVGæ ¼å¼äºŒç»´ç 

**ç¤ºä¾‹**:
```cpp
#include <qrencode.h>

std::string generateQRCode(const std::string& url) {
    QRcode* qr = QRcode_encodeString(url.c_str(), 0, QR_ECLEVEL_L, QR_MODE_8, 1);
    // å°†qr->dataè½¬æ¢ä¸ºPNGå›¾ç‰‡
    // ...
    QRcode_free(qr);
    return pngBase64;
}
```

---

### 4. åˆ†äº«æµ·æŠ¥ç”Ÿæˆï¼ˆv2.7.0ï¼‰

**ç›®æ ‡**: ç”Ÿæˆå¸¦æœ‰å¸–å­å›¾ç‰‡å’ŒäºŒç»´ç çš„ç²¾ç¾æµ·æŠ¥

**æŠ€æœ¯æ–¹æ¡ˆ**:
- ä½¿ç”¨ImageMagickåº“åˆæˆå›¾ç‰‡
- æµ·æŠ¥æ¨¡æ¿ï¼šå¸–å­å›¾ç‰‡ + æ ‡é¢˜ + ç”¨æˆ·å¤´åƒ + äºŒç»´ç 
- ç¼“å­˜ç”Ÿæˆçš„æµ·æŠ¥ï¼ˆCDNï¼‰

**æ–°å¢API**:
- GET /api/v1/share/:code/poster - è·å–åˆ†äº«æµ·æŠ¥

**æµ·æŠ¥å¸ƒå±€**:
```
+---------------------------+
|      å¸–å­ä¸»å›¾ç‰‡ (720x720)     |
|                           |
+---------------------------+
| ğŸ“· æ ‡é¢˜: ç¾å¥½çš„ä¸€å¤©            |
| ğŸ‘¤ ç”¨æˆ·: å¼ ä¸‰                |
| [äºŒç»´ç ]  æ‰«ç æŸ¥çœ‹å®Œæ•´å†…å®¹      |
+---------------------------+
```

---

### 5. çŸ­é“¾æ¥è‡ªå®šä¹‰ï¼ˆv2.8.0ï¼‰

**ç›®æ ‡**: å…è®¸ç”¨æˆ·è‡ªå®šä¹‰çŸ­é“¾æ¥åç¼€

**æ•°æ®åº“å˜æ›´**:
```sql
ALTER TABLE share_links
ADD COLUMN custom_code VARCHAR(20) NULL UNIQUE COMMENT 'è‡ªå®šä¹‰çŸ­ç ',
ADD COLUMN is_custom TINYINT NOT NULL DEFAULT 0 COMMENT 'æ˜¯å¦ä¸ºè‡ªå®šä¹‰çŸ­ç ';
```

**æ–°å¢API**:
- POST /api/v1/posts/:post_id/share/custom - åˆ›å»ºè‡ªå®šä¹‰çŸ­é“¾æ¥
  ```json
  {
    "custom_code": "my-awesome-post"
  }
  ```

**URLæ ¼å¼**:
- ç³»ç»Ÿç”Ÿæˆï¼š`https://knot.app/s/ABC12345`
- ç”¨æˆ·è‡ªå®šä¹‰ï¼š`https://knot.app/s/my-awesome-post`

**éªŒè¯è§„åˆ™**:
- é•¿åº¦ï¼š3-20å­—ç¬¦
- å­—ç¬¦é›†ï¼š0-9a-zA-Z-_ï¼ˆæ•°å­—ã€å­—æ¯ã€è¿å­—ç¬¦ã€ä¸‹åˆ’çº¿ï¼‰
- ç¦ç”¨è¯æ±‡ï¼šadmin, api, testç­‰ä¿ç•™è¯

---

### 6. çŸ­é“¾æ¥æœ‰æ•ˆæœŸç®¡ç†ï¼ˆv2.9.0ï¼‰

**ç›®æ ‡**: æ”¯æŒåˆ›å»ºä¸´æ—¶åˆ†äº«é“¾æ¥

**æ–°å¢APIå‚æ•°**:
```json
POST /api/v1/posts/:post_id/share
{
  "expire_hours": 24  // 24å°æ—¶åè¿‡æœŸ
}
```

**åº”ç”¨åœºæ™¯**:
- æ´»åŠ¨é™æ—¶åˆ†äº«
- æ•æ„Ÿå†…å®¹ä¸´æ—¶åˆ†äº«
- ä¼šå‘˜ä¸“å±å†…å®¹

**å®šæ—¶æ¸…ç†**:
```bash
# crontab
0 3 * * * /usr/local/bin/cleanup_expired_links.sh
```

---

### 7. A/Bæµ‹è¯•æ”¯æŒï¼ˆv3.0.0ï¼‰

**ç›®æ ‡**: æ”¯æŒå¤šä¸ªçŸ­é“¾æ¥æŒ‡å‘åŒä¸€å¸–å­ï¼Œç”¨äºA/Bæµ‹è¯•

**æ•°æ®åº“è®¾è®¡**:
```sql
ALTER TABLE share_links
ADD COLUMN variant VARCHAR(20) NULL COMMENT 'A/Bæµ‹è¯•å˜ä½“(A/B/C)',
ADD COLUMN experiment_id VARCHAR(50) NULL COMMENT 'å®éªŒID';

CREATE INDEX idx_experiment ON share_links(experiment_id);
```

**æ–°å¢API**:
- POST /api/v1/experiments - åˆ›å»ºA/Bæµ‹è¯•å®éªŒ
- GET /api/v1/experiments/:id/stats - è·å–å®éªŒç»Ÿè®¡æ•°æ®

**ç»Ÿè®¡æŒ‡æ ‡**:
- å„å˜ä½“ç‚¹å‡»ç‡
- è½¬åŒ–ç‡ï¼ˆç‚¹å‡» â†’ ä¸‹è½½ â†’ æ³¨å†Œï¼‰
- ç”¨æˆ·ç•™å­˜ç‡

---

### 8. çŸ­é“¾æ¥æ‰¹é‡ç®¡ç†ï¼ˆv3.1.0ï¼‰

**ç›®æ ‡**: æä¾›æ‰¹é‡åˆ›å»ºã€æŸ¥è¯¢ã€åˆ é™¤çŸ­é“¾æ¥çš„èƒ½åŠ›

**æ–°å¢API**:
- POST /api/v1/share/batch - æ‰¹é‡åˆ›å»ºåˆ†äº«é“¾æ¥
  ```json
  {
    "post_ids": ["POST_001", "POST_002", "POST_003"]
  }
  ```
- GET /api/v1/users/:user_id/shares - è·å–ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰åˆ†äº«é“¾æ¥
- DELETE /api/v1/share/batch - æ‰¹é‡åˆ é™¤åˆ†äº«é“¾æ¥

**åº”ç”¨åœºæ™¯**:
- è¥é”€æ´»åŠ¨æ‰¹é‡åˆ†äº«
- å†…å®¹åˆ›ä½œè€…ç®¡ç†è‡ªå·±çš„åˆ†äº«é“¾æ¥
- è¿è¥åå°æ‰¹é‡æ“ä½œ

---

### 9. åˆ†äº«é“¾æ¥é˜²æ»¥ç”¨æœºåˆ¶ï¼ˆv3.2.0ï¼‰

**ç›®æ ‡**: é˜²æ­¢æ¶æ„ç”¨æˆ·å¤§é‡åˆ›å»ºåˆ†äº«é“¾æ¥

**é™æµç­–ç•¥**:
- å•ç”¨æˆ·æ¯å°æ—¶æœ€å¤šåˆ›å»º100ä¸ªåˆ†äº«é“¾æ¥
- å•IPæ¯å°æ—¶æœ€å¤šåˆ›å»º500ä¸ªåˆ†äº«é“¾æ¥
- ä½¿ç”¨Redis + Sliding Windowç®—æ³•

**å®ç°ç¤ºä¾‹**:
```cpp
bool RateLimiter::checkLimit(const std::string& userId) {
    std::string key = "share_limit:" + userId;
    int64_t count = redis->incr(key);

    if (count == 1) {
        redis->expire(key, 3600); // 1å°æ—¶è¿‡æœŸ
    }

    return count <= 100; // é™åˆ¶100æ¬¡
}
```

---

### 10. åˆ†äº«é“¾æ¥åˆ†æä»ªè¡¨æ¿ï¼ˆv3.3.0ï¼‰

**ç›®æ ‡**: æä¾›Webä»ªè¡¨æ¿å±•ç¤ºåˆ†äº«æ•°æ®

**åŠŸèƒ½æ¨¡å—**:
- ğŸ“Š æ€»è§ˆï¼šæ€»åˆ†äº«æ¬¡æ•°ã€æ€»è®¿é—®æ¬¡æ•°ã€è½¬åŒ–ç‡
- ğŸ“ˆ è¶‹åŠ¿å›¾ï¼šæ¯æ—¥/æ¯å‘¨/æ¯æœˆåˆ†äº«å’Œè®¿é—®è¶‹åŠ¿
- ğŸ—ºï¸ åœ°åŸŸåˆ†å¸ƒï¼šè®¿é—®æ¥æºåœ°å›¾
- ğŸ“± è®¾å¤‡åˆ†å¸ƒï¼šiOS/Android/HarmonyOSå æ¯”
- ğŸ” çƒ­é—¨å†…å®¹ï¼šè®¿é—®é‡Top 10å¸–å­

**æŠ€æœ¯é€‰å‹**:
- å‰ç«¯ï¼šVue.js + ECharts
- åç«¯ï¼šæ–°å¢ç»Ÿè®¡APIï¼ˆGET /api/v1/analytics/shareï¼‰
- æ•°æ®å­˜å‚¨ï¼šClickHouseï¼ˆOLAPæ•°æ®åº“ï¼Œé€‚åˆåˆ†æåœºæ™¯ï¼‰

---

## å˜æ›´æ—¥å¿—

### 2025-10-11

**æ–‡æ¡£åˆ›å»º**:
- ğŸ“ åˆå§‹åŒ–æ–‡æ¡£ç»“æ„
- ğŸ“‹ å®ŒæˆHarmonyOS Deep Linkè°ƒç ”ï¼ˆDeep Linking + App Linkingä¸¤ç§æ–¹æ¡ˆï¼‰
- ğŸ¯ ç¡®å®šæŠ€æœ¯æ–¹æ¡ˆï¼šé›ªèŠ±ID + Base62ç¼–ç ï¼Œç§»é™¤ç»Ÿè®¡åŠŸèƒ½

**æŠ€æœ¯è®¾è®¡å®Œæˆ**:
- âœ… æ•°æ®åº“è®¾è®¡ï¼šshare_linksè¡¨ï¼ˆ7å­—æ®µï¼Œ4ç´¢å¼•ï¼Œ2å¤–é”®ï¼‰
- âœ… çŸ­é“¾æ¥ç®—æ³•è®¾è®¡ï¼šé›ªèŠ±IDç®—æ³• + Base62ç¼–ç å®ç°
- âœ… æ¶æ„è®¾è®¡ï¼šä¹å±‚æ¶æ„å®Œæ•´è®¾è®¡ï¼ˆModel â†’ Repository â†’ Service â†’ Handlerï¼‰
- âœ… APIè®¾è®¡ï¼š2ä¸ªæ ¸å¿ƒæ¥å£ï¼ˆåˆ›å»ºåˆ†äº«é“¾æ¥ã€è§£æåˆ†äº«é“¾æ¥ï¼‰

**Deep Linké…ç½®å®Œæˆ**:
- âœ… iOS Universal Linksé…ç½®ï¼ˆapple-app-site-associationï¼‰
- âœ… Android App Linksé…ç½®ï¼ˆassetlinks.jsonï¼‰
- âœ… HarmonyOS Deep Linkingé…ç½®ï¼ˆè‡ªå®šä¹‰Schemeï¼ŒMVPæ–¹æ¡ˆï¼‰
- âœ… HarmonyOS App Linkingé…ç½®ï¼ˆåŸŸåéªŒè¯ï¼Œç”Ÿäº§æ–¹æ¡ˆï¼‰
- âœ… ä¸‰ç«¯é…ç½®å¯¹æ¯”è¡¨å’Œå¼€å‘å»ºè®®

**å®æ–½è®¡åˆ’å®Œæˆ**:
- âœ… 8é˜¶æ®µè¯¦ç»†ä»»åŠ¡åˆ—è¡¨ï¼ˆé¢„è®¡17å°æ—¶ï¼‰
- âœ… 8ä¸ªå…³é”®æŠ€æœ¯ç‚¹è¯¦è§£
- âœ… H5å‰ç«¯é›†æˆæŒ‡å¼•ï¼ˆ6ä¸ªåœºæ™¯ï¼‰
- âœ… 5ç±»é£é™©å’Œ12ä¸ªæ³¨æ„äº‹é¡¹
- âœ… 5ç±»éªŒæ”¶æ ‡å‡†ï¼ˆåŠŸèƒ½/æ€§èƒ½/å®‰å…¨/æ–‡æ¡£/é…ç½®ï¼‰
- âœ… 10ä¸ªç‰ˆæœ¬çš„åç»­ä¼˜åŒ–æ–¹å‘ï¼ˆv2.4.0 - v3.3.0ï¼‰

**æ–‡æ¡£ç»Ÿè®¡**:
- ğŸ“„ æ€»è¡Œæ•°ï¼š~3200è¡Œ
- ğŸ“Š ç« èŠ‚æ•°ï¼š10ç« 
- ğŸ”¢ ä»£ç ç¤ºä¾‹ï¼š50+æ®µ
- ğŸ“‹ è¡¨æ ¼ï¼š15+ä¸ª
- ğŸ¯ ä»»åŠ¡é¡¹ï¼š100+ä¸ª

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**:
- â³ æ›´æ–°CLAUDE.mdï¼ˆAPIç‰ˆæœ¬å†å²ï¼‰
- â³ æ›´æ–°README.mdï¼ˆåŠŸèƒ½åˆ—è¡¨ã€APIç»Ÿè®¡ï¼‰
- â³ å¼€å§‹å®æ–½é˜¶æ®µ1ï¼ˆæ•°æ®åº“è®¾è®¡ä¸è¿ç§»ï¼‰

---

## é™„å½•

### A. ç›¸å…³æ–‡æ¡£ç´¢å¼•

**æ ¸å¿ƒæ–‡æ¡£**:
- `[000]APIæ–‡æ¡£.md` - éœ€è¦æ·»åŠ åˆ†äº«ç³»ç»ŸAPIç« èŠ‚
- `[001]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md` - éœ€è¦æ·»åŠ share_linksè¡¨è¯´æ˜
- `[002]é¡¹ç›®æ¶æ„æ–‡æ¡£.md` - å‚è€ƒä¹å±‚æ¶æ„è®¾è®¡åŸåˆ™
- `[003]ç¯å¢ƒå®‰è£…é…ç½®æ•™ç¨‹.md` - å‚è€ƒå¼€å‘ç¯å¢ƒé…ç½®

**é˜¶æ®µæ–‡æ¡£**:
- `[100]é˜¶æ®µA-åŸºç¡€æ¨¡å—å®ç°.md` - åŸºç¡€è®¾æ–½å±‚å‚è€ƒ
- `[101]é˜¶æ®µB-ç”¨æˆ·è®¤è¯æ¨¡å—.md` - JWTè®¤è¯å‚è€ƒ
- `[102]é˜¶æ®µC-å›¾ç‰‡ç®¡ç†æ¨¡å—.md` - å›¾ç‰‡å¤„ç†å‚è€ƒ
- `[105]é˜¶æ®µC-2-å¤šå›¾ç‰‡å¸–å­ç³»ç»Ÿ.md` - å¸–å­ç³»ç»Ÿå‚è€ƒ
- `[106]ç”¨æˆ·ä¿¡æ¯ç®¡ç†åŠŸèƒ½å®Œå–„-å®æ–½è®¡åˆ’.md` - å®æ–½è®¡åˆ’æ¨¡æ¿å‚è€ƒ
- `[108]é˜¶æ®µD-2-äº’åŠ¨ç³»ç»Ÿå…³æ³¨åŠŸèƒ½å®ç°è®¡åˆ’.md` - å‰ç½®ä¾èµ–

**æŠ€æœ¯æ–‡æ¡£**:
- `[200]æ•°æ®åº“è®¾è®¡æ–‡æ¡£.md` - æ•°æ®åº“è®¾è®¡ç†å¿µå‚è€ƒ
- `éœ€æ±‚åˆ†æ.md` - äº§å“éœ€æ±‚æ–‡æ¡£

### B. æ•°æ®åº“SQLè„šæœ¬

**å®Œæ•´å»ºè¡¨è¯­å¥**ï¼ˆå¯ç›´æ¥æ‰§è¡Œï¼‰:

```sql
-- ============================================
-- åˆ†äº«ç³»ç»Ÿæ•°æ®è¡¨
-- ç‰ˆæœ¬: v2.3.0
-- åˆ›å»ºæ—¶é—´: 2025-10-11
-- ============================================

USE knot_image_sharing;

-- åˆ é™¤å·²å­˜åœ¨çš„è¡¨ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
-- DROP TABLE IF EXISTS share_links;

-- åˆ›å»ºåˆ†äº«é“¾æ¥è¡¨
CREATE TABLE share_links (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç‰©ç†IDï¼ˆè‡ªå¢ä¸»é”®ï¼‰',
    short_code VARCHAR(10) NOT NULL UNIQUE COMMENT 'çŸ­é“¾æ¥ç (Base62ç¼–ç ,8ä½)',
    target_type ENUM('POST') NOT NULL DEFAULT 'POST' COMMENT 'åˆ†äº«ç›®æ ‡ç±»å‹(å½“å‰ä»…æ”¯æŒå¸–å­)',
    target_id BIGINT NOT NULL COMMENT 'ç›®æ ‡å¸–å­çš„ç‰©ç†ID(å¯¹åº”posts.id)',
    creator_id BIGINT NULL COMMENT 'åˆ›å»ºè€…ç”¨æˆ·ID(å¯é€‰,æœªç™»å½•ç”¨æˆ·å¯ä¸ºç©º)',
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    expire_time TIMESTAMP NULL COMMENT 'è¿‡æœŸæ—¶é—´(å¯é€‰,ç”¨äºä¸´æ—¶åˆ†äº«é“¾æ¥)',

    -- å¤–é”®çº¦æŸ
    CONSTRAINT fk_share_creator FOREIGN KEY (creator_id) REFERENCES users(id) ON DELETE SET NULL,
    CONSTRAINT fk_share_target FOREIGN KEY (target_id) REFERENCES posts(id) ON DELETE CASCADE,

    -- ç´¢å¼•ä¼˜åŒ–
    UNIQUE INDEX idx_short_code (short_code),
    INDEX idx_target (target_type, target_id),
    INDEX idx_creator (creator_id),
    INDEX idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='åˆ†äº«é“¾æ¥è¡¨';

-- éªŒè¯è¡¨åˆ›å»º
SHOW CREATE TABLE share_links;
SHOW INDEX FROM share_links;

-- ç¤ºä¾‹æ•°æ®ï¼ˆå¯é€‰ï¼‰
-- INSERT INTO share_links (short_code, target_type, target_id, creator_id)
-- VALUES ('ABC12345', 'POST', 1, 1);
```

### C. API Endpoint æ¸…å•

**åˆ†äº«ç³»ç»ŸAPI** (v2.3.0):

| æ–¹æ³• | è·¯å¾„ | è®¤è¯ | è¯´æ˜ |
|------|------|------|------|
| POST | `/api/v1/posts/:post_id/share` | âœ… JWT | åˆ›å»ºå¸–å­åˆ†äº«é“¾æ¥ |
| GET | `/api/v1/share/:code` | âŒ å…¬å¼€ | è§£æåˆ†äº«é“¾æ¥è·å–å¸–å­ä¿¡æ¯ |

**è¯·æ±‚ç¤ºä¾‹**:

```bash
# 1. åˆ›å»ºåˆ†äº«é“¾æ¥
curl -X POST http://localhost:8080/api/v1/posts/POST_2025Q4_ABC123/share \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json"

# å“åº”
{
  "success": true,
  "message": "åˆ†äº«é“¾æ¥åˆ›å»ºæˆåŠŸ",
  "data": {
    "short_code": "ABC12345",
    "short_link": "https://knot.app/s/ABC12345",
    "expire_time": null
  },
  "timestamp": 1760020100
}

# 2. è§£æåˆ†äº«é“¾æ¥ï¼ˆæ— éœ€è®¤è¯ï¼‰
curl http://localhost:8080/api/v1/share/ABC12345

# å“åº”
{
  "success": true,
  "message": "æŸ¥è¯¢æˆåŠŸ",
  "data": {
    "target_type": "POST",
    "target_id": 12345,
    "post": {
      "post_id": "POST_2025Q4_ABC123",
      "title": "ç¾å¥½çš„ä¸€å¤©",
      "description": "ä»Šå¤©å¤©æ°”çœŸå¥½ï¼Œæ‹äº†å‡ å¼ ç…§ç‰‡åˆ†äº«ç»™å¤§å®¶",
      "image_count": 3,
      "like_count": 42,
      "favorite_count": 15,
      "images": [...],
      "user": {...}
    },
    "deep_link": {
      "ios": "knot://post/12345",
      "android": "knot://post/12345",
      "harmonyos": "knot://post/12345",
      "universal_link": "https://knot.app/post/12345"
    }
  },
  "timestamp": 1760020100
}
```

### D. é…ç½®æ–‡ä»¶æ¨¡æ¿

**iOS: apple-app-site-association**

ä½ç½®: `https://knot.app/.well-known/apple-app-site-association`

```json
{
  "applinks": {
    "apps": [],
    "details": [
      {
        "appID": "TEAMID.com.knot.app",
        "paths": [
          "/s/*",
          "/post/*"
        ]
      }
    ]
  }
}
```

**Android: assetlinks.json**

ä½ç½®: `https://knot.app/.well-known/assetlinks.json`

```json
[
  {
    "relation": ["delegate_permission/common.handle_all_urls"],
    "target": {
      "namespace": "android_app",
      "package_name": "com.knot.app",
      "sha256_cert_fingerprints": [
        "AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99"
      ]
    }
  }
]
```

**HarmonyOS: applinking.json**

ä½ç½®: `https://knot.app/.well-known/applinking.json`

```json
{
  "relation": ["delegate_permission/common.handle_all_urls"],
  "target": {
    "namespace": "harmony_app",
    "bundle_name": "com.knot.app",
    "sha256_cert_fingerprints": [
      "AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99:AA:BB:CC:DD:EE:FF:00:11:22:33:44:55:66:77:88:99"
    ]
  }
}
```

**Nginxé…ç½®**

```nginx
server {
    listen 443 ssl http2;
    server_name knot.app;

    # SSLè¯ä¹¦
    ssl_certificate /etc/nginx/ssl/knot.app.crt;
    ssl_certificate_key /etc/nginx/ssl/knot.app.key;

    # iOS Universal Links
    location /.well-known/apple-app-site-association {
        alias /usr/share/nginx/html/.well-known/apple-app-site-association;
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
        add_header Content-Type "application/json; charset=utf-8";
    }

    # Android App Links
    location /.well-known/assetlinks.json {
        alias /usr/share/nginx/html/.well-known/assetlinks.json;
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
        add_header Content-Type "application/json; charset=utf-8";
    }

    # HarmonyOS App Linking
    location /.well-known/applinking.json {
        alias /usr/share/nginx/html/.well-known/applinking.json;
        default_type application/json;
        add_header Access-Control-Allow-Origin *;
        add_header Content-Type "application/json; charset=utf-8";
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### E. æµ‹è¯•æ¸…å•

**å•å…ƒæµ‹è¯•**:
- [ ] Base62Encoder::encode() æ­£ç¡®æ€§æµ‹è¯•
- [ ] Base62Encoder::decode() æ­£ç¡®æ€§æµ‹è¯•
- [ ] SnowflakeIdGenerator::nextId() å”¯ä¸€æ€§æµ‹è¯•
- [ ] ShareLink::isExpired() è¿‡æœŸåˆ¤æ–­æµ‹è¯•
- [ ] ShareLink::toJson() åºåˆ—åŒ–æµ‹è¯•

**é›†æˆæµ‹è¯•**:
- [ ] ShareService::createShareLink() åˆ›å»ºæµ‹è¯•
- [ ] ShareService::createShareLink() å»é‡æµ‹è¯•
- [ ] ShareService::resolveShareLink() è§£ææµ‹è¯•
- [ ] å¤–é”®çº§è”åˆ é™¤æµ‹è¯•ï¼ˆåˆ é™¤å¸–å­ååˆ†äº«é“¾æ¥è‡ªåŠ¨åˆ é™¤ï¼‰
- [ ] è¿‡æœŸé“¾æ¥å¤„ç†æµ‹è¯•

**APIæµ‹è¯•**:
- [ ] POST /api/v1/posts/:post_id/share æˆåŠŸåœºæ™¯
- [ ] POST /api/v1/posts/:post_id/share æ— Tokenå¤±è´¥åœºæ™¯
- [ ] POST /api/v1/posts/:post_id/share å¸–å­ä¸å­˜åœ¨å¤±è´¥åœºæ™¯
- [ ] GET /api/v1/share/:code æˆåŠŸåœºæ™¯
- [ ] GET /api/v1/share/:code çŸ­ç ä¸å­˜åœ¨å¤±è´¥åœºæ™¯
- [ ] GET /api/v1/share/:code é“¾æ¥å·²è¿‡æœŸå¤±è´¥åœºæ™¯

**æ€§èƒ½æµ‹è¯•**:
- [ ] çŸ­ç ç”Ÿæˆæ€§èƒ½æµ‹è¯•ï¼ˆç›®æ ‡ï¼š<1msï¼‰
- [ ] åˆ›å»ºåˆ†äº«é“¾æ¥æ€§èƒ½æµ‹è¯•ï¼ˆç›®æ ‡ï¼š<50msï¼‰
- [ ] è§£æåˆ†äº«é“¾æ¥æ€§èƒ½æµ‹è¯•ï¼ˆç›®æ ‡ï¼š<100msï¼‰
- [ ] å¹¶å‘åˆ›å»ºæµ‹è¯•ï¼ˆ100å¹¶å‘ï¼ŒæˆåŠŸç‡100%ï¼‰
- [ ] çŸ­ç å”¯ä¸€æ€§å‹åŠ›æµ‹è¯•ï¼ˆç”Ÿæˆ100ä¸‡ä¸ªçŸ­ç æ— é‡å¤ï¼‰

**Deep Linkæµ‹è¯•**:
- [ ] iOSçœŸæœºæµ‹è¯•ï¼ˆUniversal Linksï¼‰
- [ ] AndroidçœŸæœºæµ‹è¯•ï¼ˆApp Linksï¼‰
- [ ] HarmonyOSçœŸæœºæµ‹è¯•ï¼ˆDeep Linkingï¼‰
- [ ] HarmonyOSçœŸæœºæµ‹è¯•ï¼ˆApp Linkingï¼‰
- [ ] H5é¡µé¢å”¤èµ·åº”ç”¨æµ‹è¯•

### F. å¸¸è§é—®é¢˜ (FAQ)

**Q1: ä¸ºä»€ä¹ˆé€‰æ‹©é›ªèŠ±IDè€Œä¸æ˜¯è‡ªå¢IDï¼Ÿ**

A: é›ªèŠ±IDå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š
- å…¨å±€å”¯ä¸€ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
- ä¸å¯é¢„æµ‹ï¼Œå®‰å…¨æ€§æ›´é«˜ï¼ˆè‡ªå¢IDè¿ç»­å¯é¢„æµ‹ï¼‰
- æ— éœ€æŸ¥è¯¢æ•°æ®åº“å³å¯ç”Ÿæˆ
- æ€§èƒ½æ›´ä¼˜ï¼ˆæ— æ•°æ®åº“IOï¼‰

**Q2: çŸ­ç é•¿åº¦ä¸ºä»€ä¹ˆå›ºå®š8ä½ï¼Ÿ**

A: 8ä½Base62ç¼–ç æä¾›62^8 â‰ˆ 218ä¸‡äº¿ç§å¯èƒ½ï¼š
- æ»¡è¶³å¤§è§„æ¨¡åº”ç”¨éœ€æ±‚ï¼ˆå³ä½¿æ¯ç§’100ä¸‡æ¬¡ï¼Œå¯ç”¨6919å¹´ï¼‰
- é•¿åº¦é€‚ä¸­ï¼Œé€‚åˆåˆ†äº«ä¼ æ’­
- å¡«å……å‰å¯¼é›¶ä¿è¯é•¿åº¦å›ºå®šï¼ŒURLç¾è§‚

**Q3: ä¸ºä»€ä¹ˆä¸åœ¨æœ¬ç‰ˆæœ¬å®ç°ç»Ÿè®¡åŠŸèƒ½ï¼Ÿ**

A: éµå¾ªMVPåŸåˆ™ï¼Œå…ˆéªŒè¯æ ¸å¿ƒåŠŸèƒ½ï¼š
- å‡å°‘å¼€å‘å¤æ‚åº¦ï¼Œå¿«é€Ÿä¸Šçº¿
- é¿å…è¿‡åº¦è®¾è®¡
- åç»­ç‰ˆæœ¬ï¼ˆv2.4.0ï¼‰å¯å¿«é€Ÿæ·»åŠ ç»Ÿè®¡å­—æ®µ

**Q4: HarmonyOSä¸ºä»€ä¹ˆæä¾›ä¸¤ç§Deep Linkæ–¹æ¡ˆï¼Ÿ**

A: é€‚åº”ä¸åŒé˜¶æ®µéœ€æ±‚ï¼š
- Deep Linkingï¼ˆè‡ªå®šä¹‰Schemeï¼‰ï¼šMVPå¿«é€ŸéªŒè¯ï¼Œæ— éœ€æœåŠ¡å™¨é…ç½®
- App Linkingï¼ˆåŸŸåéªŒè¯ï¼‰ï¼šç”Ÿäº§ç¯å¢ƒï¼Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒå’Œå®‰å…¨æ€§

**Q5: åˆ é™¤å¸–å­ååˆ†äº«é“¾æ¥ä¼šæ€æ ·ï¼Ÿ**

A: å¤–é”®çº§è”åˆ é™¤ï¼ˆON DELETE CASCADEï¼‰ï¼š
- åˆ é™¤å¸–å­æ—¶ï¼Œæ•°æ®åº“è‡ªåŠ¨åˆ é™¤ç›¸å…³åˆ†äº«é“¾æ¥
- ç”¨æˆ·ç‚¹å‡»çŸ­é“¾æ¥æ—¶è¿”å›404"ç›®æ ‡å¸–å­ä¸å­˜åœ¨"
- H5é¡µé¢æ˜¾ç¤ºå‹å¥½é”™è¯¯æç¤º

**Q6: åŒä¸€ä¸ªå¸–å­å¤šæ¬¡åˆ›å»ºåˆ†äº«é“¾æ¥ä¼šæ€æ ·ï¼Ÿ**

A: å»é‡é€»è¾‘ï¼š
- æ£€æŸ¥å¸–å­æ˜¯å¦å·²æœ‰åˆ†äº«é“¾æ¥ï¼ˆé€šè¿‡target_idæŸ¥è¯¢ï¼‰
- å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›ç°æœ‰çŸ­é“¾æ¥
- å¦‚æœä¸å­˜åœ¨ï¼Œç”Ÿæˆæ–°çŸ­é“¾æ¥
- èŠ‚çœçŸ­ç èµ„æºï¼Œé¿å…æ•°æ®å†—ä½™

**Q7: å¦‚ä½•é˜²æ­¢çŸ­ç è¢«æ¶æ„éå†ï¼Ÿ**

A: å¤šå±‚é˜²æŠ¤ï¼š
- é›ªèŠ±IDç”Ÿæˆï¼ŒçŸ­ç ä¸å¯é¢„æµ‹
- 8ä½Base62ç¼–ç ï¼Œéå†æˆæœ¬æé«˜ï¼ˆ218ä¸‡äº¿ç§å¯èƒ½ï¼‰
- å»ºè®®æ·»åŠ Rate Limitingï¼ˆé™æµï¼‰
- å»ºè®®æ·»åŠ è®¿é—®æ—¥å¿—ç›‘æ§

**Q8: çŸ­ç ä¼šé‡å¤å—ï¼Ÿ**

A: ä¸ä¼šï¼š
- é›ªèŠ±IDç®—æ³•ä¿è¯å…¨å±€å”¯ä¸€ï¼ˆ64ä½ï¼‰
- Base62ç¼–ç ä¿æŒå”¯ä¸€æ€§
- æ•°æ®åº“å”¯ä¸€ç´¢å¼•äºŒæ¬¡ä¿éšœ
- å®é™…æµ‹è¯•ï¼šç”Ÿæˆ100ä¸‡ä¸ªçŸ­ç æ— é‡å¤

**Q9: Deep Linké…ç½®æ–‡ä»¶æ›´æ–°åå¤šä¹…ç”Ÿæ•ˆï¼Ÿ**

A:
- iOS: ç³»ç»Ÿç¼“å­˜24å°æ—¶ï¼Œå»ºè®®é‡å¯åº”ç”¨æˆ–é‡æ–°å®‰è£…
- Android: ç³»ç»Ÿç¼“å­˜è¾ƒçŸ­ï¼Œé€šå¸¸å‡ åˆ†é’Ÿç”Ÿæ•ˆ
- HarmonyOS: å®æ—¶éªŒè¯ï¼Œç«‹å³ç”Ÿæ•ˆ
- å»ºè®®é…ç½®CDNç¼“å­˜ç­–ç•¥ï¼ˆmax-age=3600ï¼‰

**Q10: å¦‚ä½•æµ‹è¯•Deep Linkæ˜¯å¦é…ç½®æˆåŠŸï¼Ÿ**

A:
```bash
# 1. éªŒè¯é…ç½®æ–‡ä»¶å¯è®¿é—®
curl -I https://knot.app/.well-known/apple-app-site-association
curl -I https://knot.app/.well-known/assetlinks.json
curl -I https://knot.app/.well-known/applinking.json

# 2. iOSæµ‹è¯•ï¼ˆçœŸæœºï¼‰
# é€šè¿‡å¤‡å¿˜å½•å‘é€é“¾æ¥ï¼Œé•¿æŒ‰æŸ¥çœ‹æ˜¯å¦æœ‰"åœ¨'Knot'ä¸­æ‰“å¼€"é€‰é¡¹

# 3. Androidæµ‹è¯•ï¼ˆçœŸæœºæˆ–æ¨¡æ‹Ÿå™¨ï¼‰
adb shell am start -a android.intent.action.VIEW -d "https://knot.app/s/ABC12345"

# 4. HarmonyOSæµ‹è¯•ï¼ˆçœŸæœºï¼‰
hdc shell aa start -U "https://knot.app/s/ABC12345" -b com.knot.app -a EntryAbility
```

---

## æ–‡æ¡£å…ƒä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11
**æœ€åæ›´æ–°**: 2025-10-11
**ä½œè€…**: Claude + ç”¨æˆ·
**å®¡æ ¸çŠ¶æ€**: â³ å¾…å®¡æ ¸
**å®æ–½çŠ¶æ€**: â³ è®¡åˆ’ä¸­

**ç›¸å…³äººå‘˜**:
- äº§å“ç»ç†: å¾…å®š
- åç«¯å¼€å‘: å¾…å®š
- å‰ç«¯å¼€å‘: å¾…å®š
- æµ‹è¯•å·¥ç¨‹å¸ˆ: å¾…å®š
- è¿ç»´å·¥ç¨‹å¸ˆ: å¾…å®š

**é¢„è®¡æ—¶é—´çº¿**:
- ğŸ“… éœ€æ±‚è¯„å®¡: 2025-10-12
- ğŸ“… å¼€å‘å¯åŠ¨: 2025-10-13
- ğŸ“… å¼€å‘å®Œæˆ: 2025-10-15ï¼ˆ17å°æ—¶ / 2å¤©ï¼‰
- ğŸ“… æµ‹è¯•éªŒæ”¶: 2025-10-16
- ğŸ“… ç”Ÿäº§éƒ¨ç½²: 2025-10-17
- ğŸ“… ç›‘æ§è§‚å¯Ÿ: 2025-10-18

**æ€»å­—æ•°**: ~35,000å­—
**æ€»ä»£ç ç¤ºä¾‹**: ~50æ®µ
**æ€»è¡¨æ ¼**: ~20ä¸ª
**æ€»ä»»åŠ¡é¡¹**: ~120ä¸ª

---

**æ–‡æ¡£ç»“æŸ**

æ„Ÿè°¢é˜…è¯»æœ¬å®æ–½è®¡åˆ’æ–‡æ¡£ã€‚å¦‚æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿åé¦ˆã€‚
