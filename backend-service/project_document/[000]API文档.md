# Knot 图片分享系统 API 文档

**项目名称**: Knot - Image Sharing Service
**版本**: v2.0.0
**更新时间**: 2025-10-08
**基础URL**: `http://localhost:8080/api/v1`

---

## 📋 目录

1. [认证相关API](#认证相关api)
   - [用户注册](#1-用户注册)
   - [用户登录](#2-用户登录)
   - [令牌验证](#3-令牌验证)
   - [令牌刷新](#4-令牌刷新)
   - [用户登出](#5-用户登出)
   - [修改密码](#6-修改密码)

2. [帖子管理API](#帖子管理api) **🆕 v2.0.0**
   - [创建帖子](#1-创建帖子)
   - [获取帖子详情](#2-获取帖子详情)
   - [更新帖子](#3-更新帖子)
   - [删除帖子](#4-删除帖子)
   - [获取Feed流](#5-获取feed流)
   - [获取用户帖子列表](#6-获取用户帖子列表)
   - [添加图片到帖子](#7-添加图片到帖子)
   - [从帖子删除图片](#8-从帖子删除图片)
   - [调整图片顺序](#9-调整图片顺序)

3. [图片管理API](#图片管理api) **⚠️ 部分已废弃**
   - [上传图片](#1-上传图片) ✅ 可用（内部调用Post API）
   - [获取最新图片列表](#2-获取最新图片列表) ✅ 可用
   - [获取图片详情](#3-获取图片详情) ✅ 可用
   - [更新图文配文](#4-更新图文配文) ❌ 已废弃（使用Post API）
   - [删除图片](#5-删除图片) ✅ 可用
   - [获取用户图片列表](#6-获取用户图片列表) ✅ 可用

4. [系统相关API](#系统相关api)
   - [健康检查](#1-健康检查)
   - [系统指标](#2-系统指标)
   - [版本信息](#3-版本信息)

---

## 认证相关API

### 1. 用户注册

**功能介绍**: 注册新用户账号

**请求方式**: `POST`

**请求路径**: `/auth/register`

**请求头**:
```
Content-Type: application/json
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| username | string | 是 | 用户名（3-50字符，字母数字下划线） | "zhangsan" |
| password | string | 是 | 密码（6-100字符） | "password123" |
| real_name | string | 是 | 真实姓名（不超过50字符） | "张三" |
| phone | string | 是 | 手机号（11位中国手机号） | "13800138000" |
| email | string | 否 | 邮箱（可选） | "zhangsan@example.com" |
| role | string | 否 | 用户角色（owner/driver/both，默认driver） | "driver" |

**请求示例**:
```json
{
  "username": "zhangsan",
  "password": "password123",
  "real_name": "张三",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "role": "driver"
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 用户数据（成功时返回） |
| data.id | integer | 物理ID |
| data.user_id | string | 逻辑ID |
| data.username | string | 用户名 |
| data.real_name | string | 真实姓名 |
| data.phone | string | 手机号 |
| data.email | string | 邮箱 |
| data.role | string | 用户角色 |
| data.status | string | 账户状态 |
| data.create_time | integer | 创建时间（时间戳） |

**成功响应示例**:
```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "id": 1,
    "user_id": "USR_2025Q1_A1B2C3",
    "username": "zhangsan",
    "real_name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "role": "driver",
    "status": "active",
    "avatar_url": "",
    "device_count": 0,
    "create_time": 1704067200,
    "update_time": 1704067200
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "用户名已存在",
  "data": null
}
```

**错误码说明**:
- `用户名已存在`: 用户名重复
- `手机号已被注册`: 手机号重复
- `邮箱已被注册`: 邮箱重复
- `用户名不能为空`: 参数验证失败
- `手机号格式不正确`: 手机号格式错误

---

### 2. 用户登录

**功能介绍**: 用户登录获取访问令牌

**请求方式**: `POST`

**请求路径**: `/auth/login`

**请求头**:
```
Content-Type: application/json
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| username | string | 是 | 用户名/手机号/邮箱 | "zhangsan" 或 "13800138000" |
| password | string | 是 | 密码 | "password123" |

**请求示例**:
```json
{
  "username": "zhangsan",
  "password": "password123"
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 登录数据（成功时返回） |
| data.access_token | string | 访问令牌（有效期1小时） |
| data.refresh_token | string | 刷新令牌（有效期24小时） |
| data.user | object | 用户信息 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "user_id": "USR_2025Q1_A1B2C3",
      "username": "zhangsan",
      "real_name": "张三",
      "phone": "13800138000",
      "email": "zhangsan@example.com",
      "role": "driver",
      "status": "active"
    }
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "密码错误",
  "data": null
}
```

**错误码说明**:
- `用户不存在`: 用户名/手机号/邮箱不存在
- `密码错误`: 密码不正确
- `账户已被封禁`: 账户状态为banned
- `账户未激活`: 账户状态为inactive

---

### 3. 令牌验证

**功能介绍**: 验证JWT访问令牌是否有效

**请求方式**: `POST`

**请求路径**: `/auth/validate`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| token | string | 是 | JWT访问令牌 | "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." |

**请求示例**:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| valid | boolean | 令牌是否有效 |
| message | string | 返回消息 |
| data | object | 令牌数据（有效时返回） |
| data.user_id | integer | 用户ID |
| data.username | string | 用户名 |

**成功响应示例**:
```json
{
  "valid": true,
  "message": "令牌有效",
  "data": {
    "user_id": 1,
    "username": "zhangsan"
  }
}
```

**失败响应示例**:
```json
{
  "valid": false,
  "message": "令牌无效或已过期",
  "data": null
}
```

---

### 4. 令牌刷新

**功能介绍**: 使用刷新令牌获取新的访问令牌

**请求方式**: `POST`

**请求路径**: `/auth/refresh`

**请求头**:
```
Content-Type: application/json
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| refresh_token | string | 是 | JWT刷新令牌 | "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." |

**请求示例**:
```json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 新令牌数据 |
| data.access_token | string | 新的访问令牌 |
| data.refresh_token | string | 新的刷新令牌 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "令牌刷新成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "刷新令牌无效",
  "data": null
}
```

---

### 5. 用户登出

**功能介绍**: 用户登出（简化实现，JWT令牌自动过期）

**请求方式**: `POST`

**请求路径**: `/auth/logout`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| access_token | string | 是 | JWT访问令牌 | "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." |

**请求示例**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "登出成功"
}
```

**注意**: 当前实现为简化版本，JWT令牌会在过期后自动失效，未实现令牌黑名单功能。

---

### 6. 修改密码

**功能介绍**: 修改用户密码

**请求方式**: `POST`

**请求路径**: `/auth/change-password`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| user_id | integer | 是 | 用户ID | 1 |
| old_password | string | 是 | 旧密码 | "password123" |
| new_password | string | 是 | 新密码（6-100字符） | "newpassword456" |

**请求示例**:
```json
{
  "user_id": 1,
  "old_password": "password123",
  "new_password": "newpassword456"
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "密码修改成功"
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "旧密码不正确"
}
```

**错误码说明**:
- `用户不存在`: 用户ID不存在
- `旧密码不正确`: 旧密码验证失败
- `新密码格式不正确`: 新密码长度不符合要求

---

## 帖子管理API

> **🆕 v2.0.0 新增**: 支持多图片帖子（1-9张图片）

### 1. 创建帖子

**功能介绍**: 创建包含1-9张图片的帖子

**请求方式**: `POST`

**请求路径**: `/posts`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | string | 是 | 帖子标题（1-255字符） |
| description | string | 否 | 帖子配文（最多1000字符） |
| imageFiles | array | 是 | 图片文件路径数组（1-9张） |
| tags | array | 否 | 标签数组（最多5个） |

**请求示例**:
```json
{
  "title": "美好的一天",
  "description": "今天天气真好，拍了几张照片分享给大家",
  "imageFiles": [
    "/tmp/upload_abc123.jpg",
    "/tmp/upload_def456.jpg",
    "/tmp/upload_ghi789.jpg"
  ],
  "tags": ["风景", "旅行", "摄影"]
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| postId | string | 帖子业务ID |
| post | object | 帖子对象（包含images数组） |

**返回示例**:
```json
{
  "success": true,
  "message": "帖子创建成功",
  "postId": "POST_2025Q4_ABC123",
  "post": {
    "postId": "POST_2025Q4_ABC123",
    "userId": 1,
    "title": "美好的一天",
    "description": "今天天气真好，拍了几张照片分享给大家",
    "imageCount": 3,
    "likeCount": 0,
    "favoriteCount": 0,
    "viewCount": 0,
    "status": "APPROVED",
    "createTime": "2025-10-08 10:30:00",
    "updateTime": "2025-10-08 10:30:00",
    "images": [
      {
        "imageId": "IMG_2025Q4_XYZ001",
        "postId": 1,
        "displayOrder": 1,
        "userId": 1,
        "fileUrl": "/uploads/images/abc123.jpg",
        "thumbnailUrl": "/uploads/thumbnails/abc123_thumb.jpg",
        "fileSize": 1024000,
        "width": 1920,
        "height": 1080,
        "mimeType": "image/jpeg",
        "createTime": "2025-10-08 10:30:00"
      },
      {
        "imageId": "IMG_2025Q4_XYZ002",
        "postId": 1,
        "displayOrder": 2,
        "userId": 1,
        "fileUrl": "/uploads/images/def456.jpg",
        "thumbnailUrl": "/uploads/thumbnails/def456_thumb.jpg",
        "fileSize": 856000,
        "width": 1920,
        "height": 1080,
        "mimeType": "image/jpeg",
        "createTime": "2025-10-08 10:30:00"
      },
      {
        "imageId": "IMG_2025Q4_XYZ003",
        "postId": 1,
        "displayOrder": 3,
        "userId": 1,
        "fileUrl": "/uploads/images/ghi789.jpg",
        "thumbnailUrl": "/uploads/thumbnails/ghi789_thumb.jpg",
        "fileSize": 920000,
        "width": 1920,
        "height": 1080,
        "mimeType": "image/jpeg",
        "createTime": "2025-10-08 10:30:00"
      }
    ]
  },
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `400 Bad Request`: 参数错误（标题为空、图片数量不符合要求等）
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 获取帖子详情

**功能介绍**: 获取帖子的完整信息（包含所有图片）

**请求方式**: `GET`

**请求路径**: `/posts/:post_id`

**请求头**:
```
无需认证
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| post | object | 帖子对象（包含images数组） |

**返回示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "post": {
    "postId": "POST_2025Q4_ABC123",
    "userId": 1,
    "title": "美好的一天",
    "description": "今天天气真好，拍了几张照片分享给大家",
    "imageCount": 3,
    "likeCount": 10,
    "favoriteCount": 5,
    "viewCount": 100,
    "status": "APPROVED",
    "createTime": "2025-10-08 10:30:00",
    "updateTime": "2025-10-08 10:30:00",
    "images": [...]
  },
  "timestamp": 1696752600
}
```

**错误码**:
- `404 Not Found`: 帖子不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 3. 更新帖子

**功能介绍**: 更新帖子的标题和配文（只有作者可以更新）

**请求方式**: `PUT`

**请求路径**: `/posts/:post_id`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | string | 是 | 新标题（1-255字符） |
| description | string | 否 | 新配文（最多1000字符） |

**请求示例**:
```json
{
  "title": "更新后的标题",
  "description": "更新后的配文"
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "帖子更新成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 4. 删除帖子

**功能介绍**: 删除帖子及其所有图片（只有作者可以删除）

**请求方式**: `DELETE`

**请求路径**: `/posts/:post_id`

**请求头**:
```
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "帖子删除成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 5. 获取Feed流

**功能介绍**: 获取最新帖子列表（分页）

**请求方式**: `GET`

**请求路径**: `/posts`

**请求头**:
```
无需认证
```

**查询参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码（默认1） |
| pageSize | int | 否 | 每页数量（默认20，最大100） |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| posts | array | 帖子列表（包含images数组） |
| total | int | 总数 |
| page | int | 当前页码 |
| pageSize | int | 每页数量 |

**返回示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "posts": [
    {
      "postId": "POST_2025Q4_ABC123",
      "userId": 1,
      "title": "美好的一天",
      "description": "今天天气真好",
      "imageCount": 3,
      "likeCount": 10,
      "favoriteCount": 5,
      "viewCount": 100,
      "status": "APPROVED",
      "createTime": "2025-10-08 10:30:00",
      "updateTime": "2025-10-08 10:30:00",
      "images": [...]
    }
  ],
  "total": 100,
  "page": 1,
  "pageSize": 20,
  "timestamp": 1696752600
}
```

**错误码**:
- `400 Bad Request`: 参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 6. 获取用户帖子列表

**功能介绍**: 获取指定用户的所有帖子（分页）

**请求方式**: `GET`

**请求路径**: `/users/:user_id/posts`

**请求头**:
```
无需认证
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | int | 是 | 用户ID |

**查询参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码（默认1） |
| pageSize | int | 否 | 每页数量（默认20，最大100） |

**返回参数**: 同"获取Feed流"

**错误码**:
- `400 Bad Request`: 参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 7. 添加图片到帖子

**功能介绍**: 向现有帖子添加图片（最多9张）

**请求方式**: `POST`

**请求路径**: `/posts/:post_id/images`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| imageFile | string | 是 | 图片文件路径 |

**请求示例**:
```json
{
  "imageFile": "/tmp/upload_new123.jpg"
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "图片添加成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 图片数量已达上限（9张）
- `500 Internal Server Error`: 服务器内部错误

---

### 8. 从帖子删除图片

**功能介绍**: 从帖子中删除指定图片（至少保留1张）

**请求方式**: `DELETE`

**请求路径**: `/posts/:post_id/images/:image_id`

**请求头**:
```
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |
| image_id | string | 是 | 图片业务ID |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "图片删除成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子或图片不存在
- `400 Bad Request`: 不能删除最后一张图片
- `500 Internal Server Error`: 服务器内部错误

---

### 9. 调整图片顺序

**功能介绍**: 调整帖子中图片的显示顺序

**请求方式**: `PUT`

**请求路径**: `/posts/:post_id/images/order`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| imageIds | array | 是 | 图片ID数组（按新顺序排列） |

**请求示例**:
```json
{
  "imageIds": [
    "IMG_2025Q4_XYZ003",
    "IMG_2025Q4_XYZ001",
    "IMG_2025Q4_XYZ002"
  ]
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "图片顺序调整成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 图片ID数量不匹配或包含无效ID
- `500 Internal Server Error`: 服务器内部错误

---

## 图片管理API

> **⚠️ 部分API已废弃**: 建议使用帖子管理API

### 1. 上传图片

**功能介绍**: 用户上传图文推文（图片为主 + 配文）

**请求方式**: `POST`

**请求路径**: `/images`

**请求头**:
```
Content-Type: multipart/form-data
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| image | File | 是 | 图片文件（支持JPEG/PNG/WebP，最大5MB） |
| title | String | 是 | 推文标题（最多255字符） |
| description | String | 否 | 推文配文（详细描述） |
| tags | String | 否 | 标签列表（逗号分隔，最多5个） |

**返回值**:

```json
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "id": 1,
    "image_id": "IMG_2025Q4_123456",
    "user_id": 1,
    "title": "美丽的风景",
    "description": "今天拍摄的日落",
    "file_url": "/uploads/images/abc123.jpg",
    "thumbnail_url": "/uploads/thumbnails/abc123_thumb.jpg",
    "file_size": 1024000,
    "width": 1920,
    "height": 1080,
    "mime_type": "image/jpeg",
    "like_count": 0,
    "favorite_count": 0,
    "view_count": 0,
    "status": "APPROVED",
    "create_time": 1759844400,
    "update_time": 1759844400
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `401 Unauthorized`: 未提供或无效的认证令牌
- `400 Bad Request`: 请求参数错误（未找到图片文件、标题为空、文件过大等）
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 获取最新图片列表

**功能介绍**: 获取最新发布的图文推文列表（按时间倒序）

**请求方式**: `GET`

**请求路径**: `/images?page=1&page_size=20`

**请求头**:
```
无需认证
```

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | Integer | 否 | 1 | 页码（从1开始） |
| page_size | Integer | 否 | 20 | 每页数量（最大100） |

**返回值**:

```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 20,
    "images": [
      {
        "id": 1,
        "image_id": "IMG_2025Q4_123456",
        "user_id": 1,
        "title": "美丽的风景",
        "description": "今天拍摄的日落",
        "file_url": "/uploads/images/abc123.jpg",
        "thumbnail_url": "/uploads/thumbnails/abc123_thumb.jpg",
        "file_size": 1024000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "like_count": 10,
        "favorite_count": 5,
        "view_count": 100,
        "status": "APPROVED",
        "create_time": 1759844400,
        "update_time": 1759844400
      }
    ]
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `400 Bad Request`: 请求参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 3. 获取图片详情

**功能介绍**: 获取指定图文推文的详细信息（会增加浏览数）

**请求方式**: `GET`

**请求路径**: `/images/:id`

**请求头**:
```
无需认证
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | String | 图片业务逻辑ID（image_id） |

**返回值**:

```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "id": 1,
    "image_id": "IMG_2025Q4_123456",
    "user_id": 1,
    "title": "美丽的风景",
    "description": "今天拍摄的日落",
    "file_url": "/uploads/images/abc123.jpg",
    "thumbnail_url": "/uploads/thumbnails/abc123_thumb.jpg",
    "file_size": 1024000,
    "width": 1920,
    "height": 1080,
    "mime_type": "image/jpeg",
    "like_count": 10,
    "favorite_count": 5,
    "view_count": 101,
    "status": "APPROVED",
    "create_time": 1759844400,
    "update_time": 1759844400
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `404 Not Found`: 图片不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 4. 更新图文配文

> **❌ 已废弃**: 请使用 `PUT /posts/:post_id` 代替

**功能介绍**: 更新图文推文的标题和配文（只有所有者可以编辑）

**请求方式**: `PUT`

**请求路径**: `/images/:id`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | String | 图片业务逻辑ID（image_id） |

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | String | 是 | 新标题（最多255字符） |
| description | String | 否 | 新配文 |

**请求示例**:

```json
{
  "title": "更新后的标题",
  "description": "更新后的配文"
}
```

**返回值**:

```json
{
  "success": true,
  "message": "更新成功",
  "data": null,
  "timestamp": 1759844400
}
```

**错误码**:
- `401 Unauthorized`: 未提供或无效的认证令牌
- `403 Forbidden`: 无权限（不是图片所有者）或图片不存在
- `400 Bad Request`: 请求参数错误（标题为空、标题过长等）
- `500 Internal Server Error`: 服务器内部错误

---

### 5. 删除图片

**功能介绍**: 删除图文推文（只有所有者可以删除）

**请求方式**: `DELETE`

**请求路径**: `/images/:id`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | String | 图片业务逻辑ID（image_id） |

**返回值**:

```json
{
  "success": true,
  "message": "删除成功",
  "data": null,
  "timestamp": 1759844400
}
```

**错误码**:
- `401 Unauthorized`: 未提供或无效的认证令牌
- `403 Forbidden`: 无权限（不是图片所有者）或图片不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 6. 获取用户图片列表

**功能介绍**: 获取指定用户发布的图文推文列表

**请求方式**: `GET`

**请求路径**: `/users/:id/images?page=1&page_size=20`

**请求头**:
```
无需认证
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | Integer | 用户ID |

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | Integer | 否 | 1 | 页码（从1开始） |
| page_size | Integer | 否 | 20 | 每页数量（最大100） |

**返回值**:

```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "total": 50,
    "page": 1,
    "page_size": 20,
    "images": [
      {
        "id": 1,
        "image_id": "IMG_2025Q4_123456",
        "user_id": 1,
        "title": "美丽的风景",
        "description": "今天拍摄的日落",
        "file_url": "/uploads/images/abc123.jpg",
        "thumbnail_url": "/uploads/thumbnails/abc123_thumb.jpg",
        "file_size": 1024000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "like_count": 10,
        "favorite_count": 5,
        "view_count": 100,
        "status": "APPROVED",
        "create_time": 1759844400,
        "update_time": 1759844400
      }
    ]
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `400 Bad Request`: 请求参数错误
- `500 Internal Server Error`: 服务器内部错误

---


## 系统相关API

### 1. 健康检查

**功能介绍**: 检查服务是否正常运行

**请求方式**: `GET`

**请求路径**: `/health`

**请求参数**: 无

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| status | string | 服务状态 |
| timestamp | integer | 时间戳 |

**成功响应示例**:
```json
{
  "status": "healthy",
  "timestamp": 1704067200
}
```

---

### 2. 系统指标

**功能介绍**: 获取系统运行指标

**请求方式**: `GET`

**请求路径**: `/metrics`

**请求参数**: 无

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| uptime | integer | 运行时间（秒） |
| requests_total | integer | 总请求数 |
| database_connections | integer | 数据库连接数 |

**成功响应示例**:
```json
{
  "uptime": 3600,
  "requests_total": 1234,
  "database_connections": 10
}
```

---

### 3. 版本信息

**功能介绍**: 获取API版本信息

**请求方式**: `GET`

**请求路径**: `/api/v1/version`

**请求参数**: 无

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| version | string | API版本 |
| build_time | string | 构建时间 |

**成功响应示例**:
```json
{
  "version": "1.0.0",
  "build_time": "2025-01-01T00:00:00Z"
}
```

---

## 📌 通用说明

### 认证方式

大部分API需要在请求头中携带JWT访问令牌：

```
Authorization: Bearer {access_token}
```

### 响应格式

所有API响应均为JSON格式，包含以下基本字段：

```json
{
  "success": true/false,
  "message": "消息内容",
  "data": {}
}
```

### 错误处理

当请求失败时，响应中会包含详细的错误信息：

```json
{
  "success": false,
  "message": "错误描述",
  "data": null
}
```

### 状态码

- `200 OK`: 请求成功
- `400 Bad Request`: 请求参数错误
- `401 Unauthorized`: 未授权（令牌无效或过期）
- `403 Forbidden`: 禁止访问
- `404 Not Found`: 资源不存在
- `500 Internal Server Error`: 服务器内部错误

---

## 🔐 安全说明

1. **密码安全**: 使用PBKDF2-HMAC-SHA256算法，100,000次迭代
2. **令牌安全**: JWT令牌使用HS256签名算法
3. **传输安全**: 生产环境建议使用HTTPS
4. **SQL注入防护**: 所有数据库查询使用预编译语句

---

## 📝 更新日志

### v2.0.0 (2025-10-08)
- ✅ 新增帖子管理API（9个接口）
  - 创建帖子（支持1-9张图片）
  - 获取帖子详情
  - 更新帖子
  - 删除帖子
  - 获取Feed流（分页）
  - 获取用户帖子列表
  - 添加图片到帖子
  - 删除帖子中的图片
  - 调整图片顺序
- ✅ 图片管理API升级为帖子系统
- ❌ 废弃 PUT /images/:image_id/text（使用 PUT /posts/:post_id 代替）

### v1.2.0 (2025-10-05)
- ✅ 新增图片管理API（6个接口）
  - 上传图片
  - 获取图片详情
  - 获取最近图片列表
  - 更新图片文本
  - 删除图片
  - 获取用户图片列表

### v1.0.0 (2025-01-XX)
- ✅ 实现用户注册API
- ✅ 实现用户登录API（支持用户名/手机号/邮箱）
- ✅ 实现令牌验证API
- ✅ 实现令牌刷新API
- ✅ 实现用户登出API
- ✅ 实现修改密码API
- ✅ 实现健康检查API
- ✅ 实现系统指标API
- ✅ 实现版本信息API

---

**文档最后更新**: 2025-10-02
**维护者**: Shared Parking Team
