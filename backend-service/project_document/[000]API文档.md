# Knot 图片分享系统 API 文档

**项目名称**: Knot - Image Sharing Service
**版本**: v2.5.0 (Feed流批量查询优化版本)
**更新时间**: 2025-10-18
**基础URL**: `http://localhost:8080/api/v1`/`http://43.142.157.145:8080/api/v1`
**部署服务器ip**：43.142.157.145

---

## 📋 目录

1. [认证相关API](#认证相关api)
   - [用户注册](#1-用户注册)
   - [用户登录](#2-用户登录)
   - [令牌验证](#3-令牌验证)
   - [令牌刷新](#4-令牌刷新)
   - [用户登出](#5-用户登出)
   - [修改密码](#6-修改密码)
   - [获取当前用户信息](#7-获取当前用户信息) **🆕 v2.1.0**
   - [更新用户信息](#8-更新用户信息) **🆕 v2.1.0**
   - [获取用户公开信息](#9-获取用户公开信息) **🆕 v2.1.0**
   - [检查用户名可用性](#10-检查用户名可用性) **🆕 v2.1.0**

2. [帖子管理API](#帖子管理api) **🆕 v2.0.0**
   - [创建帖子](#1-创建帖子)
   - [获取帖子详情](#2-获取帖子详情)
   - [更新帖子](#3-更新帖子)
   - [删除帖子](#4-删除帖子)
   - [获取Feed流](#5-获取feed流) **🔥 v2.5.0优化**
   - [获取用户帖子列表](#6-获取用户帖子列表) **🔥 v2.5.0优化**
   - [添加图片到帖子](#7-添加图片到帖子)
   - [从帖子删除图片](#8-从帖子删除图片)
   - [调整图片顺序](#9-调整图片顺序)

3. [点赞相关API](#点赞相关api) **🆕 v2.2.0**
   - [点赞帖子](#1-点赞帖子)
   - [取消点赞](#2-取消点赞)
   - [查询点赞状态](#3-查询点赞状态)

4. [收藏相关API](#收藏相关api) **🆕 v2.2.0**
   - [收藏帖子](#1-收藏帖子)
   - [取消收藏](#2-取消收藏)
   - [查询收藏状态](#3-查询收藏状态)
   - [获取用户收藏列表](#4-获取用户收藏列表)

5. [关注相关API](#关注相关api) **🆕 v2.2.0**
   - [关注用户](#1-关注用户)
   - [取消关注](#2-取消关注)
   - [查询关注状态](#3-查询关注状态)
   - [获取关注列表](#4-获取关注列表)
   - [获取粉丝列表](#5-获取粉丝列表)
   - [获取用户统计信息](#6-获取用户统计信息)
   - [批量检查关注状态](#7-批量检查关注状态)

6. [分享相关API](#分享相关api) **🆕 v2.3.0**
   - [创建帖子分享链接](#1-创建帖子分享链接)
   - [解析分享链接](#2-解析分享链接)

7. [图片管理API](#图片管理api) **⚠️ 部分已废弃**
   - [上传图片](#1-上传图片) ✅ 可用（内部调用Post API）
   - [获取最新图片列表](#2-获取最新图片列表) ✅ 可用
   - [获取图片详情](#3-获取图片详情) ✅ 可用
   - [更新图文配文](#4-更新图文配文) ❌ 已废弃（使用Post API）
   - [删除图片](#5-删除图片) ✅ 可用
   - [获取用户图片列表](#6-获取用户图片列表) ✅ 可用

8. [系统相关API](#系统相关api)
   - [健康检查](#1-健康检查)
   - [系统指标](#2-系统指标)
   - [版本信息](#3-版本信息)

---

## 🔔 最新版本更新

### 🚀 v2.5.0 Feed流批量查询优化（2025-10-18）

**核心优化**：解决N+1查询问题，支持游客访问，统一返回格式
- ✅ **可选JWT认证** - Feed流支持游客和登录用户统一访问，无效Token自动降级为游客模式（不返回401）
- ✅ **批量查询优化** - 使用SQL IN批量查询作者信息、点赞状态、收藏状态，解决N+1查询问题
- ✅ **新增返回字段** - Feed流新增`author`（作者信息）、`has_liked`（点赞状态）、`has_favorited`（收藏状态）字段
- ✅ **统一JSON结构** - 字段始终存在，游客返回`false`而不是`null`或省略字段
- ✅ **性能提升** - 游客访问减少95.2%查询次数，登录用户减少93.4%查询次数，QPS提升200%

**影响接口**：
- `GET /api/v1/posts` - 获取Feed流（新增可选认证+批量查询）
- `GET /api/v1/users/:user_id/posts` - 获取用户帖子列表（新增可选认证+批量查询）

**性能指标**：
- 游客访问Feed流（20条）：21次查询 → 1次查询（⬇️95.2%）
- 登录用户访问Feed流（20条）：61次查询 → 4次查询（⬇️93.4%）
- 响应时间（P99）：~150ms → ~50ms（⬆️66.7%）
- QPS：~100 → ~300（⬆️200%）

**详细文档**：
- 优化方案见：`project_document/[118]Feed流用户状态批量查询优化方案.md`

---

### 🔧 v2.4.1 JSON格式创建帖子支持（2025-10-15）

**新增功能**：创建帖子接口支持JSON+Base64格式
- ✅ 支持`application/json` Content-Type（Base64图片）
- ✅ 支持`multipart/form-data` Content-Type（文件上传）
- ✅ 自动检测和解码Base64数据（Data URI和纯Base64）
- ✅ 完全向后兼容，不影响现有客户端

**影响接口**：
- `POST /api/v1/posts` - 创建帖子

**技术亮点**：
- Base64解码时间：<1ms（9KB图片）
- 支持格式：PNG、JPEG、GIF、WebP
- 自动识别Content-Type并切换解析逻辑

**详细文档**：
- 实施计划见：`project_document/[115]创建帖子接口支持JSON+Base64格式-实施计划.md`

---

### 🔗 v2.3.0 分享系统（2025-10-11）

**新增功能**：短链接生成与三端Deep Link支持
- ✅ 短链接生成系统（雪花ID + Base62编码）
- ✅ Deep Link支持（iOS Universal Links、Android App Links、HarmonyOS Deep Linking）
- ✅ 短链接去重（同一帖子返回相同短链接）
- ✅ 过期机制支持

**新增接口**：
- `POST /api/v1/posts/:post_id/share` - 创建帖子分享链接
- `GET /api/v1/share/:code` - 解析分享链接（公开接口）

**技术亮点**：
- 8位Base62短码，62^8 ≈ 218万亿种可能
- 三端Deep Link统一配置方案
- 外键级联删除，数据一致性保证

**详细文档**：
- 实施计划见：`project_document/[109]阶段D-3-分享系统实现计划.md`

---

## 📋 通用说明

### 图片URL自动前缀

**所有返回的图片路径已自动添加服务器URL前缀**，客户端可直接使用返回的完整URL访问图片。

**影响字段**：
- `file_url` - 原图URL
- `thumbnail_url` - 缩略图URL
- `cover_image_url` - 封面图URL
- `avatar_url` - 用户头像URL

**返回格式**：
```json
{
  "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_xxx.jpg",
  "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_xxx_thumb.jpg"
}
```

**配置说明**：
- 生产环境：自动使用 `http://43.142.157.145:8080` 作为前缀
- 开发环境：可在 `config.json` 中配置 `server.base_url` 自定义前缀
- 相对路径模式：设置 `server.base_url: ""` 返回相对路径（用于本地开发）

---

## 认证相关API

### 1. 用户注册

**功能介绍**: 注册新用户账号

**请求方式**: `POST`

**请求路径**: `/auth/register`

**请求头**:
```
Content-Type: application/json
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| username | string | 是 | 用户名（3-50字符，字母数字下划线） | "zhangsan" |
| password | string | 是 | 密码（6-100字符） | "password123" |
| real_name | string | 是 | 真实姓名（不超过50字符） | "张三" |
| phone | string | 是 | 手机号（11位中国手机号） | "13800138000" |
| email | string | 否 | 邮箱（可选） | "zhangsan@example.com" |
| role | string | 否 | 用户角色（owner/driver/both，默认driver） | "driver" |

**请求示例**:
```json
{
  "username": "zhangsan",
  "password": "password123",
  "real_name": "张三",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "role": "driver"
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 用户数据（成功时返回） |
| data.id | integer | 物理ID |
| data.user_id | string | 逻辑ID |
| data.username | string | 用户名 |
| data.real_name | string | 真实姓名 |
| data.phone | string | 手机号 |
| data.email | string | 邮箱 |
| data.role | string | 用户角色 |
| data.status | string | 账户状态 |
| data.create_time | integer | 创建时间（时间戳） |

**成功响应示例**:
```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "id": 1,
    "user_id": "USR_2025Q1_A1B2C3",
    "username": "zhangsan",
    "real_name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "role": "driver",
    "status": "active",
    "avatar_url": "",
    "device_count": 0,
    "create_time": 1704067200,
    "update_time": 1704067200
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "用户名已存在",
  "data": null
}
```

**错误码说明**:
- `用户名已存在`: 用户名重复
- `手机号已被注册`: 手机号重复
- `邮箱已被注册`: 邮箱重复
- `用户名不能为空`: 参数验证失败
- `手机号格式不正确`: 手机号格式错误

---

### 2. 用户登录

**功能介绍**: 用户登录获取访问令牌

**请求方式**: `POST`

**请求路径**: `/auth/login`

**请求头**:
```
Content-Type: application/json
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| username | string | 是 | 用户名/手机号/邮箱 | "zhangsan" 或 "13800138000" |
| password | string | 是 | 密码 | "password123" |

**请求示例**:
```json
{
  "username": "zhangsan",
  "password": "password123"
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 登录数据（成功时返回） |
| data.access_token | string | 访问令牌（有效期1小时） |
| data.refresh_token | string | 刷新令牌（有效期24小时） |
| data.user | object | 用户信息 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 1,
      "user_id": "USR_2025Q1_A1B2C3",
      "username": "zhangsan",
      "real_name": "张三",
      "phone": "13800138000",
      "email": "zhangsan@example.com",
      "role": "driver",
      "status": "active"
    }
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "密码错误",
  "data": null
}
```

**错误码说明**:
- `用户不存在`: 用户名/手机号/邮箱不存在
- `密码错误`: 密码不正确
- `账户已被封禁`: 账户状态为banned
- `账户未激活`: 账户状态为inactive

---

### 3. 令牌验证

**功能介绍**: 验证JWT访问令牌是否有效

**请求方式**: `POST`

**请求路径**: `/auth/validate`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| token | string | 是 | JWT访问令牌 | "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." |

**请求示例**:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| valid | boolean | 令牌是否有效 |
| message | string | 返回消息 |
| data | object | 令牌数据（有效时返回） |
| data.user_id | integer | 用户ID |
| data.username | string | 用户名 |

**成功响应示例**:
```json
{
  "valid": true,
  "message": "令牌有效",
  "data": {
    "user_id": 1,
    "username": "zhangsan"
  }
}
```

**失败响应示例**:
```json
{
  "valid": false,
  "message": "令牌无效或已过期",
  "data": null
}
```

---

### 4. 令牌刷新

**功能介绍**: 使用刷新令牌获取新的访问令牌

**请求方式**: `POST`

**请求路径**: `/auth/refresh`

**请求头**:
```
Content-Type: application/json
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| refresh_token | string | 是 | JWT刷新令牌 | "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." |

**请求示例**:
```json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 新令牌数据 |
| data.access_token | string | 新的访问令牌 |
| data.refresh_token | string | 新的刷新令牌 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "令牌刷新成功",
  "data": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "刷新令牌无效",
  "data": null
}
```

---

### 5. 用户登出

**功能介绍**: 用户登出（简化实现，JWT令牌自动过期）

**请求方式**: `POST`

**请求路径**: `/auth/logout`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| access_token | string | 是 | JWT访问令牌 | "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." |

**请求示例**:
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "登出成功"
}
```

**注意**: 当前实现为简化版本，JWT令牌会在过期后自动失效，未实现令牌黑名单功能。

---

### 6. 修改密码

**功能介绍**: 修改用户密码

**请求方式**: `PUT`

**请求路径**: `/auth/password`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| user_id | integer | 是 | 用户ID | 1 |
| old_password | string | 是 | 旧密码 | "password123" |
| new_password | string | 是 | 新密码（6-100字符） | "newpassword456" |

**请求示例**:
```json
{
  "user_id": 1,
  "old_password": "password123",
  "new_password": "newpassword456"
}
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "密码修改成功"
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "旧密码不正确"
}
```

**错误码说明**:
- `用户不存在`: 用户ID不存在
- `旧密码不正确`: 旧密码验证失败
- `新密码格式不正确`: 新密码长度不符合要求

---

### 7. 获取当前用户信息

**功能介绍**: 获取当前登录用户的完整信息

**请求方式**: `GET`

**请求路径**: `/users/profile`

**请求头**:
```
Authorization: Bearer {access_token}
```

**请求参数**: 无

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 用户数据（成功时返回） |
| data.id | integer | 物理ID |
| data.user_id | string | 逻辑ID |
| data.username | string | 用户名 |
| data.real_name | string | 真实姓名 |
| data.phone | string | 手机号 |
| data.email | string | 邮箱 |
| data.avatar_url | string | 头像URL |
| data.bio | string | 个人简介 |
| data.gender | string | 性别(male/female/other/prefer_not_to_say) |
| data.location | string | 所在地 |
| data.role | string | 用户角色 |
| data.status | string | 账户状态 |
| data.device_count | integer | 绑定设备数 |
| data.create_time | integer | 创建时间（时间戳） |
| data.update_time | integer | 更新时间（时间戳） |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "id": 7,
    "user_id": "USR_2025Q4_CBNLB0",
    "username": "testuser001",
    "real_name": "测试用户001",
    "phone": "13900000099",
    "email": "test001@example.com",
    "avatar_url": "",
    "bio": "这是我的个人简介",
    "gender": "male",
    "location": "北京",
    "role": "user",
    "status": "active",
    "device_count": 0,
    "create_time": 1760018775,
    "update_time": 1760018818
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "令牌无效或已过期",
  "data": null
}
```

**错误码说明**:
- `未提供认证令牌`: Authorization头缺失
- `令牌无效或已过期`: token验证失败
- `用户不存在`: 用户ID不存在

---

### 8. 更新用户信息

**功能介绍**: 更新当前登录用户的个人信息

**请求方式**: `PUT`

**请求路径**: `/users/profile`

**请求头**:
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| real_name | string | 是 | 真实姓名（不超过50字符） | "张三" |
| phone | string | 是 | 手机号（11位中国手机号，必须以1开头） | "13800138000" |
| email | string | 否 | 邮箱（符合标准邮箱格式） | "zhangsan@example.com" |
| avatar_url | string | 否 | 头像URL（支持HTTP/HTTPS协议） | "https://example.com/avatar.jpg" |
| bio | string | 否 | 个人简介（不超过500字符） | "热爱摄影和旅行" |
| gender | string | 否 | 性别（male/female/other/prefer_not_to_say） | "male" |
| location | string | 否 | 所在地（不超过100字符） | "北京市朝阳区" |

**参数说明**:
- `real_name` 和 `phone` 为必填字段
- 其他字段为可选，若不传则保持原值不变
- `phone` 如果修改，会检查是否已被其他用户使用
- `email` 如果修改，会检查是否已被其他用户使用
- `avatar_url` 建议使用HTTPS协议的完整URL
- `gender` 只接受以下四个值：`male`（男）、`female`（女）、`other`（其他）、`prefer_not_to_say`（不愿透露）

**请求示例**:
```json
{
  "real_name": "张三",
  "phone": "13800138000",
  "email": "zhangsan@example.com",
  "avatar_url": "https://example.com/avatar.jpg",
  "bio": "热爱摄影和旅行",
  "gender": "male",
  "location": "北京市朝阳区"
}
```

**部分更新示例**（只更新部分字段）:
```json
{
  "real_name": "张三",
  "phone": "13800138000",
  "bio": "更新个人简介",
  "gender": "male"
}
```
*说明：未提供的可选字段（如email、avatar_url、location）将保持原值*

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 更新后的用户数据（成功时返回） |

**成功响应示例**:
```json
{
  "success": true,
  "message": "用户信息更新成功",
  "data": {
    "id": 7,
    "user_id": "USR_2025Q4_CBNLB0",
    "username": "testuser001",
    "real_name": "张三",
    "phone": "13800138000",
    "email": "zhangsan@example.com",
    "avatar_url": "https://example.com/avatar.jpg",
    "bio": "热爱摄影和旅行",
    "gender": "male",
    "location": "北京",
    "role": "user",
    "status": "active",
    "device_count": 0,
    "create_time": 1760018775,
    "update_time": 1760020100
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "邮箱已被其他用户使用",
  "data": null
}
```

**错误码说明**:
- `未提供认证令牌`: 缺少Authorization头
- `令牌无效或已过期`: token验证失败
- `用户不存在`: 用户ID不存在于数据库
- `真实姓名不能为空`: real_name参数缺失
- `手机号格式无效`: 手机号不符合11位中国手机号格式（必须以1开头）
- `邮箱格式无效`: 邮箱格式不正确
- `手机号已被使用`: 手机号已被其他用户注册
- `邮箱已被使用`: 邮箱已被其他用户使用
- `个人简介不能超过500个字符`: bio字段长度超限
- `所在地不能超过100个字符`: location字段长度超限
- `更新用户信息失败`: 数据库更新操作失败

**常见错误场景**:
1. **头像URL被误判为手机号**: 
   - ❌ 错误：参数顺序不对（已修复）
   - ✅ 正确：确保按照文档顺序传递参数
   
2. **bio/gender/location无法更新**:
   - ❌ 错误：代码BUG（已修复于v2.1.1）
   - ✅ 正确：现在这些字段可以正常更新
   
3. **手机号或邮箱已被使用**:
   - 修改时会检查唯一性，如果与其他用户冲突会报错
   - 如果修改为当前用户已有的值，不会报错

---

### 9. 获取用户公开信息

**功能介绍**: 获取指定用户的公开信息（无需认证）

**请求方式**: `GET`

**请求路径**: `/users/{user_id}`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| user_id | string | 是 | 用户逻辑ID（路径参数） | "USR_2025Q4_CBNLB0" |

**请求示例**:
```
GET /api/v1/users/USR_2025Q4_CBNLB0
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 用户公开数据（成功时返回） |
| data.user_id | string | 逻辑ID |
| data.username | string | 用户名 |
| data.real_name | string | 真实姓名 |
| data.avatar_url | string | 头像URL |
| data.bio | string | 个人简介 |
| data.gender | string | 性别 |
| data.location | string | 所在地 |
| data.create_time | integer | 创建时间（时间戳） |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "user_id": "USR_2025Q4_CBNLB0",
    "username": "testuser001",
    "real_name": "测试用户001",
    "avatar_url": "",
    "bio": "这是我的个人简介",
    "gender": "male",
    "location": "北京",
    "create_time": 1760018775
  }
}
```

**失败响应示例**:
```json
{
  "success": false,
  "message": "用户不存在",
  "data": null
}
```

**错误码说明**:
- `用户不存在`: 指定的user_id不存在

**注意事项**:
- 此接口无需认证,任何人都可以访问
- 仅返回公开信息,不包含敏感字段(如手机号、邮箱、密码等)

---

### 10. 检查用户名可用性

**功能介绍**: 检查用户名是否可用于注册（无需认证）

**请求方式**: `GET`

**请求路径**: `/users/check-username`

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| username | string | 是 | 待检查的用户名（查询参数） | "zhangsan" |

**请求示例**:
```
GET /api/v1/users/check-username?username=zhangsan
```

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 检查结果数据（成功时返回） |
| data.valid | boolean | 格式是否有效 |
| data.available | boolean | 是否可用 |

**成功响应示例（用户名可用）**:
```json
{
  "success": true,
  "message": "用户名可用",
  "data": {
    "valid": true,
    "available": true
  }
}
```

**成功响应示例（用户名已被占用）**:
```json
{
  "success": true,
  "message": "用户名已被占用",
  "data": {
    "valid": true,
    "available": false
  }
}
```

**失败响应示例（格式无效）**:
```json
{
  "success": false,
  "message": "用户名长度必须在3-50个字符之间",
  "data": {
    "valid": false,
    "available": false
  }
}
```

**错误码说明**:
- `缺少username参数`: 查询参数缺失
- `用户名不能为空`: 用户名为空字符串
- `用户名长度必须在3-50个字符之间`: 长度不符合要求
- `用户名只能包含字母、数字和下划线`: 格式不正确

**注意事项**:
- 此接口无需认证,任何人都可以访问
- 用户名格式要求:3-50个字符,只能包含字母、数字和下划线
- valid=false时,available必定为false

---

## 帖子管理API

> **🆕 v2.0.0 新增**: 支持多图片帖子（1-9张图片）

### 1. 创建帖子

**功能介绍**: 创建包含1-9张图片的帖子

**请求方式**: `POST`

**请求路径**: `/posts`

**支持的Content-Type**:
- ✅ `multipart/form-data` - 适用于Web浏览器、原生应用的文件上传
- ✅ `application/json` - 适用于API调用、Base64图片上传 **🆕 v2.4.1**

---

#### 格式1: multipart/form-data（推荐用于文件上传）

**请求头**:
```
Content-Type: multipart/form-data
Authorization: Bearer <access_token>
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | string | 是 | 帖子标题（1-255字符） |
| description | string | 否 | 帖子配文（最多1000字符） |
| imageFiles | file[] | 是 | 图片文件数组（1-9张，每张最大5MB） |
| tags | string[] | 否 | 标签数组（最多5个） |

**请求示例（curl）**:
```bash
curl -X POST "http://localhost:8080/api/v1/posts" \
  -H "Authorization: Bearer <token>" \
  -F "title=美好的一天" \
  -F "description=今天天气真好" \
  -F "tags=风景" \
  -F "tags=旅行" \
  -F "imageFiles=@photo1.jpg" \
  -F "imageFiles=@photo2.jpg" \
  -F "imageFiles=@photo3.jpg"
```

---

#### 格式2: application/json（适用于Base64图片） **🆕 v2.4.1**

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | string | 是 | 帖子标题（1-255字符） |
| description | string | 否 | 帖子配文（最多1000字符） |
| images | object[] | 是 | 图片数组（1-9张） |
| images[].filename | string | 否 | 文件名（默认: image.jpg） |
| images[].content_type | string | 否 | MIME类型（默认: image/jpeg） |
| images[].data | string | 是 | Base64编码的图片数据 |
| tags | string[] | 否 | 标签数组（最多5个） |

**Base64数据格式**:
- 支持Data URI格式: `data:image/jpeg;base64,/9j/4AAQSkZJRg...`
- 支持纯Base64格式: `/9j/4AAQSkZJRg...`

**请求示例（JSON）**:
```json
{
  "title": "美好的一天",
  "description": "今天天气真好，拍了几张照片分享给大家",
  "tags": ["风景", "旅行", "摄影"],
  "images": [
    {
      "filename": "photo1.jpg",
      "content_type": "image/jpeg",
      "data": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD..."
    },
    {
      "filename": "photo2.png",
      "content_type": "image/png",
      "data": "iVBORw0KGgoAAAANSUhEUgAA..."
    }
  ]
}
```

---

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post_id | string | 帖子业务ID |
| data.user_id | integer | 发布用户ID |
| data.title | string | 帖子标题 |
| data.description | string | 帖子配文 |
| data.image_count | integer | 图片数量 |
| data.like_count | integer | 点赞数 |
| data.favorite_count | integer | 收藏数 |
| data.view_count | integer | 浏览数 |
| data.status | string | 审核状态（PENDING/APPROVED/REJECTED） |
| data.create_time | integer | 创建时间（Unix时间戳） |
| data.update_time | integer | 更新时间（Unix时间戳） |
| data.images | array | 图片数组 |
| data.images[].image_id | string | 图片业务ID |
| data.images[].post_id | integer | 所属帖子物理ID |
| data.images[].display_order | integer | 显示顺序（1-9） |
| data.images[].file_url | string | 原图URL路径 |
| data.images[].thumbnail_url | string | 缩略图URL路径 |
| data.images[].file_size | integer | 文件大小（字节） |
| data.images[].width | integer | 图片宽度（像素） |
| data.images[].height | integer | 图片高度（像素） |
| data.images[].mime_type | string | MIME类型 |
| data.images[].create_time | integer | 创建时间（Unix时间戳） |
| timestamp | integer | 响应时间戳 |

**返回示例**:
```json
{
  "success": true,
  "message": "帖子创建成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "user_id": 1,
    "title": "美好的一天",
    "description": "今天天气真好，拍了几张照片分享给大家",
    "image_count": 3,
    "like_count": 0,
    "favorite_count": 0,
    "view_count": 0,
    "status": "APPROVED",
    "create_time": 1728360600,
    "update_time": 1728360600,
    "images": [
      {
        "image_id": "IMG_2025Q4_XYZ001",
        "post_id": 1,
        "display_order": 1,
        "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ001.jpg",
        "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ001_thumb.jpg",
        "file_size": 1024000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "create_time": 1728360600
      },
      {
        "image_id": "IMG_2025Q4_XYZ002",
        "post_id": 1,
        "display_order": 2,
        "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ002.jpg",
        "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ002_thumb.jpg",
        "file_size": 856000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "create_time": 1728360600
      },
      {
        "image_id": "IMG_2025Q4_XYZ003",
        "post_id": 1,
        "display_order": 3,
        "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ003.jpg",
        "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ003_thumb.jpg",
        "file_size": 920000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "create_time": 1728360600
      }
    ]
  },
  "timestamp": 1728360600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `400 Bad Request`: 参数错误（标题为空、图片数量不符合要求等）
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 获取帖子详情

**功能介绍**: 获取帖子的完整信息（包含所有图片）

**请求方式**: `GET`

**请求路径**: `/posts/:post_id`

**请求头**:
```
无需认证
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 帖子数据对象（包含完整的images数组） |

**返回示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "user_id": 1,
    "title": "美好的一天",
    "description": "今天天气真好，拍了几张照片分享给大家",
    "image_count": 3,
    "like_count": 10,
    "favorite_count": 5,
    "view_count": 100,
    "status": "APPROVED",
    "create_time": 1728360600,
    "update_time": 1728360600,
    "images": [
      {
        "image_id": "IMG_2025Q4_XYZ001",
        "post_id": 1,
        "display_order": 1,
        "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ001.jpg",
        "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ001_thumb.jpg",
        "file_size": 1024000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "create_time": 1728360600
      }
    ]
  },
  "timestamp": 1728360600
}
```

**错误码**:
- `404 Not Found`: 帖子不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 3. 更新帖子

**功能介绍**: 更新帖子的标题和配文（只有作者可以更新）

**请求方式**: `PUT`

**请求路径**: `/posts/:post_id`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | string | 是 | 新标题（1-255字符） |
| description | string | 否 | 新配文（最多1000字符） |

**请求示例**:
```json
{
  "title": "更新后的标题",
  "description": "更新后的配文"
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "帖子更新成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 4. 删除帖子

**功能介绍**: 删除帖子及其所有图片（只有作者可以删除）

**请求方式**: `DELETE`

**请求路径**: `/posts/:post_id`

**请求头**:
```
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "帖子删除成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 5. 获取Feed流

**功能介绍**: 获取最新帖子列表（分页）

**请求方式**: `GET`

**请求路径**: `/posts`

**请求头**:
```
Authorization: Bearer <access_token>  (可选)
```

**认证说明**:
- **游客模式**: 不提供Token或Token无效时，自动降级为游客模式，`has_liked`和`has_favorited`字段返回`false`
- **登录模式**: 提供有效Token时，返回当前用户对每个帖子的真实互动状态

**查询参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码（默认1） |
| pageSize | int | 否 | 每页数量（默认20，最大100） |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.posts | array | 帖子列表（包含images、author、互动状态） |
| data.posts[].author | object | **新增** 帖子作者信息 |
| data.posts[].author.user_id | integer | **新增** 作者用户ID |
| data.posts[].author.username | string | **新增** 作者用户名 |
| data.posts[].author.avatar_url | string | **新增** 作者头像URL |
| data.posts[].has_liked | boolean | **新增** 当前用户是否已点赞（游客固定返回false） |
| data.posts[].has_favorited | boolean | **新增** 当前用户是否已收藏（游客固定返回false） |
| data.total | integer | 总帖子数 |
| data.page | integer | 当前页码 |
| data.page_size | integer | 每页数量 |
| timestamp | integer | 响应时间戳 |

**返回示例**:

**游客模式（无Token）**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "posts": [
      {
        "post_id": "POST_2025Q4_ABC123",
        "user_id": 1,
        "title": "美好的一天",
        "description": "今天天气真好",
        "image_count": 3,
        "like_count": 10,
        "favorite_count": 5,
        "view_count": 100,
        "status": "APPROVED",
        "create_time": 1728360600,
        "update_time": 1728360600,
        "author": {
          "user_id": 1,
          "username": "alice",
          "avatar_url": "http://43.142.157.145:8080/uploads/avatars/alice.jpg"
        },
        "has_liked": false,
        "has_favorited": false,
        "images": [
          {
            "image_id": "IMG_2025Q4_XYZ001",
            "post_id": 1,
            "display_order": 1,
            "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ001.jpg",
            "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ001_thumb.jpg",
            "file_size": 1024000,
            "width": 1920,
            "height": 1080,
            "mime_type": "image/jpeg",
            "create_time": 1728360600
          }
        ]
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20
  },
  "timestamp": 1728360600
}
```

**登录模式（带Token）**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "posts": [
      {
        "post_id": "POST_2025Q4_ABC123",
        "user_id": 1,
        "title": "美好的一天",
        "description": "今天天气真好",
        "image_count": 3,
        "like_count": 10,
        "favorite_count": 5,
        "view_count": 100,
        "status": "APPROVED",
        "create_time": 1728360600,
        "update_time": 1728360600,
        "author": {
          "user_id": 1,
          "username": "alice",
          "avatar_url": "http://43.142.157.145:8080/uploads/avatars/alice.jpg"
        },
        "has_liked": true,
        "has_favorited": false,
        "images": [
          {
            "image_id": "IMG_2025Q4_XYZ001",
            "post_id": 1,
            "display_order": 1,
            "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ001.jpg",
            "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ001_thumb.jpg",
            "file_size": 1024000,
            "width": 1920,
            "height": 1080,
            "mime_type": "image/jpeg",
            "create_time": 1728360600
          }
        ]
      }
    ],
    "total": 100,
    "page": 1,
    "page_size": 20
  },
  "timestamp": 1728360600
}
```

**错误码**:
- `400 Bad Request`: 参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 6. 获取用户帖子列表

**功能介绍**: 获取指定用户的所有帖子（分页）

**请求方式**: `GET`

**请求路径**: `/users/:user_id/posts`

**请求头**:
```
Authorization: Bearer <access_token>  (可选)
```

**认证说明**:
- **游客模式**: 不提供Token或Token无效时，自动降级为游客模式，`has_liked`和`has_favorited`字段返回`false`
- **登录模式**: 提供有效Token时，返回当前用户对每个帖子的真实互动状态

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | int | 是 | 用户ID |

**查询参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | int | 否 | 页码（默认1） |
| pageSize | int | 否 | 每页数量（默认20，最大100） |

**返回参数**: 同"获取Feed流"（包含author、has_liked、has_favorited字段）

**错误码**:
- `400 Bad Request`: 参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 7. 添加图片到帖子

**功能介绍**: 向现有帖子添加图片（最多9张）

**请求方式**: `POST`

**请求路径**: `/posts/:post_id/images`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| imageFile | string | 是 | 图片文件路径 |

**请求示例**:
```json
{
  "imageFile": "/tmp/upload_new123.jpg"
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "图片添加成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 图片数量已达上限（9张）
- `500 Internal Server Error`: 服务器内部错误

---

### 8. 从帖子删除图片

**功能介绍**: 从帖子中删除指定图片（至少保留1张）

**请求方式**: `DELETE`

**请求路径**: `/posts/:post_id/images/:image_id`

**请求头**:
```
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |
| image_id | string | 是 | 图片业务ID |

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "图片删除成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子或图片不存在
- `400 Bad Request`: 不能删除最后一张图片
- `500 Internal Server Error`: 服务器内部错误

---

### 9. 调整图片顺序

**功能介绍**: 调整帖子中图片的显示顺序

**请求方式**: `PUT`

**请求路径**: `/posts/:post_id/images/order`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer <access_token>
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| imageIds | array | 是 | 图片ID数组（按新顺序排列） |

**请求示例**:
```json
{
  "imageIds": [
    "IMG_2025Q4_XYZ003",
    "IMG_2025Q4_XYZ001",
    "IMG_2025Q4_XYZ002"
  ]
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |

**返回示例**:
```json
{
  "success": true,
  "message": "图片顺序调整成功",
  "timestamp": 1696752600
}
```

**错误码**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `403 Forbidden`: 无权限（不是作者）
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 图片ID数量不匹配或包含无效ID
- `500 Internal Server Error`: 服务器内部错误

---

## 点赞相关API

> **🆕 v2.2.0 新增**: 支持帖子点赞功能

### 1. 点赞帖子

**功能介绍**: 为帖子点赞

**请求方式**: `POST`

**请求路径**: `/api/v1/posts/:post_id/like`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post_id | string | 帖子ID |
| data.like_count | integer | 点赞总数 |
| data.has_liked | boolean | 当前用户是否已点赞 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "点赞成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "like_count": 11,
    "has_liked": true
  },
  "timestamp": 1728360600
}
```

**失败响应示例**（已点赞）:
```json
{
  "success": false,
  "message": "您已经点赞过该帖子",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "like_count": 10,
    "has_liked": true
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 已经点赞过该帖子
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 取消点赞

**功能介绍**: 取消对帖子的点赞

**请求方式**: `DELETE`

**请求路径**: `/api/v1/posts/:post_id/like`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post_id | string | 帖子ID |
| data.like_count | integer | 点赞总数 |
| data.has_liked | boolean | 当前用户是否已点赞 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "取消点赞成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "like_count": 9,
    "has_liked": false
  },
  "timestamp": 1728360600
}
```

**失败响应示例**（未点赞）:
```json
{
  "success": false,
  "message": "您尚未点赞该帖子",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "like_count": 10,
    "has_liked": false
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 尚未点赞该帖子
- `500 Internal Server Error`: 服务器内部错误

---

### 3. 查询点赞状态

**功能介绍**: 查询当前用户对指定帖子的点赞状态

**请求方式**: `GET`

**请求路径**: `/api/v1/posts/:post_id/like/status`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post_id | string | 帖子ID |
| data.has_liked | boolean | 当前用户是否已点赞 |
| data.like_count | integer | 帖子总点赞数 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "has_liked": true,
    "like_count": 10
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 帖子不存在
- `500 Internal Server Error`: 服务器内部错误

---

## 收藏相关API

> **🆕 v2.2.0 新增**: 支持帖子收藏功能

### 1. 收藏帖子

**功能介绍**: 收藏帖子

**请求方式**: `POST`

**请求路径**: `/api/v1/posts/:post_id/favorite`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post_id | string | 帖子ID |
| data.favorite_count | integer | 收藏总数 |
| data.has_favorited | boolean | 当前用户是否已收藏 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "收藏成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "favorite_count": 6,
    "has_favorited": true
  },
  "timestamp": 1728360600
}
```

**失败响应示例**（已收藏）:
```json
{
  "success": false,
  "message": "您已经收藏过该帖子",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "favorite_count": 5,
    "has_favorited": true
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 已经收藏过该帖子
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 取消收藏

**功能介绍**: 取消收藏帖子

**请求方式**: `DELETE`

**请求路径**: `/api/v1/posts/:post_id/favorite`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post_id | string | 帖子ID |
| data.favorite_count | integer | 收藏总数 |
| data.has_favorited | boolean | 当前用户是否已收藏 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "取消收藏成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "favorite_count": 4,
    "has_favorited": false
  },
  "timestamp": 1728360600
}
```

**失败响应示例**（未收藏）:
```json
{
  "success": false,
  "message": "您尚未收藏该帖子",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "favorite_count": 5,
    "has_favorited": false
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 帖子不存在
- `400 Bad Request`: 尚未收藏该帖子
- `500 Internal Server Error`: 服务器内部错误

---

### 3. 查询收藏状态

**功能介绍**: 查询当前用户对指定帖子的收藏状态

**请求方式**: `GET`

**请求路径**: `/api/v1/posts/:post_id/favorite/status`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post_id | string | 帖子ID |
| data.has_favorited | boolean | 当前用户是否已收藏 |
| data.favorite_count | integer | 帖子总收藏数 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "post_id": "POST_2025Q4_ABC123",
    "has_favorited": true,
    "favorite_count": 5
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 帖子不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 4. 获取用户收藏列表

**功能介绍**: 获取当前用户的收藏帖子列表（分页）

**请求方式**: `GET`

**请求路径**: `/api/v1/my/favorites`

**请求头**:
```
Authorization: Bearer {access_token}
```

**查询参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | integer | 否 | 页码（默认1） |
| page_size | integer | 否 | 每页数量（默认20，最大100） |

**请求示例**:
```
GET /api/v1/my/favorites?page=1&page_size=20
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.posts | array | 收藏的帖子列表（包含完整图片信息） |
| data.total | integer | 总收藏数 |
| data.page | integer | 当前页码 |
| data.page_size | integer | 每页数量 |
| data.total_pages | integer | 总页数 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "posts": [
      {
        "post_id": "POST_2025Q4_ABC123",
        "user_id": 1,
        "title": "美好的一天",
        "description": "今天天气真好",
        "image_count": 3,
        "like_count": 10,
        "favorite_count": 5,
        "view_count": 100,
        "status": "APPROVED",
        "create_time": 1728360600,
        "update_time": 1728360600,
        "images": [
          {
            "image_id": "IMG_2025Q4_XYZ001",
            "post_id": 1,
            "display_order": 1,
            "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ001.jpg",
            "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ001_thumb.jpg",
            "file_size": 1024000,
            "width": 1920,
            "height": 1080,
            "mime_type": "image/jpeg",
            "create_time": 1728360600
          }
        ]
      }
    ],
    "total": 15,
    "page": 1,
    "page_size": 20,
    "total_pages": 1
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `400 Bad Request`: 参数错误
- `500 Internal Server Error`: 服务器内部错误

---

## 分享相关API

> **🆕 v2.3.0 新增**: 支持帖子分享功能，生成短链接

### 1. 创建帖子分享链接

**功能介绍**: 为帖子创建分享短链接，支持iOS/Android/HarmonyOS三端Deep Link

**请求方式**: `POST`

**请求路径**: `/posts/:post_id/share`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| post_id | string | 是 | 帖子业务ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.short_code | string | 短链接代码（8位Base62编码） |
| data.short_url | string | 完整短链接URL |
| data.post_id | string | 帖子ID |
| data.create_time | integer | 创建时间 |
| data.expire_time | integer | 过期时间（null表示永久有效） |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "分享链接创建成功",
  "data": {
    "short_code": "kHr7ZS9a",
    "short_url": "http://43.142.157.145:8080/s/kHr7ZS9a",
    "post_id": "POST_2025Q4_ABC123",
    "create_time": 1728360600,
    "expire_time": null
  },
  "timestamp": 1728360600
}
```

**注意事项**:
- 同一个帖子多次调用会返回相同的短链接（去重逻辑）
- 短链接代码由雪花ID算法+Base62编码生成，8位长度
- 支持Deep Link跳转到原生APP：
  - iOS: Universal Links
  - Android: App Links
  - HarmonyOS: Deep Linking + App Linking

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 帖子不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 解析分享链接

**功能介绍**: 根据短链接代码获取帖子信息（公开接口，无需认证）

**请求方式**: `GET`

**请求路径**: `/share/:code`

**请求头**: 无需认证

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| code | string | 是 | 短链接代码 |

**请求示例**:
```
GET /api/v1/share/kHr7ZS9a
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.post | object | 帖子完整信息（包含images数组） |
| data.share_info | object | 分享链接信息 |
| data.share_info.short_code | string | 短链接代码 |
| data.share_info.create_time | integer | 创建时间 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "post": {
      "post_id": "POST_2025Q4_ABC123",
      "user_id": 1,
      "title": "美好的一天",
      "description": "今天天气真好",
      "image_count": 3,
      "like_count": 10,
      "favorite_count": 5,
      "view_count": 101,
      "status": "APPROVED",
      "create_time": 1728360600,
      "update_time": 1728360600,
      "images": [
        {
          "image_id": "IMG_2025Q4_XYZ001",
          "post_id": 1,
          "display_order": 1,
          "file_url": "http://43.142.157.145:8080/uploads/images/IMG_2025Q4_XYZ001.jpg",
          "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/IMG_2025Q4_XYZ001_thumb.jpg",
          "file_size": 1024000,
          "width": 1920,
          "height": 1080,
          "mime_type": "image/jpeg",
          "create_time": 1728360600
        }
      ]
    },
    "share_info": {
      "short_code": "kHr7ZS9a",
      "create_time": 1728360600
    }
  },
  "timestamp": 1728360600
}
```

**错误码说明**:
- `404 Not Found`: 分享链接不存在或已过期
- `500 Internal Server Error`: 服务器内部错误

**注意事项**:
- 此接口无需认证，任何人都可以访问
- 访问分享链接会自动增加帖子浏览数
- 支持三端Deep Link自动跳转APP

---

## 关注相关API

> **🆕 v2.2.0 新增**: 支持用户关注功能

### 1. 关注用户

**功能介绍**: 关注指定用户

**请求方式**: `POST`

**请求路径**: `/api/v1/users/:user_id/follow`

**请求头**:
```
Authorization: Bearer {access_token}
Content-Length: 0
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 目标用户业务ID (如USR_2025Q4_XXX)或物理ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.followee_user_id | string | 被关注用户ID |
| data.is_following | boolean | 是否正在关注 |
| data.follower_count | integer | 该用户粉丝总数 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "关注成功",
  "data": {
    "followee_user_id": "USR_2025Q4_Z35Gd6",
    "is_following": true,
    "follower_count": 15
  },
  "timestamp": 1760698045
}
```

**失败响应示例**（已关注）:
```json
{
  "success": false,
  "message": "您已经关注过该用户",
  "data": {
    "followee_user_id": "USR_2025Q4_Z35Gd6",
    "is_following": true,
    "follower_count": 15
  },
  "timestamp": 1760698045
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 用户不存在
- `400 Bad Request`: 不能关注自己或已经关注过该用户
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 取消关注

**功能介绍**: 取消关注指定用户

**请求方式**: `DELETE`

**请求路径**: `/api/v1/users/:user_id/follow`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 目标用户业务ID或物理ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.followee_user_id | string | 被取消关注的用户ID |
| data.is_following | boolean | 是否正在关注 |
| data.follower_count | integer | 该用户粉丝总数 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "取消关注成功",
  "data": {
    "followee_user_id": "USR_2025Q4_Z35Gd6",
    "is_following": false,
    "follower_count": 14
  },
  "timestamp": 1760698046
}
```

**失败响应示例**（未关注）:
```json
{
  "success": false,
  "message": "您尚未关注该用户",
  "data": {
    "followee_user_id": "USR_2025Q4_Z35Gd6",
    "is_following": false,
    "follower_count": 15
  },
  "timestamp": 1760698046
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 用户不存在或未关注过该用户
- `500 Internal Server Error`: 服务器内部错误

---

### 3. 查询关注状态

**功能介绍**: 查询当前用户与目标用户的关注关系

**请求方式**: `GET`

**请求路径**: `/api/v1/users/:user_id/follow/status`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 目标用户业务ID或物理ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.user_id | string | 目标用户ID |
| data.is_following | boolean | 当前用户是否关注了目标用户 |
| data.is_followed_by | boolean | 目标用户是否关注了当前用户 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "user_id": "USR_2025Q4_Z35Gd6",
    "is_following": true,
    "is_followed_by": false
  },
  "timestamp": 1760698045
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `404 Not Found`: 用户不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 4. 获取关注列表

**功能介绍**: 获取指定用户的关注列表（Following）

**请求方式**: `GET`

**请求路径**: `/api/v1/users/:user_id/following`

**请求头**:
```
Authorization: Bearer {access_token}  # 可选，提供时会标记is_following字段
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户业务ID或物理ID |

**查询参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | integer | 否 | 页码（默认1） |
| page_size | integer | 否 | 每页数量（默认20，最大100） |

**请求示例**:
```
GET /api/v1/users/USR_2025Q4_38TiLL/following?page=1&page_size=20
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.users | array | 用户列表 |
| data.users[].user_id | string | 用户ID |
| data.users[].username | string | 用户名 |
| data.users[].real_name | string | 真实姓名 |
| data.users[].avatar_url | string | 头像URL |
| data.users[].bio | string | 个人简介 |
| data.users[].follower_count | integer | 粉丝数 |
| data.users[].is_following | boolean | 当前用户是否关注了该用户 |
| data.users[].followed_at | integer | 关注时间戳 |
| data.total | integer | 总关注数 |
| data.page | integer | 当前页码 |
| data.page_size | integer | 每页数量 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "users": [
      {
        "user_id": "3",
        "username": "testuser2",
        "real_name": "测试用户2",
        "avatar_url": "",
        "bio": "这是我的个人简介",
        "follower_count": 15,
        "is_following": true,
        "followed_at": 1760698045
      }
    ],
    "total": 1,
    "page": 1,
    "page_size": 20
  },
  "timestamp": 1760698045
}
```

**错误码说明**:
- `400 Bad Request`: 参数错误
- `404 Not Found`: 用户不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 5. 获取粉丝列表

**功能介绍**: 获取指定用户的粉丝列表（Followers）

**请求方式**: `GET`

**请求路径**: `/api/v1/users/:user_id/followers`

**请求头**:
```
Authorization: Bearer {access_token}  # 可选，提供时会标记is_following字段
```

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户业务ID或物理ID |

**查询参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| page | integer | 否 | 页码（默认1） |
| page_size | integer | 否 | 每页数量（默认20，最大100） |

**请求示例**:
```
GET /api/v1/users/3/followers?page=1&page_size=20
```

**返回参数**: 同"获取关注列表"

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "users": [
      {
        "user_id": "2",
        "username": "testuser",
        "real_name": "测试用户",
        "avatar_url": "",
        "bio": "",
        "follower_count": 0,
        "is_following": false,
        "followed_at": 1760698045
      }
    ],
    "total": 1,
    "page": 1,
    "page_size": 20
  },
  "timestamp": 1760698045
}
```

**错误码说明**:
- `400 Bad Request`: 参数错误
- `404 Not Found`: 用户不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 6. 获取用户统计信息

**功能介绍**: 获取用户的关注和粉丝统计信息

**请求方式**: `GET`

**请求路径**: `/api/v1/users/:user_id/stats`

**请求头**: 无需认证

**路径参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_id | string | 是 | 用户业务ID或物理ID |

**请求参数**: 无

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data.user_id | string | 用户ID |
| data.following_count | integer | 关注数 |
| data.follower_count | integer | 粉丝数 |
| data.post_count | integer | 帖子数 |
| data.like_count | integer | 获赞数 |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "user_id": "3",
    "following_count": 5,
    "follower_count": 15,
    "post_count": 23,
    "like_count": 156
  },
  "timestamp": 1760698046
}
```

**错误码说明**:
- `404 Not Found`: 用户不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 7. 批量检查关注状态

**功能介绍**: 批量检查当前用户是否关注了多个用户

**请求方式**: `POST`

**请求路径**: `/api/v1/users/follow/batch-status`

**请求头**:
```
Authorization: Bearer {access_token}
Content-Type: application/json
```

**请求参数**:
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| user_ids | array | 是 | 用户ID列表（最多100个） |

**请求示例**:
```json
{
  "user_ids": ["3", "4", "5", "USR_2025Q4_Z35Gd6"]
}
```

**返回参数**:
| 参数名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否成功 |
| message | string | 返回消息 |
| data | object | 关注状态映射（user_id: is_following） |
| timestamp | integer | 响应时间戳 |

**成功响应示例**:
```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "3": true,
    "4": false,
    "5": true,
    "USR_2025Q4_Z35Gd6": false
  },
  "timestamp": 1760698046
}
```

**错误码说明**:
- `401 Unauthorized`: 未提供认证令牌或令牌无效
- `400 Bad Request`: user_ids为空或超过100个
- `500 Internal Server Error`: 服务器内部错误

---
## 图片管理API

> **⚠️ 部分API已废弃**: 建议使用帖子管理API

### 1. 上传图片

**功能介绍**: 用户上传图文推文（图片为主 + 配文）

**请求方式**: `POST`

**请求路径**: `/images`

**请求头**:
```
Content-Type: multipart/form-data
Authorization: Bearer {access_token}
```

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| image | File | 是 | 图片文件（支持JPEG/PNG/WebP，最大5MB） |
| title | String | 是 | 推文标题（最多255字符） |
| description | String | 否 | 推文配文（详细描述） |
| tags | String | 否 | 标签列表（逗号分隔，最多5个） |

**返回值**:

```json
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "id": 1,
    "image_id": "IMG_2025Q4_123456",
    "user_id": 1,
    "title": "美丽的风景",
    "description": "今天拍摄的日落",
    "file_url": "http://43.142.157.145:8080/uploads/images/abc123.jpg",
    "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/abc123_thumb.jpg",
    "file_size": 1024000,
    "width": 1920,
    "height": 1080,
    "mime_type": "image/jpeg",
    "like_count": 0,
    "favorite_count": 0,
    "view_count": 0,
    "status": "APPROVED",
    "create_time": 1759844400,
    "update_time": 1759844400
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `401 Unauthorized`: 未提供或无效的认证令牌
- `400 Bad Request`: 请求参数错误（未找到图片文件、标题为空、文件过大等）
- `500 Internal Server Error`: 服务器内部错误

---

### 2. 获取最新图片列表

**功能介绍**: 获取最新发布的图文推文列表（按时间倒序）

**请求方式**: `GET`

**请求路径**: `/images?page=1&page_size=20`

**请求头**:
```
无需认证
```

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | Integer | 否 | 1 | 页码（从1开始） |
| page_size | Integer | 否 | 20 | 每页数量（最大100） |

**返回值**:

```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "total": 100,
    "page": 1,
    "page_size": 20,
    "images": [
      {
        "id": 1,
        "image_id": "IMG_2025Q4_123456",
        "user_id": 1,
        "title": "美丽的风景",
        "description": "今天拍摄的日落",
        "file_url": "http://43.142.157.145:8080/uploads/images/abc123.jpg",
        "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/abc123_thumb.jpg",
        "file_size": 1024000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "like_count": 10,
        "favorite_count": 5,
        "view_count": 100,
        "status": "APPROVED",
        "create_time": 1759844400,
        "update_time": 1759844400
      }
    ]
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `400 Bad Request`: 请求参数错误
- `500 Internal Server Error`: 服务器内部错误

---

### 3. 获取图片详情

**功能介绍**: 获取指定图文推文的详细信息（会增加浏览数）

**请求方式**: `GET`

**请求路径**: `/images/:id`

**请求头**:
```
无需认证
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | String | 图片业务逻辑ID（image_id） |

**返回值**:

```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "id": 1,
    "image_id": "IMG_2025Q4_123456",
    "user_id": 1,
    "title": "美丽的风景",
    "description": "今天拍摄的日落",
    "file_url": "http://43.142.157.145:8080/uploads/images/abc123.jpg",
    "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/abc123_thumb.jpg",
    "file_size": 1024000,
    "width": 1920,
    "height": 1080,
    "mime_type": "image/jpeg",
    "like_count": 10,
    "favorite_count": 5,
    "view_count": 101,
    "status": "APPROVED",
    "create_time": 1759844400,
    "update_time": 1759844400
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `404 Not Found`: 图片不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 4. 更新图文配文

> **❌ 已废弃**: 请使用 `PUT /posts/:post_id` 代替

**功能介绍**: 更新图文推文的标题和配文（只有所有者可以编辑）

**请求方式**: `PUT`

**请求路径**: `/images/:id`

**请求头**:
```
Content-Type: application/json
Authorization: Bearer {access_token}
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | String | 图片业务逻辑ID（image_id） |

**请求参数**:

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| title | String | 是 | 新标题（最多255字符） |
| description | String | 否 | 新配文 |

**请求示例**:

```json
{
  "title": "更新后的标题",
  "description": "更新后的配文"
}
```

**返回值**:

```json
{
  "success": true,
  "message": "更新成功",
  "data": null,
  "timestamp": 1759844400
}
```

**错误码**:
- `401 Unauthorized`: 未提供或无效的认证令牌
- `403 Forbidden`: 无权限（不是图片所有者）或图片不存在
- `400 Bad Request`: 请求参数错误（标题为空、标题过长等）
- `500 Internal Server Error`: 服务器内部错误

---

### 5. 删除图片

**功能介绍**: 删除图文推文（只有所有者可以删除）

**请求方式**: `DELETE`

**请求路径**: `/images/:id`

**请求头**:
```
Authorization: Bearer {access_token}
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | String | 图片业务逻辑ID（image_id） |

**返回值**:

```json
{
  "success": true,
  "message": "删除成功",
  "data": null,
  "timestamp": 1759844400
}
```

**错误码**:
- `401 Unauthorized`: 未提供或无效的认证令牌
- `403 Forbidden`: 无权限（不是图片所有者）或图片不存在
- `500 Internal Server Error`: 服务器内部错误

---

### 6. 获取用户图片列表

**功能介绍**: 获取指定用户发布的图文推文列表

**请求方式**: `GET`

**请求路径**: `/users/:id/images?page=1&page_size=20`

**请求头**:
```
无需认证
```

**路径参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| id | Integer | 用户ID |

**请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | Integer | 否 | 1 | 页码（从1开始） |
| page_size | Integer | 否 | 20 | 每页数量（最大100） |

**返回值**:

```json
{
  "success": true,
  "message": "查询成功",
  "data": {
    "total": 50,
    "page": 1,
    "page_size": 20,
    "images": [
      {
        "id": 1,
        "image_id": "IMG_2025Q4_123456",
        "user_id": 1,
        "title": "美丽的风景",
        "description": "今天拍摄的日落",
        "file_url": "http://43.142.157.145:8080/uploads/images/abc123.jpg",
        "thumbnail_url": "http://43.142.157.145:8080/uploads/thumbnails/abc123_thumb.jpg",
        "file_size": 1024000,
        "width": 1920,
        "height": 1080,
        "mime_type": "image/jpeg",
        "like_count": 10,
        "favorite_count": 5,
        "view_count": 100,
        "status": "APPROVED",
        "create_time": 1759844400,
        "update_time": 1759844400
      }
    ]
  },
  "timestamp": 1759844400
}
```

**错误码**:
- `400 Bad Request`: 请求参数错误
- `500 Internal Server Error`: 服务器内部错误

---


## 系统相关API

### 1. 健康检查

**功能介绍**: 检查服务是否正常运行

**请求方式**: `GET`

**请求路径**: `/health`

**请求参数**: 无

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| status | string | 服务状态 |
| timestamp | integer | 时间戳 |

**成功响应示例**:
```json
{
  "status": "healthy",
  "timestamp": 1704067200
}
```

---

### 2. 系统指标

**功能介绍**: 获取系统运行指标

**请求方式**: `GET`

**请求路径**: `/metrics`

**请求参数**: 无

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| uptime | integer | 运行时间（秒） |
| requests_total | integer | 总请求数 |
| database_connections | integer | 数据库连接数 |

**成功响应示例**:
```json
{
  "uptime": 3600,
  "requests_total": 1234,
  "database_connections": 10
}
```

---

### 3. 版本信息

**功能介绍**: 获取API版本信息

**请求方式**: `GET`

**请求路径**: `/api/v1/version`

**请求参数**: 无

**返回参数**:

| 参数名 | 类型 | 说明 |
|--------|------|------|
| version | string | API版本 |
| build_time | string | 构建时间 |

**成功响应示例**:
```json
{
  "version": "1.0.0",
  "build_time": "2025-01-01T00:00:00Z"
}
```

---

## 📌 通用说明

### 认证方式

大部分API需要在请求头中携带JWT访问令牌：

```
Authorization: Bearer {access_token}
```

### 响应格式

所有API响应均为JSON格式，包含以下基本字段：

```json
{
  "success": true/false,
  "message": "消息内容",
  "data": {}
}
```

### 错误处理

当请求失败时，响应中会包含详细的错误信息：

```json
{
  "success": false,
  "message": "错误描述",
  "data": null
}
```

### 状态码

- `200 OK`: 请求成功
- `400 Bad Request`: 请求参数错误
- `401 Unauthorized`: 未授权（令牌无效或过期）
- `403 Forbidden`: 禁止访问
- `404 Not Found`: 资源不存在
- `500 Internal Server Error`: 服务器内部错误

---

## 🔐 安全说明

1. **密码安全**: 使用PBKDF2-HMAC-SHA256算法，100,000次迭代
2. **令牌安全**: JWT令牌使用HS256签名算法
3. **传输安全**: 生产环境建议使用HTTPS
4. **SQL注入防护**: 所有数据库查询使用预编译语句

---

## 📝 更新日志

### v2.4.0 (2025-10-14) **🎯 当前版本**
- ✅ 完善API文档
  - 修复帖子管理API返回示例（统一使用下划线命名）
  - 补充images数组完整字段说明（image_id, display_order, file_url等）
  - 添加所有返回参数的详细含义说明
  - 修复修改密码API路径（PUT /auth/password）
- ✅ 文档更新与规范化
  - 统一JSON字段命名规范（snake_case）
  - 补充所有API的完整返回参数说明
  - 优化文档结构和目录组织

### v2.3.0 (2025-10-11)
- ✅ 新增分享系统API（2个接口）
  - POST /posts/:post_id/share - 创建帖子分享链接
  - GET /share/:code - 解析分享链接（公开接口）
- ✅ 技术实现
  - 雪花ID算法 + Base62编码（8位短码）
  - 短链接去重逻辑
  - 分享链接过期机制
- ✅ Deep Link支持
  - iOS Universal Links配置
  - Android App Links配置
  - HarmonyOS Deep Linking + App Linking配置
- ✅ 数据库
  - 新增 share_links 表（7字段，4索引）
  - 外键级联删除（删除帖子自动删除分享链接）

### v2.2.0 (2025-10-10)
- ✅ 新增点赞相关API（3个接口）
  - POST /posts/:post_id/like - 点赞帖子
  - DELETE /posts/:post_id/like - 取消点赞
  - GET /posts/:post_id/like/status - 查询点赞状态
- ✅ 新增收藏相关API（4个接口）
  - POST /posts/:post_id/favorite - 收藏帖子
  - DELETE /posts/:post_id/favorite - 取消收藏
  - GET /posts/:post_id/favorite/status - 查询收藏状态
  - GET /my/favorites - 获取用户收藏列表（分页）
- ✅ 数据库
  - 新增 likes 表（用户点赞记录）
  - 新增 favorites 表（用户收藏记录）
  - 添加索引优化查询性能
  - 实现点赞/收藏数的实时更新

### v2.1.0 (2025-10-09)
- ✅ 新增用户信息管理API（4个接口）
  - GET /users/profile - 获取当前用户完整信息
  - PUT /users/profile - 更新用户信息
  - GET /users/check-username - 检查用户名可用性
  - GET /users/:user_id - 获取用户公开信息
- ✅ 数据库
  - users表新增字段：bio, gender, location, website, avatar_url
  - 优化用户信息存储结构

### v2.0.0 (2025-10-08)
- ✅ 新增帖子管理API（9个接口）
  - 创建帖子（支持1-9张图片）
  - 获取帖子详情
  - 更新帖子
  - 删除帖子
  - 获取Feed流（分页）
  - 获取用户帖子列表
  - 添加图片到帖子
  - 删除帖子中的图片
  - 调整图片顺序
- ✅ 图片管理API升级为帖子系统
- ❌ 废弃 PUT /images/:image_id/text（使用 PUT /posts/:post_id 代替）

### v1.2.0 (2025-10-05)
- ✅ 新增图片管理API（6个接口）
  - 上传图片
  - 获取图片详情
  - 获取最近图片列表
  - 更新图片文本
  - 删除图片
  - 获取用户图片列表

### v1.0.0 (2025-01-XX)
- ✅ 实现用户注册API
- ✅ 实现用户登录API（支持用户名/手机号/邮箱）
- ✅ 实现令牌验证API
- ✅ 实现令牌刷新API
- ✅ 实现用户登出API
- ✅ 实现修改密码API
- ✅ 实现健康检查API
- ✅ 实现系统指标API
- ✅ 实现版本信息API

---

**文档最后更新**: 2025-10-14
**维护者**: Knot Development Team
