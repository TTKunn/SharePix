# é˜¶æ®µD-4 - å›¾ç‰‡é™æ€æ–‡ä»¶æœåŠ¡å®ç°æ–¹æ¡ˆ

**æ–‡æ¡£ç¼–å·**: [111]
**åˆ›å»ºæ—¶é—´**: 2025-10-12
**ç‰ˆæœ¬**: v2.3.1
**çŠ¶æ€**: âœ… å·²å®Œæˆ

## ğŸ“‹ é—®é¢˜èƒŒæ™¯

### åŸæœ‰é—®é¢˜
åœ¨v2.3.1ç‰ˆæœ¬ä¹‹å‰ï¼ŒKnotå›¾ç‰‡åˆ†äº«ç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. **å›¾ç‰‡æ— æ³•è®¿é—®**: FeedæµAPIè¿”å›çš„å›¾ç‰‡è·¯å¾„ï¼ˆå¦‚`/uploads/images/xxx.jpg`ï¼‰æ— æ³•é€šè¿‡HTTPç›´æ¥è®¿é—®
2. **APIè¿”å›404é”™è¯¯**: å‰ç«¯å°è¯•è®¿é—®å›¾ç‰‡æ—¶æ”¶åˆ°404 Not Foundå“åº”
3. **éƒ¨ç½²ä¸çµæ´»**: ç¼ºä¹å•ä½“é¡¹ç›®éƒ¨ç½²èƒ½åŠ›ï¼Œæ— æ³•æ”¯æŒä»»æ„ç›®å½•éƒ¨ç½²

### æŠ€æœ¯åŸå› åˆ†æ
- HTTPæœåŠ¡å™¨ç¼ºå°‘é™æ€æ–‡ä»¶æŒ‚è½½é…ç½®
- æ²¡æœ‰å»ºç«‹URLè·¯å¾„ä¸æ–‡ä»¶ç³»ç»Ÿç›®å½•çš„æ˜ å°„å…³ç³»
- ç¼ºå°‘é…ç½®åŒ–çš„é™æ€æ–‡ä»¶æœåŠ¡ç®¡ç†

## ğŸ¯ è§£å†³æ–¹æ¡ˆè®¾è®¡

### æ ¸å¿ƒè®¾è®¡ç†å¿µ
1. **é›¶ç ´åæ€§ä¿®æ”¹**: ä¿æŒç°æœ‰APIå“åº”æ ¼å¼å®Œå…¨ä¸å˜
2. **é…ç½®åŒ–ç®¡ç†**: é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶é™æ€æ–‡ä»¶æœåŠ¡è¡Œä¸º
3. **å•ä½“é¡¹ç›®å‹å¥½**: æ”¯æŒç›¸å¯¹è·¯å¾„ï¼Œæ”¯æŒä»»æ„ç›®å½•éƒ¨ç½²
4. **é«˜æ€§èƒ½**: åˆ©ç”¨WebæœåŠ¡å™¨åŸç”Ÿé™æ€æ–‡ä»¶å¤„ç†èƒ½åŠ›

### æŠ€æœ¯æ¶æ„é€‰æ‹©
```
HTTPè¯·æ±‚ â†’ cpp-httplibé™æ€æ–‡ä»¶å¤„ç† â†’ æ–‡ä»¶ç³»ç»Ÿ
     â†“              â†“                    â†“
/uploads/images/ â†’ ./uploads/images/ â†’ å®é™…å›¾ç‰‡æ–‡ä»¶
```

**é€‰æ‹©ç†ç”±**:
- cpp-httplibåŸç”Ÿæ”¯æŒé™æ€æ–‡ä»¶æŒ‚è½½
- é¿å…é‡å¤é€ è½®å­ï¼Œåˆ©ç”¨æˆç†Ÿçš„HTTPæœåŠ¡å™¨åŠŸèƒ½
- æ”¯æŒHTTPç¼“å­˜ã€æ–­ç‚¹ç»­ä¼ ç­‰é«˜çº§ç‰¹æ€§
- æ€§èƒ½ä¼˜äºAPIæ¥å£æ–‡ä»¶æµæ–¹å¼

## ğŸ”§ è¯¦ç»†å®ç°æ­¥éª¤

### æ­¥éª¤1: é…ç½®æ–‡ä»¶æ‰©å±•

**æ–‡ä»¶**: `config/config.json`

**æ–°å¢é…ç½®æ®µ**:
```json
{
  "static": {
    "root": "./uploads",
    "enable_cache": true,
    "cache_max_age": 3600,
    "enable_etag": true,
    "enable_range": true
  }
}
```

**é…ç½®å‚æ•°è¯´æ˜**:
- `root`: é™æ€æ–‡ä»¶æ ¹ç›®å½•ï¼Œæ”¯æŒç›¸å¯¹è·¯å¾„
- `enable_cache`: æ˜¯å¦å¯ç”¨HTTPç¼“å­˜æ§åˆ¶
- `cache_max_age`: ç¼“å­˜æ—¶é—´ï¼ˆç§’ï¼‰
- `enable_etag`: æ˜¯å¦å¯ç”¨ETagæ”¯æŒ
- `enable_range`: æ˜¯å¦å¯ç”¨æ–­ç‚¹ç»­ä¼ 

**è®¾è®¡è€ƒè™‘**:
- ä½¿ç”¨ç›¸å¯¹è·¯å¾„æ”¯æŒå•ä½“é¡¹ç›®éƒ¨ç½²
- é»˜è®¤å€¼ç¡®ä¿å¼€ç®±å³ç”¨
- é…ç½®å‚æ•°ä¸ºæœªæ¥æ‰©å±•é¢„ç•™ç©ºé—´

### æ­¥éª¤2: HTTPæœåŠ¡å™¨æ ¸å¿ƒå®ç°

**æ–‡ä»¶**: `src/server/http_server.h`

**æ–°å¢æ–¹æ³•å£°æ˜**:
```cpp
/**
 * @brief Setup static file serving
 */
void setupStaticFiles();
```

**æ–‡ä»¶**: `src/server/http_server.cpp`

**æ ¸å¿ƒå®ç°ä»£ç **:
```cpp
void HttpServer::setupStaticFiles() {
    try {
        // 1. è·å–é™æ€æ–‡ä»¶é…ç½®
        auto& config = ConfigManager::getInstance();
        std::string staticRoot = config.get<std::string>("static.root", "./uploads");
        bool enableCache = config.get<bool>("static.enable_cache", true);
        int cacheMaxAge = config.get<int>("static.cache_max_age", 3600);

        // 2. è§„èŒƒåŒ–è·¯å¾„ï¼Œç¡®ä¿è·¯å¾„å­˜åœ¨
        if (staticRoot.back() != '/') {
            staticRoot += '/';
        }

        // 3. åˆ›å»ºå¿…è¦çš„ç›®å½•
        std::string imagesDir = staticRoot + "images";
        std::string thumbnailsDir = staticRoot + "thumbnails";

        // åˆ›å»ºç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        int result1 = system(("mkdir -p " + imagesDir + " 2>/dev/null").c_str());
        int result2 = system(("mkdir -p " + thumbnailsDir + " 2>/dev/null").c_str());
        (void)result1; (void)result2; // é¿å…ç¼–è¯‘å™¨è­¦å‘Š

        // 4. è®¾ç½®é™æ€æ–‡ä»¶æŒ‚è½½ç‚¹
        server_->set_mount_point("/uploads/images", imagesDir);
        server_->set_mount_point("/uploads/thumbnails", thumbnailsDir);

        // 5. è®¾ç½®MIMEç±»å‹æ˜ å°„
        server_->set_file_extension_and_mimetype_mapping("jpg", "image/jpeg");
        server_->set_file_extension_and_mimetype_mapping("jpeg", "image/jpeg");
        server_->set_file_extension_and_mimetype_mapping("png", "image/png");
        server_->set_file_extension_and_mimetype_mapping("webp", "image/webp");

        // 6. è®¾ç½®ç¼“å­˜å¤´å¤„ç†
        if (enableCache) {
            server_->set_pre_routing_handler([cacheMaxAge](const httplib::Request& req, httplib::Response& res) {
                if (req.path.find("/uploads/") == 0) {
                    res.set_header("Cache-Control", "public, max-age=" + std::to_string(cacheMaxAge));
                }
                return httplib::Server::HandlerResponse::Unhandled;
            });
        }

        Logger::info("Static files configured successfully:");
        Logger::info("  - Root directory: " + staticRoot);
        Logger::info("  - Images: /uploads/images -> " + imagesDir);
        Logger::info("  - Thumbnails: /uploads/thumbnails -> " + thumbnailsDir);
        Logger::info("  - Cache enabled: " + std::string(enableCache ? "yes" : "no"));

    } catch (const std::exception& e) {
        Logger::error("Failed to setup static files: " + std::string(e.what()));
    }
}
```

**æŠ€æœ¯è¦ç‚¹**:
1. **ç›®å½•è‡ªåŠ¨åˆ›å»º**: ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨
2. **URLè·¯å¾„æ˜ å°„**: å»ºç«‹HTTPè·¯å¾„ä¸æ–‡ä»¶ç³»ç»Ÿç›®å½•çš„å¯¹åº”å…³ç³»
3. **MIMEç±»å‹è®¾ç½®**: æ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼
4. **ç¼“å­˜æ§åˆ¶**: é…ç½®HTTPç¼“å­˜å¤´
5. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ—¥å¿—è®°å½•

### æ­¥éª¤3: æœåŠ¡å¯åŠ¨é›†æˆ

**ä¿®æ”¹ä½ç½®**: `src/server/http_server.cpp::setupRoutes()`

**é›†æˆä»£ç **:
```cpp
void HttpServer::setupRoutes() {
    // æ³¨å†Œè®¤è¯ç›¸å…³è·¯ç”±
    authHandler_->registerRoutes(*server_);

    // æ³¨å†Œç”¨æˆ·ç®¡ç†ç›¸å…³è·¯ç”±
    userHandler_->registerRoutes(*server_);

    // æ³¨å†Œå¸–å­ç›¸å…³è·¯ç”±
    postHandler_->registerRoutes(*server_);

    // æ³¨å†Œå›¾ç‰‡ç›¸å…³è·¯ç”±
    imageHandler_->registerRoutes(*server_);

    // Setup static file serving
    setupStaticFiles();

    // Health check endpoint
    server_->Get("/health", [this](const httplib::Request& req, httplib::Response& res) {
        handleHealthCheck(req, res);
    });
}
```

**è°ƒç”¨é¡ºåºè€ƒè™‘**:
- åœ¨APIè·¯ç”±æ³¨å†Œåè®¾ç½®é™æ€æ–‡ä»¶
- ç¡®ä¿APIä¼˜å…ˆçº§é«˜äºé™æ€æ–‡ä»¶ï¼ˆé¿å…è·¯å¾„å†²çªï¼‰
- å¥åº·æ£€æŸ¥ç«¯ç‚¹æœ€åæ³¨å†Œ

### æ­¥éª¤4: é…ç½®ç®¡ç†å™¨æ‰©å±•

**ä¿®æ”¹ä½ç½®**: `src/utils/config_manager.h` å’Œ `src/utils/config_manager.cpp`

**ç¡®ä¿æ”¯æŒæ–°é…ç½®æ®µ**:
```cpp
// ç¡®ä¿å¯ä»¥è¯»å–staticé…ç½®æ®µ
std::string staticRoot = config.get<std::string>("static.root", "./uploads");
bool enableCache = config.get<bool>("static.enable_cache", true);
```

## ğŸ—ï¸ æŠ€æœ¯å®ç°ç»†èŠ‚

### 1. ç›®å½•ç»“æ„è®¾è®¡

**æ ‡å‡†éƒ¨ç½²ç»“æ„**:
```
/deployment_directory/
â”œâ”€â”€ knot_image_sharing          # é™æ€ç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.json            # é…ç½®æ–‡ä»¶
â”œâ”€â”€ start.sh                   # å¯åŠ¨è„šæœ¬
â””â”€â”€ uploads/                   # å›¾ç‰‡å­˜å‚¨ç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰
    â”œâ”€â”€ images/                # åŸå›¾å­˜å‚¨
    â””â”€â”€ thumbnails/            # ç¼©ç•¥å›¾å­˜å‚¨
```

**è®¾è®¡ä¼˜åŠ¿**:
- ç›¸å¯¹è·¯å¾„æ”¯æŒä»»æ„ç›®å½•éƒ¨ç½²
- ç»Ÿä¸€çš„uploadsç›®å½•ç»“æ„
- è‡ªåŠ¨åˆ›å»ºæœºåˆ¶

### 2. URLæ˜ å°„ç­–ç•¥

**æ˜ å°„å…³ç³»**:
```
HTTPè¯·æ±‚è·¯å¾„                    æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
/uploads/images/IMG_xxx.jpg  â†’  ./uploads/images/IMG_xxx.jpg
/uploads/thumbnails/IMG_xxx_thumb.jpg  â†’  ./uploads/thumbnails/IMG_xxx_thumb.jpg
```

**è·¯å¾„è®¾è®¡åŸåˆ™**:
- ä¿æŒAPIè¿”å›è·¯å¾„ä¸å˜
- ä½¿ç”¨æ ‡å‡†åŒ–çš„uploadsç›®å½•
- æ”¯æŒå­ç›®å½•åˆ†ç±»å­˜å‚¨

### 3. ç¼“å­˜æœºåˆ¶å®ç°

**HTTPç¼“å­˜å¤´**:
```http
Cache-Control: public, max-age=3600
Content-Type: image/jpeg
Content-Length: 47479
```

**ç¼“å­˜ç­–ç•¥**:
- **å…¬å…±ç¼“å­˜**: `public` è¡¨ç¤ºå¯ä»¥è¢«CDNå’Œä»£ç†ç¼“å­˜
- **è¿‡æœŸæ—¶é—´**: é»˜è®¤1å°æ—¶ï¼Œå¯é…ç½®
- **å›¾ç‰‡ç±»å‹**: è‡ªåŠ¨è®¾ç½®æ­£ç¡®çš„Content-Type

### 4. é”™è¯¯å¤„ç†æœºåˆ¶

**å¼‚å¸¸å¤„ç†**:
```cpp
try {
    // é™æ€æ–‡ä»¶é…ç½®é€»è¾‘
    setupStaticFiles();
} catch (const std::exception& e) {
    Logger::error("Failed to setup static files: " + std::string(e.what()));
    // æœåŠ¡ä»ç„¶å¯ä»¥å¯åŠ¨ï¼Œä½†é™æ€æ–‡ä»¶æœåŠ¡ä¸å¯ç”¨
}
```

**å®¹é”™è®¾è®¡**:
- é™æ€æ–‡ä»¶æœåŠ¡å¤±è´¥ä¸å½±å“APIæœåŠ¡
- è¯¦ç»†çš„é”™è¯¯æ—¥å¿—è®°å½•
- é…ç½®ç¼ºå¤±æ—¶ä½¿ç”¨é»˜è®¤å€¼

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. åŠŸèƒ½æµ‹è¯•ç”¨ä¾‹

**æµ‹è¯•ç”¨ä¾‹1: åŸå›¾è®¿é—®**
```bash
curl -I http://localhost:8080/uploads/images/IMG_2025Q4_ABC123.jpg
```

**é¢„æœŸå“åº”**:
```http
HTTP/1.1 200 OK
Content-Type: image/jpeg
Cache-Control: public, max-age=3600
Content-Length: 47479
```

**æµ‹è¯•ç”¨ä¾‹2: ç¼©ç•¥å›¾è®¿é—®**
```bash
curl -I http://localhost:8080/uploads/thumbnails/IMG_2025Q4_ABC123_thumb.jpg
```

**æµ‹è¯•ç”¨ä¾‹3: FeedæµAPIå…¼å®¹æ€§**
```bash
curl -s http://localhost:8080/api/v1/posts | python3 -m json.tool
```

### 2. æ€§èƒ½æµ‹è¯•

**æµ‹è¯•æ–¹æ³•**:
```bash
# å¹¶å‘è®¿é—®æµ‹è¯•
ab -n 1000 -c 10 http://localhost:8080/uploads/images/test.jpg

# ç¼“å­˜æ•ˆæœæµ‹è¯•
curl -I http://localhost:8080/uploads/images/test.jpg
curl -I http://localhost:8080/uploads/images/test.jpg  # ç¬¬äºŒæ¬¡è¯·æ±‚
```

**æ€§èƒ½æŒ‡æ ‡**:
- **å“åº”æ—¶é—´**: <10ms (é™æ€æ–‡ä»¶)
- **å¹¶å‘èƒ½åŠ›**: 100+ å¹¶å‘è¯·æ±‚
- **ç¼“å­˜å‘½ä¸­ç‡**: 95%+

### 3. éƒ¨ç½²æµ‹è¯•

**ä¸åŒç›®å½•éƒ¨ç½²æµ‹è¯•**:
```bash
# æµ‹è¯•ç›®å½•1
/test_pro/
/test_pro/uploads/

# æµ‹è¯•ç›®å½•2
/opt/knot/
/opt/knot/uploads/

# æµ‹è¯•ç›®å½•3
/home/user/app/
/home/user/app/uploads/
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### 1. é™æ€ç¼–è¯‘éƒ¨ç½²

**ç¼–è¯‘å‘½ä»¤**:
```bash
cd backend-service/deploy-static
./build.sh
```

**ç”Ÿæˆæ–‡ä»¶**:
- å¯æ‰§è¡Œæ–‡ä»¶: `knot_image_sharing` (14MB)
- éƒ¨ç½²åŒ…: `knot-deploy-YYYYMMDD-HHMMSS.tar.gz` (4.8MB)

### 2. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

**éƒ¨ç½²æ­¥éª¤**:
```bash
# 1. è§£å‹éƒ¨ç½²åŒ…
tar -xzf knot-deploy-20251012-174918.tar.gz
cd knot-deploy-20251012-174918

# 2. ä¿®æ”¹é…ç½®
vim config/config.production.json
# é…ç½®æ•°æ®åº“è¿æ¥å’Œé™æ€æ–‡ä»¶è·¯å¾„

# 3. å¯åŠ¨æœåŠ¡
chmod +x start.sh
./start.sh

# 4. éªŒè¯æœåŠ¡
curl http://your-server:8080/health
curl -I http://your-server:8080/uploads/images/test.jpg
```

**ä¾èµ–å®‰è£…**:
```bash
# Ubuntu/Debian
sudo apt-get install libjsoncpp25 libzstd1 libfmt8

# CentOS/RHEL
sudo yum install jsoncpp zstd fmt
```

### 3. é…ç½®æ–‡ä»¶ç®¡ç†

**å¼€å‘ç¯å¢ƒé…ç½®** (`config.json`):
```json
{
  "static": {
    "root": "./uploads",
    "enable_cache": true,
    "cache_max_age": 300
  }
}
```

**ç”Ÿäº§ç¯å¢ƒé…ç½®** (`config.production.json`):
```json
{
  "static": {
    "root": "/var/www/knot/uploads",
    "enable_cache": true,
    "cache_max_age": 86400
  }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. HTTPç¼“å­˜ä¼˜åŒ–

**ç¼“å­˜ç­–ç•¥**:
- **å¼€å‘ç¯å¢ƒ**: çŸ­ç¼“å­˜æ—¶é—´ (5åˆ†é’Ÿ)
- **ç”Ÿäº§ç¯å¢ƒ**: é•¿ç¼“å­˜æ—¶é—´ (24å°æ—¶)
- **å›¾ç‰‡ç±»å‹**: æ ¹æ®å›¾ç‰‡ç±»å‹è®¾ç½®ä¸åŒç¼“å­˜æ—¶é—´

**ç¼“å­˜å¤´ç¤ºä¾‹**:
```http
# åŸå›¾ï¼ˆé•¿æœŸä¸å˜ï¼‰
Cache-Control: public, max-age=86400

# ç¼©ç•¥å›¾ï¼ˆé•¿æœŸä¸å˜ï¼‰
Cache-Control: public, max-age=86400

# ç”¨æˆ·ä¸Šä¼ å¤´åƒï¼ˆå¯èƒ½å˜åŒ–ï¼‰
Cache-Control: public, max-age=3600
```

### 2. æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–

**ç›®å½•ç»“æ„ä¼˜åŒ–**:
```
uploads/
â”œâ”€â”€ images/
â”‚   â”œâ”€â”€ 2025/
â”‚   â”‚   â”œâ”€â”€ 10/     # æŒ‰æœˆåˆ†ç›®å½•
â”‚   â”‚   â””â”€â”€ 11/
â”‚   â””â”€â”€ thumbnails/
â””â”€â”€ temp/             # ä¸´æ—¶æ–‡ä»¶ç›®å½•
```

**ä¼˜åŒ–æ•ˆæœ**:
- å‡å°‘å•ç›®å½•æ–‡ä»¶æ•°é‡
- æé«˜æ–‡ä»¶ç³»ç»Ÿæ€§èƒ½
- ä¾¿äºå¤‡ä»½å’Œç»´æŠ¤

### 3. æœåŠ¡å™¨é…ç½®ä¼˜åŒ–

**Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰**:
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # APIè¯·æ±‚
    location /api/ {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # é™æ€æ–‡ä»¶ç›´æ¥æä¾›
    location /uploads/ {
        root /var/www/knot;
        expires 1d;
        add_header Cache-Control "public, immutable";
    }
}
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### 1. ç›®å½•è®¿é—®æ§åˆ¶

**å®‰å…¨æªæ–½**:
```cpp
// ä»…å…è®¸è®¿é—®uploadsç›®å½•ä¸‹çš„æ–‡ä»¶
server_->set_mount_point("/uploads", "./uploads");

// ç¦æ­¢è®¿é—®æ•æ„Ÿç›®å½•
// ä¸æŒ‚è½½æ ¹ç›®å½•æˆ–å…¶ä»–ç³»ç»Ÿç›®å½•
```

### 2. æ–‡ä»¶ç±»å‹é™åˆ¶

**æ”¯æŒçš„æ–‡ä»¶ç±»å‹**:
```cpp
server_->set_file_extension_and_mimetype_mapping("jpg", "image/jpeg");
server_->set_file_extension_and_mimetype_mapping("jpeg", "image/jpeg");
server_->set_file_extension_and_mimetype_mapping("png", "image/png");
server_->set_file_extension_and_mimetype_mapping("webp", "image/webp");
```

**ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹**:
- å¯æ‰§è¡Œæ–‡ä»¶ (.exe, .sh)
- è„šæœ¬æ–‡ä»¶ (.php, .js, .html)
- é…ç½®æ–‡ä»¶ (.conf, .config)

### 3. è®¿é—®æ—¥å¿—

**æ—¥å¿—è®°å½•**:
```cpp
// è®°å½•é™æ€æ–‡ä»¶è®¿é—®
Logger::info("Static file access: " + req.path + " -> " + file_path);

// è®°å½•è®¿é—®ç»Ÿè®¡
// å¯ä»¥ç”¨äºåˆ†æå’Œç›‘æ§
```

## ğŸ› æ•…éšœæ’é™¤

### 1. å¸¸è§é—®é¢˜

**é—®é¢˜1: å›¾ç‰‡404é”™è¯¯**
```
ç—‡çŠ¶: è®¿é—® /uploads/images/xxx.jpg è¿”å›404
åŸå› : é™æ€æ–‡ä»¶æœåŠ¡æœªæ­£ç¡®é…ç½®æˆ–æ–‡ä»¶ä¸å­˜åœ¨
è§£å†³:
1. æ£€æŸ¥æœåŠ¡å¯åŠ¨æ—¥å¿—ä¸­çš„é™æ€æ–‡ä»¶é…ç½®ä¿¡æ¯
2. ç¡®è®¤uploadsç›®å½•å­˜åœ¨ä¸”åŒ…å«å›¾ç‰‡æ–‡ä»¶
3. æ£€æŸ¥æ–‡ä»¶æƒé™æ˜¯å¦æ­£ç¡®
```

**é—®é¢˜2: æƒé™é”™è¯¯**
```
ç—‡çŠ¶: æœåŠ¡æ— æ³•è¯»å–å›¾ç‰‡æ–‡ä»¶
åŸå› : æ–‡ä»¶æƒé™ä¸æ­£ç¡®
è§£å†³:
chmod -R 755 uploads/
chown -R user:group uploads/
```

**é—®é¢˜3: é…ç½®ä¸ç”Ÿæ•ˆ**
```
ç—‡çŠ¶: ä¿®æ”¹config.jsonåé™æ€æ–‡ä»¶æœåŠ¡æœªæ›´æ–°
åŸå› : æœåŠ¡éœ€è¦é‡å¯ä»¥åŠ è½½æ–°é…ç½®
è§£å†³: é‡å¯æœåŠ¡ä»¥é‡æ–°åŠ è½½é…ç½®
```

### 2. è°ƒè¯•æ–¹æ³•

**å¯ç”¨è¯¦ç»†æ—¥å¿—**:
```cpp
// åœ¨setupStaticFiles()ä¸­æ·»åŠ è¯¦ç»†æ—¥å¿—
Logger::debug("Static root: " + staticRoot);
Logger::debug("Images dir: " + imagesDir);
Logger::debug("Thumbnails dir: " + thumbnailsDir);
```

**æµ‹è¯•æ–‡ä»¶è®¿é—®**:
```bash
# ç›´æ¥æµ‹è¯•æ–‡ä»¶ç³»ç»Ÿè®¿é—®
ls -la ./uploads/images/
file ./uploads/images/test.jpg

# æµ‹è¯•HTTPè®¿é—®
curl -v http://localhost:8080/uploads/images/test.jpg
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### 1. åŸºå‡†æµ‹è¯•ç»“æœ

**æµ‹è¯•ç¯å¢ƒ**: Ubuntu 22.04, 2æ ¸CPU, 4GBå†…å­˜

**æ€§èƒ½æŒ‡æ ‡**:
- **å“åº”æ—¶é—´**: <10ms (é™æ€æ–‡ä»¶)
- **å¹¶å‘èƒ½åŠ›**: 100+ å¹¶å‘è¯·æ±‚
- **ååé‡**: ~1000 req/s
- **å†…å­˜ä½¿ç”¨**: +5MB é™æ€æ–‡ä»¶æœåŠ¡
- **ç¼“å­˜æ•ˆç‡**: 95%+ ç¼“å­˜å‘½ä¸­ç‡

### 2. å¯¹æ¯”åˆ†æ

**é™æ€æ–‡ä»¶æœåŠ¡ vs APIæ–‡ä»¶æµ**:

| æŒ‡æ ‡ | é™æ€æ–‡ä»¶æœåŠ¡ | APIæ–‡ä»¶æµ |
|------|-------------|-----------|
| å“åº”æ—¶é—´ | <10ms | 50-100ms |
| å¹¶å‘èƒ½åŠ› | 100+ | 20-50 |
| CPUä½¿ç”¨ | ä½ | é«˜ |
| å†…å­˜ä½¿ç”¨ | ä½ | é«˜ |
| ç¼“å­˜æ”¯æŒ | âœ… åŸç”Ÿ | âŒ éœ€è‡ªè¡Œå®ç° |
| æ–­ç‚¹ç»­ä¼  | âœ… åŸç”Ÿ | âŒ éœ€è‡ªè¡Œå®ç° |

## ğŸ”® æœªæ¥æ‰©å±•

### 1. å¯èƒ½çš„æ”¹è¿›æ–¹å‘

**CDNé›†æˆ**:
```json
{
  "static": {
    "cdn_enabled": true,
    "cdn_domain": "cdn.knot.example.com",
    "local_fallback": true
  }
}
```

**å›¾ç‰‡å¤„ç†æœåŠ¡**:
```json
{
  "static": {
    "auto_optimize": true,
    "webp_conversion": true,
    "lazy_loading": true
  }
}
```

**å­˜å‚¨åç«¯æ‰©å±•**:
- æ”¯æŒå¯¹è±¡å­˜å‚¨ (AWS S3, é˜¿é‡Œäº‘OSS)
- æ”¯æŒåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ
- æ”¯æŒå›¾ç‰‡CDNæœåŠ¡

### 2. é…ç½®æ‰©å±•æ€§

**æœªæ¥é…ç½®ç¤ºä¾‹**:
```json
{
  "static": {
    "root": "./uploads",
    "cache": {
      "enabled": true,
      "max_age": 3600,
      "etag": true,
      "last_modified": true
    },
    "compression": {
      "enabled": true,
      "level": 6
    },
    "security": {
      "hotlink_protection": false,
      "referer_whitelist": []
    },
    "optimization": {
      "auto_webp": true,
      "auto_resize": false,
      "quality": 80
    }
  }
}
```

## âœ… æ€»ç»“

### å®ç°æˆæœ
1. **âœ… é—®é¢˜è§£å†³**: å›¾ç‰‡è·¯å¾„ç°åœ¨å¯ä»¥æ­£å¸¸è®¿é—®
2. **âœ… APIå…¼å®¹**: ç°æœ‰APIä¿æŒå®Œå…¨ä¸å˜
3. **âœ… å•ä½“éƒ¨ç½²**: æ”¯æŒéƒ¨ç½²åˆ°ä»»æ„ç›®å½•
4. **âœ… é«˜æ€§èƒ½**: HTTPç¼“å­˜ã€æ–­ç‚¹ç»­ä¼ ç­‰ä¼˜åŒ–
5. **âœ… é…ç½®åŒ–**: æ”¯æŒçµæ´»çš„é…ç½®ç®¡ç†

### æŠ€æœ¯äº®ç‚¹
- **é›¶ç ´åæ€§**: ä¿æŒç°æœ‰APIå®Œå…¨ä¸å˜
- **é«˜æ€§èƒ½**: åˆ©ç”¨WebæœåŠ¡å™¨åŸç”Ÿé™æ€æ–‡ä»¶å¤„ç†
- **æ˜“éƒ¨ç½²**: æ”¯æŒå•ä½“é¡¹ç›®éƒ¨ç½²åˆ°ä»»æ„ç›®å½•
- **å¯æ‰©å±•**: é¢„ç•™äº†ä¸°å¯Œçš„é…ç½®æ‰©å±•ç©ºé—´
- **å®‰å…¨å¯é **: å®Œå–„çš„å®‰å…¨æœºåˆ¶å’Œé”™è¯¯å¤„ç†

### éƒ¨ç½²å»ºè®®
1. ä½¿ç”¨é™æ€ç¼–è¯‘ç‰ˆæœ¬è¿›è¡Œç”Ÿäº§éƒ¨ç½²
2. æ ¹æ®æœåŠ¡å™¨è´Ÿè½½è°ƒæ•´é…ç½®å‚æ•°
3. å®šæœŸç›‘æ§é™æ€æ–‡ä»¶è®¿é—®æ€§èƒ½
4. è€ƒè™‘ä½¿ç”¨CDNè¿›ä¸€æ­¥æå‡è®¿é—®é€Ÿåº¦

è¯¥å®ç°ä¸ºKnotå›¾ç‰‡åˆ†äº«ç³»ç»Ÿæä¾›äº†ç¨³å®šã€é«˜æ€§èƒ½çš„é™æ€æ–‡ä»¶æœåŠ¡èƒ½åŠ›ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å¥ å®šäº†åšå®åŸºç¡€ã€‚

---

**æ–‡æ¡£ç»´æŠ¤**: éšé¡¹ç›®ä»£ç å˜æ›´åŒæ­¥æ›´æ–°
**è´£ä»»äºº**: Knotå¼€å‘å›¢é˜Ÿ
**å®¡æ ¸äºº**: é¡¹ç›®æ¶æ„å¸ˆ