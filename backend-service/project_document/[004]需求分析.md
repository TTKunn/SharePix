# Knot - å›¾ç‰‡åˆ†äº«ç¤¾åŒº MVPéœ€æ±‚åˆ†æ

**é¡¹ç›®å®šä½**: ç®€çº¦è€Œä¸ç®€å•çš„å›¾ç‰‡åˆ†äº«ç¤¾åŒºï¼Œè®©åˆ›ä½œå›å½’æœ¬è´¨
**ç‰ˆæœ¬**: v1.0 MVP
**æ›´æ–°æ—¶é—´**: 2025-10-07

---

## ä¸€ã€äº§å“å®šä½ä¸æ ¸å¿ƒç†å¿µ

### ğŸ¯ äº§å“å®šä½
Knotæ˜¯ä¸€ä¸ª**è½»é‡çº§å›¾ç‰‡åˆ†äº«ç¤¾åŒº**ï¼Œä¸“æ³¨äºæä¾›ç®€æ´ã€æµç•…çš„å›¾ç‰‡åˆ†äº«ä½“éªŒã€‚

**æ ¸å¿ƒå·®å¼‚åŒ–**:
- ğŸ¨ **åˆ›ä½œä¼˜å…ˆ**: å¿«é€Ÿä¸Šä¼ â†’ä¸€é”®å‘å¸ƒï¼Œé™ä½åˆ›ä½œé—¨æ§›
- ğŸ” **å‘ç°ä¸ºç‹**: ç€‘å¸ƒæµ+æ™ºèƒ½æ¨èï¼Œæ²‰æµ¸å¼æµè§ˆä½“éªŒ
- ğŸ’¬ **è½»ç¤¾äº¤**: ç‚¹èµ/æ”¶è—/å…³æ³¨ï¼Œç®€å•é«˜æ•ˆçš„äº’åŠ¨æ–¹å¼
- ğŸš€ **æ€§èƒ½æè‡´**: å›¾ç‰‡å‹ç¼©+CDNåŠ é€Ÿï¼Œç§’å¼€ä½“éªŒ

### ğŸ¨ è®¾è®¡ç†å¿µ
- **ç®€çº¦ä¸ç®€å•**: å»é™¤å†—ä½™åŠŸèƒ½ï¼Œä¸“æ³¨æ ¸å¿ƒä½“éªŒ
- **ç§»åŠ¨ä¼˜å…ˆ**: ä¸ºç§»åŠ¨ç«¯è®¾è®¡ï¼Œå…¼é¡¾Webç«¯
- **æ¸è¿›å¢å¼º**: MVPéªŒè¯æ ¸å¿ƒä»·å€¼ï¼Œåç»­è¿­ä»£æ‰©å±•åŠŸèƒ½

---

## äºŒã€ç”¨æˆ·è§’è‰²åˆ†æ

### 1. æ ¸å¿ƒç”¨æˆ·è§’è‰²

| è§’è‰² | æ ¸å¿ƒéœ€æ±‚ | ç—›ç‚¹ | ä¼˜å…ˆçº§ |
|------|---------|------|--------|
| **å†…å®¹åˆ›ä½œè€…** | å¿«é€Ÿä¸Šä¼ å›¾ç‰‡ã€è·å¾—äº’åŠ¨åé¦ˆã€ç®¡ç†ä½œå“ | ä¸Šä¼ æµç¨‹ç¹çã€ç¼ºå°‘æ›å…‰ | P0 |
| **å†…å®¹æ¶ˆè´¹è€…** | æµè§ˆä¼˜è´¨å›¾ç‰‡ã€ç‚¹èµæ”¶è—ã€å…³æ³¨åˆ›ä½œè€… | å†…å®¹è´¨é‡å‚å·®ä¸é½ã€å‘ç°å›°éš¾ | P0 |

**MVPé˜¶æ®µæš‚ä¸è€ƒè™‘**:
- âŒ ç³»ç»Ÿç®¡ç†å‘˜(å†…å®¹å®¡æ ¸åç½®åˆ°V1.1)
- âŒ å•†ä¸šç”¨æˆ·(å¹¿å‘Š/ä»˜è´¹åŠŸèƒ½V2.0è€ƒè™‘)

### 2. ç”¨æˆ·æ•…äº‹

**åˆ›ä½œè€…**:
- "ä½œä¸ºä¸€åæ‘„å½±çˆ±å¥½è€…ï¼Œæˆ‘å¸Œæœ›èƒ½å¿«é€Ÿä¸Šä¼ ç…§ç‰‡å¹¶è·å¾—æ›å…‰ï¼Œè€Œä¸éœ€è¦å¤æ‚çš„ç¼–è¾‘å’Œè®¾ç½®"
- "æˆ‘æƒ³çŸ¥é“æœ‰å¤šå°‘äººå–œæ¬¢æˆ‘çš„ä½œå“ï¼Œå¹¶èƒ½æ–¹ä¾¿åœ°ç®¡ç†æˆ‘çš„å›¾ç‰‡åº“"

**æ¶ˆè´¹è€…**:
- "æˆ‘æƒ³åœ¨ç¢ç‰‡æ—¶é—´æµè§ˆæœ‰è¶£çš„å›¾ç‰‡ï¼Œç®€å•çš„ç‚¹èµ/æ”¶è—å°±èƒ½è®°å½•å–œæ¬¢çš„å†…å®¹"
- "å…³æ³¨å–œæ¬¢çš„åˆ›ä½œè€…åï¼Œèƒ½ä¼˜å…ˆçœ‹åˆ°ä»–ä»¬çš„æ–°ä½œå“"

---

## ä¸‰ã€MVPåŠŸèƒ½èŒƒå›´

### âœ… V1.0 MVP æ ¸å¿ƒåŠŸèƒ½

#### ğŸ” æ¨¡å—1: ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ (åŸºç¡€)

| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| æ³¨å†Œ/ç™»å½• | æ‰‹æœºå·æˆ–é‚®ç®±æ³¨å†Œï¼ŒJWTä»¤ç‰Œè®¤è¯ | P0 |
| ä¸ªäººä¸»é¡µ | å±•ç¤ºç”¨æˆ·åã€å¤´åƒã€ç®€ä»‹ã€å‘å¸ƒæ•°/å…³æ³¨æ•°/ç²‰ä¸æ•° | P0 |
| ç¼–è¾‘èµ„æ–™ | ä¿®æ”¹å¤´åƒã€ç”¨æˆ·åã€ä¸ªäººç®€ä»‹ | P0 |
| åŸºç¡€è®¾ç½® | ä¸»é¢˜åˆ‡æ¢(æµ…è‰²/æ·±è‰²) | P1 |

**æµç¨‹å›¾**:
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant A as è®¤è¯æœåŠ¡
    participant D as æ•°æ®åº“

    U->>F: 1. è¾“å…¥æ‰‹æœºå·/é‚®ç®±+å¯†ç 
    F->>A: 2. å‘é€æ³¨å†Œ/ç™»å½•è¯·æ±‚
    A->>D: 3. éªŒè¯å‡­æ®/åˆ›å»ºç”¨æˆ·
    D-->>A: 4. è¿”å›ç”¨æˆ·ä¿¡æ¯
    A-->>F: 5. è¿”å›JWTä»¤ç‰Œ
    F->>F: 6. å­˜å‚¨ä»¤ç‰Œåˆ°æœ¬åœ°
    F-->>U: 7. è·³è½¬åˆ°é¦–é¡µ
```

#### ğŸ“¸ æ¨¡å—2: å›¾ç‰‡ç®¡ç†ç³»ç»Ÿ (æ ¸å¿ƒ)

| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| **ä¸Šä¼ åŠŸèƒ½** |  | |
| - å›¾ç‰‡ä¸Šä¼  | æ”¯æŒJPEG/PNG/WebPï¼Œå•å›¾â‰¤5MB | P0 |
| - è‡ªåŠ¨å‹ç¼© | å‹ç¼©åˆ°åˆé€‚å¤§å°(è´¨é‡80%)ï¼Œç”Ÿæˆç¼©ç•¥å›¾ | P0 |
| - å…ƒæ•°æ®å¡«å†™ | æ ‡é¢˜(å¿…å¡«)ã€æè¿°(å¯é€‰)ã€æ ‡ç­¾(æœ€å¤š5ä¸ª) | P0 |
| **æµè§ˆåŠŸèƒ½** |  | |
| - é¦–é¡µFeed | ç€‘å¸ƒæµå¸ƒå±€ï¼Œæ™ºèƒ½æ¨è(çƒ­åº¦+æ—¶é—´åŠ æƒ) | P0 |
| - å›¾ç‰‡è¯¦æƒ… | å¤§å›¾æŸ¥çœ‹+ä½œè€…ä¿¡æ¯+äº’åŠ¨æ•°æ® | P0 |
| - æ ‡ç­¾æœç´¢ | æŒ‰æ ‡ç­¾æœç´¢å›¾ç‰‡ | P0 |
| - ç”¨æˆ·å›¾ç‰‡å¢™ | ä¸ªäººä¸»é¡µå±•ç¤ºè¯¥ç”¨æˆ·çš„æ‰€æœ‰å›¾ç‰‡ | P0 |
| **ç®¡ç†åŠŸèƒ½** |  | |
| - æˆ‘çš„å›¾ç‰‡ | æŸ¥çœ‹/ç¼–è¾‘/åˆ é™¤è‡ªå·±çš„å›¾ç‰‡ | P0 |

**ä¸Šä¼ æµç¨‹**:
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant I as å›¾ç‰‡æœåŠ¡
    participant S as å­˜å‚¨æœåŠ¡
    participant D as æ•°æ®åº“

    U->>F: 1. é€‰æ‹©å›¾ç‰‡
    F->>F: 2. å®¢æˆ·ç«¯å‹ç¼©é¢„è§ˆ
    U->>F: 3. å¡«å†™æ ‡é¢˜/æ ‡ç­¾/æè¿°
    F->>I: 4. ä¸Šä¼ å›¾ç‰‡+å…ƒæ•°æ®
    I->>I: 5. éªŒè¯æ ¼å¼/å¤§å°
    I->>I: 6. å‹ç¼©å›¾ç‰‡(è´¨é‡80%)
    I->>I: 7. ç”Ÿæˆç¼©ç•¥å›¾(300x300)
    I->>S: 8. ä¿å­˜åŸå›¾+ç¼©ç•¥å›¾
    S-->>I: 9. è¿”å›æ–‡ä»¶URL
    I->>D: 10. ä¿å­˜å›¾ç‰‡è®°å½•
    I-->>F: 11. è¿”å›æˆåŠŸ+å›¾ç‰‡ID
    F-->>U: 12. è·³è½¬åˆ°å›¾ç‰‡è¯¦æƒ…é¡µ
```

**Feedæ¨èæµç¨‹**:
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant R as æ¨èæœåŠ¡
    participant D as æ•°æ®åº“

    U->>F: 1. æ‰“å¼€é¦–é¡µ
    F->>R: 2. è¯·æ±‚Feed(é¡µç /æ¯é¡µæ•°é‡)
    R->>D: 3. æŸ¥è¯¢æ¨èç®—æ³•ç»“æœ
    Note over R,D: ç®€å•æ¨èç®—æ³•:<br/>çƒ­åº¦=(ç‚¹èµæ•°*0.7+æ”¶è—æ•°*0.3)<br/>æ—¶é—´è¡°å‡=1/((å½“å‰æ—¶é—´-å‘å¸ƒæ—¶é—´)+2)^1.5<br/>æ’åº=çƒ­åº¦*æ—¶é—´è¡°å‡
    D-->>R: 4. è¿”å›å›¾ç‰‡åˆ—è¡¨(ç¼©ç•¥å›¾URL)
    R-->>F: 5. è¿”å›åˆ†é¡µæ•°æ®
    F-->>U: 6. æ¸²æŸ“ç€‘å¸ƒæµ
    U->>F: 7. ä¸‹æ‹‰åŠ è½½æ›´å¤š
    F->>R: 8. è¯·æ±‚ä¸‹ä¸€é¡µ
```

#### ğŸ’• æ¨¡å—3: äº’åŠ¨ç³»ç»Ÿ (è½»é‡åŒ–)

| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| **ç‚¹èµç³»ç»Ÿ** | | |
| - ç‚¹èµ/å–æ¶ˆ | ä¸€é”®ç‚¹èµï¼Œå®æ—¶æ›´æ–°ç‚¹èµæ•° | P0 |
| - æˆ‘çš„ç‚¹èµ | æŸ¥çœ‹æˆ‘ç‚¹èµè¿‡çš„å›¾ç‰‡åˆ—è¡¨ | P1 |
| **æ”¶è—ç³»ç»Ÿ** | | |
| - æ”¶è—/å–æ¶ˆ | æ”¶è—åˆ°"æˆ‘çš„æ”¶è—" | P0 |
| - æˆ‘çš„æ”¶è— | æŸ¥çœ‹æ”¶è—åˆ—è¡¨ | P0 |
| **å…³æ³¨ç³»ç»Ÿ** | | |
| - å…³æ³¨/å–å…³ | å…³æ³¨/å–æ¶ˆå…³æ³¨ç”¨æˆ· | P0 |
| - å…³æ³¨åˆ—è¡¨ | æŸ¥çœ‹æˆ‘å…³æ³¨çš„äºº | P0 |
| - ç²‰ä¸åˆ—è¡¨ | æŸ¥çœ‹å…³æ³¨æˆ‘çš„äºº | P0 |
| - å…³æ³¨Feed | ä¼˜å…ˆå±•ç¤ºå…³æ³¨ç”¨æˆ·çš„å›¾ç‰‡ | P1 |
| **åˆ†äº«ç³»ç»Ÿ** | | |
| - ç”Ÿæˆåˆ†äº«é“¾æ¥ | ä¸ºå›¾ç‰‡ç”ŸæˆçŸ­é“¾æ¥(å¦‚knot.app/s/ABC123) | P0 |
| - Deep Linkå”¤èµ· | ç‚¹å‡»é“¾æ¥è‡ªåŠ¨å”¤èµ·APP | P0 |
| - H5è½åœ°é¡µ | æœªå®‰è£…ç”¨æˆ·çš„å¼•å¯¼é¡µ | P0 |
| - Web Share API | è°ƒç”¨ç³»ç»ŸåŸç”Ÿåˆ†äº«é¢æ¿ | P0 |
| - ç¤¾äº¤å¹³å°åˆ†äº« | å¾®ä¿¡/å¾®åš/QQå¿«æ·åˆ†äº« | P1 |
| - åˆ†äº«æ•°æ®ç»Ÿè®¡ | è¿½è¸ªåˆ†äº«ç‚¹å‡»/è½¬åŒ–æ•°æ® | P1 |

**ç‚¹èµæµç¨‹**:
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant I as äº’åŠ¨æœåŠ¡
    participant D as æ•°æ®åº“

    U->>F: 1. ç‚¹å‡»ç‚¹èµæŒ‰é’®
    F->>F: 2. ä¹è§‚æ›´æ–°UI(ç«‹å³æ˜¾ç¤ºå·²ç‚¹èµ)
    F->>I: 3. å‘é€ç‚¹èµè¯·æ±‚
    I->>D: 4. æ’å…¥ç‚¹èµè®°å½•
    I->>D: 5. æ›´æ–°å›¾ç‰‡ç‚¹èµæ•°(+1)
    D-->>I: 6. è¿”å›æ“ä½œç»“æœ

    alt æˆåŠŸ
        I-->>F: 7. è¿”å›æˆåŠŸ
    else å¤±è´¥(å¦‚é‡å¤ç‚¹èµ)
        I-->>F: 7. è¿”å›å¤±è´¥
        F->>F: 8. å›æ»šUIçŠ¶æ€
    end
```

**åˆ†äº«æµç¨‹**:
```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant F as å‰ç«¯
    participant S as åˆ†äº«æœåŠ¡
    participant D as æ•°æ®åº“
    participant H5 as H5è½åœ°é¡µ

    U->>F: 1. ç‚¹å‡»åˆ†äº«æŒ‰é’®
    F->>S: 2. è¯·æ±‚ç”Ÿæˆåˆ†äº«é“¾æ¥
    S->>S: 3. ç”ŸæˆçŸ­é“¾æ¥ç (Base62)
    S->>D: 4. ä¿å­˜åˆ†äº«è®°å½•
    D-->>S: 5. è¿”å›ä¿å­˜ç»“æœ
    S-->>F: 6. è¿”å›çŸ­é“¾æ¥(knot.app/s/ABC123)
    F->>F: 7. è°ƒç”¨Web Share API/æ˜¾ç¤ºåˆ†äº«é¢æ¿

    Note over F: ç”¨æˆ·é€‰æ‹©åˆ†äº«åˆ°å¾®ä¿¡
    F->>å¤–éƒ¨: 8. åˆ†äº«é“¾æ¥åˆ°å¾®ä¿¡

    Note over H5: å¥½å‹ç‚¹å‡»é“¾æ¥
    å¤–éƒ¨->>H5: 9. æ‰“å¼€é“¾æ¥
    H5->>S: 10. è§£æçŸ­é“¾æ¥ç 
    S->>D: 11. æŸ¥è¯¢ç›®æ ‡ä¿¡æ¯+è®°å½•è®¿é—®
    D-->>S: 12. è¿”å›å›¾ç‰‡è¯¦æƒ…
    S-->>H5: 13. è¿”å›æ•°æ®

    alt å·²å®‰è£…APP
        H5->>APP: 14. å”¤èµ·APP(Universal Link)
        APP->>è¯¦æƒ…é¡µ: 15. è·³è½¬åˆ°å›¾ç‰‡è¯¦æƒ…é¡µ
    else æœªå®‰è£…APP
        H5->>H5: 14. æ˜¾ç¤ºè½åœ°é¡µ+ä¸‹è½½å¼•å¯¼
    end
```

#### ğŸ›¡ï¸ æ¨¡å—4: ç³»ç»Ÿæ”¯æŒ (åŸºç¡€)

| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| å›¾ç‰‡å­˜å‚¨ | æœ¬åœ°å­˜å‚¨/å¯¹è±¡å­˜å‚¨(MinIO/é˜¿é‡Œäº‘OSS) | P0 |
| å›¾ç‰‡å‹ç¼© | è‡ªåŠ¨å‹ç¼©+ç¼©ç•¥å›¾ç”Ÿæˆ | P0 |
| ç”¨æˆ·ç»Ÿè®¡ | å‘å¸ƒæ•°/å…³æ³¨æ•°/ç²‰ä¸æ•°å†—ä½™è¡¨ | P0 |

---

### âŒ V1.0 MVP æš‚ä¸å®ç°

ä»¥ä¸‹åŠŸèƒ½å»¶ååˆ°åç»­ç‰ˆæœ¬:

| åŠŸèƒ½ | è®¡åˆ’ç‰ˆæœ¬ | åŸå›  |
|------|---------|------|
| è¯„è®ºç³»ç»Ÿ | V1.1 | MVPä¸“æ³¨æµè§ˆ+è½»äº’åŠ¨ |
| å†…å®¹å®¡æ ¸ | V1.1 | åˆæœŸç”¨æˆ·å°‘ï¼Œäººå·¥å·¡æŸ¥ |
| å›¾ç‰‡ç¼–è¾‘ | V1.2 | ä½¿ç”¨ç³»ç»Ÿç¼–è¾‘å™¨ |
| é€šçŸ¥ç³»ç»Ÿ | V1.1 | ä¾èµ–è¯„è®ºç³»ç»Ÿ |
| ç¬¬ä¸‰æ–¹ç™»å½• | V1.2 | ç®€åŒ–å¼€å‘æµç¨‹ |
| ç¬¬ä¸‰æ–¹åˆ†äº«SDK | V1.1 | MVPä½¿ç”¨URL Scheme |
| åœ°ç†ä½ç½® | V2.0 | éæ ¸å¿ƒåŠŸèƒ½ |
| è¯é¢˜æŒ‘æˆ˜ | V2.0 | è¿è¥å‘åŠŸèƒ½ |

---

## å››ã€æ•°æ®åº“è®¾è®¡ (MVPç²¾ç®€ç‰ˆ)

### è¡¨ç»“æ„æ€»è§ˆ

**9å¼ æ ¸å¿ƒè¡¨** (vs åŸè®¾è®¡14å¼ ï¼Œç²¾ç®€36%):

| è¡¨å | è¯´æ˜ | è®°å½•æ•°é¢„ä¼° |
|------|------|-----------|
| users | ç”¨æˆ·è¡¨ | ~1ä¸‡ |
| images | å›¾ç‰‡è¡¨ | ~10ä¸‡ |
| tags | æ ‡ç­¾è¡¨ | ~1000 |
| image_tags | å›¾ç‰‡æ ‡ç­¾å…³è”è¡¨ | ~50ä¸‡ |
| likes | ç‚¹èµè¡¨ | ~100ä¸‡ |
| favorites | æ”¶è—è¡¨ | ~50ä¸‡ |
| follows | å…³æ³¨è¡¨ | ~5ä¸‡ |
| user_stats | ç”¨æˆ·ç»Ÿè®¡è¡¨(å†—ä½™) | ~1ä¸‡ |
| share_links | åˆ†äº«é“¾æ¥è¡¨ | ~10ä¸‡ |

### æ ¸å¿ƒè¡¨è®¾è®¡

#### 1. ç”¨æˆ·è¡¨ (users)

```sql
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ç‰©ç†ä¸»é”®',
    user_id VARCHAR(36) NOT NULL UNIQUE COMMENT 'ä¸šåŠ¡é€»è¾‘ID',
    username VARCHAR(50) NOT NULL UNIQUE COMMENT 'ç”¨æˆ·å',
    password_hash VARCHAR(255) NOT NULL COMMENT 'å¯†ç å“ˆå¸Œ(PBKDF2)',
    email VARCHAR(100) UNIQUE COMMENT 'é‚®ç®±',
    phone VARCHAR(20) UNIQUE COMMENT 'æ‰‹æœºå·',
    avatar_url VARCHAR(500) COMMENT 'å¤´åƒURL',
    bio VARCHAR(500) COMMENT 'ä¸ªäººç®€ä»‹',
    status ENUM('ACTIVE', 'INACTIVE', 'BANNED') DEFAULT 'ACTIVE',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_username (username),
    INDEX idx_email (email),
    INDEX idx_phone (phone)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

**ç²¾ç®€è¯´æ˜**:
- âœ… å»æ‰`is_deleted`(ç›´æ¥ç¡¬åˆ é™¤ï¼Œç®€åŒ–é€»è¾‘)
- âœ… å»æ‰`last_login_time`(éæ ¸å¿ƒç»Ÿè®¡)
- âœ… ç»Ÿä¸€å¯†ç å­˜å‚¨åœ¨usersè¡¨ï¼Œä¸éœ€è¦ç‹¬ç«‹çš„user_authsè¡¨

#### 2. å›¾ç‰‡è¡¨ (images)

```sql
CREATE TABLE images (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    image_id VARCHAR(36) NOT NULL UNIQUE COMMENT 'ä¸šåŠ¡é€»è¾‘ID',
    user_id BIGINT NOT NULL COMMENT 'ä¸Šä¼ ç”¨æˆ·ID',
    title VARCHAR(255) NOT NULL COMMENT 'å›¾ç‰‡æ ‡é¢˜',
    description TEXT COMMENT 'å›¾ç‰‡æè¿°',
    file_url VARCHAR(500) NOT NULL COMMENT 'åŸå›¾URL',
    thumbnail_url VARCHAR(500) NOT NULL COMMENT 'ç¼©ç•¥å›¾URL',
    file_size BIGINT NOT NULL COMMENT 'æ–‡ä»¶å¤§å°(å­—èŠ‚)',
    width INT COMMENT 'å®½åº¦',
    height INT COMMENT 'é«˜åº¦',
    mime_type VARCHAR(50) NOT NULL COMMENT 'image/jpegç­‰',
    like_count INT DEFAULT 0 COMMENT 'ç‚¹èµæ•°(å†—ä½™)',
    favorite_count INT DEFAULT 0 COMMENT 'æ”¶è—æ•°(å†—ä½™)',
    view_count INT DEFAULT 0 COMMENT 'æµè§ˆæ•°',
    status ENUM('PENDING', 'APPROVED', 'REJECTED') DEFAULT 'APPROVED' COMMENT 'å®¡æ ¸çŠ¶æ€',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    INDEX idx_user_id (user_id),
    INDEX idx_status_create (status, create_time),
    INDEX idx_like_count (like_count),
    INDEX idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å›¾ç‰‡è¡¨';
```

**ä¼˜åŒ–è¯´æ˜**:
- âœ… å»æ‰`file_key`(ç›´æ¥ç”¨URL)
- âœ… å¢åŠ `thumbnail_url`(ç¼©ç•¥å›¾ç‹¬ç«‹å­˜å‚¨)
- âœ… `status`é»˜è®¤`APPROVED`(MVPæ— å®¡æ ¸)
- âœ… å»æ‰`is_deleted`(ç›´æ¥åˆ é™¤)
- âœ… å†—ä½™`like_count/favorite_count`æå‡æŸ¥è¯¢æ€§èƒ½

#### 3. æ ‡ç­¾è¡¨ (tags)

```sql
CREATE TABLE tags (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL UNIQUE COMMENT 'æ ‡ç­¾å(å¦‚"é£æ™¯")',
    use_count INT DEFAULT 0 COMMENT 'ä½¿ç”¨æ¬¡æ•°(å†—ä½™)',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_name (name),
    INDEX idx_use_count (use_count)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ ‡ç­¾è¡¨';
```

**ä¼˜åŒ–è¯´æ˜**:
- âœ… å»æ‰`tag_id`ä¸šåŠ¡ID(ç®€åŒ–æŸ¥è¯¢)
- âœ… å¢åŠ `use_count`ç»Ÿè®¡çƒ­é—¨æ ‡ç­¾

#### 4. å›¾ç‰‡æ ‡ç­¾å…³è”è¡¨ (image_tags)

```sql
CREATE TABLE image_tags (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    image_id BIGINT NOT NULL,
    tag_id BIGINT NOT NULL,
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (image_id) REFERENCES images(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE,
    UNIQUE KEY uk_image_tag (image_id, tag_id),
    INDEX idx_tag_id (tag_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å›¾ç‰‡æ ‡ç­¾å…³è”è¡¨';
```

#### 5. ç‚¹èµè¡¨ (likes)

```sql
CREATE TABLE likes (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL COMMENT 'ç‚¹èµç”¨æˆ·ID',
    image_id BIGINT NOT NULL COMMENT 'è¢«ç‚¹èµå›¾ç‰‡ID',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (image_id) REFERENCES images(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_image (user_id, image_id),
    INDEX idx_image_id (image_id),
    INDEX idx_user_create (user_id, create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç‚¹èµè¡¨';
```

**ä¼˜åŒ–è¯´æ˜**:
- âœ… å»æ‰`like_id`ä¸šåŠ¡ID(ç®€åŒ–è®¾è®¡)

#### 6. æ”¶è—è¡¨ (favorites)

```sql
CREATE TABLE favorites (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL COMMENT 'æ”¶è—ç”¨æˆ·ID',
    image_id BIGINT NOT NULL COMMENT 'è¢«æ”¶è—å›¾ç‰‡ID',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (image_id) REFERENCES images(id) ON DELETE CASCADE,
    UNIQUE KEY uk_user_image (user_id, image_id),
    INDEX idx_image_id (image_id),
    INDEX idx_user_create (user_id, create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ”¶è—è¡¨';
```

#### 7. å…³æ³¨è¡¨ (follows)

```sql
CREATE TABLE follows (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    follower_id BIGINT NOT NULL COMMENT 'å…³æ³¨è€…ID',
    followed_id BIGINT NOT NULL COMMENT 'è¢«å…³æ³¨è€…ID',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (follower_id) REFERENCES users(id) ON DELETE CASCADE,
    FOREIGN KEY (followed_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE KEY uk_follower_followed (follower_id, followed_id),
    INDEX idx_follower_id (follower_id),
    INDEX idx_followed_id (followed_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å…³æ³¨è¡¨';
```

#### 8. ç”¨æˆ·ç»Ÿè®¡è¡¨ (user_stats)

```sql
CREATE TABLE user_stats (
    user_id BIGINT PRIMARY KEY COMMENT 'å…³è”ç”¨æˆ·ID',
    image_count INT DEFAULT 0 COMMENT 'å‘å¸ƒå›¾ç‰‡æ•°',
    follower_count INT DEFAULT 0 COMMENT 'ç²‰ä¸æ•°',
    following_count INT DEFAULT 0 COMMENT 'å…³æ³¨æ•°',
    total_likes INT DEFAULT 0 COMMENT 'è·èµæ€»æ•°',
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·ç»Ÿè®¡è¡¨';
```

**è®¾è®¡è¯´æ˜**:
- âœ… å†—ä½™è®¾è®¡ï¼Œé¿å…é«˜é¢‘COUNTæŸ¥è¯¢
- âœ… é€šè¿‡è§¦å‘å™¨æˆ–å®šæ—¶ä»»åŠ¡æ›´æ–°ç»Ÿè®¡æ•°æ®

#### 9. åˆ†äº«é“¾æ¥è¡¨ (share_links)

```sql
CREATE TABLE share_links (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    short_code VARCHAR(10) NOT NULL UNIQUE COMMENT 'çŸ­é“¾æ¥ç (å¦‚ABC123)',
    target_type ENUM('IMAGE', 'USER', 'TAG') NOT NULL COMMENT 'åˆ†äº«ç›®æ ‡ç±»å‹',
    target_id BIGINT NOT NULL COMMENT 'ç›®æ ‡ID',
    creator_id BIGINT COMMENT 'åˆ›å»ºè€…ID',
    visit_count INT DEFAULT 0 COMMENT 'è®¿é—®æ¬¡æ•°',
    install_count INT DEFAULT 0 COMMENT 'å¸¦æ¥çš„å®‰è£…æ¬¡æ•°',
    share_platform VARCHAR(20) COMMENT 'åˆ†äº«å¹³å°(wechat/weibo/qq)',
    create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    expire_time DATETIME COMMENT 'è¿‡æœŸæ—¶é—´(å¯é€‰)',
    FOREIGN KEY (creator_id) REFERENCES users(id) ON DELETE SET NULL,
    INDEX idx_short_code (short_code),
    INDEX idx_target (target_type, target_id),
    INDEX idx_creator (creator_id),
    INDEX idx_create_time (create_time)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='åˆ†äº«é“¾æ¥è¡¨';
```

**è®¾è®¡è¯´æ˜**:
- âœ… `short_code`ä½¿ç”¨Base62ç¼–ç (0-9/A-Z/a-z)ï¼Œ8ä½å¯æ”¯æŒ62^8â‰ˆ218ä¸‡äº¿æ¡è®°å½•
- âœ… `target_type`æ”¯æŒå¤šç§åˆ†äº«å¯¹è±¡(å›¾ç‰‡/ç”¨æˆ·/æ ‡ç­¾)ï¼Œæ‰©å±•æ€§å¼º
- âœ… `visit_count`å’Œ`install_count`ç”¨äºæ•°æ®åˆ†æå’Œè¿è¥ä¼˜åŒ–
- âœ… `expire_time`æ”¯æŒä¸´æ—¶åˆ†äº«é“¾æ¥(å¦‚æ´»åŠ¨ä¸“å±é“¾æ¥)

### ERå›¾

```mermaid
erDiagram
    users ||--o{ images : "å‘å¸ƒ"
    users ||--o{ likes : "ç‚¹èµ"
    users ||--o{ favorites : "æ”¶è—"
    users ||--o{ follows : "å…³æ³¨è€…"
    users ||--o{ follows : "è¢«å…³æ³¨"
    users ||--|| user_stats : "ç»Ÿè®¡"
    users ||--o{ share_links : "åˆ›å»º"

    images ||--o{ image_tags : "æ ‡ç­¾"
    images ||--o{ likes : "è¢«ç‚¹èµ"
    images ||--o{ favorites : "è¢«æ”¶è—"
    images ||--o{ share_links : "è¢«åˆ†äº«"

    tags ||--o{ image_tags : "å›¾ç‰‡"

    users {
        bigint id PK
        varchar user_id UK
        varchar username UK
        varchar password_hash
        varchar email UK
        varchar phone UK
        varchar avatar_url
        varchar bio
        enum status
    }

    images {
        bigint id PK
        varchar image_id UK
        bigint user_id FK
        varchar title
        text description
        varchar file_url
        varchar thumbnail_url
        int like_count
        int favorite_count
        int view_count
        enum status
    }

    tags {
        bigint id PK
        varchar name UK
        int use_count
    }

    likes {
        bigint id PK
        bigint user_id FK
        bigint image_id FK
        datetime create_time
    }

    favorites {
        bigint id PK
        bigint user_id FK
        bigint image_id FK
        datetime create_time
    }

    follows {
        bigint id PK
        bigint follower_id FK
        bigint followed_id FK
        datetime create_time
    }

    user_stats {
        bigint user_id PK_FK
        int image_count
        int follower_count
        int following_count
        int total_likes
    }

    share_links {
        bigint id PK
        varchar short_code UK
        enum target_type
        bigint target_id
        bigint creator_id FK
        int visit_count
        int install_count
        varchar share_platform
        datetime expire_time
    }
```

---

## äº”ã€APIæ¥å£è®¾è®¡

### æ¥å£è§„èŒƒ

**è¯·æ±‚æ ¼å¼**:
- åè®®: HTTP/HTTPS
- è®¤è¯: JWT Bearer Token (é™¤æ³¨å†Œ/ç™»å½•å¤–æ‰€æœ‰æ¥å£éœ€è¦)
- Content-Type: `application/json`

**å“åº”æ ¼å¼**:
```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": { ... },
  "timestamp": 1696147200
}
```

**é”™è¯¯ç **:
| Code | è¯´æ˜ |
|------|------|
| 200 | æˆåŠŸ |
| 400 | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | æœªè®¤è¯ |
| 403 | æ— æƒé™ |
| 404 | èµ„æºä¸å­˜åœ¨ |
| 500 | æœåŠ¡å™¨é”™è¯¯ |

### APIæ¸…å•

#### 1. ç”¨æˆ·è®¤è¯æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| æ³¨å†Œ | POST | `/api/v1/auth/register` | ç”¨æˆ·æ³¨å†Œ |
| ç™»å½• | POST | `/api/v1/auth/login` | ç”¨æˆ·ç™»å½• |
| åˆ·æ–°ä»¤ç‰Œ | POST | `/api/v1/auth/refresh` | åˆ·æ–°Token |
| è·å–ç”¨æˆ·ä¿¡æ¯ | GET | `/api/v1/auth/me` | è·å–å½“å‰ç”¨æˆ· |
| æ›´æ–°ç”¨æˆ·èµ„æ–™ | PUT | `/api/v1/auth/profile` | ç¼–è¾‘å¤´åƒ/ç®€ä»‹ |

**ç¤ºä¾‹: æ³¨å†Œæ¥å£**
```http
POST /api/v1/auth/register
Content-Type: application/json

{
  "username": "john_doe",
  "email": "john@example.com",
  "password": "SecurePass123"
}

// å“åº”
{
  "success": true,
  "data": {
    "user_id": "USR_2025_ABC123",
    "username": "john_doe",
    "access_token": "eyJhbGciOiJIUzI1NiIs...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIs..."
  }
}
```

#### 2. å›¾ç‰‡ç®¡ç†æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ä¸Šä¼ å›¾ç‰‡ | POST | `/api/v1/images` | ä¸Šä¼ å›¾ç‰‡ |
| è·å–å›¾ç‰‡è¯¦æƒ… | GET | `/api/v1/images/:id` | å›¾ç‰‡è¯¦æƒ… |
| ç¼–è¾‘å›¾ç‰‡ | PUT | `/api/v1/images/:id` | ç¼–è¾‘æ ‡é¢˜/æè¿°/æ ‡ç­¾ |
| åˆ é™¤å›¾ç‰‡ | DELETE | `/api/v1/images/:id` | åˆ é™¤å›¾ç‰‡ |
| ç”¨æˆ·å›¾ç‰‡åˆ—è¡¨ | GET | `/api/v1/users/:id/images` | æŸç”¨æˆ·çš„å›¾ç‰‡ |

**ç¤ºä¾‹: ä¸Šä¼ å›¾ç‰‡**
```http
POST /api/v1/images
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
Content-Type: multipart/form-data

{
  "image": <binary>,
  "title": "æ—¥è½",
  "description": "ä»Šå¤©åœ¨æµ·è¾¹æ‹çš„",
  "tags": ["é£æ™¯", "æ—¥è½", "å¤§æµ·"]
}

// å“åº”
{
  "success": true,
  "data": {
    "image_id": "IMG_2025_XYZ789",
    "file_url": "https://cdn.knot.com/images/abc123.jpg",
    "thumbnail_url": "https://cdn.knot.com/thumbs/abc123.jpg"
  }
}
```

#### 3. Feedæµæ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| æ¨èFeed | GET | `/api/v1/feed` | é¦–é¡µæ¨è |
| å…³æ³¨Feed | GET | `/api/v1/feed/following` | å…³æ³¨ç”¨æˆ·çš„å›¾ç‰‡ |
| æœç´¢å›¾ç‰‡ | GET | `/api/v1/search?tag=é£æ™¯` | æŒ‰æ ‡ç­¾æœç´¢ |
| çƒ­é—¨æ ‡ç­¾ | GET | `/api/v1/tags/trending` | çƒ­é—¨æ ‡ç­¾åˆ—è¡¨ |

**ç¤ºä¾‹: è·å–Feed**
```http
GET /api/v1/feed?page=1&limit=20
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...

// å“åº”
{
  "success": true,
  "data": {
    "images": [
      {
        "image_id": "IMG_2025_XYZ789",
        "title": "æ—¥è½",
        "thumbnail_url": "https://cdn.knot.com/thumbs/abc123.jpg",
        "user": {
          "user_id": "USR_2025_ABC123",
          "username": "john_doe",
          "avatar_url": "https://cdn.knot.com/avatars/123.jpg"
        },
        "like_count": 42,
        "favorite_count": 15,
        "tags": ["é£æ™¯", "æ—¥è½"]
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 1000,
      "has_more": true
    }
  }
}
```

#### 4. äº’åŠ¨æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç‚¹èµ | POST | `/api/v1/images/:id/like` | ç‚¹èµå›¾ç‰‡ |
| å–æ¶ˆç‚¹èµ | DELETE | `/api/v1/images/:id/like` | å–æ¶ˆç‚¹èµ |
| æ”¶è— | POST | `/api/v1/images/:id/favorite` | æ”¶è—å›¾ç‰‡ |
| å–æ¶ˆæ”¶è— | DELETE | `/api/v1/images/:id/favorite` | å–æ¶ˆæ”¶è— |
| å…³æ³¨ç”¨æˆ· | POST | `/api/v1/users/:id/follow` | å…³æ³¨ |
| å–æ¶ˆå…³æ³¨ | DELETE | `/api/v1/users/:id/follow` | å–å…³ |
| æˆ‘çš„ç‚¹èµ | GET | `/api/v1/me/likes` | æˆ‘ç‚¹èµçš„å›¾ç‰‡ |
| æˆ‘çš„æ”¶è— | GET | `/api/v1/me/favorites` | æˆ‘çš„æ”¶è— |
| å…³æ³¨åˆ—è¡¨ | GET | `/api/v1/users/:id/following` | å…³æ³¨çš„äºº |
| ç²‰ä¸åˆ—è¡¨ | GET | `/api/v1/users/:id/followers` | ç²‰ä¸ |

#### 5. åˆ†äº«æ¥å£

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç”Ÿæˆåˆ†äº«é“¾æ¥ | POST | `/api/v1/images/:id/share` | åˆ›å»ºåˆ†äº«çŸ­é“¾æ¥ |
| è§£æåˆ†äº«é“¾æ¥ | GET | `/api/v1/share/:code` | è·å–åˆ†äº«ç›®æ ‡ä¿¡æ¯(å…¬å¼€) |
| åˆ†äº«ç»Ÿè®¡ | GET | `/api/v1/share/:code/stats` | æŸ¥çœ‹åˆ†äº«æ•°æ®(ä»…åˆ›å»ºè€…) |

**ç¤ºä¾‹: ç”Ÿæˆåˆ†äº«é“¾æ¥**
```http
POST /api/v1/images/IMG_2025_XYZ789/share
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
Content-Type: application/json

{
  "platform": "wechat"  // wechat/weibo/qq/copy_link
}

// å“åº”
{
  "success": true,
  "data": {
    "short_link": "https://knot.app/s/ABC123",
    "short_code": "ABC123",
    "qr_code_url": "https://api.knot.app/qrcode/ABC123.png",
    "expire_time": null
  }
}
```

**ç¤ºä¾‹: è§£æåˆ†äº«é“¾æ¥**
```http
GET /api/v1/share/ABC123
// æ— éœ€è®¤è¯ï¼Œå…¬å¼€æ¥å£

// å“åº”
{
  "success": true,
  "data": {
    "target_type": "IMAGE",
    "target_id": 12345,
    "image": {
      "image_id": "IMG_2025_XYZ789",
      "title": "æ—¥è½",
      "description": "ä»Šå¤©åœ¨æµ·è¾¹æ‹çš„",
      "file_url": "https://cdn.knot.com/images/abc123.jpg",
      "thumbnail_url": "https://cdn.knot.com/thumbs/abc123.jpg",
      "user": {
        "user_id": "USR_2025_ABC123",
        "username": "john_doe",
        "avatar_url": "https://cdn.knot.com/avatars/123.jpg"
      },
      "like_count": 42,
      "favorite_count": 15,
      "tags": ["é£æ™¯", "æ—¥è½"]
    },
    "deep_link": {
      "ios": "knot://i/12345",
      "android": "knot://i/12345"
    }
  }
}
```

---

## å…­ã€æŠ€æœ¯æ–¹æ¡ˆ

### 1. åç«¯æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| C++ | 17 | é«˜æ€§èƒ½åç«¯ |
| MySQL | 8.0+ | ä¸»æ•°æ®åº“ |
| cpp-httplib | 0.11.0 | HTTPæœåŠ¡å™¨ |
| jwt-cpp | 0.6.0 | JWTè®¤è¯ |
| JsonCpp | 1.9.5 | JSONå¤„ç† |
| OpenSSL | 1.1.1 | å¯†ç å“ˆå¸Œ |
| spdlog | 1.9.2 | æ—¥å¿— |

### 2. å›¾ç‰‡å­˜å‚¨æ–¹æ¡ˆ

**é˜¶æ®µ1(MVP)**: æœ¬åœ°å­˜å‚¨
- åŸå›¾: `/var/www/knot/images/original/`
- ç¼©ç•¥å›¾: `/var/www/knot/images/thumbnails/`
- é€šè¿‡Nginxæä¾›é™æ€æ–‡ä»¶æœåŠ¡

**é˜¶æ®µ2(V1.1+)**: å¯¹è±¡å­˜å‚¨
- è¿ç§»åˆ°MinIO/é˜¿é‡Œäº‘OSS/è…¾è®¯äº‘COS
- ä½¿ç”¨CDNåŠ é€Ÿè®¿é—®

### 3. å›¾ç‰‡å¤„ç†æµç¨‹

```cpp
// ä¼ªä»£ç 
class ImageProcessor {
public:
    ProcessedImage process(const RawImage& raw) {
        // 1. éªŒè¯æ ¼å¼
        validateFormat(raw);

        // 2. å‹ç¼©åŸå›¾(è´¨é‡80%)
        auto compressed = compress(raw, 0.8);

        // 3. ç”Ÿæˆç¼©ç•¥å›¾(300x300)
        auto thumbnail = generateThumbnail(compressed, 300, 300);

        // 4. ä¿å­˜æ–‡ä»¶
        auto originalUrl = storage->save(compressed, "original");
        auto thumbnailUrl = storage->save(thumbnail, "thumbnails");

        return {originalUrl, thumbnailUrl};
    }
};
```

### 4. Feedæ¨èç®—æ³•(MVPç®€åŒ–ç‰ˆ)

**æ’åºå…¬å¼**:
```
çƒ­åº¦åˆ†æ•° = (ç‚¹èµæ•° * 0.7 + æ”¶è—æ•° * 0.3)
æ—¶é—´è¡°å‡ = 1 / ((å½“å‰æ—¶é—´ - å‘å¸ƒæ—¶é—´å°æ—¶æ•°) + 2) ^ 1.5
æœ€ç»ˆåˆ†æ•° = çƒ­åº¦åˆ†æ•° * æ—¶é—´è¡°å‡
```

**SQLå®ç°**:
```sql
SELECT i.*
FROM images i
WHERE i.status = 'APPROVED'
ORDER BY
  (i.like_count * 0.7 + i.favorite_count * 0.3) /
  POW(TIMESTAMPDIFF(HOUR, i.create_time, NOW()) + 2, 1.5) DESC
LIMIT 20 OFFSET 0;
```

### 5. åˆ†äº«é“¾æ¥Deep Linkæ–¹æ¡ˆ

#### 5.1 çŸ­é“¾æ¥ç”Ÿæˆç®—æ³•

**æŠ€æœ¯é€‰å‹**: é›ªèŠ±ç®—æ³• + Base62ç¼–ç 

```cpp
class ShareLinkGenerator {
private:
    const char* BASE62_CHARS =
        "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";

public:
    // ç”ŸæˆçŸ­é“¾æ¥
    std::string generate(const std::string& targetType, int64_t targetId,
                        int64_t creatorId, const std::string& platform) {
        // 1. ç”Ÿæˆé›ªèŠ±ID (ä¿è¯å…¨å±€å”¯ä¸€)
        int64_t snowflakeId = SnowflakeIdGenerator::getInstance().nextId();

        // 2. Base62ç¼–ç  (å–å‰8ä½)
        std::string shortCode = base62Encode(snowflakeId).substr(0, 8);

        // 3. ä¿å­˜åˆ°æ•°æ®åº“
        ShareLink link;
        link.shortCode = shortCode;
        link.targetType = targetType;
        link.targetId = targetId;
        link.creatorId = creatorId;
        link.sharePlatform = platform;
        repository->save(link);

        return "https://knot.app/s/" + shortCode;
    }

private:
    std::string base62Encode(int64_t num) {
        if (num == 0) return "0";

        std::string result;
        while (num > 0) {
            result = BASE62_CHARS[num % 62] + result;
            num /= 62;
        }
        return result;
    }
};
```

#### 5.2 Deep Linké…ç½®

**iOS Universal Links**:

æœåŠ¡å™¨é…ç½® `https://knot.app/.well-known/apple-app-site-association`:
```json
{
  "applinks": {
    "apps": [],
    "details": [{
      "appID": "TEAMID.com.knot.app",
      "paths": ["/s/*", "/i/*", "/u/*"]
    }]
  }
}
```

**Android App Links**:

æœåŠ¡å™¨é…ç½® `https://knot.app/.well-known/assetlinks.json`:
```json
[{
  "relation": ["delegate_permission/common.handle_all_urls"],
  "target": {
    "namespace": "android_app",
    "package_name": "com.knot.app",
    "sha256_cert_fingerprints": ["YOUR_CERT_FINGERPRINT"]
  }
}]
```

#### 5.3 H5è½åœ°é¡µè®¾è®¡

**ç”¨é€”**: æœªå®‰è£…APPç”¨æˆ·çš„å¼•å¯¼é¡µ

**æ ¸å¿ƒåŠŸèƒ½**:
1. å±•ç¤ºåˆ†äº«å†…å®¹(å›¾ç‰‡é¢„è§ˆ+ä½œè€…ä¿¡æ¯)
2. æ™ºèƒ½å”¤èµ·APP(å·²å®‰è£…ç”¨æˆ·)
3. ä¸‹è½½å¼•å¯¼(æœªå®‰è£…ç”¨æˆ·)
4. OpenGraphæ ‡ç­¾(ç¤¾äº¤å¹³å°é¢„è§ˆä¼˜åŒ–)

**æŠ€æœ¯å®ç°**:
```html
<!DOCTYPE html>
<html>
<head>
    <meta property="og:title" content="æ—¥è½ - Knot">
    <meta property="og:image" content="https://cdn.knot.com/thumbs/abc123.jpg">
    <meta property="og:description" content="ä»Šå¤©åœ¨æµ·è¾¹æ‹çš„">
</head>
<body>
    <script>
        // æ™ºèƒ½å”¤èµ·APP
        const ua = navigator.userAgent;
        const isIOS = /iPhone|iPad|iPod/i.test(ua);
        const isAndroid = /Android/i.test(ua);

        function openApp() {
            if (isIOS) {
                window.location.href = 'knot://s/ABC123';
                setTimeout(() => {
                    window.location.href = 'https://apps.apple.com/app/knot/id...';
                }, 2000);
            } else if (isAndroid) {
                window.location.href = 'knot://s/ABC123';
                setTimeout(() => {
                    window.location.href = 'https://play.google.com/store/apps/...';
                }, 2000);
            }
        }
    </script>
</body>
</html>
```

#### 5.4 ç¤¾äº¤å¹³å°å¿«æ·åˆ†äº«

**æ— éœ€SDKæ–¹æ¡ˆ** (URL Scheme):

```javascript
const shareUrls = {
    // å¾®åš
    weibo: (link, title) =>
        `https://service.weibo.com/share/share.php?url=${encodeURIComponent(link)}&title=${encodeURIComponent(title)}`,

    // QQ
    qq: (link, title) =>
        `mqqapi://share/to_fri?src_type=web&version=1&file_type=news&url=${encodeURIComponent(link)}&title=${encodeURIComponent(title)}`,

    // Twitter
    twitter: (link, title) =>
        `https://twitter.com/intent/tweet?url=${encodeURIComponent(link)}&text=${encodeURIComponent(title)}`,

    // å¾®ä¿¡ï¼šå¤åˆ¶é“¾æ¥+å¼•å¯¼
    wechat: (link) => {
        navigator.clipboard.writeText(link);
        alert('é“¾æ¥å·²å¤åˆ¶ï¼Œè¯·æ‰“å¼€å¾®ä¿¡ç²˜è´´åˆ†äº«');
    }
};
```

#### 5.5 åˆ†äº«æ•°æ®ç»Ÿè®¡

**è¿½è¸ªæŒ‡æ ‡**:
- åˆ†äº«æ¬¡æ•°
- ç‚¹å‡»æ¬¡æ•° (visit_count)
- è½¬åŒ–æ¬¡æ•° (install_count)
- åˆ†äº«å¹³å°åˆ†å¸ƒ
- æœ€å—æ¬¢è¿å†…å®¹

**åˆ†æSQL**:
```sql
-- åˆ†äº«æ¼æ–—åˆ†æ
SELECT
    share_platform AS å¹³å°,
    COUNT(*) AS åˆ†äº«æ¬¡æ•°,
    SUM(visit_count) AS ç‚¹å‡»æ¬¡æ•°,
    SUM(install_count) AS å¸¦æ¥å®‰è£…,
    ROUND(SUM(install_count) * 100.0 / NULLIF(SUM(visit_count), 0), 2) AS è½¬åŒ–ç‡
FROM share_links
WHERE create_time >= DATE_SUB(NOW(), INTERVAL 7 DAY)
GROUP BY share_platform
ORDER BY åˆ†äº«æ¬¡æ•° DESC;
```

---

## ä¸ƒã€æ€§èƒ½æŒ‡æ ‡

### MVPæ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯´æ˜ |
|------|--------|------|
| å¹¶å‘ç”¨æˆ·æ•° | 100+ | åŒæ—¶åœ¨çº¿ç”¨æˆ· |
| APIå“åº”æ—¶é—´ | <100ms | P95 |
| å›¾ç‰‡ä¸Šä¼ æ—¶é—´ | <3s | 5MBå›¾ç‰‡ |
| FeedåŠ è½½æ—¶é—´ | <500ms | é¦–å±20å¼ å›¾ |
| æ•°æ®åº“QPS | 500+ | æŸ¥è¯¢æ¯ç§’ |

---

## å…«ã€å¼€å‘è®¡åˆ’

### è¿ç§»å·¥ä½œé‡ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | å·¥ä½œé‡ |
|------|------|--------|
| é˜¶æ®µ1 | æ¸…ç†åœè½¦ä½æ¨¡å— | 0.5å¤© |
| é˜¶æ®µ2 | ç²¾ç®€ç”¨æˆ·æ¨¡å— | 1å¤© |
| é˜¶æ®µ3 | å®ç°å›¾ç‰‡æ¨¡å— | 3å¤© |
| é˜¶æ®µ4 | å®ç°äº’åŠ¨æ¨¡å—(ç‚¹èµ/æ”¶è—/å…³æ³¨) | 2å¤© |
| é˜¶æ®µ5 | å®ç°åˆ†äº«åŠŸèƒ½(çŸ­é“¾æ¥+Deep Link) | 1.5å¤© |
| é˜¶æ®µ6 | å®ç°Feedæµæ¨è | 1å¤© |
| é˜¶æ®µ7 | H5è½åœ°é¡µå¼€å‘ | 0.5å¤© |
| é˜¶æ®µ8 | æµ‹è¯•ä¸ä¼˜åŒ– | 1å¤© |
| **æ€»è®¡** | | **10.5å¤©** |

### é‡Œç¨‹ç¢‘

- **Week 1**: å®Œæˆæ•°æ®åº“è®¾è®¡+ç”¨æˆ·æ¨¡å—è¿ç§»
- **Week 2**: å®Œæˆå›¾ç‰‡ä¸Šä¼ +æµè§ˆåŠŸèƒ½+åˆ†äº«ç³»ç»Ÿ
- **Week 3**: å®Œæˆäº’åŠ¨ç³»ç»Ÿ+Feedæ¨è+H5è½åœ°é¡µ
- **Week 4**: æµ‹è¯•+ä¼˜åŒ–+ä¸Šçº¿

---

## ä¹ã€åç»­ç‰ˆæœ¬è§„åˆ’

### V1.1 (MVP+1ä¸ªæœˆ)
- âœ… è¯„è®ºç³»ç»Ÿ
- âœ… é€šçŸ¥ä¸­å¿ƒ
- âœ… å†…å®¹å®¡æ ¸(æ¥å…¥ç¬¬ä¸‰æ–¹API)
- âœ… ç¬¬ä¸‰æ–¹åˆ†äº«SDK(å¾®ä¿¡SDK/å¾®åšSDK)
- âœ… åˆ†äº«æµ·æŠ¥ç”Ÿæˆ(å¸¦äºŒç»´ç )

### V1.2 (MVP+3ä¸ªæœˆ)
- âœ… å›¾ç‰‡ç¼–è¾‘å™¨(æ»¤é•œ/è£å‰ª)
- âœ… ç¬¬ä¸‰æ–¹ç™»å½•(å¾®ä¿¡/QQ)
- âœ… é‚€è¯·ç ç³»ç»Ÿ(åˆ†äº«èµšç§¯åˆ†)

### V2.0 (MVP+6ä¸ªæœˆ)
- âœ… è¯é¢˜æŒ‘æˆ˜
- âœ… åˆ›ä½œè€…æ¿€åŠ±è®¡åˆ’
- âœ… å¹¿å‘Šç³»ç»Ÿ

---

## åã€é™„å½•

### A. æ•°æ®åº“å®Œæ•´å»ºè¡¨SQL

è§ `database/init.sql` æ–‡ä»¶

### B. ä¸åŸéœ€æ±‚å¯¹æ¯”

| ç»´åº¦ | åŸéœ€æ±‚ | MVPç‰ˆæœ¬ | å˜åŒ– |
|------|--------|---------|------|
| æ•°æ®è¡¨æ•°é‡ | 14å¼  | 9å¼  | -36% |
| æ ¸å¿ƒåŠŸèƒ½ | 9ä¸ªæ¨¡å— | 4ä¸ªæ¨¡å—(å«åˆ†äº«) | èšç„¦æ ¸å¿ƒ |
| å¼€å‘å‘¨æœŸ | ~4å‘¨ | ~2.5å‘¨ | å¿«é€ŸéªŒè¯ |
| å¤æ‚åº¦ | é«˜ | ä¸­ | é™ä½é£é™© |

### C. å¯å¤ç”¨èµ„æº

**100%å¤ç”¨**:
- å®‰å…¨å±‚(JWT/å¯†ç å“ˆå¸Œ)
- åŸºç¡€è®¾æ–½(è¿æ¥æ± /æ—¥å¿—/é…ç½®)
- HTTPæœåŠ¡å™¨

**90%å¤ç”¨**:
- ç”¨æˆ·ç®¡ç†æ¨¡å—

**å…¨æ–°å¼€å‘**:
- å›¾ç‰‡ç®¡ç†+äº’åŠ¨+Feed

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-10-07
**ç»´æŠ¤è€…**: Knot Team
